<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Metatables and Metamethods</title>

    <link rel="alternate" href="https://campusempresa.com/lua/metatables-and-metamethods" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/lua/metatables-and-metamethods" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/lua/metatables-and-metamethods" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body>
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-8 p-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo_header.png" style="visibility:hiddenxx;"></a>
			</h1>
		</div>
		<div class="col-4 p-0 text-end">
			<h2 id="main_title"><cite>Building today's and tomorrow's society</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-0 m-0 text-end">
													<b id="lit_lang_es" class="px-2">EN</b>
				|
				<a href="https://campusempresa.com/lua/metatables-and-metamethods" class="px-2">ES</a></b>
				|
				<a href="https://campusempresa.cat/lua/metatables-and-metamethods" class="px-2">CA</a>
					</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="/objective">The Project</a>
				<a href="/about">About Us</a>
				<a href="/contribute">Contribute</a>
				<a href="/donate">Donations</a>
				<a href="/licence">License</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content"><div class='row navigation'>
	<div class='col-4'>
					<a href='dictionaries'>&#x25C4;Dictionaries</a>
			</div>
	<div class='col-4 text-center'>
		<a href="./" class="title">Metatables and Metamethods</a>
	</div>
	<div class='col-4 text-end'>
					<a href='closures'>Closures &#x25BA;</a>
			</div>
</div>
<div class='content'></div><h1>Introduction to Metatables</h1>
<div class='content'><p>Metatables in Lua provide a powerful way to change the behavior of tables. They allow you to define custom behaviors for standard operations like addition, subtraction, and even table indexing.</p>
<ul>
<li>
<p><strong>What is a Metatable?</strong>
A metatable is a table that can change the behavior of another table. It acts as a blueprint for how a table should behave under certain conditions.</p>
</li>
<li>
<p><strong>Setting a Metatable</strong>
You can set a metatable for a table using the <code>setmetatable</code> function.</p>
</li>
</ul>
</div><h2>Example</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("bG9jYWwgbXlUYWJsZSA9IHt9CmxvY2FsIG15TWV0YXRhYmxlID0ge30KCnNldG1ldGF0YWJsZShteVRhYmxlLCBteU1ldGF0YWJsZSk="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>local myTable = {}
local myMetatable = {}

setmetatable(myTable, myMetatable)</pre></div><div class='content'><p>In this example, <code>myTable</code> now has <code>myMetatable</code> as its metatable.</p>
</div><h1>Metamethods</h1>
<div class='content'><p>Metamethods are special functions that can be defined in a metatable to change the behavior of a table. They are identified by specific keys in the metatable.</p>
<ul>
<li><strong>Common Metamethods</strong>
<ul>
<li><code>__index</code>: Customizes table indexing.</li>
<li><code>__newindex</code>: Customizes table assignment.</li>
<li><code>__add</code>: Customizes the addition operation.</li>
<li><code>__sub</code>: Customizes the subtraction operation.</li>
<li><code>__mul</code>: Customizes the multiplication operation.</li>
<li><code>__div</code>: Customizes the division operation.</li>
<li><code>__tostring</code>: Customizes the string representation of a table.</li>
</ul>
</li>
</ul>
</div><h2>Example: Custom Indexing</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("bG9jYWwgbXlUYWJsZSA9IHthID0gMSwgYiA9IDJ9CmxvY2FsIG15TWV0YXRhYmxlID0gewogICAgX19pbmRleCA9IGZ1bmN0aW9uKHRhYmxlLCBrZXkpCiAgICAgICAgaWYga2V5ID09ICJjIiB0aGVuCiAgICAgICAgICAgIHJldHVybiAzCiAgICAgICAgZWxzZQogICAgICAgICAgICByZXR1cm4gbmlsCiAgICAgICAgZW5kCiAgICBlbmQKfQoKc2V0bWV0YXRhYmxlKG15VGFibGUsIG15TWV0YXRhYmxlKQoKcHJpbnQobXlUYWJsZS5hKSAgLS0gT3V0cHV0OiAxCnByaW50KG15VGFibGUuYykgIC0tIE91dHB1dDogMw=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>local myTable = {a = 1, b = 2}
local myMetatable = {
    __index = function(table, key)
        if key == &quot;c&quot; then
            return 3
        else
            return nil
        end
    end
}

setmetatable(myTable, myMetatable)

print(myTable.a)  -- Output: 1
print(myTable.c)  -- Output: 3</pre></div><div class='content'><p>In this example, accessing <code>myTable.c</code> returns <code>3</code> because of the custom <code>__index</code> metamethod.</p>
</div><h1>Advanced Metamethods</h1>
<div class='content'><p>For more advanced use cases, you can define metamethods for arithmetic operations, concatenation, and more.</p>
</div><h2>Example: Custom Addition</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("bG9jYWwgdmVjdG9yMSA9IHt4ID0gMSwgeSA9IDJ9CmxvY2FsIHZlY3RvcjIgPSB7eCA9IDMsIHkgPSA0fQoKbG9jYWwgdmVjdG9yTWV0YXRhYmxlID0gewogICAgX19hZGQgPSBmdW5jdGlvbih2MSwgdjIpCiAgICAgICAgcmV0dXJuIHt4ID0gdjEueCArIHYyLngsIHkgPSB2MS55ICsgdjIueX0KICAgIGVuZAp9CgpzZXRtZXRhdGFibGUodmVjdG9yMSwgdmVjdG9yTWV0YXRhYmxlKQpzZXRtZXRhdGFibGUodmVjdG9yMiwgdmVjdG9yTWV0YXRhYmxlKQoKbG9jYWwgcmVzdWx0ID0gdmVjdG9yMSArIHZlY3RvcjIKcHJpbnQocmVzdWx0LngsIHJlc3VsdC55KSAgLS0gT3V0cHV0OiA0IDY="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>local vector1 = {x = 1, y = 2}
local vector2 = {x = 3, y = 4}

local vectorMetatable = {
    __add = function(v1, v2)
        return {x = v1.x + v2.x, y = v1.y + v2.y}
    end
}

setmetatable(vector1, vectorMetatable)
setmetatable(vector2, vectorMetatable)

local result = vector1 + vector2
print(result.x, result.y)  -- Output: 4 6</pre></div><div class='content'><p>In this example, adding <code>vector1</code> and <code>vector2</code> results in a new table with the sum of their <code>x</code> and <code>y</code> values.</p>
</div><h1>Practical Use Cases</h1>
<div class='content'><p>Metatables and metamethods can be used to:</p>
<ul>
<li>Implement object-oriented programming.</li>
<li>Create read-only tables.</li>
<li>Define custom behaviors for mathematical operations.</li>
<li>Control access to table elements.</li>
</ul>
</div><h2>Example: Read-Only Table</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("bG9jYWwgZnVuY3Rpb24gcmVhZG9ubHkodGFibGUpCiAgICBsb2NhbCBwcm94eSA9IHt9CiAgICBsb2NhbCBtdCA9IHsKICAgICAgICBfX2luZGV4ID0gdGFibGUsCiAgICAgICAgX19uZXdpbmRleCA9IGZ1bmN0aW9uKHQsIGtleSwgdmFsdWUpCiAgICAgICAgICAgIGVycm9yKCJBdHRlbXB0IHRvIG1vZGlmeSByZWFkLW9ubHkgdGFibGUiKQogICAgICAgIGVuZAogICAgfQogICAgc2V0bWV0YXRhYmxlKHByb3h5LCBtdCkKICAgIHJldHVybiBwcm94eQplbmQKCmxvY2FsIG9yaWdpbmFsVGFibGUgPSB7YSA9IDEsIGIgPSAyfQpsb2NhbCByb1RhYmxlID0gcmVhZG9ubHkob3JpZ2luYWxUYWJsZSkKCnByaW50KHJvVGFibGUuYSkgIC0tIE91dHB1dDogMQpyb1RhYmxlLmEgPSAxMCAgICAtLSBFcnJvcjogQXR0ZW1wdCB0byBtb2RpZnkgcmVhZC1vbmx5IHRhYmxl"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>local function readonly(table)
    local proxy = {}
    local mt = {
        __index = table,
        __newindex = function(t, key, value)
            error(&quot;Attempt to modify read-only table&quot;)
        end
    }
    setmetatable(proxy, mt)
    return proxy
end

local originalTable = {a = 1, b = 2}
local roTable = readonly(originalTable)

print(roTable.a)  -- Output: 1
roTable.a = 10    -- Error: Attempt to modify read-only table</pre></div><div class='content'><p>In this example, <code>roTable</code> is a read-only version of <code>originalTable</code>.</p>
</div><h1>Conclusion</h1>
<div class='content'><p>Metatables and metamethods in Lua provide a flexible way to customize the behavior of tables. By understanding and utilizing these features, you can create more powerful and efficient Lua programs. Whether you are implementing custom behaviors for arithmetic operations or creating read-only tables, metatables and metamethods are essential tools in your Lua programming toolkit.</p>
</div><div class='row navigation'>
	<div class='col-4'>
					<a href='dictionaries'>&#x25C4;Dictionaries</a>
			</div>
	<div class='col-4 text-center'>
		<a href="./" class="title">Metatables and Metamethods</a>
	</div>
	<div class='col-4 text-end'>
					<a href='closures'>Closures &#x25BA;</a>
			</div>
</div>
</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Advertising</h1>
			<p>This space is reserved for advertising.</p>
			<p>If you want to be a sponsor, contact us to include links in this area: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Thank you for collaborating!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. All rights reserved</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir galetes per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Entès!</a>
    <a href="/cookies">Més informació</a>
</div>	

	</div>    
</body>
</html>
