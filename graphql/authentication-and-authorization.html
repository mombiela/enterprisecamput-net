<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Authentication and Authorization in GraphQL</title>

    <link rel="alternate" href="https://campusempresa.com/graphql/authentication-and-authorization" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/graphql/authentication-and-authorization" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/graphql/authentication-and-authorization" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body>
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-8 p-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo_header.png" style="visibility:hiddenxx;"></a>
			</h1>
		</div>
		<div class="col-4 p-0 text-end">
			<h2 id="main_title"><cite>Building today's and tomorrow's society</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-0 m-0 text-end">
													<b id="lit_lang_es" class="px-2">EN</b>
				|
				<a href="https://campusempresa.com/graphql/authentication-and-authorization" class="px-2">ES</a></b>
				|
				<a href="https://campusempresa.cat/graphql/authentication-and-authorization" class="px-2">CA</a>
					</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="/objective">The Project</a>
				<a href="/about">About Us</a>
				<a href="/contribute">Contribute</a>
				<a href="/donate">Donations</a>
				<a href="/licence">License</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content"><div class='row navigation'>
	<div class='col-4'>
					<a href='rate-limiting'>&#x25C4;Rate Limiting</a>
			</div>
	<div class='col-4 text-center'>
		<a href="./" class="title">Authentication and Authorization in GraphQL</a>
	</div>
	<div class='col-4 text-end'>
					<a href='error-handling'>Error Handling &#x25BA;</a>
			</div>
</div>
<div class='content'></div><h1>Introduction</h1>
<div class='content'><p>In this section, we'll explore the concepts of authentication and authorization within the context of GraphQL. Understanding these concepts is crucial for building secure and robust applications.</p>
<ul>
<li><strong>Authentication</strong>: The process of verifying the identity of a user or system.</li>
<li><strong>Authorization</strong>: The process of determining what an authenticated user or system is allowed to do.</li>
</ul>
</div><h1>Authentication</h1>
<div class='content'></div><h2>Basic Authentication</h2>
<div class='content'><p>Basic authentication involves verifying the identity of a user through credentials such as a username and password.</p>
<h4>Example</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("bXV0YXRpb24gewogIGxvZ2luKHVzZXJuYW1lOiAidXNlciIsIHBhc3N3b3JkOiAicGFzc3dvcmQiKSB7CiAgICB0b2tlbgogIH0KfQ=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>mutation {
  login(username: &quot;user&quot;, password: &quot;password&quot;) {
    token
  }
}</pre></div><div class='content'><ul>
<li><strong>Explanation</strong>: This mutation takes a username and password and returns a token if the credentials are valid. The token is then used for subsequent requests to authenticate the user.</li>
</ul>
</div><h2>Token-Based Authentication</h2>
<div class='content'><p>Token-based authentication involves issuing a token upon successful login, which is then used to authenticate subsequent requests.</p>
<h4>Example</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("bXV0YXRpb24gewogIGxvZ2luKHVzZXJuYW1lOiAidXNlciIsIHBhc3N3b3JkOiAicGFzc3dvcmQiKSB7CiAgICB0b2tlbgogIH0KfQ=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>mutation {
  login(username: &quot;user&quot;, password: &quot;password&quot;) {
    token
  }
}</pre></div><div class='content'><ul>
<li><strong>Explanation</strong>: Similar to the basic authentication example, but the token is stored client-side (e.g., in local storage) and sent with each request.</li>
</ul>
<h4>Using Tokens in Requests</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("cXVlcnkgewogIHVzZXIgewogICAgaWQKICAgIG5hbWUKICB9Cn0="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>query {
  user {
    id
    name
  }
}</pre></div><div class='content'><ul>
<li><strong>Explanation</strong>: The token is typically sent in the HTTP headers. For example, in an HTTP request, you might include the token like this:
<pre><code>Authorization: Bearer &lt;token&gt;
</code></pre>
</li>
</ul>
</div><h2>OAuth</h2>
<div class='content'><p>OAuth is an open standard for access delegation, commonly used for token-based authentication.</p>
<h4>Example</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("bXV0YXRpb24gewogIGxvZ2luV2l0aE9BdXRoKHByb3ZpZGVyOiAiZ29vZ2xlIiwgdG9rZW46ICJvYXV0aC10b2tlbiIpIHsKICAgIHRva2VuCiAgfQp9"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>mutation {
  loginWithOAuth(provider: &quot;google&quot;, token: &quot;oauth-token&quot;) {
    token
  }
}</pre></div><div class='content'><ul>
<li><strong>Explanation</strong>: This mutation uses an OAuth token obtained from a provider like Google to authenticate the user and return a token for subsequent requests.</li>
</ul>
</div><h1>Authorization</h1>
<div class='content'></div><h2>Role-Based Access Control (RBAC)</h2>
<div class='content'><p>RBAC restricts access based on the roles assigned to users.</p>
<h4>Example</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("dHlwZSBRdWVyeSB7CiAgYWRtaW5EYXRhOiBBZG1pbkRhdGEgQGF1dGgocmVxdWlyZXM6IEFETUlOKQogIHVzZXJEYXRhOiBVc2VyRGF0YSBAYXV0aChyZXF1aXJlczogVVNFUikKfQ=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>type Query {
  adminData: AdminData @auth(requires: ADMIN)
  userData: UserData @auth(requires: USER)
}</pre></div><div class='content'><ul>
<li><strong>Explanation</strong>: The <code>@auth</code> directive checks if the user has the required role before resolving the field.</li>
</ul>
</div><h2>Field-Level Authorization</h2>
<div class='content'><p>Field-level authorization controls access to specific fields within a type.</p>
<h4>Example</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("dHlwZSBVc2VyIHsKICBpZDogSUQhCiAgbmFtZTogU3RyaW5nIQogIGVtYWlsOiBTdHJpbmchIEBhdXRoKHJlcXVpcmVzOiBBRE1JTikKfQ=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>type User {
  id: ID!
  name: String!
  email: String! @auth(requires: ADMIN)
}</pre></div><div class='content'><ul>
<li><strong>Explanation</strong>: The <code>@auth</code> directive restricts access to the <code>email</code> field to users with the <code>ADMIN</code> role.</li>
</ul>
</div><h2>Custom Authorization Logic</h2>
<div class='content'><p>Custom authorization logic allows for more complex rules beyond role-based checks.</p>
<h4>Example</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("dHlwZSBRdWVyeSB7CiAgc2Vuc2l0aXZlRGF0YTogU2Vuc2l0aXZlRGF0YSBAYXV0aChyZXF1aXJlczogImlzT3duZXIiKQp9"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>type Query {
  sensitiveData: SensitiveData @auth(requires: &quot;isOwner&quot;)
}</pre></div><div class='content'><ul>
<li><strong>Explanation</strong>: The <code>@auth</code> directive can be configured to call a custom function like <code>isOwner</code> to determine access.</li>
</ul>
</div><h1>Implementing Authentication and Authorization in GraphQL</h1>
<div class='content'></div><h2>Middleware</h2>
<div class='content'><p>Middleware can be used to handle authentication and authorization logic.</p>
<h4>Example</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y29uc3QgeyBBcG9sbG9TZXJ2ZXIgfSA9IHJlcXVpcmUoJ2Fwb2xsby1zZXJ2ZXInKTsKY29uc3QgeyB2ZXJpZnlUb2tlbiB9ID0gcmVxdWlyZSgnLi9hdXRoJyk7Cgpjb25zdCBzZXJ2ZXIgPSBuZXcgQXBvbGxvU2VydmVyKHsKICB0eXBlRGVmcywKICByZXNvbHZlcnMsCiAgY29udGV4dDogKHsgcmVxIH0pID0+IHsKICAgIGNvbnN0IHRva2VuID0gcmVxLmhlYWRlcnMuYXV0aG9yaXphdGlvbiB8fCAnJzsKICAgIGNvbnN0IHVzZXIgPSB2ZXJpZnlUb2tlbih0b2tlbik7CiAgICByZXR1cm4geyB1c2VyIH07CiAgfSwKfSk7"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>const { ApolloServer } = require('apollo-server');
const { verifyToken } = require('./auth');

const server = new ApolloServer({
  typeDefs,
  resolvers,
  context: ({ req }) =&gt; {
    const token = req.headers.authorization || '';
    const user = verifyToken(token);
    return { user };
  },
});</pre></div><div class='content'><ul>
<li><strong>Explanation</strong>: The <code>verifyToken</code> function checks the token and returns the user. The user is then added to the context, making it available in resolvers.</li>
</ul>
</div><h2>Directives</h2>
<div class='content'><p>Custom directives can be used to implement authorization logic directly in the schema.</p>
<h4>Example</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y29uc3QgeyBTY2hlbWFEaXJlY3RpdmVWaXNpdG9yIH0gPSByZXF1aXJlKCdhcG9sbG8tc2VydmVyJyk7CmNvbnN0IHsgZGVmYXVsdEZpZWxkUmVzb2x2ZXIgfSA9IHJlcXVpcmUoJ2dyYXBocWwnKTsKCmNsYXNzIEF1dGhEaXJlY3RpdmUgZXh0ZW5kcyBTY2hlbWFEaXJlY3RpdmVWaXNpdG9yIHsKICB2aXNpdEZpZWxkRGVmaW5pdGlvbihmaWVsZCkgewogICAgY29uc3QgeyByZXNvbHZlID0gZGVmYXVsdEZpZWxkUmVzb2x2ZXIgfSA9IGZpZWxkOwogICAgY29uc3QgeyByZXF1aXJlcyB9ID0gdGhpcy5hcmdzOwoKICAgIGZpZWxkLnJlc29sdmUgPSBhc3luYyBmdW5jdGlvbiAoLi4uYXJncykgewogICAgICBjb25zdCBjb250ZXh0ID0gYXJnc1syXTsKICAgICAgaWYgKCFjb250ZXh0LnVzZXIgfHwgIWNvbnRleHQudXNlci5yb2xlcy5pbmNsdWRlcyhyZXF1aXJlcykpIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ05vdCBhdXRob3JpemVkJyk7CiAgICAgIH0KICAgICAgcmV0dXJuIHJlc29sdmUuYXBwbHkodGhpcywgYXJncyk7CiAgICB9OwogIH0KfQoKY29uc3QgdHlwZURlZnMgPSBgCiAgZGlyZWN0aXZlIEBhdXRoKHJlcXVpcmVzOiBSb2xlISkgb24gRklFTERfREVGSU5JVElPTgoKICBlbnVtIFJvbGUgewogICAgQURNSU4KICAgIFVTRVIKICB9CgogIHR5cGUgUXVlcnkgewogICAgYWRtaW5EYXRhOiBBZG1pbkRhdGEgQGF1dGgocmVxdWlyZXM6IEFETUlOKQogICAgdXNlckRhdGE6IFVzZXJEYXRhIEBhdXRoKHJlcXVpcmVzOiBVU0VSKQogIH0KYDsKCmNvbnN0IHNjaGVtYSA9IG1ha2VFeGVjdXRhYmxlU2NoZW1hKHsKICB0eXBlRGVmcywKICByZXNvbHZlcnMsCiAgc2NoZW1hRGlyZWN0aXZlczogewogICAgYXV0aDogQXV0aERpcmVjdGl2ZSwKICB9LAp9KTs="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>const { SchemaDirectiveVisitor } = require('apollo-server');
const { defaultFieldResolver } = require('graphql');

class AuthDirective extends SchemaDirectiveVisitor {
  visitFieldDefinition(field) {
    const { resolve = defaultFieldResolver } = field;
    const { requires } = this.args;

    field.resolve = async function (...args) {
      const context = args[2];
      if (!context.user || !context.user.roles.includes(requires)) {
        throw new Error('Not authorized');
      }
      return resolve.apply(this, args);
    };
  }
}

const typeDefs = `
  directive @auth(requires: Role!) on FIELD_DEFINITION

  enum Role {
    ADMIN
    USER
  }

  type Query {
    adminData: AdminData @auth(requires: ADMIN)
    userData: UserData @auth(requires: USER)
  }
`;

const schema = makeExecutableSchema({
  typeDefs,
  resolvers,
  schemaDirectives: {
    auth: AuthDirective,
  },
});</pre></div><div class='content'><ul>
<li><strong>Explanation</strong>: The <code>AuthDirective</code> checks the user's roles before resolving the field. If the user is not authorized, an error is thrown.</li>
</ul>
</div><h1>Conclusion</h1>
<div class='content'><p>Authentication and authorization are critical components of any secure application. In GraphQL, these can be implemented using various strategies such as token-based authentication, role-based access control, and custom directives. By understanding and applying these concepts, you can ensure that your GraphQL API is both secure and robust.</p>
</div><div class='row navigation'>
	<div class='col-4'>
					<a href='rate-limiting'>&#x25C4;Rate Limiting</a>
			</div>
	<div class='col-4 text-center'>
		<a href="./" class="title">Authentication and Authorization in GraphQL</a>
	</div>
	<div class='col-4 text-end'>
					<a href='error-handling'>Error Handling &#x25BA;</a>
			</div>
</div>
</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Advertising</h1>
			<p>This space is reserved for advertising.</p>
			<p>If you want to be a sponsor, contact us to include links in this area: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Thank you for collaborating!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. All rights reserved</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir galetes per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Entès!</a>
    <a href="/cookies">Més informació</a>
</div>	

	</div>    
</body>
</html>
