<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Structured Streaming in Apache Spark</title>

    <link rel="alternate" href="https://campusempresa.com/apachespark/structured-streaming" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/apachespark/structured-streaming" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/apachespark/structured-streaming" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body>
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-8 p-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo_header.png" style="visibility:hiddenxx;"></a>
			</h1>
		</div>
		<div class="col-4 p-0 text-end">
			<h2 id="main_title"><cite>Building today's and tomorrow's society</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-0 m-0 text-end">
													<b id="lit_lang_es" class="px-2">EN</b>
				|
				<a href="https://campusempresa.com/apachespark/structured-streaming" class="px-2">ES</a></b>
				|
				<a href="https://campusempresa.cat/apachespark/structured-streaming" class="px-2">CA</a>
					</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="/objective">The Project</a>
				<a href="/about">About Us</a>
				<a href="/contribute">Contribute</a>
				<a href="/donate">Donations</a>
				<a href="/licence">License</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content"><div class='row navigation'>
	<div class='col-4'>
					<a href='stateful-stream-processing'>&#x25C4;Stateful Stream Processing</a>
			</div>
	<div class='col-4 text-center'>
		<a href="./" class="title">Structured Streaming in Apache Spark</a>
	</div>
	<div class='col-4 text-end'>
					<a href='introduction-to-spark-mllib'>Introduction to Spark MLlib &#x25BA;</a>
			</div>
</div>
<div class='content'></div><h1>Introduction to Structured Streaming</h1>
<div class='content'><p>Structured Streaming is a scalable and fault-tolerant stream processing engine built on the Spark SQL engine. It allows you to express streaming computations the same way you would express batch computations on static data.</p>
</div><h2>Key Concepts</h2>
<div class='content'><ul>
<li><strong>Unbounded Data</strong>: Data that continuously arrives over time.</li>
<li><strong>Streaming Query</strong>: A continuous query that processes streaming data.</li>
<li><strong>Trigger</strong>: Defines the timing of streaming data processing.</li>
<li><strong>Stateful Operations</strong>: Operations that maintain state across batches of data.</li>
</ul>
</div><h1>Setting Up Structured Streaming</h1>
<div class='content'><p>Before diving into coding, ensure you have the necessary environment set up:</p>
<ul>
<li>Apache Spark installed.</li>
<li>A development environment like Jupyter Notebook or an IDE (e.g., IntelliJ IDEA).</li>
</ul>
</div><h2>Example Setup Code</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ZnJvbSBweXNwYXJrLnNxbCBpbXBvcnQgU3BhcmtTZXNzaW9uCgojIENyZWF0ZSBhIFNwYXJrIHNlc3Npb24Kc3BhcmsgPSBTcGFya1Nlc3Npb24uYnVpbGRlciBcCiAgICAuYXBwTmFtZSgiU3RydWN0dXJlZFN0cmVhbWluZ0V4YW1wbGUiKSBcCiAgICAuZ2V0T3JDcmVhdGUoKQ=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>from pyspark.sql import SparkSession

# Create a Spark session
spark = SparkSession.builder \
    .appName(&quot;StructuredStreamingExample&quot;) \
    .getOrCreate()</pre></div><div class='content'></div><h1>Basic Operations</h1>
<h2>Reading from a Stream</h2>
<div class='content'><p>Structured Streaming supports various data sources like Kafka, files, and sockets.</p>
<h4>Example: Reading from a Socket</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("IyBSZWFkIHN0cmVhbWluZyBkYXRhIGZyb20gYSBzb2NrZXQKbGluZXMgPSBzcGFyay5yZWFkU3RyZWFtIFwKICAgIC5mb3JtYXQoInNvY2tldCIpIFwKICAgIC5vcHRpb24oImhvc3QiLCAibG9jYWxob3N0IikgXAogICAgLm9wdGlvbigicG9ydCIsIDk5OTkpIFwKICAgIC5sb2FkKCkKCiMgRGlzcGxheSB0aGUgc2NoZW1hIG9mIHRoZSBEYXRhRnJhbWUKbGluZXMucHJpbnRTY2hlbWEoKQ=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'># Read streaming data from a socket
lines = spark.readStream \
    .format(&quot;socket&quot;) \
    .option(&quot;host&quot;, &quot;localhost&quot;) \
    .option(&quot;port&quot;, 9999) \
    .load()

# Display the schema of the DataFrame
lines.printSchema()</pre></div><div class='content'></div><h2>Writing to a Stream</h2>
<div class='content'><p>You can write the output of a streaming query to various sinks like console, files, or Kafka.</p>
<h4>Example: Writing to Console</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("IyBXcml0ZSB0aGUgc3RyZWFtaW5nIGRhdGEgdG8gdGhlIGNvbnNvbGUKcXVlcnkgPSBsaW5lcy53cml0ZVN0cmVhbSBcCiAgICAub3V0cHV0TW9kZSgiYXBwZW5kIikgXAogICAgLmZvcm1hdCgiY29uc29sZSIpIFwKICAgIC5zdGFydCgpCgojIEF3YWl0IHRlcm1pbmF0aW9uIG9mIHRoZSBxdWVyeQpxdWVyeS5hd2FpdFRlcm1pbmF0aW9uKCk="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'># Write the streaming data to the console
query = lines.writeStream \
    .outputMode(&quot;append&quot;) \
    .format(&quot;console&quot;) \
    .start()

# Await termination of the query
query.awaitTermination()</pre></div><div class='content'></div><h1>Transformations on Streaming Data</h1>
<div class='content'><p>Structured Streaming allows you to apply various transformations on streaming data.</p>
</div><h2>Example: Word Count</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ZnJvbSBweXNwYXJrLnNxbC5mdW5jdGlvbnMgaW1wb3J0IGV4cGxvZGUsIHNwbGl0CgojIFNwbGl0IHRoZSBsaW5lcyBpbnRvIHdvcmRzCndvcmRzID0gbGluZXMuc2VsZWN0KAogICAgZXhwbG9kZSgKICAgICAgICBzcGxpdChsaW5lcy52YWx1ZSwgIiAiKQogICAgKS5hbGlhcygid29yZCIpCikKCiMgQ291bnQgdGhlIG9jY3VycmVuY2VzIG9mIGVhY2ggd29yZAp3b3JkQ291bnRzID0gd29yZHMuZ3JvdXBCeSgid29yZCIpLmNvdW50KCkKCiMgV3JpdGUgdGhlIHdvcmQgY291bnRzIHRvIHRoZSBjb25zb2xlCnF1ZXJ5ID0gd29yZENvdW50cy53cml0ZVN0cmVhbSBcCiAgICAub3V0cHV0TW9kZSgiY29tcGxldGUiKSBcCiAgICAuZm9ybWF0KCJjb25zb2xlIikgXAogICAgLnN0YXJ0KCkKCnF1ZXJ5LmF3YWl0VGVybWluYXRpb24oKQ=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>from pyspark.sql.functions import explode, split

# Split the lines into words
words = lines.select(
    explode(
        split(lines.value, &quot; &quot;)
    ).alias(&quot;word&quot;)
)

# Count the occurrences of each word
wordCounts = words.groupBy(&quot;word&quot;).count()

# Write the word counts to the console
query = wordCounts.writeStream \
    .outputMode(&quot;complete&quot;) \
    .format(&quot;console&quot;) \
    .start()

query.awaitTermination()</pre></div><div class='content'></div><h1>Advanced Topics</h1>
<h2>Windowed Operations</h2>
<div class='content'><p>Windowed operations allow you to perform aggregations over a sliding window of time.</p>
<h4>Example: Windowed Word Count</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ZnJvbSBweXNwYXJrLnNxbC5mdW5jdGlvbnMgaW1wb3J0IHdpbmRvdwoKIyBEZWZpbmUgYSB3aW5kb3cgb2YgMTAgbWludXRlcywgc2xpZGluZyBldmVyeSA1IG1pbnV0ZXMKd2luZG93ZWRDb3VudHMgPSB3b3Jkcy5ncm91cEJ5KAogICAgd2luZG93KHdvcmRzLnRpbWVzdGFtcCwgIjEwIG1pbnV0ZXMiLCAiNSBtaW51dGVzIiksCiAgICB3b3Jkcy53b3JkCikuY291bnQoKQoKIyBXcml0ZSB0aGUgd2luZG93ZWQgd29yZCBjb3VudHMgdG8gdGhlIGNvbnNvbGUKcXVlcnkgPSB3aW5kb3dlZENvdW50cy53cml0ZVN0cmVhbSBcCiAgICAub3V0cHV0TW9kZSgiY29tcGxldGUiKSBcCiAgICAuZm9ybWF0KCJjb25zb2xlIikgXAogICAgLnN0YXJ0KCkKCnF1ZXJ5LmF3YWl0VGVybWluYXRpb24oKQ=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>from pyspark.sql.functions import window

# Define a window of 10 minutes, sliding every 5 minutes
windowedCounts = words.groupBy(
    window(words.timestamp, &quot;10 minutes&quot;, &quot;5 minutes&quot;),
    words.word
).count()

# Write the windowed word counts to the console
query = windowedCounts.writeStream \
    .outputMode(&quot;complete&quot;) \
    .format(&quot;console&quot;) \
    .start()

query.awaitTermination()</pre></div><div class='content'></div><h2>Stateful Operations</h2>
<div class='content'><p>Stateful operations maintain state across batches of data, which is useful for operations like running totals.</p>
<h4>Example: Running Total</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ZnJvbSBweXNwYXJrLnNxbC5mdW5jdGlvbnMgaW1wb3J0IGV4cHIKCiMgRGVmaW5lIGEgcnVubmluZyB0b3RhbApydW5uaW5nVG90YWwgPSB3b3Jkcy53aXRoV2F0ZXJtYXJrKCJ0aW1lc3RhbXAiLCAiMTAgbWludXRlcyIpIFwKICAgIC5ncm91cEJ5KCJ3b3JkIikgXAogICAgLmFnZyhleHByKCJjb3VudCgqKSBhcyB0b3RhbCIpKQoKIyBXcml0ZSB0aGUgcnVubmluZyB0b3RhbCB0byB0aGUgY29uc29sZQpxdWVyeSA9IHJ1bm5pbmdUb3RhbC53cml0ZVN0cmVhbSBcCiAgICAub3V0cHV0TW9kZSgidXBkYXRlIikgXAogICAgLmZvcm1hdCgiY29uc29sZSIpIFwKICAgIC5zdGFydCgpCgpxdWVyeS5hd2FpdFRlcm1pbmF0aW9uKCk="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>from pyspark.sql.functions import expr

# Define a running total
runningTotal = words.withWatermark(&quot;timestamp&quot;, &quot;10 minutes&quot;) \
    .groupBy(&quot;word&quot;) \
    .agg(expr(&quot;count(*) as total&quot;))

# Write the running total to the console
query = runningTotal.writeStream \
    .outputMode(&quot;update&quot;) \
    .format(&quot;console&quot;) \
    .start()

query.awaitTermination()</pre></div><div class='content'></div><h1>Fault Tolerance and Checkpointing</h1>
<div class='content'><p>Structured Streaming provides built-in fault tolerance through checkpointing and write-ahead logs.</p>
</div><h2>Example: Checkpointing</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("IyBEZWZpbmUgYSBjaGVja3BvaW50IGxvY2F0aW9uCnF1ZXJ5ID0gd29yZENvdW50cy53cml0ZVN0cmVhbSBcCiAgICAub3V0cHV0TW9kZSgiY29tcGxldGUiKSBcCiAgICAuZm9ybWF0KCJjb25zb2xlIikgXAogICAgLm9wdGlvbigiY2hlY2twb2ludExvY2F0aW9uIiwgIi9wYXRoL3RvL2NoZWNrcG9pbnQvZGlyIikgXAogICAgLnN0YXJ0KCkKCnF1ZXJ5LmF3YWl0VGVybWluYXRpb24oKQ=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'># Define a checkpoint location
query = wordCounts.writeStream \
    .outputMode(&quot;complete&quot;) \
    .format(&quot;console&quot;) \
    .option(&quot;checkpointLocation&quot;, &quot;/path/to/checkpoint/dir&quot;) \
    .start()

query.awaitTermination()</pre></div><div class='content'></div><h1>Conclusion</h1>
<div class='content'><p>Structured Streaming in Apache Spark provides a powerful and flexible framework for processing streaming data. By leveraging the same APIs used for batch processing, it simplifies the development of streaming applications. Key features like windowed operations, stateful processing, and fault tolerance make it suitable for a wide range of real-time data processing tasks.</p>
</div><div class='row navigation'>
	<div class='col-4'>
					<a href='stateful-stream-processing'>&#x25C4;Stateful Stream Processing</a>
			</div>
	<div class='col-4 text-center'>
		<a href="./" class="title">Structured Streaming in Apache Spark</a>
	</div>
	<div class='col-4 text-end'>
					<a href='introduction-to-spark-mllib'>Introduction to Spark MLlib &#x25BA;</a>
			</div>
</div>
</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Advertising</h1>
			<p>This space is reserved for advertising.</p>
			<p>If you want to be a sponsor, contact us to include links in this area: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Thank you for collaborating!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. All rights reserved</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir galetes per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Accept</a>
    <a href="/cookies">More Information</a>
</div>	

	</div>    
</body>
</html>
