<!DOCTYPE html>
<html lang="en">
<head>
    <title> Using Roles in Playbooks </title>
        
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="index, nofollow, noarchive">
    
    <link rel="alternate" href="https://campusempresa.com/mod/ansible/04-04-using-roles-in-playbooks" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/mod/ansible/04-04-using-roles-in-playbooks" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/mod/ansible/04-04-using-roles-in-playbooks" hreflang="en" />
    
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.ea63f62b9e.css" rel="stylesheet">
	 
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="/js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script>
  		var LANG = "en";
  		var CATEGORY = "frameworks";
  		var MOD_NAME = "ansible";
  		var TEMA_NAME = "4-4";
  		var TYPE = "mod";
  		var PATH = "mod/ansible/04-04-using-roles-in-playbooks";
  		var IS_INDEX = false;
  	</script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="module" src="/js/app.902a5a267d.js"></script>
	<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-0611338592562725" crossorigin="anonymous"></script>
	  	
</head>

<body class="d-none">
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-12 col-md-6 p-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo-header_enterprise.png"></a>
			</h1>
		</div>
		<div class="col-12 col-md-6 p-0 text-end">
			<p class="mb-0 p-0">	<b id="lit_lang_es" class="px-2">EN</b>
	|
	<a href="https://campusempresa.com/mod/ansible/04-04-using-roles-in-playbooks" class="px-2">ES</a></b>
	|
	<a href="https://campusempresa.cat/mod/ansible/04-04-using-roles-in-playbooks" class="px-2">CA</a>
</p>
			<p class="mb-4 mt-0 mx-2  d-none d-md-block"><cite>All the knowledge within your reach</cite></p>
		</div>
	</div>
</div>
<div class="subheader container-xxl d-none d-md-block">
	<div class="row">
		<div class="col-12 p-2 p-md-0 m-0 text-end">
			<a href="/objective" rel="nofollow">The Project</a> | 
<a href="/about" rel="nofollow">About Us</a> | 
<a href="/contribute" rel="nofollow">Contribute</a> | 
<a href="/donate" rel="nofollow">Donations</a> | 
<a href="/license" rel="nofollow">License</a>
		</div>
	</div>
</div>
		<div class="top-bar container-fluid p-0">
	<div class="container-xxl p-0">
		<div class="row">
			<div class="col">
				<div class="d-flex justify-content-between">
					<div class="left">
						<a href="/" class="nav-link px-3" id="btnHome">
	<i class="bi bi-house-fill"></i>
	HOME
</a>

<a href="/my-courses" class="nav-link px-3 d-none" id="btnMyCourses">
	<i class="bi bi-rocket-takeoff-fill"></i>
	<i><b>My courses</b></i>
</a>
<a href="/completed-courses" class="nav-link px-3 d-none" id="trophy_button">
	<i class="bi bi-trophy-fill"></i>
	Completed             
</a>

					</div>
                    <div class="ms-auto right">
                        <a id="user_button" href="#" class="nav-link px-3" data-bs-toggle="modal" data-bs-target="#loginModal">
                            <i id="user_icon" class="bi"></i>                            
                        </a>
                    </div>					
				</div>
			</div>
		</div>
	</div>
</div>

		<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
										<div class="row py-1 m-0" id="buttonsModSection">
	<div class="col-6 p-0" data-mod="ansible">
		<a  href="#" class="text-secondary d-none" data-read-mod="ansible" data-read-unit="4-4" style="text-decoration:none;">
			<i class="bi bi-check-circle-fill"></i> 
			Mark as read
		</a>
		<a href="#" class="text-secondary d-none" data-unread-mod="ansible" data-unread-unit="4-4" style="text-decoration:none;">
			<i class="bi bi-x-circle-fill"></i>
			Mark as unread
		</a>
	</div>
	<div class="col-6 text-end p-0">
					<a href="./"  class="nav-link">
				<i class="bi bi-journal-text"></i>
				Course Content
			</a>
			</div>
</div>						<div id="inner_content">
				<div class='row navigation'>
	<div class='col-2 d-none d-md-block'>
					<a href='04-03-role-directory-structure' title="Role Directory Structure" class="py-2 px-3 btn btn-primary">
				&#x25C4; Previous 
			</a>
			</div>
	<div class='col-2 d-md-none'>
					<a href='04-03-role-directory-structure' title="Role Directory Structure" class="py-2 px-3 btn btn-primary">
				&#x25C4;
			</a>
			</div>
	<div class='col-8 text-center'>
					<h2 style="text-decoration:underline">Using Roles in Playbooks</h2>
			</div>
	<div class='col-2 text-end d-none d-md-block'>
					<a href='05-01-handlers' title="Handlers" class="py-2 px-3 btn btn-primary"
				data-read-mod="ansible" data-read-unit="4-4">
				Next &#x25BA;
			</a>
			</div>
	<div class='col-2 text-end d-md-none '>
					<a href='05-01-handlers' title="Handlers" class="py-2 px-3 btn btn-primary" 
				data-read-mod="ansible" data-read-unit="4-4">
				 &#x25BA;
			</a>
			</div>
</div>
<div class='content'><p>In this section, we will explore how to use roles in Ansible playbooks. Roles are a powerful feature in Ansible that allow you to organize your playbooks and reusable components in a structured manner. By the end of this section, you will understand how to integrate roles into your playbooks effectively.</p>
</div><h1>What are Roles?</h1>
<div class='content'><p>Roles are a way to group related tasks, variables, files, templates, and handlers into a single unit. This makes your playbooks more modular, reusable, and easier to manage.</p>
</div><h2>Key Components of a Role</h2>
<div class='content'><ul>
<li><strong>Tasks</strong>: The main list of tasks to be executed by the role.</li>
<li><strong>Handlers</strong>: Handlers that can be used within the role or notified by tasks.</li>
<li><strong>Templates</strong>: Jinja2 templates that can be used to generate configuration files.</li>
<li><strong>Files</strong>: Static files that can be deployed by the role.</li>
<li><strong>Vars</strong>: Variables specific to the role.</li>
<li><strong>Defaults</strong>: Default variables for the role.</li>
<li><strong>Meta</strong>: Metadata about the role, including dependencies.</li>
<li><strong>Tests</strong>: Test cases for the role.</li>
</ul>
</div><h1>Using Roles in Playbooks</h1>
<div class='content'><p>To use a role in a playbook, you simply need to include the role in the <code>roles</code> section of your playbook. Below is a step-by-step guide on how to do this.</p>
</div><h2>Step 1: Create a Role</h2>
<div class='content'><p>First, create a role using the <code>ansible-galaxy</code> command:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("YW5zaWJsZS1nYWxheHkgaW5pdCBteV9yb2xl"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>ansible-galaxy init my_role</pre></div><div class='content'><p>This command will create a directory structure for the role <code>my_role</code>.</p>
</div><h2>Step 2: Define the Role's Tasks</h2>
<div class='content'><p>Navigate to the <code>tasks</code> directory of your role and create a <code>main.yml</code> file:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("IyByb2xlcy9teV9yb2xlL3Rhc2tzL21haW4ueW1sCi0tLQotIG5hbWU6IEVuc3VyZSBBcGFjaGUgaXMgaW5zdGFsbGVkCiAgYXB0OgogICAgbmFtZTogYXBhY2hlMgogICAgc3RhdGU6IHByZXNlbnQKCi0gbmFtZTogU3RhcnQgQXBhY2hlIHNlcnZpY2UKICBzZXJ2aWNlOgogICAgbmFtZTogYXBhY2hlMgogICAgc3RhdGU6IHN0YXJ0ZWQKICAgIGVuYWJsZWQ6IHRydWU="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'># roles/my_role/tasks/main.yml
---
- name: Ensure Apache is installed
  apt:
    name: apache2
    state: present

- name: Start Apache service
  service:
    name: apache2
    state: started
    enabled: true</pre></div><div class='content'></div><h2>Step 3: Include the Role in a Playbook</h2>
<div class='content'><p>Create a playbook that includes the role:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("IyBwbGF5Ym9vay55bWwKLS0tCi0gaG9zdHM6IHdlYnNlcnZlcnMKICByb2xlczoKICAgIC0gbXlfcm9sZQ=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'># playbook.yml
---
- hosts: webservers
  roles:
    - my_role</pre></div><div class='content'></div><h2>Step 4: Run the Playbook</h2>
<div class='content'><p>Execute the playbook using the <code>ansible-playbook</code> command:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("YW5zaWJsZS1wbGF5Ym9vayAtaSBpbnZlbnRvcnkgcGxheWJvb2sueW1s"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>ansible-playbook -i inventory playbook.yml</pre></div><div class='content'></div><h2>Example Playbook with Multiple Roles</h2>
<div class='content'><p>You can include multiple roles in a single playbook. Here is an example:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("IyBwbGF5Ym9vay55bWwKLS0tCi0gaG9zdHM6IHdlYnNlcnZlcnMKICByb2xlczoKICAgIC0gcm9sZTogbXlfcm9sZQogICAgLSByb2xlOiBhbm90aGVyX3JvbGU="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'># playbook.yml
---
- hosts: webservers
  roles:
    - role: my_role
    - role: another_role</pre></div><div class='content'></div><h2>Using Role Variables</h2>
<div class='content'><p>Roles can have their own variables, which can be defined in the <code>vars</code> or <code>defaults</code> directory of the role. You can also pass variables to roles directly in the playbook:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("IyBwbGF5Ym9vay55bWwKLS0tCi0gaG9zdHM6IHdlYnNlcnZlcnMKICByb2xlczoKICAgIC0gcm9sZTogbXlfcm9sZQogICAgICB2YXJzOgogICAgICAgIGFwYWNoZV9wb3J0OiA4MDgw"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'># playbook.yml
---
- hosts: webservers
  roles:
    - role: my_role
      vars:
        apache_port: 8080</pre></div><div class='content'></div><h2>Practical Exercise</h2>
<div class='content'><p><strong>Exercise:</strong> Create a role named <code>nginx_role</code> that installs and configures Nginx, and then use this role in a playbook.</p>
<p><strong>Steps:</strong></p>
<ol>
<li>Create the role:
<pre><code class="language-bash">ansible-galaxy init nginx_role
</code></pre>
</li>
<li>Define the tasks in <code>nginx_role/tasks/main.yml</code>:
<pre><code class="language-yaml"># roles/nginx_role/tasks/main.yml
---
- name: Ensure Nginx is installed
  apt:
    name: nginx
    state: present

- name: Start Nginx service
  service:
    name: nginx
    state: started
    enabled: true
</code></pre>
</li>
<li>Create a playbook that uses the <code>nginx_role</code>:
<pre><code class="language-yaml"># playbook.yml
---
- hosts: webservers
  roles:
    - nginx_role
</code></pre>
</li>
<li>Run the playbook:
<pre><code class="language-bash">ansible-playbook -i inventory playbook.yml
</code></pre>
</li>
</ol>
<p><strong>Solution:</strong></p>
<p>The solution involves following the steps outlined above. Ensure that the <code>nginx_role</code> is correctly defined and included in the playbook.</p>
</div><h2>Common Mistakes and Tips</h2>
<div class='content'><ul>
<li><strong>Incorrect Directory Structure</strong>: Ensure that the role's directory structure follows the standard layout.</li>
<li><strong>Variable Scope</strong>: Be mindful of variable precedence and scope when using role variables.</li>
<li><strong>Role Dependencies</strong>: Use the <code>meta/main.yml</code> file to define role dependencies if your role relies on other roles.</li>
</ul>
</div><h1>Conclusion</h1>
<div class='content'><p>In this section, we learned how to use roles in Ansible playbooks. Roles help in organizing and reusing code, making your playbooks more maintainable. We covered the creation of roles, defining tasks, and including roles in playbooks. Additionally, we provided a practical exercise to reinforce the concepts learned. In the next module, we will delve into advanced playbook techniques, including handlers, templates, and error handling.</p>
</div><div class='row navigation'>
	<div class='col-2 d-none d-md-block'>
					<a href='04-03-role-directory-structure' title="Role Directory Structure" class="py-2 px-3 btn btn-primary">
				&#x25C4; Previous 
			</a>
			</div>
	<div class='col-2 d-md-none'>
					<a href='04-03-role-directory-structure' title="Role Directory Structure" class="py-2 px-3 btn btn-primary">
				&#x25C4;
			</a>
			</div>
	<div class='col-8 text-center'>
			</div>
	<div class='col-2 text-end d-none d-md-block'>
					<a href='05-01-handlers' title="Handlers" class="py-2 px-3 btn btn-primary"
				data-read-mod="ansible" data-read-unit="4-4">
				Next &#x25BA;
			</a>
			</div>
	<div class='col-2 text-end d-md-none '>
					<a href='05-01-handlers' title="Handlers" class="py-2 px-3 btn btn-primary" 
				data-read-mod="ansible" data-read-unit="4-4">
				 &#x25BA;
			</a>
			</div>
</div>

			</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
						
	<div class="container mt-2 d-none d-md-block index">
		<h1>Ansible: From Beginner to Advanced</h1>
<h2>Module 1: Introduction to Ansible</h2>
<ul>
<li><a href="01-01-what-is-ansible">What is Ansible?</a></li>
<li><a href="01-02-installing-ansible">Installing Ansible</a></li>
<li><a href="01-03-ansible-architecture">Ansible Architecture</a></li>
<li><a href="01-04-basic-ansible-commands">Basic Ansible Commands</a></li>
</ul>
<h2>Module 2: Ansible Basics</h2>
<ul>
<li><a href="02-01-inventory-files">Inventory Files</a></li>
<li><a href="02-02-ansible-configuration">Ansible Configuration</a></li>
<li><a href="02-03-ad-hoc-commands">Ad-Hoc Commands</a></li>
<li><a href="02-04-ansible-modules">Ansible Modules</a></li>
</ul>
<h2>Module 3: Playbooks</h2>
<ul>
<li><a href="03-01-introduction-to-playbooks">Introduction to Playbooks</a></li>
<li><a href="03-02-writing-your-first-playbook">Writing Your First Playbook</a></li>
<li><a href="03-03-playbook-structure">Playbook Structure</a></li>
<li><a href="03-04-variables-and-facts">Variables and Facts</a></li>
<li><a href="03-05-conditionals-and-loops">Conditionals and Loops</a></li>
</ul>
<h2>Module 4: Roles</h2>
<ul>
<li><a href="04-01-introduction-to-roles">Introduction to Roles</a></li>
<li><a href="04-02-creating-roles">Creating Roles</a></li>
<li><a href="04-03-role-directory-structure">Role Directory Structure</a></li>
<li><a href="04-04-using-roles-in-playbooks">Using Roles in Playbooks</a></li>
</ul>
<h2>Module 5: Advanced Playbook Techniques</h2>
<ul>
<li><a href="05-01-handlers">Handlers</a></li>
<li><a href="05-02-templates">Templates</a></li>
<li><a href="05-03-ansible-vault">Ansible Vault</a></li>
<li><a href="05-04-error-handling">Error Handling</a></li>
<li><a href="05-05-optimizing-playbooks">Optimizing Playbooks</a></li>
</ul>
<h2>Module 6: Ansible Galaxy</h2>
<ul>
<li><a href="06-01-what-is-ansible-galaxy">What is Ansible Galaxy?</a></li>
<li><a href="06-02-using-ansible-galaxy">Using Ansible Galaxy</a></li>
<li><a href="06-03-creating-and-sharing-roles">Creating and Sharing Roles</a></li>
</ul>
<h2>Module 7: Ansible Tower</h2>
<ul>
<li><a href="07-01-introduction-to-ansible-tower">Introduction to Ansible Tower</a></li>
<li><a href="07-02-installing-ansible-tower">Installing Ansible Tower</a></li>
<li><a href="07-03-using-ansible-tower">Using Ansible Tower</a></li>
<li><a href="07-04-managing-projects-and-inventories">Managing Projects and Inventories</a></li>
</ul>
<h2>Module 8: Ansible for DevOps</h2>
<ul>
<li><a href="08-01-ansible-and-docker">Ansible and Docker</a></li>
<li><a href="08-02-ansible-and-kubernetes">Ansible and Kubernetes</a></li>
<li><a href="08-03-ci-cd-with-ansible">CI/CD with Ansible</a></li>
<li><a href="08-04-ansible-in-cloud-environments">Ansible in Cloud Environments</a></li>
</ul>
<h2>Module 9: Ansible Best Practices</h2>
<ul>
<li><a href="09-01-code-organization">Code Organization</a></li>
<li><a href="09-02-security-best-practices">Security Best Practices</a></li>
<li><a href="09-03-performance-tuning">Performance Tuning</a></li>
<li><a href="09-04-testing-ansible-code">Testing Ansible Code</a></li>
</ul>
<h2>Module 10: Advanced Ansible Topics</h2>
<ul>
<li><a href="10-01-custom-modules">Custom Modules</a></li>
<li><a href="10-02-dynamic-inventory">Dynamic Inventory</a></li>
<li><a href="10-03-ansible-plugins">Ansible Plugins</a></li>
<li><a href="10-04-ansible-api">Ansible API</a></li>
</ul>

	</div>










		</div>
	</div>
</div>		
<div class="container-xxl d-block d-md-none">
	<div class="row">
		<div class="col-12 p-2 p-md-0 m-0 text-end">
			<a href="/objective" rel="nofollow">The Project</a> | 
<a href="/about" rel="nofollow">About Us</a> | 
<a href="/contribute" rel="nofollow">Contribute</a> | 
<a href="/donate" rel="nofollow">Donations</a> | 
<a href="/license" rel="nofollow">License</a>
		</div>
	</div>
</div>

<div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. All rights reserved</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	We use cookies to improve your user experience and offer content tailored to your interests.
    <a href="#" id="btn_accept_cookies" class="button">Accept</a>
    <a href="/cookies">More Information</a>
</div>	

		<div class="modal fade" id="loginModal" tabindex="-1" aria-labelledby="loginModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="loginModalLabel">User not authenticated</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
            	<div id="modal-body-main"></div>
            </div>
        </div>
    </div>
</div>	</div>    
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
</body>
</html>
