<!DOCTYPE html>
<html lang="en">
<head>
    <title> Monitoring with Prometheus </title>
        
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="index, follow, noarchive">
    
    <link rel="alternate" href="https://campusempresa.com/cursos/kubernetes/07-01-monitoring-prometheus" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/cursos/kubernetes/07-01-monitoring-prometheus" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/courses/kubernetes/07-01-monitoring-prometheus" hreflang="en" />
    
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.1ab297bfa4.css" rel="stylesheet">
	 
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="/js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script>
  		var LANG = "en";
  		var CATEGORY = "frameworks";
  		var MOD_NAME = "kubernetes";
  		var TEMA_NAME = "7-1";
  		var TYPE = "mod";
  		var PATH = "mod/kubernetes/07-01-monitoring-prometheus";
  		var IS_INDEX = false;
  	</script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="module" src="/js/app.e0e4cfcd99.js"></script>
	<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-0611338592562725" crossorigin="anonymous"></script>
	  	
	<!-- Google tag (gtag.js) -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=G-VVPMPJSR3P"></script>
	<script>
	  window.dataLayer = window.dataLayer || [];
	  function gtag(){dataLayer.push(arguments);}
	  gtag('js', new Date());	
	  gtag('config', 'G-VVPMPJSR3P');
	</script>
</head>

<body class="d-none">
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-12 col-md-6 p-0">
			<a href="/"><img src="/img/logo-header_enterprise.png" alt="Logo Enterprise Campus"></a>
		</div>
		<div class="col-12 col-md-6 p-0 text-end">
			<p class="mb-0 p-0">	<b id="lit_lang_es" class="px-2">EN</b>
	|
	<a href="https://campusempresa.com/cursos/kubernetes/07-01-monitoring-prometheus" class="px-2">ES</a></b>
	|
	<a href="https://campusempresa.cat/cursos/kubernetes/07-01-monitoring-prometheus" class="px-2">CA</a>
</p>
			<p class="mb-4 mt-0 mx-2  d-none d-md-block"><cite>All the knowledge within your reach</cite></p>
		</div>
	</div>
</div>
<div class="subheader container-xxl d-none d-md-block">
	<div class="row">
		<div class="col-12 p-2 p-md-0 m-0 text-end">
			<a href="/objective" rel="nofollow">The Project</a> | 
<a href="/about" rel="nofollow">About Us</a> | 
<a href="/contribute" rel="nofollow">Contribute</a> | 
<a href="/donate" rel="nofollow">Donations</a> | 
<a href="/license" rel="nofollow">License</a>
		</div>
	</div>
</div>
		<div class="top-bar container-fluid p-0">
	<div class="container-xxl p-0">
		<div class="row">
			<div class="col">
				<div class="d-flex justify-content-between">
					<div class="left">
						<a href="/" class="nav-link px-3" id="btnHome">
	<i class="bi bi-house-fill"></i>
	HOME
</a>

<a href="/my-courses" class="nav-link px-3 d-none" id="btnMyCourses">
	<i class="bi bi-rocket-takeoff-fill"></i>
	<i><b>My courses</b></i>
</a>
<a href="/completed-courses" class="nav-link px-3 d-none" id="trophy_button">
	<i class="bi bi-trophy-fill"></i>
	Completed             
</a>

					</div>
                    <div class="ms-auto right">
                        <a id="user_button" href="#" class="nav-link px-3" data-bs-toggle="modal" data-bs-target="#loginModal">
                            <i id="user_icon" class="bi"></i>                            
                        </a>
                    </div>					
				</div>
			</div>
		</div>
	</div>
</div>

		<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
										<div class="row py-1 m-0" id="buttonsModSection">
	<div class="col-6 p-0" data-mod="kubernetes">
		<a  href="#" class="text-secondary d-none" data-read-mod="kubernetes" data-read-unit="7-1" style="text-decoration:none;">
			<i class="bi bi-check-circle-fill"></i> 
			Mark as read
		</a>
		<a href="#" class="text-secondary d-none" data-unread-mod="kubernetes" data-unread-unit="7-1" style="text-decoration:none;">
			<i class="bi bi-x-circle-fill"></i>
			Mark as unread
		</a>
	</div>
	<div class="col-6 text-end p-0">
					<a href="./"  class="nav-link">
				<i class="bi bi-journal-text"></i>
				Course Content
			</a>
			</div>
</div>						<div id="inner_content">
				<div class='row navigation'>
	<div class='col-2 d-none d-md-block'>
					<a href='06-04-crds' title="Custom Resource Definitions (CRDs)" class="py-2 px-3 btn btn-primary">
				&#x25C4; Previous 
			</a>
			</div>
	<div class='col-2 d-md-none'>
					<a href='06-04-crds' title="Custom Resource Definitions (CRDs)" class="py-2 px-3 btn btn-primary">
				&#x25C4;
			</a>
			</div>
	<div class='col-8 text-center'>
					<h1 style="text-decoration:underline">Monitoring with Prometheus</h1>
			</div>
	<div class='col-2 text-end d-none d-md-block'>
					<a href='07-02-logging-efk' title="Logging with Elasticsearch, Fluentd, and Kibana (EFK)" class="py-2 px-3 btn btn-primary"
				data-read-mod="kubernetes" data-read-unit="7-1">
				Next &#x25BA;
			</a>
			</div>
	<div class='col-2 text-end d-md-none '>
					<a href='07-02-logging-efk' title="Logging with Elasticsearch, Fluentd, and Kibana (EFK)" class="py-2 px-3 btn btn-primary" 
				data-read-mod="kubernetes" data-read-unit="7-1">
				 &#x25BA;
			</a>
			</div>
</div>
<div class='content'><p>Monitoring is a critical aspect of managing and maintaining a Kubernetes cluster. Prometheus is a powerful open-source monitoring and alerting toolkit designed specifically for reliability and scalability. In this section, we will cover the basics of Prometheus, how to set it up in a Kubernetes cluster, and how to use it to monitor your applications and infrastructure.</p>
</div><h2>What is Prometheus?</h2>
<div class='content'><p>Prometheus is an open-source systems monitoring and alerting toolkit originally built at SoundCloud. It is now a standalone open-source project and maintained independently of any company. Prometheus is designed for reliability and scalability, making it a popular choice for monitoring Kubernetes clusters.</p>
</div><h3>Key Features of Prometheus:</h3>
<div class='content'><ul>
<li><strong>Multi-dimensional data model</strong>: Time series data is identified by metric name and key/value pairs.</li>
<li><strong>Flexible query language</strong>: PromQL (Prometheus Query Language) allows for powerful querying and aggregation.</li>
<li><strong>Pull-based model</strong>: Prometheus scrapes metrics from instrumented jobs.</li>
<li><strong>No reliance on distributed storage</strong>: Single server nodes are autonomous.</li>
<li><strong>Built-in support for service discovery</strong>: Integrates with Kubernetes, Consul, and other service discovery mechanisms.</li>
<li><strong>Alerting</strong>: Integrated alerting based on PromQL queries.</li>
</ul>
</div><h2>Setting Up Prometheus in Kubernetes</h2>
<div class='content'><p>To set up Prometheus in a Kubernetes cluster, you can use the Prometheus Operator, which simplifies the deployment and management of Prometheus instances. The Prometheus Operator provides Kubernetes native deployment and management of Prometheus and related monitoring components.</p>
</div><h3>Step-by-Step Setup:</h3>
<div class='content'><ol>
<li>
<p><strong>Install Prometheus Operator</strong>:</p>
<ul>
<li>You can install the Prometheus Operator using Helm, a package manager for Kubernetes.</li>
</ul>
<pre><code class="language-bash">helm repo add prometheus-community https://prometheus-community.github.io/helm-charts
helm repo update
helm install prometheus prometheus-community/kube-prometheus-stack
</code></pre>
</li>
<li>
<p><strong>Verify Installation</strong>:</p>
<ul>
<li>Check the status of the Prometheus pods to ensure they are running.</li>
</ul>
<pre><code class="language-bash">kubectl get pods -n default -l &quot;release=prometheus&quot;
</code></pre>
</li>
<li>
<p><strong>Access Prometheus Dashboard</strong>:</p>
<ul>
<li>Forward the Prometheus service port to your local machine to access the Prometheus dashboard.</li>
</ul>
<pre><code class="language-bash">kubectl port-forward svc/prometheus-kube-prometheus-prometheus 9090:9090
</code></pre>
<ul>
<li>Open your browser and navigate to <code>http://localhost:9090</code> to access the Prometheus dashboard.</li>
</ul>
</li>
</ol>
</div><h2>Using Prometheus to Monitor Kubernetes</h2>
<div class='content'><p>Once Prometheus is set up, you can start monitoring your Kubernetes cluster and applications. Prometheus collects metrics from various sources, including Kubernetes components, application pods, and custom metrics.</p>
</div><h3>Key Metrics to Monitor:</h3>
<div class='content'><ul>
<li><strong>Node Metrics</strong>: CPU usage, memory usage, disk I/O, network I/O.</li>
<li><strong>Pod Metrics</strong>: CPU usage, memory usage, restart counts, pod status.</li>
<li><strong>Cluster Metrics</strong>: API server request rates, scheduler performance, controller manager metrics.</li>
</ul>
</div><h3>Example PromQL Queries:</h3>
<div class='content'><ol>
<li>
<p><strong>CPU Usage of a Node</strong>:</p>
<pre><code class="language-promql">sum(rate(node_cpu_seconds_total{mode!=&quot;idle&quot;}[5m])) by (instance)
</code></pre>
</li>
<li>
<p><strong>Memory Usage of a Pod</strong>:</p>
<pre><code class="language-promql">sum(container_memory_usage_bytes{pod=&quot;your-pod-name&quot;}) by (container)
</code></pre>
</li>
<li>
<p><strong>Total Requests to the API Server</strong>:</p>
<pre><code class="language-promql">sum(rate(apiserver_request_total[5m]))
</code></pre>
</li>
</ol>
</div><h3>Creating Alerts:</h3>
<div class='content'><p>Prometheus allows you to create alerts based on specific conditions. Alerts are defined in a configuration file and evaluated at regular intervals.</p>
<h4>Example Alert Rule:</h4>
<p>Create a file named <code>alert-rules.yaml</code> with the following content:</p>
</div><div style='position:relative'><a class='copy_button d-none d-md-inline' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Z3JvdXBzOgotIG5hbWU6IGV4YW1wbGUKICBydWxlczoKICAtIGFsZXJ0OiBIaWdoQ1BVVXNhZ2UKICAgIGV4cHI6IHN1bShyYXRlKGNvbnRhaW5lcl9jcHVfdXNhZ2Vfc2Vjb25kc190b3RhbFsxbV0pKSBieSAocG9kKSA+IDAuOAogICAgZm9yOiAybQogICAgbGFiZWxzOgogICAgICBzZXZlcml0eTogd2FybmluZwogICAgYW5ub3RhdGlvbnM6CiAgICAgIHN1bW1hcnk6ICJIaWdoIENQVSB1c2FnZSBkZXRlY3RlZCIKICAgICAgZGVzY3JpcHRpb246ICJQb2Qge3sgJGxhYmVscy5wb2QgfX0gaXMgdXNpbmcgbW9yZSB0aGFuIDgwJSBDUFUgZm9yIG1vcmUgdGhhbiAyIG1pbnV0ZXMuIg=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>groups:
- name: example
  rules:
  - alert: HighCPUUsage
    expr: sum(rate(container_cpu_usage_seconds_total[1m])) by (pod) &gt; 0.8
    for: 2m
    labels:
      severity: warning
    annotations:
      summary: &quot;High CPU usage detected&quot;
      description: &quot;Pod {{ $labels.pod }} is using more than 80% CPU for more than 2 minutes.&quot;</pre></div><div class='content'><p>Apply the alert rule:</p>
</div><div style='position:relative'><a class='copy_button d-none d-md-inline' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("a3ViZWN0bCBhcHBseSAtZiBhbGVydC1ydWxlcy55YW1s"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>kubectl apply -f alert-rules.yaml</pre></div><div class='content'></div><h2>Practical Exercise</h2>
<div class='content'></div><h3>Exercise: Monitor a Sample Application</h3>
<div class='content'><ol>
<li>
<p><strong>Deploy a Sample Application</strong>:</p>
<ul>
<li>Deploy a sample Nginx application in your Kubernetes cluster.</li>
</ul>
<pre><code class="language-yaml">apiVersion: apps/v1
kind: Deployment
metadata:
  name: nginx-deployment
spec:
  replicas: 2
  selector:
    matchLabels:
      app: nginx
  template:
    metadata:
      labels:
        app: nginx
    spec:
      containers:
      - name: nginx
        image: nginx:1.14.2
        ports:
        - containerPort: 80
</code></pre>
<pre><code class="language-bash">kubectl apply -f nginx-deployment.yaml
</code></pre>
</li>
<li>
<p><strong>Expose the Application</strong>:</p>
<ul>
<li>Create a service to expose the Nginx application.</li>
</ul>
<pre><code class="language-yaml">apiVersion: v1
kind: Service
metadata:
  name: nginx-service
spec:
  selector:
    app: nginx
  ports:
    - protocol: TCP
      port: 80
      targetPort: 80
</code></pre>
<pre><code class="language-bash">kubectl apply -f nginx-service.yaml
</code></pre>
</li>
<li>
<p><strong>Monitor the Application</strong>:</p>
<ul>
<li>Use Prometheus to monitor the CPU and memory usage of the Nginx pods.</li>
</ul>
<pre><code class="language-promql">sum(rate(container_cpu_usage_seconds_total{pod=~&quot;nginx-deployment-.*&quot;}[1m])) by (pod)
</code></pre>
<pre><code class="language-promql">sum(container_memory_usage_bytes{pod=~&quot;nginx-deployment-.*&quot;}) by (pod)
</code></pre>
</li>
</ol>
</div><h3>Solution:</h3>
<div class='content'><ul>
<li>Deploy the Nginx application and expose it using the provided YAML files.</li>
<li>Access the Prometheus dashboard and use the provided PromQL queries to monitor the CPU and memory usage of the Nginx pods.</li>
</ul>
</div><h2>Summary</h2>
<div class='content'><p>In this section, we covered the basics of Prometheus, how to set it up in a Kubernetes cluster, and how to use it to monitor your applications and infrastructure. We also explored some key metrics to monitor and how to create alerts based on specific conditions. By the end of this section, you should have a good understanding of how to use Prometheus for monitoring in Kubernetes.</p>
</div><div class='row navigation'>
	<div class='col-2 d-none d-md-block'>
					<a href='06-04-crds' title="Custom Resource Definitions (CRDs)" class="py-2 px-3 btn btn-primary">
				&#x25C4; Previous 
			</a>
			</div>
	<div class='col-2 d-md-none'>
					<a href='06-04-crds' title="Custom Resource Definitions (CRDs)" class="py-2 px-3 btn btn-primary">
				&#x25C4;
			</a>
			</div>
	<div class='col-8 text-center'>
			</div>
	<div class='col-2 text-end d-none d-md-block'>
					<a href='07-02-logging-efk' title="Logging with Elasticsearch, Fluentd, and Kibana (EFK)" class="py-2 px-3 btn btn-primary"
				data-read-mod="kubernetes" data-read-unit="7-1">
				Next &#x25BA;
			</a>
			</div>
	<div class='col-2 text-end d-md-none '>
					<a href='07-02-logging-efk' title="Logging with Elasticsearch, Fluentd, and Kibana (EFK)" class="py-2 px-3 btn btn-primary" 
				data-read-mod="kubernetes" data-read-unit="7-1">
				 &#x25BA;
			</a>
			</div>
</div>

			</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
						
	<div class="container mt-2 d-none d-md-block index">
		<h1>Kubernetes Course</h1>
<h2>Module 1: Introduction to Kubernetes</h2>
<ul>
<li><a href="01-01-what-is-kubernetes">What is Kubernetes?</a></li>
<li><a href="01-02-kubernetes-architecture">Kubernetes Architecture</a></li>
<li><a href="01-03-key-concepts-terminology">Key Concepts and Terminology</a></li>
<li><a href="01-04-setting-up-cluster">Setting Up a Kubernetes Cluster</a></li>
<li><a href="01-05-kubernetes-cli">Kubernetes CLI (kubectl)</a></li>
</ul>
<h2>Module 2: Core Kubernetes Components</h2>
<ul>
<li><a href="02-01-pods">Pods</a></li>
<li><a href="02-02-replicasets">ReplicaSets</a></li>
<li><a href="02-03-deployments">Deployments</a></li>
<li><a href="02-04-services">Services</a></li>
<li><a href="02-05-namespaces">Namespaces</a></li>
</ul>
<h2>Module 3: Configuration and Secrets Management</h2>
<ul>
<li><a href="03-01-configmaps">ConfigMaps</a></li>
<li><a href="03-02-secrets">Secrets</a></li>
<li><a href="03-03-environment-variables">Environment Variables</a></li>
<li><a href="03-04-resource-quotas-limits">Resource Quotas and Limits</a></li>
</ul>
<h2>Module 4: Networking in Kubernetes</h2>
<ul>
<li><a href="04-01-cluster-networking">Cluster Networking</a></li>
<li><a href="04-02-service-types">Service Types</a></li>
<li><a href="04-03-ingress-controllers">Ingress Controllers</a></li>
<li><a href="04-04-network-policies">Network Policies</a></li>
</ul>
<h2>Module 5: Storage in Kubernetes</h2>
<ul>
<li><a href="05-01-volumes">Volumes</a></li>
<li><a href="05-02-persistent-volumes">Persistent Volumes</a></li>
<li><a href="05-03-persistent-volume-claims">Persistent Volume Claims</a></li>
<li><a href="05-04-storage-classes">Storage Classes</a></li>
</ul>
<h2>Module 6: Advanced Kubernetes Concepts</h2>
<ul>
<li><a href="06-01-statefulsets">StatefulSets</a></li>
<li><a href="06-02-daemonsets">DaemonSets</a></li>
<li><a href="06-03-jobs-cronjobs">Jobs and CronJobs</a></li>
<li><a href="06-04-crds">Custom Resource Definitions (CRDs)</a></li>
</ul>
<h2>Module 7: Monitoring and Logging</h2>
<ul>
<li><a href="07-01-monitoring-prometheus">Monitoring with Prometheus</a></li>
<li><a href="07-02-logging-efk">Logging with Elasticsearch, Fluentd, and Kibana (EFK)</a></li>
<li><a href="07-03-health-checks-probes">Health Checks and Probes</a></li>
<li><a href="07-04-metrics-server">Metrics Server</a></li>
</ul>
<h2>Module 8: Security in Kubernetes</h2>
<ul>
<li><a href="08-01-rbac">Role-Based Access Control (RBAC)</a></li>
<li><a href="08-02-pod-security-policies">Pod Security Policies</a></li>
<li><a href="08-03-network-security">Network Security</a></li>
<li><a href="08-04-image-security">Image Security</a></li>
</ul>
<h2>Module 9: Scaling and Performance</h2>
<ul>
<li><a href="09-01-horizontal-pod-autoscaling">Horizontal Pod Autoscaling</a></li>
<li><a href="09-02-vertical-pod-autoscaling">Vertical Pod Autoscaling</a></li>
<li><a href="09-03-cluster-autoscaling">Cluster Autoscaling</a></li>
<li><a href="09-04-performance-tuning">Performance Tuning</a></li>
</ul>
<h2>Module 10: Kubernetes Ecosystem and Tools</h2>
<ul>
<li><a href="10-01-helm">Helm</a></li>
<li><a href="10-02-kustomize">Kustomize</a></li>
<li><a href="10-03-kubeadm">Kubeadm</a></li>
<li><a href="10-04-minikube">Minikube</a></li>
</ul>
<h2>Module 11: Case Studies and Real-World Applications</h2>
<ul>
<li><a href="11-01-deploying-web-application">Deploying a Web Application</a></li>
<li><a href="11-02-cicd-kubernetes">CI/CD with Kubernetes</a></li>
<li><a href="11-03-running-stateful-applications">Running Stateful Applications</a></li>
<li><a href="11-04-multi-cluster-management">Multi-Cluster Management</a></li>
</ul>
<h2>Module 12: Preparing for Kubernetes Certification</h2>
<ul>
<li><a href="12-01-cka">Certified Kubernetes Administrator (CKA)</a></li>
<li><a href="12-02-ckad">Certified Kubernetes Application Developer (CKAD)</a></li>
<li><a href="12-03-cks">Certified Kubernetes Security Specialist (CKS)</a></li>
<li><a href="12-04-exam-preparation-tips">Exam Preparation Tips</a></li>
</ul>

	</div>










		</div>
	</div>
</div>		
<div class="container-xxl d-block d-md-none">
	<div class="row">
		<div class="col-12 p-2 p-md-0 m-0 text-end">
			<a href="/objective" rel="nofollow">The Project</a> | 
<a href="/about" rel="nofollow">About Us</a> | 
<a href="/contribute" rel="nofollow">Contribute</a> | 
<a href="/donate" rel="nofollow">Donations</a> | 
<a href="/license" rel="nofollow">License</a>
		</div>
	</div>
</div>

<div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. All rights reserved</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	We use cookies to improve your user experience and offer content tailored to your interests.
    <a href="#" id="btn_accept_cookies" class="button">Accept</a>
    <a href="/cookies">More Information</a>
</div>	

		<div class="modal fade" id="loginModal" tabindex="-1" aria-labelledby="loginModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="loginModalLabel">User not authenticated</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
            	<div id="modal-body-main"></div>
            </div>
        </div>
    </div>
</div>	</div>    
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
</body>
</html>
