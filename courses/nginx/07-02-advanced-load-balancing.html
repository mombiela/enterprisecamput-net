<!DOCTYPE html>
<html lang="en">
<head>
    <title> Advanced Load Balancing </title>
        
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="index, follow, noarchive">
    
    <link rel="alternate" href="https://campusempresa.com/cursos/nginx/07-02-advanced-load-balancing" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/cursos/nginx/07-02-advanced-load-balancing" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/courses/nginx/07-02-advanced-load-balancing" hreflang="en" />
    
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.1ab297bfa4.css" rel="stylesheet">
	 
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="/js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script>
  		var LANG = "en";
  		var CATEGORY = "tech-tools";
  		var MOD_NAME = "nginx";
  		var TEMA_NAME = "7-2";
  		var TYPE = "mod";
  		var PATH = "mod/nginx/07-02-advanced-load-balancing";
  		var IS_INDEX = false;
  	</script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="module" src="/js/app.902a5a267d.js"></script>
	<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-0611338592562725" crossorigin="anonymous"></script>
	  	
	<!-- Google tag (gtag.js) -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=G-VVPMPJSR3P"></script>
	<script>
	  window.dataLayer = window.dataLayer || [];
	  function gtag(){dataLayer.push(arguments);}
	  gtag('js', new Date());	
	  gtag('config', 'G-VVPMPJSR3P');
	</script>
</head>

<body class="d-none">
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-12 col-md-6 p-0">
			<a href="/"><img src="/img/logo-header_enterprise.png" alt="Logo Enterprise Campus"></a>
		</div>
		<div class="col-12 col-md-6 p-0 text-end">
			<p class="mb-0 p-0">	<b id="lit_lang_es" class="px-2">EN</b>
	|
	<a href="https://campusempresa.com/cursos/nginx/07-02-advanced-load-balancing" class="px-2">ES</a></b>
	|
	<a href="https://campusempresa.cat/cursos/nginx/07-02-advanced-load-balancing" class="px-2">CA</a>
</p>
			<p class="mb-4 mt-0 mx-2  d-none d-md-block"><cite>All the knowledge within your reach</cite></p>
		</div>
	</div>
</div>
<div class="subheader container-xxl d-none d-md-block">
	<div class="row">
		<div class="col-12 p-2 p-md-0 m-0 text-end">
			<a href="/objective" rel="nofollow">The Project</a> | 
<a href="/about" rel="nofollow">About Us</a> | 
<a href="/contribute" rel="nofollow">Contribute</a> | 
<a href="/donate" rel="nofollow">Donations</a> | 
<a href="/license" rel="nofollow">License</a>
		</div>
	</div>
</div>
		<div class="top-bar container-fluid p-0">
	<div class="container-xxl p-0">
		<div class="row">
			<div class="col">
				<div class="d-flex justify-content-between">
					<div class="left">
						<a href="/" class="nav-link px-3" id="btnHome">
	<i class="bi bi-house-fill"></i>
	HOME
</a>

<a href="/my-courses" class="nav-link px-3 d-none" id="btnMyCourses">
	<i class="bi bi-rocket-takeoff-fill"></i>
	<i><b>My courses</b></i>
</a>
<a href="/completed-courses" class="nav-link px-3 d-none" id="trophy_button">
	<i class="bi bi-trophy-fill"></i>
	Completed             
</a>

					</div>
                    <div class="ms-auto right">
                        <a id="user_button" href="#" class="nav-link px-3" data-bs-toggle="modal" data-bs-target="#loginModal">
                            <i id="user_icon" class="bi"></i>                            
                        </a>
                    </div>					
				</div>
			</div>
		</div>
	</div>
</div>

		<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
										<div class="row py-1 m-0" id="buttonsModSection">
	<div class="col-6 p-0" data-mod="nginx">
		<a  href="#" class="text-secondary d-none" data-read-mod="nginx" data-read-unit="7-2" style="text-decoration:none;">
			<i class="bi bi-check-circle-fill"></i> 
			Mark as read
		</a>
		<a href="#" class="text-secondary d-none" data-unread-mod="nginx" data-unread-unit="7-2" style="text-decoration:none;">
			<i class="bi bi-x-circle-fill"></i>
			Mark as unread
		</a>
	</div>
	<div class="col-6 text-end p-0">
					<a href="./"  class="nav-link">
				<i class="bi bi-journal-text"></i>
				Course Content
			</a>
			</div>
</div>						<div id="inner_content">
				<div class='row navigation'>
	<div class='col-2 d-none d-md-block'>
					<a href='07-01-introduction-nginx-plus' title="Introduction to NGINX Plus" class="py-2 px-3 btn btn-primary">
				&#x25C4; Previous 
			</a>
			</div>
	<div class='col-2 d-md-none'>
					<a href='07-01-introduction-nginx-plus' title="Introduction to NGINX Plus" class="py-2 px-3 btn btn-primary">
				&#x25C4;
			</a>
			</div>
	<div class='col-8 text-center'>
					<h1 style="text-decoration:underline">Advanced Load Balancing</h1>
			</div>
	<div class='col-2 text-end d-none d-md-block'>
					<a href='07-03-application-health-monitoring' title="Application Health Monitoring" class="py-2 px-3 btn btn-primary"
				data-read-mod="nginx" data-read-unit="7-2">
				Next &#x25BA;
			</a>
			</div>
	<div class='col-2 text-end d-md-none '>
					<a href='07-03-application-health-monitoring' title="Application Health Monitoring" class="py-2 px-3 btn btn-primary" 
				data-read-mod="nginx" data-read-unit="7-2">
				 &#x25BA;
			</a>
			</div>
</div>
<div class='content'><p>In this section, we will delve into advanced load balancing techniques using NGINX Plus. Load balancing is crucial for distributing incoming network traffic across multiple servers to ensure no single server becomes overwhelmed, thus improving the overall performance and reliability of your web applications.</p>
</div><h2>Key Concepts</h2>
<div class='content'><ol>
<li>
<p><strong>Load Balancing Algorithms</strong>:</p>
<ul>
<li><strong>Round Robin</strong>: Distributes requests sequentially.</li>
<li><strong>Least Connections</strong>: Directs traffic to the server with the fewest active connections.</li>
<li><strong>IP Hash</strong>: Routes requests based on the client's IP address.</li>
<li><strong>Random with Two Choices</strong>: Selects two servers at random and sends the request to the one with fewer connections.</li>
</ul>
</li>
<li>
<p><strong>Session Persistence</strong>:</p>
<ul>
<li>Ensures that a user's session is consistently directed to the same server.</li>
</ul>
</li>
<li>
<p><strong>Health Checks</strong>:</p>
<ul>
<li>Regularly monitors the health of backend servers to ensure traffic is only sent to healthy servers.</li>
</ul>
</li>
<li>
<p><strong>Dynamic Reconfiguration</strong>:</p>
<ul>
<li>Allows for real-time updates to the load balancing configuration without restarting NGINX.</li>
</ul>
</li>
</ol>
</div><h2>Practical Example</h2>
<div class='content'></div><h3>Load Balancing Configuration</h3>
<div class='content'><p>Below is an example of an advanced load balancing configuration using NGINX Plus:</p>
</div><div style='position:relative'><a class='copy_button d-none d-md-inline' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("aHR0cCB7CiAgICB1cHN0cmVhbSBiYWNrZW5kIHsKICAgICAgICB6b25lIGJhY2tlbmQgNjRrOwogICAgICAgIHNlcnZlciBiYWNrZW5kMS5leGFtcGxlLmNvbTsKICAgICAgICBzZXJ2ZXIgYmFja2VuZDIuZXhhbXBsZS5jb207CiAgICAgICAgc2VydmVyIGJhY2tlbmQzLmV4YW1wbGUuY29tOwoKICAgICAgICAjIExvYWQgYmFsYW5jaW5nIGFsZ29yaXRobQogICAgICAgIGxlYXN0X2Nvbm47CgogICAgICAgICMgSGVhbHRoIGNoZWNrcwogICAgICAgIGhlYWx0aF9jaGVjayBpbnRlcnZhbD0xMHMgZmFpbHM9MyBwYXNzZXM9MjsKICAgIH0KCiAgICBzZXJ2ZXIgewogICAgICAgIGxpc3RlbiA4MDsKCiAgICAgICAgbG9jYXRpb24gLyB7CiAgICAgICAgICAgIHByb3h5X3Bhc3MgaHR0cDovL2JhY2tlbmQ7CiAgICAgICAgICAgIHByb3h5X3NldF9oZWFkZXIgSG9zdCAkaG9zdDsKICAgICAgICAgICAgcHJveHlfc2V0X2hlYWRlciBYLVJlYWwtSVAgJHJlbW90ZV9hZGRyOwogICAgICAgICAgICBwcm94eV9zZXRfaGVhZGVyIFgtRm9yd2FyZGVkLUZvciAkcHJveHlfYWRkX3hfZm9yd2FyZGVkX2ZvcjsKICAgICAgICAgICAgcHJveHlfc2V0X2hlYWRlciBYLUZvcndhcmRlZC1Qcm90byAkc2NoZW1lOwogICAgICAgIH0KICAgIH0KfQ=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>http {
    upstream backend {
        zone backend 64k;
        server backend1.example.com;
        server backend2.example.com;
        server backend3.example.com;

        # Load balancing algorithm
        least_conn;

        # Health checks
        health_check interval=10s fails=3 passes=2;
    }

    server {
        listen 80;

        location / {
            proxy_pass http://backend;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
    }
}</pre></div><div class='content'></div><h3>Explanation</h3>
<div class='content'><ul>
<li><strong>upstream backend</strong>: Defines a group of backend servers.</li>
<li><strong>zone backend 64k</strong>: Allocates shared memory for storing the state of the upstream group.</li>
<li><strong>least_conn</strong>: Uses the least connections algorithm for load balancing.</li>
<li><strong>health_check</strong>: Configures health checks to run every 10 seconds, marking a server as unhealthy after 3 consecutive failures and healthy after 2 consecutive successes.</li>
<li><strong>proxy_pass</strong>: Forwards requests to the defined upstream group.</li>
<li><strong>proxy_set_header</strong>: Sets various headers to pass along with the request.</li>
</ul>
</div><h2>Practical Exercise</h2>
<div class='content'></div><h3>Exercise: Configure Advanced Load Balancing</h3>
<div class='content'><ol>
<li><strong>Objective</strong>: Configure NGINX Plus to use the IP Hash load balancing algorithm and set up session persistence.</li>
<li><strong>Steps</strong>:
<ul>
<li>Define an upstream group with at least three backend servers.</li>
<li>Configure the IP Hash algorithm.</li>
<li>Enable session persistence.</li>
<li>Set up health checks.</li>
</ul>
</li>
</ol>
</div><h3>Solution</h3>
<div class='content'></div><div style='position:relative'><a class='copy_button d-none d-md-inline' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("aHR0cCB7CiAgICB1cHN0cmVhbSBiYWNrZW5kIHsKICAgICAgICB6b25lIGJhY2tlbmQgNjRrOwogICAgICAgIHNlcnZlciBiYWNrZW5kMS5leGFtcGxlLmNvbTsKICAgICAgICBzZXJ2ZXIgYmFja2VuZDIuZXhhbXBsZS5jb207CiAgICAgICAgc2VydmVyIGJhY2tlbmQzLmV4YW1wbGUuY29tOwoKICAgICAgICAjIExvYWQgYmFsYW5jaW5nIGFsZ29yaXRobQogICAgICAgIGlwX2hhc2g7CgogICAgICAgICMgSGVhbHRoIGNoZWNrcwogICAgICAgIGhlYWx0aF9jaGVjayBpbnRlcnZhbD0xMHMgZmFpbHM9MyBwYXNzZXM9MjsKICAgIH0KCiAgICBzZXJ2ZXIgewogICAgICAgIGxpc3RlbiA4MDsKCiAgICAgICAgbG9jYXRpb24gLyB7CiAgICAgICAgICAgIHByb3h5X3Bhc3MgaHR0cDovL2JhY2tlbmQ7CiAgICAgICAgICAgIHByb3h5X3NldF9oZWFkZXIgSG9zdCAkaG9zdDsKICAgICAgICAgICAgcHJveHlfc2V0X2hlYWRlciBYLVJlYWwtSVAgJHJlbW90ZV9hZGRyOwogICAgICAgICAgICBwcm94eV9zZXRfaGVhZGVyIFgtRm9yd2FyZGVkLUZvciAkcHJveHlfYWRkX3hfZm9yd2FyZGVkX2ZvcjsKICAgICAgICAgICAgcHJveHlfc2V0X2hlYWRlciBYLUZvcndhcmRlZC1Qcm90byAkc2NoZW1lOwoKICAgICAgICAgICAgIyBTZXNzaW9uIHBlcnNpc3RlbmNlCiAgICAgICAgICAgIHByb3h5X2Nvb2tpZV9wYXRoIC8gIi87IEh0dHBPbmx5OyBTZWN1cmU7IFNhbWVTaXRlPVN0cmljdCI7CiAgICAgICAgfQogICAgfQp9"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>http {
    upstream backend {
        zone backend 64k;
        server backend1.example.com;
        server backend2.example.com;
        server backend3.example.com;

        # Load balancing algorithm
        ip_hash;

        # Health checks
        health_check interval=10s fails=3 passes=2;
    }

    server {
        listen 80;

        location / {
            proxy_pass http://backend;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;

            # Session persistence
            proxy_cookie_path / &quot;/; HttpOnly; Secure; SameSite=Strict&quot;;
        }
    }
}</pre></div><div class='content'></div><h3>Explanation</h3>
<div class='content'><ul>
<li><strong>ip_hash</strong>: Uses the IP Hash algorithm to ensure requests from the same client IP are directed to the same server.</li>
<li><strong>proxy_cookie_path</strong>: Ensures session cookies are set with appropriate security attributes.</li>
</ul>
</div><h2>Common Mistakes and Tips</h2>
<div class='content'><ul>
<li><strong>Misconfigured Health Checks</strong>: Ensure the health check parameters are correctly set to avoid false positives or negatives.</li>
<li><strong>Session Persistence</strong>: Be cautious with session persistence settings to avoid issues with load distribution.</li>
<li><strong>Dynamic Reconfiguration</strong>: Use NGINX Plus's API for dynamic reconfiguration to avoid downtime.</li>
</ul>
</div><h2>Conclusion</h2>
<div class='content'><p>In this section, we covered advanced load balancing techniques using NGINX Plus, including various algorithms, session persistence, and health checks. These techniques help ensure efficient traffic distribution and high availability of your web applications. In the next section, we will explore application health monitoring with NGINX Plus.</p>
</div><div class='row navigation'>
	<div class='col-2 d-none d-md-block'>
					<a href='07-01-introduction-nginx-plus' title="Introduction to NGINX Plus" class="py-2 px-3 btn btn-primary">
				&#x25C4; Previous 
			</a>
			</div>
	<div class='col-2 d-md-none'>
					<a href='07-01-introduction-nginx-plus' title="Introduction to NGINX Plus" class="py-2 px-3 btn btn-primary">
				&#x25C4;
			</a>
			</div>
	<div class='col-8 text-center'>
			</div>
	<div class='col-2 text-end d-none d-md-block'>
					<a href='07-03-application-health-monitoring' title="Application Health Monitoring" class="py-2 px-3 btn btn-primary"
				data-read-mod="nginx" data-read-unit="7-2">
				Next &#x25BA;
			</a>
			</div>
	<div class='col-2 text-end d-md-none '>
					<a href='07-03-application-health-monitoring' title="Application Health Monitoring" class="py-2 px-3 btn btn-primary" 
				data-read-mod="nginx" data-read-unit="7-2">
				 &#x25BA;
			</a>
			</div>
</div>

			</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
						
	<div class="container mt-2 d-none d-md-block index">
		<h1>NGINX Course</h1>
<h2>Module 1: Introduction to NGINX</h2>
<ul>
<li><a href="01-01-what-is-nginx">What is NGINX?</a></li>
<li><a href="01-02-installing-nginx">Installing NGINX</a></li>
<li><a href="01-03-basic-nginx-configuration">Basic NGINX Configuration</a></li>
<li><a href="01-04-starting-stopping-nginx">Starting and Stopping NGINX</a></li>
</ul>
<h2>Module 2: NGINX as a Web Server</h2>
<ul>
<li><a href="02-01-serving-static-content">Serving Static Content</a></li>
<li><a href="02-02-directory-listings">Directory Listings</a></li>
<li><a href="02-03-custom-error-pages">Custom Error Pages</a></li>
<li><a href="02-04-logging-log-formats">Logging and Log Formats</a></li>
</ul>
<h2>Module 3: NGINX as a Reverse Proxy</h2>
<ul>
<li><a href="03-01-introduction-reverse-proxy">Introduction to Reverse Proxy</a></li>
<li><a href="03-02-configuring-reverse-proxy">Configuring a Reverse Proxy</a></li>
<li><a href="03-03-load-balancing">Load Balancing</a></li>
<li><a href="03-04-health-checks">Health Checks</a></li>
</ul>
<h2>Module 4: Security and Optimization</h2>
<ul>
<li><a href="04-01-basic-security-practices">Basic Security Practices</a></li>
<li><a href="04-02-rate-limiting">Rate Limiting</a></li>
<li><a href="04-03-ssl-tls-configuration">SSL/TLS Configuration</a></li>
<li><a href="04-04-caching">Caching</a></li>
</ul>
<h2>Module 5: Advanced NGINX Features</h2>
<ul>
<li><a href="05-01-nginx-modules">NGINX Modules</a></li>
<li><a href="05-02-using-nginx-docker">Using NGINX with Docker</a></li>
<li><a href="05-03-nginx-http2">NGINX and HTTP/2</a></li>
<li><a href="05-04-nginx-grpc">NGINX and gRPC</a></li>
</ul>
<h2>Module 6: Monitoring and Troubleshooting</h2>
<ul>
<li><a href="06-01-monitoring-nginx">Monitoring NGINX</a></li>
<li><a href="06-02-common-issues-solutions">Common Issues and Solutions</a></li>
<li><a href="06-03-performance-tuning">Performance Tuning</a></li>
<li><a href="06-04-debugging-nginx">Debugging NGINX</a></li>
</ul>
<h2>Module 7: NGINX Plus</h2>
<ul>
<li><a href="07-01-introduction-nginx-plus">Introduction to NGINX Plus</a></li>
<li><a href="07-02-advanced-load-balancing">Advanced Load Balancing</a></li>
<li><a href="07-03-application-health-monitoring">Application Health Monitoring</a></li>
<li><a href="07-04-dynamic-configuration">Dynamic Configuration</a></li>
</ul>

	</div>










		</div>
	</div>
</div>		
<div class="container-xxl d-block d-md-none">
	<div class="row">
		<div class="col-12 p-2 p-md-0 m-0 text-end">
			<a href="/objective" rel="nofollow">The Project</a> | 
<a href="/about" rel="nofollow">About Us</a> | 
<a href="/contribute" rel="nofollow">Contribute</a> | 
<a href="/donate" rel="nofollow">Donations</a> | 
<a href="/license" rel="nofollow">License</a>
		</div>
	</div>
</div>

<div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. All rights reserved</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	We use cookies to improve your user experience and offer content tailored to your interests.
    <a href="#" id="btn_accept_cookies" class="button">Accept</a>
    <a href="/cookies">More Information</a>
</div>	

		<div class="modal fade" id="loginModal" tabindex="-1" aria-labelledby="loginModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="loginModalLabel">User not authenticated</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
            	<div id="modal-body-main"></div>
            </div>
        </div>
    </div>
</div>	</div>    
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
</body>
</html>
