<!DOCTYPE html>
<html lang="en">
<head>
    <title> Metatables and Metamethods </title>
        
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="index, nofollow, noarchive">
    
    <link rel="alternate" href="https://campusempresa.com/cursos/lua/03-02-metatables-metamethods" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/cursos/lua/03-02-metatables-metamethods" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/courses/lua/03-02-metatables-metamethods" hreflang="en" />
    
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.188a386f47.css" rel="stylesheet">
	 
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="/js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script>
  		var LANG = "en";
  		var CATEGORY = "languages";
  		var MOD_NAME = "lua";
  		var TEMA_NAME = "3-2";
  		var TYPE = "mod";
  		var PATH = "mod/lua/03-02-metatables-metamethods";
  		var IS_INDEX = false;
  	</script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="module" src="/js/app.902a5a267d.js"></script>
	<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-0611338592562725" crossorigin="anonymous"></script>
	  	
	<!-- Google tag (gtag.js) -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=G-VVPMPJSR3P"></script>
	<script>
	  window.dataLayer = window.dataLayer || [];
	  function gtag(){dataLayer.push(arguments);}
	  gtag('js', new Date());	
	  gtag('config', 'G-VVPMPJSR3P');
	</script>
</head>

<body class="d-none">
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-12 col-md-6 p-0">
			<a href="/"><img src="/img/logo-header_enterprise.png" alt="Logo Enterprise Campus"></a>
		</div>
		<div class="col-12 col-md-6 p-0 text-end">
			<p class="mb-0 p-0">	<b id="lit_lang_es" class="px-2">EN</b>
	|
	<a href="https://campusempresa.com/cursos/lua/03-02-metatables-metamethods" class="px-2">ES</a></b>
	|
	<a href="https://campusempresa.cat/cursos/lua/03-02-metatables-metamethods" class="px-2">CA</a>
</p>
			<p class="mb-4 mt-0 mx-2  d-none d-md-block"><cite>All the knowledge within your reach</cite></p>
		</div>
	</div>
</div>
<div class="subheader container-xxl d-none d-md-block">
	<div class="row">
		<div class="col-12 p-2 p-md-0 m-0 text-end">
			<a href="/objective" rel="nofollow">The Project</a> | 
<a href="/about" rel="nofollow">About Us</a> | 
<a href="/contribute" rel="nofollow">Contribute</a> | 
<a href="/donate" rel="nofollow">Donations</a> | 
<a href="/license" rel="nofollow">License</a>
		</div>
	</div>
</div>
		<div class="top-bar container-fluid p-0">
	<div class="container-xxl p-0">
		<div class="row">
			<div class="col">
				<div class="d-flex justify-content-between">
					<div class="left">
						<a href="/" class="nav-link px-3" id="btnHome">
	<i class="bi bi-house-fill"></i>
	HOME
</a>

<a href="/my-courses" class="nav-link px-3 d-none" id="btnMyCourses">
	<i class="bi bi-rocket-takeoff-fill"></i>
	<i><b>My courses</b></i>
</a>
<a href="/completed-courses" class="nav-link px-3 d-none" id="trophy_button">
	<i class="bi bi-trophy-fill"></i>
	Completed             
</a>

					</div>
                    <div class="ms-auto right">
                        <a id="user_button" href="#" class="nav-link px-3" data-bs-toggle="modal" data-bs-target="#loginModal">
                            <i id="user_icon" class="bi"></i>                            
                        </a>
                    </div>					
				</div>
			</div>
		</div>
	</div>
</div>

		<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
										<div class="row py-1 m-0" id="buttonsModSection">
	<div class="col-6 p-0" data-mod="lua">
		<a  href="#" class="text-secondary d-none" data-read-mod="lua" data-read-unit="3-2" style="text-decoration:none;">
			<i class="bi bi-check-circle-fill"></i> 
			Mark as read
		</a>
		<a href="#" class="text-secondary d-none" data-unread-mod="lua" data-unread-unit="3-2" style="text-decoration:none;">
			<i class="bi bi-x-circle-fill"></i>
			Mark as unread
		</a>
	</div>
	<div class="col-6 text-end p-0">
					<a href="./"  class="nav-link">
				<i class="bi bi-journal-text"></i>
				Course Content
			</a>
			</div>
</div>						<div id="inner_content">
				<div class='row navigation'>
	<div class='col-2 d-none d-md-block'>
					<a href='03-01-tables' title="Tables" class="py-2 px-3 btn btn-primary">
				&#x25C4; Previous 
			</a>
			</div>
	<div class='col-2 d-md-none'>
					<a href='03-01-tables' title="Tables" class="py-2 px-3 btn btn-primary">
				&#x25C4;
			</a>
			</div>
	<div class='col-8 text-center'>
					<h1 style="text-decoration:underline">Metatables and Metamethods</h1>
			</div>
	<div class='col-2 text-end d-none d-md-block'>
					<a href='03-03-modules-packages' title="Modules and Packages" class="py-2 px-3 btn btn-primary"
				data-read-mod="lua" data-read-unit="3-2">
				Next &#x25BA;
			</a>
			</div>
	<div class='col-2 text-end d-md-none '>
					<a href='03-03-modules-packages' title="Modules and Packages" class="py-2 px-3 btn btn-primary" 
				data-read-mod="lua" data-read-unit="3-2">
				 &#x25BA;
			</a>
			</div>
</div>
<div class='content'><p>Metatables and metamethods are powerful features in Lua that allow you to change the behavior of tables. They enable you to define custom operations for tables, such as arithmetic operations, comparisons, and more. This module will cover the basics of metatables and metamethods, how to set them up, and practical examples to illustrate their use.</p>
</div><h2>What are Metatables?</h2>
<div class='content'><p>A metatable is a table that defines how another table behaves in certain operations. You can think of it as a set of rules or methods that Lua follows when performing operations on the table.</p>
</div><h3>Key Concepts</h3>
<div class='content'><ul>
<li><strong>Metatable</strong>: A table that defines behavior for another table.</li>
<li><strong>Metamethod</strong>: A function defined in a metatable that overrides the default behavior of a table.</li>
</ul>
</div><h2>Setting Up a Metatable</h2>
<div class='content'><p>To set up a metatable for a table, you use the <code>setmetatable</code> function. You can retrieve the metatable of a table using the <code>getmetatable</code> function.</p>
</div><h3>Example</h3>
<div class='content'></div><div style='position:relative'><a class='copy_button d-none d-md-inline' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("bG9jYWwgbXlUYWJsZSA9IHt9CmxvY2FsIG15TWV0YXRhYmxlID0ge30KCnNldG1ldGF0YWJsZShteVRhYmxlLCBteU1ldGF0YWJsZSkKCnByaW50KGdldG1ldGF0YWJsZShteVRhYmxlKSA9PSBteU1ldGF0YWJsZSkgIC0tIE91dHB1dDogdHJ1ZQ=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>local myTable = {}
local myMetatable = {}

setmetatable(myTable, myMetatable)

print(getmetatable(myTable) == myMetatable)  -- Output: true</pre></div><div class='content'><p>In this example, <code>myTable</code> is assigned a metatable <code>myMetatable</code>. The <code>getmetatable</code> function confirms that <code>myTable</code>'s metatable is indeed <code>myMetatable</code>.</p>
</div><h2>Common Metamethods</h2>
<div class='content'><p>Metamethods are special keys in a metatable that Lua recognizes and uses to override default behaviors. Here are some common metamethods:</p>
<table>
<thead>
<tr>
<th>Metamethod</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>__index</code></td>
<td>Accesses a value in the table.</td>
</tr>
<tr>
<td><code>__newindex</code></td>
<td>Sets a value in the table.</td>
</tr>
<tr>
<td><code>__add</code></td>
<td>Defines behavior for the <code>+</code> operator.</td>
</tr>
<tr>
<td><code>__sub</code></td>
<td>Defines behavior for the <code>-</code> operator.</td>
</tr>
<tr>
<td><code>__mul</code></td>
<td>Defines behavior for the <code>*</code> operator.</td>
</tr>
<tr>
<td><code>__div</code></td>
<td>Defines behavior for the <code>/</code> operator.</td>
</tr>
<tr>
<td><code>__eq</code></td>
<td>Defines behavior for the <code>==</code> operator.</td>
</tr>
<tr>
<td><code>__lt</code></td>
<td>Defines behavior for the <code>&lt;</code> operator.</td>
</tr>
<tr>
<td><code>__le</code></td>
<td>Defines behavior for the <code>&lt;=</code> operator.</td>
</tr>
</tbody>
</table>
</div><h2>Practical Examples</h2>
<div class='content'></div><h3>Example 1: Using <code>__index</code> Metamethod</h3>
<div class='content'><p>The <code>__index</code> metamethod is used to define what happens when you try to access a key that does not exist in the table.</p>
</div><div style='position:relative'><a class='copy_button d-none d-md-inline' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("bG9jYWwgZGVmYXVsdFRhYmxlID0ge2EgPSAxLCBiID0gMn0KbG9jYWwgbXlUYWJsZSA9IHNldG1ldGF0YWJsZSh7fSwge19faW5kZXggPSBkZWZhdWx0VGFibGV9KQoKcHJpbnQobXlUYWJsZS5hKSAgLS0gT3V0cHV0OiAxCnByaW50KG15VGFibGUuYikgIC0tIE91dHB1dDogMgpwcmludChteVRhYmxlLmMpICAtLSBPdXRwdXQ6IG5pbA=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>local defaultTable = {a = 1, b = 2}
local myTable = setmetatable({}, {__index = defaultTable})

print(myTable.a)  -- Output: 1
print(myTable.b)  -- Output: 2
print(myTable.c)  -- Output: nil</pre></div><div class='content'><p>In this example, <code>myTable</code> uses <code>defaultTable</code> as a fallback for missing keys.</p>
</div><h3>Example 2: Using <code>__newindex</code> Metamethod</h3>
<div class='content'><p>The <code>__newindex</code> metamethod is used to define what happens when you try to set a key in the table.</p>
</div><div style='position:relative'><a class='copy_button d-none d-md-inline' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("bG9jYWwgbXlUYWJsZSA9IHt9CmxvY2FsIG15TWV0YXRhYmxlID0gewogICAgX19uZXdpbmRleCA9IGZ1bmN0aW9uKHRhYmxlLCBrZXksIHZhbHVlKQogICAgICAgIHByaW50KCJTZXR0aW5nIGtleSAiIC4uIGtleSAuLiAiIHRvIHZhbHVlICIgLi4gdmFsdWUpCiAgICAgICAgcmF3c2V0KHRhYmxlLCBrZXksIHZhbHVlKQogICAgZW5kCn0KCnNldG1ldGF0YWJsZShteVRhYmxlLCBteU1ldGF0YWJsZSkKbXlUYWJsZS5hID0gMTAgIC0tIE91dHB1dDogU2V0dGluZyBrZXkgYSB0byB2YWx1ZSAxMA=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>local myTable = {}
local myMetatable = {
    __newindex = function(table, key, value)
        print(&quot;Setting key &quot; .. key .. &quot; to value &quot; .. value)
        rawset(table, key, value)
    end
}

setmetatable(myTable, myMetatable)
myTable.a = 10  -- Output: Setting key a to value 10</pre></div><div class='content'><p>In this example, the <code>__newindex</code> metamethod prints a message whenever a new key-value pair is added to <code>myTable</code>.</p>
</div><h3>Example 3: Using Arithmetic Metamethods</h3>
<div class='content'><p>You can define custom behavior for arithmetic operations using metamethods like <code>__add</code>, <code>__sub</code>, etc.</p>
</div><div style='position:relative'><a class='copy_button d-none d-md-inline' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("bG9jYWwgdmVjdG9yMSA9IHt4ID0gMSwgeSA9IDJ9CmxvY2FsIHZlY3RvcjIgPSB7eCA9IDMsIHkgPSA0fQoKbG9jYWwgdmVjdG9yTWV0YXRhYmxlID0gewogICAgX19hZGQgPSBmdW5jdGlvbih2MSwgdjIpCiAgICAgICAgcmV0dXJuIHt4ID0gdjEueCArIHYyLngsIHkgPSB2MS55ICsgdjIueX0KICAgIGVuZAp9CgpzZXRtZXRhdGFibGUodmVjdG9yMSwgdmVjdG9yTWV0YXRhYmxlKQpzZXRtZXRhdGFibGUodmVjdG9yMiwgdmVjdG9yTWV0YXRhYmxlKQoKbG9jYWwgcmVzdWx0ID0gdmVjdG9yMSArIHZlY3RvcjIKcHJpbnQocmVzdWx0LngsIHJlc3VsdC55KSAgLS0gT3V0cHV0OiA0IDY="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>local vector1 = {x = 1, y = 2}
local vector2 = {x = 3, y = 4}

local vectorMetatable = {
    __add = function(v1, v2)
        return {x = v1.x + v2.x, y = v1.y + v2.y}
    end
}

setmetatable(vector1, vectorMetatable)
setmetatable(vector2, vectorMetatable)

local result = vector1 + vector2
print(result.x, result.y)  -- Output: 4 6</pre></div><div class='content'><p>In this example, the <code>__add</code> metamethod defines how to add two vectors.</p>
</div><h2>Exercises</h2>
<div class='content'></div><h3>Exercise 1: Custom Indexing</h3>
<div class='content'><p>Create a table with a metatable that provides default values for missing keys.</p>
</div><div style='position:relative'><a class='copy_button d-none d-md-inline' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("bG9jYWwgZGVmYXVsdFZhbHVlcyA9IHthID0gMTAsIGIgPSAyMH0KbG9jYWwgbXlUYWJsZSA9IHNldG1ldGF0YWJsZSh7fSwge19faW5kZXggPSBkZWZhdWx0VmFsdWVzfSkKCnByaW50KG15VGFibGUuYSkgIC0tIE91dHB1dDogMTAKcHJpbnQobXlUYWJsZS5iKSAgLS0gT3V0cHV0OiAyMApwcmludChteVRhYmxlLmMpICAtLSBPdXRwdXQ6IG5pbA=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>local defaultValues = {a = 10, b = 20}
local myTable = setmetatable({}, {__index = defaultValues})

print(myTable.a)  -- Output: 10
print(myTable.b)  -- Output: 20
print(myTable.c)  -- Output: nil</pre></div><div class='content'></div><h3>Exercise 2: Custom Addition</h3>
<div class='content'><p>Define a metatable that allows you to add two tables representing complex numbers.</p>
</div><div style='position:relative'><a class='copy_button d-none d-md-inline' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("bG9jYWwgY29tcGxleDEgPSB7cmVhbCA9IDEsIGltYWcgPSAyfQpsb2NhbCBjb21wbGV4MiA9IHtyZWFsID0gMywgaW1hZyA9IDR9Cgpsb2NhbCBjb21wbGV4TWV0YXRhYmxlID0gewogICAgX19hZGQgPSBmdW5jdGlvbihjMSwgYzIpCiAgICAgICAgcmV0dXJuIHtyZWFsID0gYzEucmVhbCArIGMyLnJlYWwsIGltYWcgPSBjMS5pbWFnICsgYzIuaW1hZ30KICAgIGVuZAp9CgpzZXRtZXRhdGFibGUoY29tcGxleDEsIGNvbXBsZXhNZXRhdGFibGUpCnNldG1ldGF0YWJsZShjb21wbGV4MiwgY29tcGxleE1ldGF0YWJsZSkKCmxvY2FsIHJlc3VsdCA9IGNvbXBsZXgxICsgY29tcGxleDIKcHJpbnQocmVzdWx0LnJlYWwsIHJlc3VsdC5pbWFnKSAgLS0gT3V0cHV0OiA0IDY="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>local complex1 = {real = 1, imag = 2}
local complex2 = {real = 3, imag = 4}

local complexMetatable = {
    __add = function(c1, c2)
        return {real = c1.real + c2.real, imag = c1.imag + c2.imag}
    end
}

setmetatable(complex1, complexMetatable)
setmetatable(complex2, complexMetatable)

local result = complex1 + complex2
print(result.real, result.imag)  -- Output: 4 6</pre></div><div class='content'></div><h2>Common Mistakes and Tips</h2>
<div class='content'><ul>
<li><strong>Forgetting to use <code>rawset</code> in <code>__newindex</code></strong>: When defining a <code>__newindex</code> metamethod, use <code>rawset</code> to avoid infinite recursion.</li>
<li><strong>Not setting the metatable correctly</strong>: Ensure you use <code>setmetatable</code> correctly to assign a metatable to a table.</li>
<li><strong>Misunderstanding <code>__index</code></strong>: Remember that <code>__index</code> can be a function or a table. If it's a table, Lua will look up the key in that table.</li>
</ul>
</div><h2>Conclusion</h2>
<div class='content'><p>Metatables and metamethods provide a powerful way to customize the behavior of tables in Lua. By understanding and using these features, you can create more flexible and dynamic Lua programs. In the next module, we will explore modules and packages, which will help you organize and reuse your Lua code more effectively.</p>
</div><div class='row navigation'>
	<div class='col-2 d-none d-md-block'>
					<a href='03-01-tables' title="Tables" class="py-2 px-3 btn btn-primary">
				&#x25C4; Previous 
			</a>
			</div>
	<div class='col-2 d-md-none'>
					<a href='03-01-tables' title="Tables" class="py-2 px-3 btn btn-primary">
				&#x25C4;
			</a>
			</div>
	<div class='col-8 text-center'>
			</div>
	<div class='col-2 text-end d-none d-md-block'>
					<a href='03-03-modules-packages' title="Modules and Packages" class="py-2 px-3 btn btn-primary"
				data-read-mod="lua" data-read-unit="3-2">
				Next &#x25BA;
			</a>
			</div>
	<div class='col-2 text-end d-md-none '>
					<a href='03-03-modules-packages' title="Modules and Packages" class="py-2 px-3 btn btn-primary" 
				data-read-mod="lua" data-read-unit="3-2">
				 &#x25BA;
			</a>
			</div>
</div>

			</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
						
	<div class="container mt-2 d-none d-md-block index">
		<h1>Lua Programming Course</h1>
<h2>Module 1: Introduction to Lua</h2>
<ul>
<li><a href="01-01-what-is-lua">What is Lua?</a></li>
<li><a href="01-02-setting-up-lua">Setting Up the Lua Environment</a></li>
<li><a href="01-03-first-lua-script">Your First Lua Script</a></li>
<li><a href="01-04-basic-syntax">Basic Syntax and Structure</a></li>
</ul>
<h2>Module 2: Basic Concepts</h2>
<ul>
<li><a href="02-01-variables-data-types">Variables and Data Types</a></li>
<li><a href="02-02-operators">Operators</a></li>
<li><a href="02-03-control-structures">Control Structures</a></li>
<li><a href="02-04-loops">Loops</a></li>
<li><a href="02-05-functions">Functions</a></li>
</ul>
<h2>Module 3: Intermediate Concepts</h2>
<ul>
<li><a href="03-01-tables">Tables</a></li>
<li><a href="03-02-metatables-metamethods">Metatables and Metamethods</a></li>
<li><a href="03-03-modules-packages">Modules and Packages</a></li>
<li><a href="03-04-error-handling">Error Handling</a></li>
<li><a href="03-05-file-io">File I/O</a></li>
</ul>
<h2>Module 4: Advanced Concepts</h2>
<ul>
<li><a href="04-01-coroutines">Coroutines</a></li>
<li><a href="04-02-oop-lua">Object-Oriented Programming in Lua</a></li>
<li><a href="04-03-debugging-techniques">Debugging Techniques</a></li>
<li><a href="04-04-performance-optimization">Performance Optimization</a></li>
<li><a href="04-05-lua-c-api">Using the Lua C API</a></li>
</ul>
<h2>Module 5: Practical Applications</h2>
<ul>
<li><a href="05-01-building-simple-game">Building a Simple Game</a></li>
<li><a href="05-02-scripting-game-engines">Scripting in Game Engines</a></li>
<li><a href="05-03-automating-tasks">Automating Tasks with Lua</a></li>
<li><a href="05-04-integrating-lua">Integrating Lua with Other Languages</a></li>
</ul>
<h2>Module 6: Final Project</h2>
<ul>
<li><a href="06-01-project-overview">Project Overview</a></li>
<li><a href="06-02-planning-design">Planning and Design</a></li>
<li><a href="06-03-implementation">Implementation</a></li>
<li><a href="06-04-testing-debugging">Testing and Debugging</a></li>
<li><a href="06-05-project-presentation">Project Presentation</a></li>
</ul>

	</div>










		</div>
	</div>
</div>		
<div class="container-xxl d-block d-md-none">
	<div class="row">
		<div class="col-12 p-2 p-md-0 m-0 text-end">
			<a href="/objective" rel="nofollow">The Project</a> | 
<a href="/about" rel="nofollow">About Us</a> | 
<a href="/contribute" rel="nofollow">Contribute</a> | 
<a href="/donate" rel="nofollow">Donations</a> | 
<a href="/license" rel="nofollow">License</a>
		</div>
	</div>
</div>

<div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. All rights reserved</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	We use cookies to improve your user experience and offer content tailored to your interests.
    <a href="#" id="btn_accept_cookies" class="button">Accept</a>
    <a href="/cookies">More Information</a>
</div>	

		<div class="modal fade" id="loginModal" tabindex="-1" aria-labelledby="loginModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="loginModalLabel">User not authenticated</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
            	<div id="modal-body-main"></div>
            </div>
        </div>
    </div>
</div>	</div>    
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
</body>
</html>
