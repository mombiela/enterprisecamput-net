<!DOCTYPE html>
<html lang="en">
<head>
    <title> Shadow Mapping </title>
        
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="index, follow, noarchive">
    
    <link rel="alternate" href="https://campusempresa.com/cursos/opengl/06-03-shadow-mapping" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/cursos/opengl/06-03-shadow-mapping" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/courses/opengl/06-03-shadow-mapping" hreflang="en" />
    
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.1ab297bfa4.css" rel="stylesheet">
	 
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="/js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script>
  		var LANG = "en";
  		var CATEGORY = "frameworks";
  		var MOD_NAME = "open_gl";
  		var TEMA_NAME = "6-3";
  		var TYPE = "mod";
  		var PATH = "mod/open_gl/06-03-shadow-mapping";
  		var IS_INDEX = false;
  	</script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="module" src="/js/app.8d8afe898f.js"></script>
	<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-0611338592562725" crossorigin="anonymous"></script>
	  	
	<!-- Google tag (gtag.js) -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=G-VVPMPJSR3P"></script>
	<script>
	  window.dataLayer = window.dataLayer || [];
	  function gtag(){dataLayer.push(arguments);}
	  gtag('js', new Date());	
	  gtag('config', 'G-VVPMPJSR3P');
	</script>
</head>

<body class="d-none">
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-12 col-md-6 p-0">
			<a href="/"><img src="/img/logo-header_enterprise.png" alt="Logo Enterprise Campus"></a>
		</div>
		<div class="col-12 col-md-6 p-0 text-end">
			<p class="mb-0 p-0">	<b id="lit_lang_es" class="px-2">EN</b>
	|
	<a href="https://campusempresa.com/cursos/opengl/06-03-shadow-mapping" class="px-2">ES</a></b>
	|
	<a href="https://campusempresa.cat/cursos/opengl/06-03-shadow-mapping" class="px-2">CA</a>
</p>
			<p class="mb-4 mt-0 mx-2  d-none d-md-block"><cite>All the knowledge within your reach</cite></p>
		</div>
	</div>
</div>
<div class="subheader container-xxl d-none d-md-block">
	<div class="row">
		<div class="col-12 p-2 p-md-0 m-0 text-end">
			<a href="/objective" rel="nofollow">The Project</a> | 
<a href="/about" rel="nofollow">About Us</a> | 
<a href="/contribute" rel="nofollow">Contribute</a> | 
<a href="/donate" rel="nofollow">Donations</a> | 
<a href="/license" rel="nofollow">License</a>
		</div>
	</div>
</div>
		<div class="top-bar container-fluid p-0">
	<div class="container-xxl p-0">
		<div class="row">
			<div class="col">
				<div class="d-flex justify-content-between">
					<div class="left">
						<a href="/" class="nav-link px-3" id="btnHome">
	<i class="bi bi-house-fill"></i>
	HOME
</a>

<a href="/my-courses" class="nav-link px-3 d-none" id="btnMyCourses">
	<i class="bi bi-rocket-takeoff-fill"></i>
	<i><b>My courses</b></i>
</a>
<a href="/completed-courses" class="nav-link px-3 d-none" id="trophy_button">
	<i class="bi bi-trophy-fill"></i>
	Completed             
</a>

					</div>
                    <div class="ms-auto right">
                        <a id="user_button" href="#" class="nav-link px-3" data-bs-toggle="modal" data-bs-target="#loginModal">
                            <i id="user_icon" class="bi"></i>                            
                        </a>
                    </div>					
				</div>
			</div>
		</div>
	</div>
</div>

		<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
										<div class="row py-1 m-0" id="buttonsModSection">
	<div class="col-6 p-0" data-mod="open_gl">
		<a  href="#" class="text-secondary d-none" data-read-mod="open_gl" data-read-unit="6-3" style="text-decoration:none;">
			<i class="bi bi-check-circle-fill"></i> 
			Mark as read
		</a>
		<a href="#" class="text-secondary d-none" data-unread-mod="open_gl" data-unread-unit="6-3" style="text-decoration:none;">
			<i class="bi bi-x-circle-fill"></i>
			Mark as unread
		</a>
	</div>
	<div class="col-6 text-end p-0">
					<a href="./"  class="nav-link">
				<i class="bi bi-journal-text"></i>
				Course Content
			</a>
			</div>
</div>						<div id="inner_content">
				<div class='row navigation'>
	<div class='col-2 d-none d-md-block'>
					<a href='06-02-post-processing' title="Post-Processing Effects" class="py-2 px-3 btn btn-primary">
				&#x25C4; Previous 
			</a>
			</div>
	<div class='col-2 d-md-none'>
					<a href='06-02-post-processing' title="Post-Processing Effects" class="py-2 px-3 btn btn-primary">
				&#x25C4;
			</a>
			</div>
	<div class='col-8 text-center'>
					<h1 style="text-decoration:underline">Shadow Mapping</h1>
			</div>
	<div class='col-2 text-end d-none d-md-block'>
					<a href='06-04-environment-mapping' title="Environment Mapping" class="py-2 px-3 btn btn-primary"
				data-read-mod="open_gl" data-read-unit="6-3">
				Next &#x25BA;
			</a>
			</div>
	<div class='col-2 text-end d-md-none '>
					<a href='06-04-environment-mapping' title="Environment Mapping" class="py-2 px-3 btn btn-primary" 
				data-read-mod="open_gl" data-read-unit="6-3">
				 &#x25BA;
			</a>
			</div>
</div>
<div class='content'><p>Shadow mapping is a technique used in 3D computer graphics to add shadows to a scene. It involves rendering the scene from the perspective of the light source to create a depth map, which is then used to determine whether a pixel is in shadow or not when rendering the scene from the camera's perspective.</p>
</div><h2>Key Concepts</h2>
<div class='content'><ol>
<li><strong>Depth Map</strong>: A texture that stores the depth information from the light's perspective.</li>
<li><strong>Light Space Transformation</strong>: Transforming world coordinates to the light's view space.</li>
<li><strong>Shadow Comparison</strong>: Comparing the depth of a fragment with the depth stored in the depth map to determine if it is in shadow.</li>
</ol>
</div><h2>Steps to Implement Shadow Mapping</h2>
<div class='content'><ol>
<li>
<p><strong>Render the Scene from the Light's Perspective</strong>:</p>
<ul>
<li>Create a depth map by rendering the scene from the light's point of view.</li>
<li>Store the depth information in a texture.</li>
</ul>
</li>
<li>
<p><strong>Render the Scene from the Camera's Perspective</strong>:</p>
<ul>
<li>Use the depth map to determine if a fragment is in shadow.</li>
<li>Apply shadow calculations to the final color of the fragment.</li>
</ul>
</li>
</ol>
</div><h2>Practical Example</h2>
<div class='content'></div><h3>Step 1: Create a Depth Map</h3>
<div class='content'><p>First, we need to set up a framebuffer and a texture to store the depth information.</p>
</div><div style='position:relative'><a class='copy_button d-none d-md-inline' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Ly8gQ3JlYXRlIGEgZnJhbWVidWZmZXIgb2JqZWN0CkdMdWludCBkZXB0aE1hcEZCTzsKZ2xHZW5GcmFtZWJ1ZmZlcnMoMSwgJmRlcHRoTWFwRkJPKTsKCi8vIENyZWF0ZSBhIHRleHR1cmUgdG8gc3RvcmUgdGhlIGRlcHRoIG1hcApHTHVpbnQgZGVwdGhNYXA7CmdsR2VuVGV4dHVyZXMoMSwgJmRlcHRoTWFwKTsKZ2xCaW5kVGV4dHVyZShHTF9URVhUVVJFXzJELCBkZXB0aE1hcCk7CmdsVGV4SW1hZ2UyRChHTF9URVhUVVJFXzJELCAwLCBHTF9ERVBUSF9DT01QT05FTlQsIFNIQURPV19XSURUSCwgU0hBRE9XX0hFSUdIVCwgMCwgR0xfREVQVEhfQ09NUE9ORU5ULCBHTF9GTE9BVCwgTlVMTCk7CmdsVGV4UGFyYW1ldGVyaShHTF9URVhUVVJFXzJELCBHTF9URVhUVVJFX01JTl9GSUxURVIsIEdMX05FQVJFU1QpOwpnbFRleFBhcmFtZXRlcmkoR0xfVEVYVFVSRV8yRCwgR0xfVEVYVFVSRV9NQUdfRklMVEVSLCBHTF9ORUFSRVNUKTsKZ2xUZXhQYXJhbWV0ZXJpKEdMX1RFWFRVUkVfMkQsIEdMX1RFWFRVUkVfV1JBUF9TLCBHTF9DTEFNUF9UT19CT1JERVIpOwpnbFRleFBhcmFtZXRlcmkoR0xfVEVYVFVSRV8yRCwgR0xfVEVYVFVSRV9XUkFQX1QsIEdMX0NMQU1QX1RPX0JPUkRFUik7CmZsb2F0IGJvcmRlckNvbG9yW10gPSB7IDEuMCwgMS4wLCAxLjAsIDEuMCB9OwpnbFRleFBhcmFtZXRlcmZ2KEdMX1RFWFRVUkVfMkQsIEdMX1RFWFRVUkVfQk9SREVSX0NPTE9SLCBib3JkZXJDb2xvcik7CgovLyBBdHRhY2ggdGhlIHRleHR1cmUgYXMgdGhlIGRlcHRoIGJ1ZmZlcgpnbEJpbmRGcmFtZWJ1ZmZlcihHTF9GUkFNRUJVRkZFUiwgZGVwdGhNYXBGQk8pOwpnbEZyYW1lYnVmZmVyVGV4dHVyZTJEKEdMX0ZSQU1FQlVGRkVSLCBHTF9ERVBUSF9BVFRBQ0hNRU5ULCBHTF9URVhUVVJFXzJELCBkZXB0aE1hcCwgMCk7CmdsRHJhd0J1ZmZlcihHTF9OT05FKTsKZ2xSZWFkQnVmZmVyKEdMX05PTkUpOwpnbEJpbmRGcmFtZWJ1ZmZlcihHTF9GUkFNRUJVRkZFUiwgMCk7"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>// Create a framebuffer object
GLuint depthMapFBO;
glGenFramebuffers(1, &amp;depthMapFBO);

// Create a texture to store the depth map
GLuint depthMap;
glGenTextures(1, &amp;depthMap);
glBindTexture(GL_TEXTURE_2D, depthMap);
glTexImage2D(GL_TEXTURE_2D, 0, GL_DEPTH_COMPONENT, SHADOW_WIDTH, SHADOW_HEIGHT, 0, GL_DEPTH_COMPONENT, GL_FLOAT, NULL);
glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MIN_FILTER, GL_NEAREST);
glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MAG_FILTER, GL_NEAREST);
glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_WRAP_S, GL_CLAMP_TO_BORDER);
glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_WRAP_T, GL_CLAMP_TO_BORDER);
float borderColor[] = { 1.0, 1.0, 1.0, 1.0 };
glTexParameterfv(GL_TEXTURE_2D, GL_TEXTURE_BORDER_COLOR, borderColor);

// Attach the texture as the depth buffer
glBindFramebuffer(GL_FRAMEBUFFER, depthMapFBO);
glFramebufferTexture2D(GL_FRAMEBUFFER, GL_DEPTH_ATTACHMENT, GL_TEXTURE_2D, depthMap, 0);
glDrawBuffer(GL_NONE);
glReadBuffer(GL_NONE);
glBindFramebuffer(GL_FRAMEBUFFER, 0);</pre></div><div class='content'></div><h3>Step 2: Render the Scene from the Light's Perspective</h3>
<div class='content'><p>Render the scene to the depth map from the light's point of view.</p>
</div><div style='position:relative'><a class='copy_button d-none d-md-inline' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Ly8gU2V0IHRoZSB2aWV3cG9ydCB0byB0aGUgc2l6ZSBvZiB0aGUgZGVwdGggbWFwCmdsVmlld3BvcnQoMCwgMCwgU0hBRE9XX1dJRFRILCBTSEFET1dfSEVJR0hUKTsKZ2xCaW5kRnJhbWVidWZmZXIoR0xfRlJBTUVCVUZGRVIsIGRlcHRoTWFwRkJPKTsKZ2xDbGVhcihHTF9ERVBUSF9CVUZGRVJfQklUKTsKCi8vIENvbmZpZ3VyZSB0aGUgbGlnaHQncyB2aWV3IGFuZCBwcm9qZWN0aW9uIG1hdHJpY2VzCmdsbTo6bWF0NCBsaWdodFByb2plY3Rpb24sIGxpZ2h0VmlldzsKZ2xtOjptYXQ0IGxpZ2h0U3BhY2VNYXRyaXg7CmZsb2F0IG5lYXJfcGxhbmUgPSAxLjBmLCBmYXJfcGxhbmUgPSA3LjVmOwpsaWdodFByb2plY3Rpb24gPSBnbG06Om9ydGhvKC0xMC4wZiwgMTAuMGYsIC0xMC4wZiwgMTAuMGYsIG5lYXJfcGxhbmUsIGZhcl9wbGFuZSk7CmxpZ2h0VmlldyA9IGdsbTo6bG9va0F0KGxpZ2h0UG9zLCBnbG06OnZlYzMoMC4wZiksIGdsbTo6dmVjMygwLjAsIDEuMCwgMC4wKSk7CmxpZ2h0U3BhY2VNYXRyaXggPSBsaWdodFByb2plY3Rpb24gKiBsaWdodFZpZXc7CgovLyBSZW5kZXIgdGhlIHNjZW5lCnNoYWRvd1NoYWRlci51c2UoKTsKc2hhZG93U2hhZGVyLnNldE1hdDQoImxpZ2h0U3BhY2VNYXRyaXgiLCBsaWdodFNwYWNlTWF0cml4KTsKcmVuZGVyU2NlbmUoc2hhZG93U2hhZGVyKTsKCmdsQmluZEZyYW1lYnVmZmVyKEdMX0ZSQU1FQlVGRkVSLCAwKTs="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>// Set the viewport to the size of the depth map
glViewport(0, 0, SHADOW_WIDTH, SHADOW_HEIGHT);
glBindFramebuffer(GL_FRAMEBUFFER, depthMapFBO);
glClear(GL_DEPTH_BUFFER_BIT);

// Configure the light's view and projection matrices
glm::mat4 lightProjection, lightView;
glm::mat4 lightSpaceMatrix;
float near_plane = 1.0f, far_plane = 7.5f;
lightProjection = glm::ortho(-10.0f, 10.0f, -10.0f, 10.0f, near_plane, far_plane);
lightView = glm::lookAt(lightPos, glm::vec3(0.0f), glm::vec3(0.0, 1.0, 0.0));
lightSpaceMatrix = lightProjection * lightView;

// Render the scene
shadowShader.use();
shadowShader.setMat4(&quot;lightSpaceMatrix&quot;, lightSpaceMatrix);
renderScene(shadowShader);

glBindFramebuffer(GL_FRAMEBUFFER, 0);</pre></div><div class='content'></div><h3>Step 3: Render the Scene from the Camera's Perspective</h3>
<div class='content'><p>Use the depth map to determine if a fragment is in shadow.</p>
</div><div style='position:relative'><a class='copy_button d-none d-md-inline' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Ly8gU2V0IHRoZSB2aWV3cG9ydCBiYWNrIHRvIHRoZSBvcmlnaW5hbCBzaXplCmdsVmlld3BvcnQoMCwgMCwgU0NSX1dJRFRILCBTQ1JfSEVJR0hUKTsKZ2xDbGVhcihHTF9DT0xPUl9CVUZGRVJfQklUIHwgR0xfREVQVEhfQlVGRkVSX0JJVCk7CgovLyBDb25maWd1cmUgdGhlIGNhbWVyYSdzIHZpZXcgYW5kIHByb2plY3Rpb24gbWF0cmljZXMKZ2xtOjptYXQ0IHByb2plY3Rpb24gPSBnbG06OnBlcnNwZWN0aXZlKGdsbTo6cmFkaWFucyhjYW1lcmEuWm9vbSksIChmbG9hdClTQ1JfV0lEVEggLyAoZmxvYXQpU0NSX0hFSUdIVCwgMC4xZiwgMTAwLjBmKTsKZ2xtOjptYXQ0IHZpZXcgPSBjYW1lcmEuR2V0Vmlld01hdHJpeCgpOwpzaGFkZXIudXNlKCk7CnNoYWRlci5zZXRNYXQ0KCJwcm9qZWN0aW9uIiwgcHJvamVjdGlvbik7CnNoYWRlci5zZXRNYXQ0KCJ2aWV3Iiwgdmlldyk7CgovLyBTZXQgdGhlIGxpZ2h0IHNwYWNlIG1hdHJpeCBhbmQgZGVwdGggbWFwCnNoYWRlci5zZXRNYXQ0KCJsaWdodFNwYWNlTWF0cml4IiwgbGlnaHRTcGFjZU1hdHJpeCk7CmdsQWN0aXZlVGV4dHVyZShHTF9URVhUVVJFMSk7CmdsQmluZFRleHR1cmUoR0xfVEVYVFVSRV8yRCwgZGVwdGhNYXApOwpzaGFkZXIuc2V0SW50KCJzaGFkb3dNYXAiLCAxKTsKCi8vIFJlbmRlciB0aGUgc2NlbmUKcmVuZGVyU2NlbmUoc2hhZGVyKTs="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>// Set the viewport back to the original size
glViewport(0, 0, SCR_WIDTH, SCR_HEIGHT);
glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT);

// Configure the camera's view and projection matrices
glm::mat4 projection = glm::perspective(glm::radians(camera.Zoom), (float)SCR_WIDTH / (float)SCR_HEIGHT, 0.1f, 100.0f);
glm::mat4 view = camera.GetViewMatrix();
shader.use();
shader.setMat4(&quot;projection&quot;, projection);
shader.setMat4(&quot;view&quot;, view);

// Set the light space matrix and depth map
shader.setMat4(&quot;lightSpaceMatrix&quot;, lightSpaceMatrix);
glActiveTexture(GL_TEXTURE1);
glBindTexture(GL_TEXTURE_2D, depthMap);
shader.setInt(&quot;shadowMap&quot;, 1);

// Render the scene
renderScene(shader);</pre></div><div class='content'></div><h3>Shadow Calculation in the Fragment Shader</h3>
<div class='content'><p>In the fragment shader, compare the depth of the current fragment with the depth stored in the depth map.</p>
</div><div style='position:relative'><a class='copy_button d-none d-md-inline' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("I3ZlcnNpb24gMzMwIGNvcmUKb3V0IHZlYzQgRnJhZ0NvbG9yOwoKaW4gdmVjMyBGcmFnUG9zOwppbiB2ZWMzIE5vcm1hbDsKaW4gdmVjNCBGcmFnUG9zTGlnaHRTcGFjZTsKCnVuaWZvcm0gc2FtcGxlcjJEIHNoYWRvd01hcDsKdW5pZm9ybSB2ZWMzIGxpZ2h0UG9zOwp1bmlmb3JtIHZlYzMgdmlld1BvczsKCmZsb2F0IFNoYWRvd0NhbGN1bGF0aW9uKHZlYzQgZnJhZ1Bvc0xpZ2h0U3BhY2UpCnsKICAgIC8vIFBlcmZvcm0gcGVyc3BlY3RpdmUgZGl2aWRlCiAgICB2ZWMzIHByb2pDb29yZHMgPSBmcmFnUG9zTGlnaHRTcGFjZS54eXogLyBmcmFnUG9zTGlnaHRTcGFjZS53OwogICAgLy8gVHJhbnNmb3JtIHRvIFswLDFdIHJhbmdlCiAgICBwcm9qQ29vcmRzID0gcHJvakNvb3JkcyAqIDAuNSArIDAuNTsKICAgIC8vIEdldCBjbG9zZXN0IGRlcHRoIHZhbHVlIGZyb20gbGlnaHQncyBwZXJzcGVjdGl2ZSAodXNpbmcgWzAsMV0gcmFuZ2UgZnJhZ1Bvc0xpZ2h0IGFzIGNvb3JkcykKICAgIGZsb2F0IGNsb3Nlc3REZXB0aCA9IHRleHR1cmUoc2hhZG93TWFwLCBwcm9qQ29vcmRzLnh5KS5yOyAKICAgIC8vIEdldCBkZXB0aCBvZiBjdXJyZW50IGZyYWdtZW50IGZyb20gbGlnaHQncyBwZXJzcGVjdGl2ZQogICAgZmxvYXQgY3VycmVudERlcHRoID0gcHJvakNvb3Jkcy56OwogICAgLy8gQ2hlY2sgd2hldGhlciBjdXJyZW50IGZyYWcgcG9zIGlzIGluIHNoYWRvdwogICAgZmxvYXQgc2hhZG93ID0gY3VycmVudERlcHRoID4gY2xvc2VzdERlcHRoICA/IDEuMCA6IDAuMDsKCiAgICByZXR1cm4gc2hhZG93Owp9Cgp2b2lkIG1haW4oKQp7CiAgICAvLyBBbWJpZW50CiAgICB2ZWMzIGFtYmllbnQgPSAwLjE1ICogdmVjMygxLjApOwoKICAgIC8vIERpZmZ1c2UKICAgIHZlYzMgbm9ybSA9IG5vcm1hbGl6ZShOb3JtYWwpOwogICAgdmVjMyBsaWdodERpciA9IG5vcm1hbGl6ZShsaWdodFBvcyAtIEZyYWdQb3MpOwogICAgZmxvYXQgZGlmZiA9IG1heChkb3Qobm9ybSwgbGlnaHREaXIpLCAwLjApOwogICAgdmVjMyBkaWZmdXNlID0gZGlmZiAqIHZlYzMoMS4wKTsKCiAgICAvLyBTcGVjdWxhcgogICAgdmVjMyB2aWV3RGlyID0gbm9ybWFsaXplKHZpZXdQb3MgLSBGcmFnUG9zKTsKICAgIHZlYzMgcmVmbGVjdERpciA9IHJlZmxlY3QoLWxpZ2h0RGlyLCBub3JtKTsKICAgIGZsb2F0IHNwZWMgPSBwb3cobWF4KGRvdCh2aWV3RGlyLCByZWZsZWN0RGlyKSwgMC4wKSwgMzIuMCk7CiAgICB2ZWMzIHNwZWN1bGFyID0gc3BlYyAqIHZlYzMoMS4wKTsKCiAgICAvLyBDYWxjdWxhdGUgc2hhZG93CiAgICBmbG9hdCBzaGFkb3cgPSBTaGFkb3dDYWxjdWxhdGlvbihGcmFnUG9zTGlnaHRTcGFjZSk7ICAgICAgIAogICAgdmVjMyBsaWdodGluZyA9IChhbWJpZW50ICsgKDEuMCAtIHNoYWRvdykgKiAoZGlmZnVzZSArIHNwZWN1bGFyKSk7CgogICAgRnJhZ0NvbG9yID0gdmVjNChsaWdodGluZywgMS4wKTsKfQ=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>#version 330 core
out vec4 FragColor;

in vec3 FragPos;
in vec3 Normal;
in vec4 FragPosLightSpace;

uniform sampler2D shadowMap;
uniform vec3 lightPos;
uniform vec3 viewPos;

float ShadowCalculation(vec4 fragPosLightSpace)
{
    // Perform perspective divide
    vec3 projCoords = fragPosLightSpace.xyz / fragPosLightSpace.w;
    // Transform to [0,1] range
    projCoords = projCoords * 0.5 + 0.5;
    // Get closest depth value from light's perspective (using [0,1] range fragPosLight as coords)
    float closestDepth = texture(shadowMap, projCoords.xy).r; 
    // Get depth of current fragment from light's perspective
    float currentDepth = projCoords.z;
    // Check whether current frag pos is in shadow
    float shadow = currentDepth &gt; closestDepth  ? 1.0 : 0.0;

    return shadow;
}

void main()
{
    // Ambient
    vec3 ambient = 0.15 * vec3(1.0);

    // Diffuse
    vec3 norm = normalize(Normal);
    vec3 lightDir = normalize(lightPos - FragPos);
    float diff = max(dot(norm, lightDir), 0.0);
    vec3 diffuse = diff * vec3(1.0);

    // Specular
    vec3 viewDir = normalize(viewPos - FragPos);
    vec3 reflectDir = reflect(-lightDir, norm);
    float spec = pow(max(dot(viewDir, reflectDir), 0.0), 32.0);
    vec3 specular = spec * vec3(1.0);

    // Calculate shadow
    float shadow = ShadowCalculation(FragPosLightSpace);       
    vec3 lighting = (ambient + (1.0 - shadow) * (diffuse + specular));

    FragColor = vec4(lighting, 1.0);
}</pre></div><div class='content'></div><h2>Practical Exercises</h2>
<div class='content'></div><h3>Exercise 1: Basic Shadow Mapping</h3>
<div class='content'><ol>
<li>Set up a simple scene with a plane and a cube.</li>
<li>Implement shadow mapping as described above.</li>
<li>Adjust the light's position and observe the shadows.</li>
</ol>
<p><strong>Solution:</strong></p>
<p>Follow the steps provided in the practical example to set up the depth map, render the scene from the light's perspective, and then render the scene from the camera's perspective using the depth map for shadow calculations.</p>
</div><h3>Exercise 2: Soft Shadows</h3>
<div class='content'><ol>
<li>Modify the shadow calculation to create soft shadows.</li>
<li>Implement Percentage Closer Filtering (PCF) to smooth the shadow edges.</li>
</ol>
<p><strong>Solution:</strong></p>
<p>In the fragment shader, sample multiple points around the current fragment's position in the depth map and average the results to create soft shadows.</p>
</div><div style='position:relative'><a class='copy_button d-none d-md-inline' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ZmxvYXQgU2hhZG93Q2FsY3VsYXRpb24odmVjNCBmcmFnUG9zTGlnaHRTcGFjZSkKewogICAgdmVjMyBwcm9qQ29vcmRzID0gZnJhZ1Bvc0xpZ2h0U3BhY2UueHl6IC8gZnJhZ1Bvc0xpZ2h0U3BhY2UudzsKICAgIHByb2pDb29yZHMgPSBwcm9qQ29vcmRzICogMC41ICsgMC41OwogICAgZmxvYXQgY3VycmVudERlcHRoID0gcHJvakNvb3Jkcy56OwogICAgZmxvYXQgc2hhZG93ID0gMC4wOwogICAgdmVjMiB0ZXhlbFNpemUgPSAxLjAgLyB0ZXh0dXJlU2l6ZShzaGFkb3dNYXAsIDApOwogICAgZm9yKGludCB4ID0gLTE7IHggPD0gMTsgKyt4KQogICAgewogICAgICAgIGZvcihpbnQgeSA9IC0xOyB5IDw9IDE7ICsreSkKICAgICAgICB7CiAgICAgICAgICAgIGZsb2F0IHBjZkRlcHRoID0gdGV4dHVyZShzaGFkb3dNYXAsIHByb2pDb29yZHMueHkgKyB2ZWMyKHgsIHkpICogdGV4ZWxTaXplKS5yOyAKICAgICAgICAgICAgc2hhZG93ICs9IGN1cnJlbnREZXB0aCA+IHBjZkRlcHRoICA/IDEuMCA6IDAuMDsgICAgICAgIAogICAgICAgIH0gICAgCiAgICB9CiAgICBzaGFkb3cgLz0gOS4wOwoKICAgIHJldHVybiBzaGFkb3c7Cn0="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>float ShadowCalculation(vec4 fragPosLightSpace)
{
    vec3 projCoords = fragPosLightSpace.xyz / fragPosLightSpace.w;
    projCoords = projCoords * 0.5 + 0.5;
    float currentDepth = projCoords.z;
    float shadow = 0.0;
    vec2 texelSize = 1.0 / textureSize(shadowMap, 0);
    for(int x = -1; x &lt;= 1; ++x)
    {
        for(int y = -1; y &lt;= 1; ++y)
        {
            float pcfDepth = texture(shadowMap, projCoords.xy + vec2(x, y) * texelSize).r; 
            shadow += currentDepth &gt; pcfDepth  ? 1.0 : 0.0;        
        }    
    }
    shadow /= 9.0;

    return shadow;
}</pre></div><div class='content'></div><h2>Common Mistakes and Tips</h2>
<div class='content'><ul>
<li><strong>Incorrect Depth Map Setup</strong>: Ensure the depth map is correctly set up and the framebuffer is properly configured.</li>
<li><strong>Precision Issues</strong>: Use a high precision depth buffer to avoid artifacts.</li>
<li><strong>Light Space Matrix</strong>: Make sure the light space matrix is correctly calculated and passed to the shaders.</li>
<li><strong>Shadow Acne</strong>: Use a small bias to prevent shadow acne, which occurs due to precision issues.</li>
</ul>
</div><h2>Conclusion</h2>
<div class='content'><p>Shadow mapping is a powerful technique for adding realistic shadows to a scene. By understanding the key concepts and following the steps to implement shadow mapping, you can create visually appealing shadows in your OpenGL applications. Practice with different scenes and lighting conditions to master shadow mapping and explore advanced techniques like soft shadows for even more realistic results.</p>
</div><div class='row navigation'>
	<div class='col-2 d-none d-md-block'>
					<a href='06-02-post-processing' title="Post-Processing Effects" class="py-2 px-3 btn btn-primary">
				&#x25C4; Previous 
			</a>
			</div>
	<div class='col-2 d-md-none'>
					<a href='06-02-post-processing' title="Post-Processing Effects" class="py-2 px-3 btn btn-primary">
				&#x25C4;
			</a>
			</div>
	<div class='col-8 text-center'>
			</div>
	<div class='col-2 text-end d-none d-md-block'>
					<a href='06-04-environment-mapping' title="Environment Mapping" class="py-2 px-3 btn btn-primary"
				data-read-mod="open_gl" data-read-unit="6-3">
				Next &#x25BA;
			</a>
			</div>
	<div class='col-2 text-end d-md-none '>
					<a href='06-04-environment-mapping' title="Environment Mapping" class="py-2 px-3 btn btn-primary" 
				data-read-mod="open_gl" data-read-unit="6-3">
				 &#x25BA;
			</a>
			</div>
</div>

			</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
						
	<div class="container mt-2 d-none d-md-block index">
		<h1>OpenGL Programming Course</h1>
<h2>Module 1: Introduction to OpenGL</h2>
<ul>
<li><a href="01-01-what-is-opengl">What is OpenGL?</a></li>
<li><a href="01-02-setting-up-environment">Setting Up Your Development Environment</a></li>
<li><a href="01-03-first-opengl-program">Creating Your First OpenGL Program</a></li>
<li><a href="01-04-opengl-pipeline">Understanding the OpenGL Pipeline</a></li>
</ul>
<h2>Module 2: Basic Rendering</h2>
<ul>
<li><a href="02-01-drawing-basic-shapes">Drawing Basic Shapes</a></li>
<li><a href="02-02-coordinates-transformations">Understanding Coordinates and Transformations</a></li>
<li><a href="02-03-coloring-shading">Coloring and Shading</a></li>
<li><a href="02-04-using-buffers">Using Buffers</a></li>
</ul>
<h2>Module 3: Intermediate Rendering Techniques</h2>
<ul>
<li><a href="03-01-textures-mapping">Textures and Texture Mapping</a></li>
<li><a href="03-02-lighting-materials">Lighting and Materials</a></li>
<li><a href="03-03-blending-transparency">Blending and Transparency</a></li>
<li><a href="03-04-depth-stencil-testing">Depth Testing and Stencil Testing</a></li>
</ul>
<h2>Module 4: Advanced Rendering Techniques</h2>
<ul>
<li><a href="04-01-framebuffers-renderbuffers">Framebuffers and Renderbuffers</a></li>
<li><a href="04-02-advanced-shading">Advanced Shading Techniques</a></li>
<li><a href="04-03-instanced-rendering">Instanced Rendering</a></li>
<li><a href="04-04-tessellation">Tessellation</a></li>
</ul>
<h2>Module 5: Performance Optimization</h2>
<ul>
<li><a href="05-01-optimizing-code">Optimizing OpenGL Code</a></li>
<li><a href="05-02-using-vaos">Using Vertex Array Objects (VAOs)</a></li>
<li><a href="05-03-memory-management">Efficient Memory Management</a></li>
<li><a href="05-04-profiling-debugging">Profiling and Debugging</a></li>
</ul>
<h2>Module 6: Special Effects and Techniques</h2>
<ul>
<li><a href="06-01-particle-systems">Particle Systems</a></li>
<li><a href="06-02-post-processing">Post-Processing Effects</a></li>
<li><a href="06-03-shadow-mapping">Shadow Mapping</a></li>
<li><a href="06-04-environment-mapping">Environment Mapping</a></li>
</ul>
<h2>Module 7: Advanced Topics</h2>
<ul>
<li><a href="07-01-compute-shaders">Compute Shaders</a></li>
<li><a href="07-02-geometry-shaders">Geometry Shaders</a></li>
<li><a href="07-03-multi-pass-rendering">Multi-pass Rendering</a></li>
<li><a href="07-04-opengl-extensions">OpenGL Extensions</a></li>
</ul>
<h2>Module 8: Real-World Applications</h2>
<ul>
<li><a href="08-01-building-simple-game">Building a Simple Game</a></li>
<li><a href="08-02-3d-model-viewer">Creating a 3D Model Viewer</a></li>
<li><a href="08-03-developing-graphics-engine">Developing a Graphics Engine</a></li>
<li><a href="08-04-integrating-other-libraries">Integrating OpenGL with Other Libraries</a></li>
</ul>

	</div>










		</div>
	</div>
</div>		
<div class="container-xxl d-block d-md-none">
	<div class="row">
		<div class="col-12 p-2 p-md-0 m-0 text-end">
			<a href="/objective" rel="nofollow">The Project</a> | 
<a href="/about" rel="nofollow">About Us</a> | 
<a href="/contribute" rel="nofollow">Contribute</a> | 
<a href="/donate" rel="nofollow">Donations</a> | 
<a href="/license" rel="nofollow">License</a>
		</div>
	</div>
</div>

<div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. All rights reserved</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	We use cookies to improve your user experience and offer content tailored to your interests.
    <a href="#" id="btn_accept_cookies" class="button">Accept</a>
    <a href="/cookies">More Information</a>
</div>	

		<div class="modal fade" id="loginModal" tabindex="-1" aria-labelledby="loginModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="loginModalLabel">User not authenticated</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
            	<div id="modal-body-main"></div>
            </div>
        </div>
    </div>
</div>	</div>    
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
</body>
</html>
