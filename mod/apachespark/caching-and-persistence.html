<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Caching and Persistence in Apache Spark</title>

    <link rel="alternate" href="https://campusempresa.com/mod/apachespark/caching-and-persistence" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/mod/apachespark/caching-and-persistence" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/mod/apachespark/caching-and-persistence" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body>
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-8 p-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo_header.png" style="visibility:hiddenxx;"></a>
			</h1>
		</div>
		<div class="col-4 p-0 text-end">
			<h2 id="main_title"><cite>Building today's and tomorrow's society</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-0 m-0 text-end">
													<b id="lit_lang_es" class="px-2">EN</b>
				|
				<a href="https://campusempresa.com/mod/apachespark/caching-and-persistence" class="px-2">ES</a></b>
				|
				<a href="https://campusempresa.cat/mod/apachespark/caching-and-persistence" class="px-2">CA</a>
					</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="/objective">The Project</a>
				<a href="/about">About Us</a>
				<a href="/contribute">Contribute</a>
				<a href="/donate">Donations</a>
				<a href="/licence">License</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content"><div class='row navigation'>
	<div class='col-4'>
					<a href='partitioning-and-shuffling'>&#x25C4;Partitioning and Shuffling</a>
			</div>
	<div class='col-4 text-center'>
		<a href="./" class="title">Caching and Persistence in Apache Spark</a>
	</div>
	<div class='col-4 text-end'>
					<a href='tuning-spark-applications'>Tuning Spark Applications &#x25BA;</a>
			</div>
</div>
<div class='content'></div><h1>Introduction</h1>
<div class='content'><p>Caching and persistence are crucial concepts in Apache Spark that help optimize the performance of your applications by storing intermediate results. This section will cover the basics of caching and persistence, their importance, and how to use them effectively in Spark.</p>
</div><h1>Why Caching and Persistence?</h1>
<div class='content'><ul>
<li><strong>Performance Improvement</strong>: Reduces the time taken to recompute intermediate results.</li>
<li><strong>Resource Optimization</strong>: Efficient use of memory and storage resources.</li>
<li><strong>Fault Tolerance</strong>: Provides resilience against node failures by storing data in a distributed manner.</li>
</ul>
</div><h1>Caching in Spark</h1>
<div class='content'><p>Caching is a lazy operation in Spark that stores the data in-memory for faster access. It is useful when you have an RDD or DataFrame that is reused multiple times in your application.</p>
</div><h2>How to Cache Data</h2>
<div class='content'><p>You can cache an RDD or DataFrame using the <code>cache()</code> method.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("dmFsIHJkZCA9IHNjLnRleHRGaWxlKCJoZGZzOi8vcGF0aC90by9maWxlIikKdmFsIGNhY2hlZFJkZCA9IHJkZC5jYWNoZSgp"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>val rdd = sc.textFile(&quot;hdfs://path/to/file&quot;)
val cachedRdd = rdd.cache()</pre></div><div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ZGYgPSBzcGFyay5yZWFkLnRleHQoImhkZnM6Ly9wYXRoL3RvL2ZpbGUiKQpjYWNoZWREZiA9IGRmLmNhY2hlKCk="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>df = spark.read.text(&quot;hdfs://path/to/file&quot;)
cachedDf = df.cache()</pre></div><div class='content'></div><h2>When to Use Caching</h2>
<div class='content'><ul>
<li>When an RDD or DataFrame is reused multiple times.</li>
<li>When the computation cost of regenerating the RDD or DataFrame is high.</li>
</ul>
</div><h1>Persistence in Spark</h1>
<div class='content'><p>Persistence is a more flexible version of caching that allows you to specify the storage level. The storage level determines how and where the data is stored (e.g., in-memory, on disk, or both).</p>
</div><h2>Storage Levels</h2>
<div class='content'><ul>
<li><strong>MEMORY_ONLY</strong>: Stores RDD as deserialized Java objects in the JVM. If the RDD does not fit in memory, some partitions will not be cached and will be recomputed when needed.</li>
<li><strong>MEMORY_AND_DISK</strong>: Stores RDD as deserialized Java objects in the JVM. If the RDD does not fit in memory, the partitions that do not fit are stored on disk and read from there when needed.</li>
<li><strong>DISK_ONLY</strong>: Stores RDD partitions only on disk.</li>
<li><strong>MEMORY_ONLY_SER</strong>: Stores RDD as serialized Java objects (one byte array per partition) in the JVM.</li>
<li><strong>MEMORY_AND_DISK_SER</strong>: Similar to MEMORY_ONLY_SER but spills partitions that do not fit in memory to disk.</li>
</ul>
</div><h2>How to Persist Data</h2>
<div class='content'><p>You can persist an RDD or DataFrame using the <code>persist()</code> method with a specified storage level.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("aW1wb3J0IG9yZy5hcGFjaGUuc3Bhcmsuc3RvcmFnZS5TdG9yYWdlTGV2ZWwKCnZhbCByZGQgPSBzYy50ZXh0RmlsZSgiaGRmczovL3BhdGgvdG8vZmlsZSIpCnZhbCBwZXJzaXN0ZWRSZGQgPSByZGQucGVyc2lzdChTdG9yYWdlTGV2ZWwuTUVNT1JZX0FORF9ESVNLKQ=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>import org.apache.spark.storage.StorageLevel

val rdd = sc.textFile(&quot;hdfs://path/to/file&quot;)
val persistedRdd = rdd.persist(StorageLevel.MEMORY_AND_DISK)</pre></div><div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ZnJvbSBweXNwYXJrIGltcG9ydCBTdG9yYWdlTGV2ZWwKCmRmID0gc3BhcmsucmVhZC50ZXh0KCJoZGZzOi8vcGF0aC90by9maWxlIikKcGVyc2lzdGVkRGYgPSBkZi5wZXJzaXN0KFN0b3JhZ2VMZXZlbC5NRU1PUllfQU5EX0RJU0sp"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>from pyspark import StorageLevel

df = spark.read.text(&quot;hdfs://path/to/file&quot;)
persistedDf = df.persist(StorageLevel.MEMORY_AND_DISK)</pre></div><div class='content'></div><h2>Comparing Storage Levels</h2>
<div class='content'><p>| Storage Level         | Memory Usage | Disk Usage | CPU Usage | Fault Tolerance |
|-----------------------|--------------|------------|-----------|-----------------|
| MEMORY_ONLY           | High         | None       | Low       | Low             |
| MEMORY_AND_DISK       | Medium       | Medium     | Medium    | Medium          |
| DISK_ONLY             | None         | High       | High      | High            |
| MEMORY_ONLY_SER       | Low          | None       | High      | Low             |
| MEMORY_AND_DISK_SER   | Low          | Medium     | High      | Medium          |</p>
</div><h1>Practical Examples</h1>
<h2>Example 1: Caching a DataFrame</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("IyBSZWFkaW5nIGEgQ1NWIGZpbGUgaW50byBhIERhdGFGcmFtZQpkZiA9IHNwYXJrLnJlYWQuY3N2KCJoZGZzOi8vcGF0aC90by9jc3ZmaWxlIiwgaGVhZGVyPVRydWUsIGluZmVyU2NoZW1hPVRydWUpCgojIFBlcmZvcm1pbmcgc29tZSB0cmFuc2Zvcm1hdGlvbnMKZGZfZmlsdGVyZWQgPSBkZi5maWx0ZXIoZGZbJ2FnZSddID4gMzApCgojIENhY2hpbmcgdGhlIERhdGFGcmFtZQpkZl9jYWNoZWQgPSBkZl9maWx0ZXJlZC5jYWNoZSgpCgojIFBlcmZvcm1pbmcgYWN0aW9ucyBvbiB0aGUgY2FjaGVkIERhdGFGcmFtZQpkZl9jYWNoZWQuc2hvdygpCmRmX2NhY2hlZC5jb3VudCgp"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'># Reading a CSV file into a DataFrame
df = spark.read.csv(&quot;hdfs://path/to/csvfile&quot;, header=True, inferSchema=True)

# Performing some transformations
df_filtered = df.filter(df['age'] &gt; 30)

# Caching the DataFrame
df_cached = df_filtered.cache()

# Performing actions on the cached DataFrame
df_cached.show()
df_cached.count()</pre></div><div class='content'></div><h2>Example 2: Persisting an RDD</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("aW1wb3J0IG9yZy5hcGFjaGUuc3Bhcmsuc3RvcmFnZS5TdG9yYWdlTGV2ZWwKCi8vIFJlYWRpbmcgYSB0ZXh0IGZpbGUgaW50byBhbiBSREQKdmFsIHJkZCA9IHNjLnRleHRGaWxlKCJoZGZzOi8vcGF0aC90by90ZXh0ZmlsZSIpCgovLyBQZXJmb3JtaW5nIHNvbWUgdHJhbnNmb3JtYXRpb25zCnZhbCByZGRGaWx0ZXJlZCA9IHJkZC5maWx0ZXIobGluZSA9PiBsaW5lLmNvbnRhaW5zKCJTcGFyayIpKQoKLy8gUGVyc2lzdGluZyB0aGUgUkREIHdpdGggTUVNT1JZX0FORF9ESVNLIHN0b3JhZ2UgbGV2ZWwKdmFsIHJkZFBlcnNpc3RlZCA9IHJkZEZpbHRlcmVkLnBlcnNpc3QoU3RvcmFnZUxldmVsLk1FTU9SWV9BTkRfRElTSykKCi8vIFBlcmZvcm1pbmcgYWN0aW9ucyBvbiB0aGUgcGVyc2lzdGVkIFJERApwcmludGxuKHJkZFBlcnNpc3RlZC5jb3VudCgpKQpyZGRQZXJzaXN0ZWQuY29sbGVjdCgpLmZvcmVhY2gocHJpbnRsbik="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>import org.apache.spark.storage.StorageLevel

// Reading a text file into an RDD
val rdd = sc.textFile(&quot;hdfs://path/to/textfile&quot;)

// Performing some transformations
val rddFiltered = rdd.filter(line =&gt; line.contains(&quot;Spark&quot;))

// Persisting the RDD with MEMORY_AND_DISK storage level
val rddPersisted = rddFiltered.persist(StorageLevel.MEMORY_AND_DISK)

// Performing actions on the persisted RDD
println(rddPersisted.count())
rddPersisted.collect().foreach(println)</pre></div><div class='content'></div><h1>Conclusion</h1>
<div class='content'><p>Caching and persistence are powerful techniques in Apache Spark that can significantly enhance the performance and efficiency of your applications. By understanding when and how to use these features, you can optimize resource usage and improve the fault tolerance of your Spark jobs. Remember to choose the appropriate storage level based on your application's requirements and the available resources.</p>
</div><div class='row navigation'>
	<div class='col-4'>
					<a href='partitioning-and-shuffling'>&#x25C4;Partitioning and Shuffling</a>
			</div>
	<div class='col-4 text-center'>
		<a href="./" class="title">Caching and Persistence in Apache Spark</a>
	</div>
	<div class='col-4 text-end'>
					<a href='tuning-spark-applications'>Tuning Spark Applications &#x25BA;</a>
			</div>
</div>
</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Advertising</h1>
			<p>This space is reserved for advertising.</p>
			<p>If you want to be a sponsor, contact us to include links in this area: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Thank you for collaborating!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. All rights reserved</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir galetes per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Accept</a>
    <a href="/cookies">More Information</a>
</div>	

	</div>    
</body>
</html>
