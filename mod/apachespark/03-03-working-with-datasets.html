<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Working with Datasets</title>

    <link rel="alternate" href="https://campusempresa.com/mod/apachespark/03-03-working-with-datasets" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/mod/apachespark/03-03-working-with-datasets" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/mod/apachespark/03-03-working-with-datasets" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="/js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body >
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-12 col-md-8 p-2 p-md-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo-header_enterprise.png"></a>
			</h1>
		</div>
		<div class="col-12 col-md-4 p-2 p-md-0 text-end">
			<h2 id="main_title"><cite>Building today's and tomorrow's society</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-2 p-md-0 m-0 text-end">
													<b id="lit_lang_es" class="px-2">EN</b>
				|
				<a href="https://campusempresa.com/mod/apachespark/03-03-working-with-datasets" class="px-2">ES</a></b>
				|
				<a href="https://campusempresa.cat/mod/apachespark/03-03-working-with-datasets" class="px-2">CA</a>
					</div>
	</div>
</div>

<div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<!-- <a href="/">Home</a>  -->
									<a href="./">Course Content</a>
					<span class="sep">|</span>
								<a href="/all/competencias">Technical Skills</a>
				<a href="/all/conocimientos">Knowledge</a>
				<a href="/all/soft_skills">Social Skills</a>
			</div>
		</div>
	</div>
</div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content">
								<div class='row navigation'>
	<div class='col-1 col-md-2'>
					<a href='03-02-dataframe-operations' title="DataFrame Operations">
				<span class="d-none d-md-inline">&#x25C4; Previous</span>
				<span class="d-inline d-md-none"><i class="bi bi-caret-left-square-fill"></i></span>
			</a>
			</div>
	<div class='col-10 col-md-8 text-center'>
					<a href="./"><h2 style="text-decoration:underline">Working with Datasets</h2></a>
			</div>
	<div class='col-1 col-md-2 text-end'>
					<a href='03-04-handling-missing-data' title="Handling Missing Data">
				<span class="d-none d-md-inline">Next &#x25BA;</span>
				<span class="d-inline d-md-none"><i class="bi bi-caret-right-square-fill"></i></span>
			</a>
			</div>
</div>
<div class='content'><p>In this section, we will explore Spark Datasets, which provide the benefits of RDDs (Resilient Distributed Datasets) with the optimization advantages of DataFrames. Datasets are a strongly-typed, immutable collection of objects that can be processed in parallel. They are available in both Scala and Java, but not in Python.</p>
</div><h1><p>Key Concepts</p>
</h1>
<div class='content'><ol>
<li>
<p><strong>Dataset Overview</strong></p>
<ul>
<li>Datasets are a distributed collection of data.</li>
<li>They provide the benefits of RDDs with the optimizations of DataFrames.</li>
<li>Datasets are strongly-typed, meaning they enforce a schema at compile time.</li>
</ul>
</li>
<li>
<p><strong>Creating Datasets</strong></p>
<ul>
<li>Datasets can be created from existing RDDs, DataFrames, or by reading data from external sources.</li>
</ul>
</li>
<li>
<p><strong>Dataset Operations</strong></p>
<ul>
<li>Datasets support a wide range of operations, including transformations and actions.</li>
<li>Common operations include <code>map</code>, <code>filter</code>, <code>groupBy</code>, and <code>agg</code>.</li>
</ul>
</li>
<li>
<p><strong>Interoperability with DataFrames</strong></p>
<ul>
<li>Datasets can be easily converted to DataFrames and vice versa.</li>
</ul>
</li>
</ol>
</div><h1><p>Creating Datasets</p>
</h1>
<div class='content'></div><h2><p>From a Collection</p>
</h2>
<div class='content'><p>You can create a Dataset from a collection of objects in your driver program.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("aW1wb3J0IG9yZy5hcGFjaGUuc3Bhcmsuc3FsLlNwYXJrU2Vzc2lvbgoKdmFsIHNwYXJrID0gU3BhcmtTZXNzaW9uLmJ1aWxkZXIuYXBwTmFtZSgiRGF0YXNldEV4YW1wbGUiKS5nZXRPckNyZWF0ZSgpCgovLyBDcmVhdGUgYSBjYXNlIGNsYXNzCmNhc2UgY2xhc3MgUGVyc29uKG5hbWU6IFN0cmluZywgYWdlOiBJbnQpCgovLyBDcmVhdGUgYSBzZXF1ZW5jZSBvZiBQZXJzb24gb2JqZWN0cwp2YWwgcGVvcGxlID0gU2VxKFBlcnNvbigiSm9obiIsIDMwKSwgUGVyc29uKCJKYW5lIiwgMjUpLCBQZXJzb24oIkpha2UiLCAzNSkpCgovLyBDb252ZXJ0IHRoZSBzZXF1ZW5jZSB0byBhIERhdGFzZXQKaW1wb3J0IHNwYXJrLmltcGxpY2l0cy5fCnZhbCBwZW9wbGVEUyA9IHBlb3BsZS50b0RTKCkKCnBlb3BsZURTLnNob3coKQ=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>import org.apache.spark.sql.SparkSession

val spark = SparkSession.builder.appName(&quot;DatasetExample&quot;).getOrCreate()

// Create a case class
case class Person(name: String, age: Int)

// Create a sequence of Person objects
val people = Seq(Person(&quot;John&quot;, 30), Person(&quot;Jane&quot;, 25), Person(&quot;Jake&quot;, 35))

// Convert the sequence to a Dataset
import spark.implicits._
val peopleDS = people.toDS()

peopleDS.show()</pre></div><div class='content'></div><h2><p>From a DataFrame</p>
</h2>
<div class='content'><p>You can convert an existing DataFrame to a Dataset by specifying the type.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("aW1wb3J0IG9yZy5hcGFjaGUuc3Bhcmsuc3FsLlNwYXJrU2Vzc2lvbgoKdmFsIHNwYXJrID0gU3BhcmtTZXNzaW9uLmJ1aWxkZXIuYXBwTmFtZSgiRGF0YXNldEV4YW1wbGUiKS5nZXRPckNyZWF0ZSgpCgovLyBDcmVhdGUgYSBEYXRhRnJhbWUKdmFsIGRmID0gc3BhcmsucmVhZC5qc29uKCJwYXRoL3RvL3Blb3BsZS5qc29uIikKCi8vIENvbnZlcnQgdGhlIERhdGFGcmFtZSB0byBhIERhdGFzZXQKY2FzZSBjbGFzcyBQZXJzb24obmFtZTogU3RyaW5nLCBhZ2U6IEludCkKaW1wb3J0IHNwYXJrLmltcGxpY2l0cy5fCnZhbCBwZW9wbGVEUyA9IGRmLmFzW1BlcnNvbl0KCnBlb3BsZURTLnNob3coKQ=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>import org.apache.spark.sql.SparkSession

val spark = SparkSession.builder.appName(&quot;DatasetExample&quot;).getOrCreate()

// Create a DataFrame
val df = spark.read.json(&quot;path/to/people.json&quot;)

// Convert the DataFrame to a Dataset
case class Person(name: String, age: Int)
import spark.implicits._
val peopleDS = df.as[Person]

peopleDS.show()</pre></div><div class='content'></div><h2><p>From an RDD</p>
</h2>
<div class='content'><p>You can also create a Dataset from an existing RDD.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("aW1wb3J0IG9yZy5hcGFjaGUuc3Bhcmsuc3FsLlNwYXJrU2Vzc2lvbgoKdmFsIHNwYXJrID0gU3BhcmtTZXNzaW9uLmJ1aWxkZXIuYXBwTmFtZSgiRGF0YXNldEV4YW1wbGUiKS5nZXRPckNyZWF0ZSgpCgovLyBDcmVhdGUgYW4gUkRECnZhbCByZGQgPSBzcGFyay5zcGFya0NvbnRleHQucGFyYWxsZWxpemUoU2VxKFBlcnNvbigiSm9obiIsIDMwKSwgUGVyc29uKCJKYW5lIiwgMjUpLCBQZXJzb24oIkpha2UiLCAzNSkpKQoKLy8gQ29udmVydCB0aGUgUkREIHRvIGEgRGF0YXNldAppbXBvcnQgc3BhcmsuaW1wbGljaXRzLl8KdmFsIHBlb3BsZURTID0gcmRkLnRvRFMoKQoKcGVvcGxlRFMuc2hvdygp"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>import org.apache.spark.sql.SparkSession

val spark = SparkSession.builder.appName(&quot;DatasetExample&quot;).getOrCreate()

// Create an RDD
val rdd = spark.sparkContext.parallelize(Seq(Person(&quot;John&quot;, 30), Person(&quot;Jane&quot;, 25), Person(&quot;Jake&quot;, 35)))

// Convert the RDD to a Dataset
import spark.implicits._
val peopleDS = rdd.toDS()

peopleDS.show()</pre></div><div class='content'></div><h1><p>Dataset Operations</p>
</h1>
<div class='content'></div><h2><p>Transformations</p>
</h2>
<div class='content'><p>Transformations are operations on Datasets that return a new Dataset. They are lazy, meaning they are not executed until an action is called.</p>
<ul>
<li><strong>map</strong>: Applies a function to each element and returns a new Dataset.</li>
</ul>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("dmFsIG5hbWVzRFMgPSBwZW9wbGVEUy5tYXAocGVyc29uID0+IHBlcnNvbi5uYW1lKQpuYW1lc0RTLnNob3coKQ=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>val namesDS = peopleDS.map(person =&gt; person.name)
namesDS.show()</pre></div><div class='content'><ul>
<li><strong>filter</strong>: Returns a new Dataset containing only the elements that satisfy a predicate.</li>
</ul>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("dmFsIGFkdWx0c0RTID0gcGVvcGxlRFMuZmlsdGVyKHBlcnNvbiA9PiBwZXJzb24uYWdlID49IDE4KQphZHVsdHNEUy5zaG93KCk="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>val adultsDS = peopleDS.filter(person =&gt; person.age &gt;= 18)
adultsDS.show()</pre></div><div class='content'><ul>
<li><strong>groupBy</strong>: Groups the Dataset using the specified columns.</li>
</ul>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("dmFsIGdyb3VwZWREUyA9IHBlb3BsZURTLmdyb3VwQnkoImFnZSIpLmNvdW50KCkKZ3JvdXBlZERTLnNob3coKQ=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>val groupedDS = peopleDS.groupBy(&quot;age&quot;).count()
groupedDS.show()</pre></div><div class='content'></div><h2><p>Actions</p>
</h2>
<div class='content'><p>Actions trigger the execution of transformations and return a result to the driver program.</p>
<ul>
<li><strong>collect</strong>: Returns an array that contains all of the elements in the Dataset.</li>
</ul>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("dmFsIHBlb3BsZUFycmF5ID0gcGVvcGxlRFMuY29sbGVjdCgpCnBlb3BsZUFycmF5LmZvcmVhY2gocHJpbnRsbik="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>val peopleArray = peopleDS.collect()
peopleArray.foreach(println)</pre></div><div class='content'><ul>
<li><strong>count</strong>: Returns the number of elements in the Dataset.</li>
</ul>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("dmFsIGNvdW50ID0gcGVvcGxlRFMuY291bnQoKQpwcmludGxuKHMiTnVtYmVyIG9mIHBlb3BsZTogJGNvdW50Iik="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>val count = peopleDS.count()
println(s&quot;Number of people: $count&quot;)</pre></div><div class='content'><ul>
<li><strong>show</strong>: Displays the top rows of the Dataset in a tabular form.</li>
</ul>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("cGVvcGxlRFMuc2hvdygp"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>peopleDS.show()</pre></div><div class='content'></div><h1><p>Interoperability with DataFrames</p>
</h1>
<div class='content'><p>You can easily convert a Dataset to a DataFrame and vice versa.</p>
<ul>
<li><strong>Dataset to DataFrame</strong>:</li>
</ul>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("dmFsIGRmID0gcGVvcGxlRFMudG9ERigpCmRmLnNob3coKQ=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>val df = peopleDS.toDF()
df.show()</pre></div><div class='content'><ul>
<li><strong>DataFrame to Dataset</strong>:</li>
</ul>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("dmFsIGRzID0gZGYuYXNbUGVyc29uXQpkcy5zaG93KCk="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>val ds = df.as[Person]
ds.show()</pre></div><div class='content'></div><h1><p>Practical Exercise</p>
</h1>
<div class='content'></div><h2><p>Exercise: Working with Datasets</p>
</h2>
<div class='content'><ol>
<li>Create a case class <code>Employee</code> with fields <code>name</code> (String), <code>age</code> (Int), and <code>salary</code> (Double).</li>
<li>Create a Dataset of <code>Employee</code> objects.</li>
<li>Perform the following operations on the Dataset:
<ul>
<li>Filter employees with a salary greater than 50000.</li>
<li>Group employees by age and count the number of employees in each age group.</li>
<li>Convert the Dataset to a DataFrame and show the result.</li>
</ul>
</li>
</ol>
</div><h2><p>Solution</p>
</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("aW1wb3J0IG9yZy5hcGFjaGUuc3Bhcmsuc3FsLlNwYXJrU2Vzc2lvbgoKdmFsIHNwYXJrID0gU3BhcmtTZXNzaW9uLmJ1aWxkZXIuYXBwTmFtZSgiRGF0YXNldEV4ZXJjaXNlIikuZ2V0T3JDcmVhdGUoKQoKLy8gU3RlcCAxOiBDcmVhdGUgYSBjYXNlIGNsYXNzCmNhc2UgY2xhc3MgRW1wbG95ZWUobmFtZTogU3RyaW5nLCBhZ2U6IEludCwgc2FsYXJ5OiBEb3VibGUpCgovLyBTdGVwIDI6IENyZWF0ZSBhIERhdGFzZXQgb2YgRW1wbG95ZWUgb2JqZWN0cwp2YWwgZW1wbG95ZWVzID0gU2VxKAogIEVtcGxveWVlKCJBbGljZSIsIDMwLCA2MDAwMCksCiAgRW1wbG95ZWUoIkJvYiIsIDI1LCA0NTAwMCksCiAgRW1wbG95ZWUoIkNoYXJsaWUiLCAzNSwgNzAwMDApLAogIEVtcGxveWVlKCJEYXZpZCIsIDMwLCA1MDAwMCkKKQoKaW1wb3J0IHNwYXJrLmltcGxpY2l0cy5fCnZhbCBlbXBsb3llZURTID0gZW1wbG95ZWVzLnRvRFMoKQoKLy8gU3RlcCAzOiBQZXJmb3JtIG9wZXJhdGlvbnMgb24gdGhlIERhdGFzZXQKCi8vIEZpbHRlciBlbXBsb3llZXMgd2l0aCBhIHNhbGFyeSBncmVhdGVyIHRoYW4gNTAwMDAKdmFsIGhpZ2hTYWxhcnlEUyA9IGVtcGxveWVlRFMuZmlsdGVyKGVtcGxveWVlID0+IGVtcGxveWVlLnNhbGFyeSA+IDUwMDAwKQpoaWdoU2FsYXJ5RFMuc2hvdygpCgovLyBHcm91cCBlbXBsb3llZXMgYnkgYWdlIGFuZCBjb3VudCB0aGUgbnVtYmVyIG9mIGVtcGxveWVlcyBpbiBlYWNoIGFnZSBncm91cAp2YWwgZ3JvdXBlZERTID0gZW1wbG95ZWVEUy5ncm91cEJ5KCJhZ2UiKS5jb3VudCgpCmdyb3VwZWREUy5zaG93KCkKCi8vIENvbnZlcnQgdGhlIERhdGFzZXQgdG8gYSBEYXRhRnJhbWUgYW5kIHNob3cgdGhlIHJlc3VsdAp2YWwgZW1wbG95ZWVERiA9IGVtcGxveWVlRFMudG9ERigpCmVtcGxveWVlREYuc2hvdygp"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>import org.apache.spark.sql.SparkSession

val spark = SparkSession.builder.appName(&quot;DatasetExercise&quot;).getOrCreate()

// Step 1: Create a case class
case class Employee(name: String, age: Int, salary: Double)

// Step 2: Create a Dataset of Employee objects
val employees = Seq(
  Employee(&quot;Alice&quot;, 30, 60000),
  Employee(&quot;Bob&quot;, 25, 45000),
  Employee(&quot;Charlie&quot;, 35, 70000),
  Employee(&quot;David&quot;, 30, 50000)
)

import spark.implicits._
val employeeDS = employees.toDS()

// Step 3: Perform operations on the Dataset

// Filter employees with a salary greater than 50000
val highSalaryDS = employeeDS.filter(employee =&gt; employee.salary &gt; 50000)
highSalaryDS.show()

// Group employees by age and count the number of employees in each age group
val groupedDS = employeeDS.groupBy(&quot;age&quot;).count()
groupedDS.show()

// Convert the Dataset to a DataFrame and show the result
val employeeDF = employeeDS.toDF()
employeeDF.show()</pre></div><div class='content'></div><h1><p>Summary</p>
</h1>
<div class='content'><p>In this section, we covered the basics of working with Datasets in Apache Spark. We learned how to create Datasets from collections, DataFrames, and RDDs. We also explored various transformations and actions that can be performed on Datasets. Finally, we discussed the interoperability between Datasets and DataFrames and provided a practical exercise to reinforce the concepts.</p>
<p>Next, we will delve into handling missing data in Spark, which is crucial for maintaining data quality and integrity in your applications.</p>
</div><div class='row navigation'>
	<div class='col-1 col-md-2'>
					<a href='03-02-dataframe-operations' title="DataFrame Operations">
				<span class="d-none d-md-inline">&#x25C4; Previous</span>
				<span class="d-inline d-md-none"><i class="bi bi-caret-left-square-fill"></i></span>
			</a>
			</div>
	<div class='col-10 col-md-8 text-center'>
			</div>
	<div class='col-1 col-md-2 text-end'>
					<a href='03-04-handling-missing-data' title="Handling Missing Data">
				<span class="d-none d-md-inline">Next &#x25BA;</span>
				<span class="d-inline d-md-none"><i class="bi bi-caret-right-square-fill"></i></span>
			</a>
			</div>
</div>

			</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Advertising</h1>
			<p>This space is reserved for advertising.</p>
			<p>If you want to be a sponsor, contact us to include links in this area: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Thank you for collaborating!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. All rights reserved</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	We use cookies to improve your user experience and offer content tailored to your interests.
    <a href="#" id="btn_accept_cookies" class="button">Accept</a>
    <a href="/cookies">More Information</a>
</div>	

	</div>    
</body>
</html>
