<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stateful Stream Processing</title>

    <link rel="alternate" href="https://campusempresa.com/mod/apachespark/stateful-stream-processing" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/mod/apachespark/stateful-stream-processing" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/mod/apachespark/stateful-stream-processing" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body>
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-8 p-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo-header_enterprise.png"></a>
			</h1>
		</div>
		<div class="col-4 p-0 text-end">
			<h2 id="main_title"><cite>Building today's and tomorrow's society</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-0 m-0 text-end">
													<b id="lit_lang_es" class="px-2">EN</b>
				|
				<a href="https://campusempresa.com/mod/apachespark/stateful-stream-processing" class="px-2">ES</a></b>
				|
				<a href="https://campusempresa.cat/mod/apachespark/stateful-stream-processing" class="px-2">CA</a>
					</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="/objective">The Project</a>
				<a href="/about">About Us</a>
				<a href="/contribute">Contribute</a>
				<a href="/donate">Donations</a>
				<a href="/licence">License</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content"><div class='row navigation'>
	<div class='col-4'>
					<a href='window-operations'>&#x25C4;Window Operations</a>
			</div>
	<div class='col-4 text-center'>
		<a href="./" class="title">Stateful Stream Processing</a>
	</div>
	<div class='col-4 text-end'>
					<a href='structured-streaming'>Structured Streaming &#x25BA;</a>
			</div>
</div>
<div class='content'><p>Stateful stream processing is a powerful feature in Apache Spark that allows you to maintain and update state information across multiple records in a stream. This is crucial for applications that need to track information over time, such as sessionization, real-time analytics, and monitoring.</p>
</div><h1>Introduction to Stateful Stream Processing</h1>
<div class='content'><p>Stateful stream processing involves maintaining state information across multiple records in a stream. This state can be updated and queried as new data arrives.</p>
<ul>
<li><strong>State</strong>: Information that is maintained across multiple records.</li>
<li><strong>Stateful Operations</strong>: Operations that update and query the state.</li>
</ul>
</div><h1>Key Concepts</h1>
<div class='content'><ul>
<li><strong>State</strong>: The stored information that can be updated and queried.</li>
<li><strong>Stateful Transformation</strong>: Transformations that involve state, such as <code>mapWithState</code> and <code>updateStateByKey</code>.</li>
<li><strong>Checkpointing</strong>: Mechanism to save the state periodically to ensure fault tolerance.</li>
</ul>
</div><h1>Stateful Transformations</h1>
<div class='content'></div><h2>`mapWithState`</h2>
<div class='content'><p>The <code>mapWithState</code> operation allows you to maintain and update state information for each key in a DStream.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("aW1wb3J0IG9yZy5hcGFjaGUuc3Bhcmsuc3RyZWFtaW5nLl8KaW1wb3J0IG9yZy5hcGFjaGUuc3Bhcmsuc3RyZWFtaW5nLlN0cmVhbWluZ0NvbnRleHQuXwppbXBvcnQgb3JnLmFwYWNoZS5zcGFyay5zdHJlYW1pbmcuZHN0cmVhbS5fCgp2YWwgY29uZiA9IG5ldyBTcGFya0NvbmYoKS5zZXRNYXN0ZXIoImxvY2FsWzJdIikuc2V0QXBwTmFtZSgiU3RhdGVmdWxOZXR3b3JrV29yZENvdW50IikKdmFsIHNzYyA9IG5ldyBTdHJlYW1pbmdDb250ZXh0KGNvbmYsIFNlY29uZHMoMSkpCgovLyBJbml0aWFsIHN0YXRlIFJERAp2YWwgaW5pdGlhbFJERCA9IHNzYy5zcGFya0NvbnRleHQucGFyYWxsZWxpemUoTGlzdCgoImhlbGxvIiwgMSksICgid29ybGQiLCAxKSkpCgovLyBGdW5jdGlvbiB0byB1cGRhdGUgdGhlIHN0YXRlCmRlZiBtYXBwaW5nRnVuY3Rpb24oYmF0Y2hUaW1lOiBUaW1lLCBrZXk6IFN0cmluZywgdmFsdWU6IE9wdGlvbltJbnRdLCBzdGF0ZTogU3RhdGVbSW50XSk6IE9wdGlvblsoU3RyaW5nLCBJbnQpXSA9IHsKICB2YWwgc3VtID0gdmFsdWUuZ2V0T3JFbHNlKDApICsgc3RhdGUuZ2V0T3B0aW9uLmdldE9yRWxzZSgwKQogIHZhbCBvdXRwdXQgPSAoa2V5LCBzdW0pCiAgc3RhdGUudXBkYXRlKHN1bSkKICBTb21lKG91dHB1dCkKfQoKdmFsIGxpbmVzID0gc3NjLnNvY2tldFRleHRTdHJlYW0oImxvY2FsaG9zdCIsIDk5OTkpCnZhbCB3b3JkcyA9IGxpbmVzLmZsYXRNYXAoXy5zcGxpdCgiICIpKQp2YWwgd29yZERzdHJlYW0gPSB3b3Jkcy5tYXAod29yZCA9PiAod29yZCwgMSkpCgp2YWwgc3RhdGVEc3RyZWFtID0gd29yZERzdHJlYW0ubWFwV2l0aFN0YXRlKFN0YXRlU3BlYy5mdW5jdGlvbihtYXBwaW5nRnVuY3Rpb24pLmluaXRpYWxTdGF0ZShpbml0aWFsUkREKSkKc3RhdGVEc3RyZWFtLnByaW50KCkKCnNzYy5zdGFydCgpCnNzYy5hd2FpdFRlcm1pbmF0aW9uKCk="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>import org.apache.spark.streaming._
import org.apache.spark.streaming.StreamingContext._
import org.apache.spark.streaming.dstream._

val conf = new SparkConf().setMaster(&quot;local[2]&quot;).setAppName(&quot;StatefulNetworkWordCount&quot;)
val ssc = new StreamingContext(conf, Seconds(1))

// Initial state RDD
val initialRDD = ssc.sparkContext.parallelize(List((&quot;hello&quot;, 1), (&quot;world&quot;, 1)))

// Function to update the state
def mappingFunction(batchTime: Time, key: String, value: Option[Int], state: State[Int]): Option[(String, Int)] = {
  val sum = value.getOrElse(0) + state.getOption.getOrElse(0)
  val output = (key, sum)
  state.update(sum)
  Some(output)
}

val lines = ssc.socketTextStream(&quot;localhost&quot;, 9999)
val words = lines.flatMap(_.split(&quot; &quot;))
val wordDstream = words.map(word =&gt; (word, 1))

val stateDstream = wordDstream.mapWithState(StateSpec.function(mappingFunction).initialState(initialRDD))
stateDstream.print()

ssc.start()
ssc.awaitTermination()</pre></div><div class='content'></div><h2>`updateStateByKey`</h2>
<div class='content'><p>The <code>updateStateByKey</code> operation allows you to maintain state across batches of data.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("aW1wb3J0IG9yZy5hcGFjaGUuc3Bhcmsuc3RyZWFtaW5nLl8KaW1wb3J0IG9yZy5hcGFjaGUuc3Bhcmsuc3RyZWFtaW5nLlN0cmVhbWluZ0NvbnRleHQuXwoKdmFsIGNvbmYgPSBuZXcgU3BhcmtDb25mKCkuc2V0TWFzdGVyKCJsb2NhbFsyXSIpLnNldEFwcE5hbWUoIlN0YXRlZnVsTmV0d29ya1dvcmRDb3VudCIpCnZhbCBzc2MgPSBuZXcgU3RyZWFtaW5nQ29udGV4dChjb25mLCBTZWNvbmRzKDEpKQoKLy8gRnVuY3Rpb24gdG8gdXBkYXRlIHRoZSBzdGF0ZQpkZWYgdXBkYXRlRnVuY3Rpb24obmV3VmFsdWVzOiBTZXFbSW50XSwgcnVubmluZ0NvdW50OiBPcHRpb25bSW50XSk6IE9wdGlvbltJbnRdID0gewogIHZhbCBuZXdDb3VudCA9IHJ1bm5pbmdDb3VudC5nZXRPckVsc2UoMCkgKyBuZXdWYWx1ZXMuc3VtCiAgU29tZShuZXdDb3VudCkKfQoKc3NjLmNoZWNrcG9pbnQoImNoZWNrcG9pbnQiKQoKdmFsIGxpbmVzID0gc3NjLnNvY2tldFRleHRTdHJlYW0oImxvY2FsaG9zdCIsIDk5OTkpCnZhbCB3b3JkcyA9IGxpbmVzLmZsYXRNYXAoXy5zcGxpdCgiICIpKQp2YWwgd29yZERzdHJlYW0gPSB3b3Jkcy5tYXAod29yZCA9PiAod29yZCwgMSkpCgp2YWwgc3RhdGVEc3RyZWFtID0gd29yZERzdHJlYW0udXBkYXRlU3RhdGVCeUtleSh1cGRhdGVGdW5jdGlvbikKc3RhdGVEc3RyZWFtLnByaW50KCkKCnNzYy5zdGFydCgpCnNzYy5hd2FpdFRlcm1pbmF0aW9uKCk="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>import org.apache.spark.streaming._
import org.apache.spark.streaming.StreamingContext._

val conf = new SparkConf().setMaster(&quot;local[2]&quot;).setAppName(&quot;StatefulNetworkWordCount&quot;)
val ssc = new StreamingContext(conf, Seconds(1))

// Function to update the state
def updateFunction(newValues: Seq[Int], runningCount: Option[Int]): Option[Int] = {
  val newCount = runningCount.getOrElse(0) + newValues.sum
  Some(newCount)
}

ssc.checkpoint(&quot;checkpoint&quot;)

val lines = ssc.socketTextStream(&quot;localhost&quot;, 9999)
val words = lines.flatMap(_.split(&quot; &quot;))
val wordDstream = words.map(word =&gt; (word, 1))

val stateDstream = wordDstream.updateStateByKey(updateFunction)
stateDstream.print()

ssc.start()
ssc.awaitTermination()</pre></div><div class='content'></div><h1>Checkpointing</h1>
<div class='content'><p>Checkpointing is essential for fault tolerance in stateful stream processing. It saves the state of the stream periodically to a reliable storage.</p>
<ul>
<li><strong>Checkpoint Directory</strong>: A directory in HDFS or a similar distributed file system where the state is saved.</li>
<li><strong>Checkpoint Interval</strong>: The frequency at which the state is saved.</li>
</ul>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("c3NjLmNoZWNrcG9pbnQoImhkZnM6Ly9jaGVja3BvaW50LWRpcmVjdG9yeSIp"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>ssc.checkpoint(&quot;hdfs://checkpoint-directory&quot;)</pre></div><div class='content'></div><h1>Summary</h1>
<div class='content'><p>Stateful stream processing in Apache Spark allows you to maintain and update state information across multiple records in a stream. Key operations include <code>mapWithState</code> and <code>updateStateByKey</code>, which enable you to perform complex transformations that depend on historical data. Checkpointing ensures fault tolerance by periodically saving the state to a reliable storage.</p>
<p>By understanding and utilizing these concepts, you can build robust, stateful streaming applications that can handle real-time data processing requirements effectively.</p>
</div><div class='row navigation'>
	<div class='col-4'>
					<a href='window-operations'>&#x25C4;Window Operations</a>
			</div>
	<div class='col-4 text-center'>
		<a href="./" class="title">Stateful Stream Processing</a>
	</div>
	<div class='col-4 text-end'>
					<a href='structured-streaming'>Structured Streaming &#x25BA;</a>
			</div>
</div>
</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Advertising</h1>
			<p>This space is reserved for advertising.</p>
			<p>If you want to be a sponsor, contact us to include links in this area: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Thank you for collaborating!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. All rights reserved</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir galetes per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Accept</a>
    <a href="/cookies">More Information</a>
</div>	

	</div>    
</body>
</html>
