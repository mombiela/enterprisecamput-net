<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Running SQL Queries Programmatically</title>

    <link rel="alternate" href="https://campusempresa.com/mod/apachespark/running-sql-queries-programmatically" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/mod/apachespark/running-sql-queries-programmatically" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/mod/apachespark/running-sql-queries-programmatically" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body >
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-8 p-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo-header_enterprise.png"></a>
			</h1>
		</div>
		<div class="col-4 p-0 text-end">
			<h2 id="main_title"><cite>Building today's and tomorrow's society</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-0 m-0 text-end">
													<b id="lit_lang_es" class="px-2">EN</b>
				|
				<a href="https://campusempresa.com/mod/apachespark/running-sql-queries-programmatically" class="px-2">ES</a></b>
				|
				<a href="https://campusempresa.cat/mod/apachespark/running-sql-queries-programmatically" class="px-2">CA</a>
					</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="/objective">The Project</a>
				<a href="/about">About Us</a>
				<a href="/contribute">Contribute</a>
				<a href="/donate">Donations</a>
				<a href="/licence">License</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content">
								<div class='row navigation'>
	<div class='col-4'>
					<a href='dataframes-api'>&#x25C4;DataFrames API</a>
			</div>
	<div class='col-4 text-center'>
		<a href="./" class="title">Running SQL Queries Programmatically</a>
	</div>
	<div class='col-4 text-end'>
					<a href='data-sources-and-sinks'>Data Sources and Sinks &#x25BA;</a>
			</div>
</div>
<div class='content'></div><h1>Introduction</h1>
<div class='content'><p>In this section, we will explore how to run SQL queries programmatically using Apache Spark. This is a crucial skill for data engineers and data scientists who need to perform complex data manipulations and analyses. We will cover the basics of Spark SQL, how to create DataFrames, and how to execute SQL queries on these DataFrames.</p>
</div><h1>Key Concepts</h1>
<div class='content'><ul>
<li><strong>SparkSession</strong>: The entry point to programming Spark with the Dataset and DataFrame API.</li>
<li><strong>DataFrame</strong>: A distributed collection of data organized into named columns.</li>
<li><strong>SQLContext</strong>: An entry point for working with structured data (DataFrames) in Spark.</li>
</ul>
</div><h1>Setting Up SparkSession</h1>
<div class='content'><p>Before running SQL queries, you need to set up a SparkSession. This is the entry point for all Spark functionalities.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ZnJvbSBweXNwYXJrLnNxbCBpbXBvcnQgU3BhcmtTZXNzaW9uCgojIEluaXRpYWxpemUgU3BhcmtTZXNzaW9uCnNwYXJrID0gU3BhcmtTZXNzaW9uLmJ1aWxkZXIgXAogICAgLmFwcE5hbWUoIlNRTCBRdWVyaWVzIFByb2dyYW1tYXRpY2FsbHkiKSBcCiAgICAuZ2V0T3JDcmVhdGUoKQ=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>from pyspark.sql import SparkSession

# Initialize SparkSession
spark = SparkSession.builder \
    .appName(&quot;SQL Queries Programmatically&quot;) \
    .getOrCreate()</pre></div><div class='content'></div><h1>Creating DataFrames</h1>
<div class='content'><p>DataFrames are the primary abstraction in Spark SQL. You can create DataFrames from various data sources, such as JSON, CSV, and Parquet files.</p>
</div><h2>Example: Creating a DataFrame from a JSON file</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("IyBMb2FkIEpTT04gZGF0YSBpbnRvIGEgRGF0YUZyYW1lCmRmID0gc3BhcmsucmVhZC5qc29uKCJwYXRoL3RvL3lvdXIvanNvbmZpbGUuanNvbiIpCgojIFNob3cgdGhlIERhdGFGcmFtZSBzY2hlbWEKZGYucHJpbnRTY2hlbWEoKQoKIyBEaXNwbGF5IHRoZSBmaXJzdCBmZXcgcm93cyBvZiB0aGUgRGF0YUZyYW1lCmRmLnNob3coKQ=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'># Load JSON data into a DataFrame
df = spark.read.json(&quot;path/to/your/jsonfile.json&quot;)

# Show the DataFrame schema
df.printSchema()

# Display the first few rows of the DataFrame
df.show()</pre></div><div class='content'></div><h1>Running SQL Queries</h1>
<div class='content'><p>Once you have a DataFrame, you can register it as a temporary view and run SQL queries against it.</p>
</div><h2>Example: Registering a DataFrame as a Temporary View</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("IyBSZWdpc3RlciB0aGUgRGF0YUZyYW1lIGFzIGEgdGVtcG9yYXJ5IHZpZXcKZGYuY3JlYXRlT3JSZXBsYWNlVGVtcFZpZXcoIm15X3RhYmxlIikKCiMgUnVuIGFuIFNRTCBxdWVyeQpyZXN1bHQgPSBzcGFyay5zcWwoIlNFTEVDVCAqIEZST00gbXlfdGFibGUgV0hFUkUgYWdlID4gMzAiKQoKIyBTaG93IHRoZSByZXN1bHQKcmVzdWx0LnNob3coKQ=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'># Register the DataFrame as a temporary view
df.createOrReplaceTempView(&quot;my_table&quot;)

# Run an SQL query
result = spark.sql(&quot;SELECT * FROM my_table WHERE age &gt; 30&quot;)

# Show the result
result.show()</pre></div><div class='content'></div><h1>Advanced SQL Queries</h1>
<div class='content'><p>As you become more comfortable with basic SQL queries, you can start exploring more advanced queries, such as joins, aggregations, and window functions.</p>
</div><h2>Example: Performing a Join</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("IyBMb2FkIGFub3RoZXIgRGF0YUZyYW1lCmRmMiA9IHNwYXJrLnJlYWQuanNvbigicGF0aC90by9hbm90aGVyL2pzb25maWxlLmpzb24iKQoKIyBSZWdpc3RlciB0aGUgc2Vjb25kIERhdGFGcmFtZSBhcyBhIHRlbXBvcmFyeSB2aWV3CmRmMi5jcmVhdGVPclJlcGxhY2VUZW1wVmlldygiYW5vdGhlcl90YWJsZSIpCgojIFBlcmZvcm0gYSBqb2luIGJldHdlZW4gdGhlIHR3byB0YWJsZXMKam9pbl9yZXN1bHQgPSBzcGFyay5zcWwoIiIiCiAgICBTRUxFQ1QgYS5uYW1lLCBiLnNhbGFyeQogICAgRlJPTSBteV90YWJsZSBhCiAgICBKT0lOIGFub3RoZXJfdGFibGUgYgogICAgT04gYS5pZCA9IGIuaWQKIiIiKQoKIyBTaG93IHRoZSBqb2luIHJlc3VsdApqb2luX3Jlc3VsdC5zaG93KCk="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'># Load another DataFrame
df2 = spark.read.json(&quot;path/to/another/jsonfile.json&quot;)

# Register the second DataFrame as a temporary view
df2.createOrReplaceTempView(&quot;another_table&quot;)

# Perform a join between the two tables
join_result = spark.sql(&quot;&quot;&quot;
    SELECT a.name, b.salary
    FROM my_table a
    JOIN another_table b
    ON a.id = b.id
&quot;&quot;&quot;)

# Show the join result
join_result.show()</pre></div><div class='content'></div><h2>Example: Aggregations</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("IyBQZXJmb3JtIGFuIGFnZ3JlZ2F0aW9uIHF1ZXJ5CmFnZ19yZXN1bHQgPSBzcGFyay5zcWwoIiIiCiAgICBTRUxFQ1QgZGVwYXJ0bWVudCwgQVZHKHNhbGFyeSkgYXMgYXZnX3NhbGFyeQogICAgRlJPTSBhbm90aGVyX3RhYmxlCiAgICBHUk9VUCBCWSBkZXBhcnRtZW50CiIiIikKCiMgU2hvdyB0aGUgYWdncmVnYXRpb24gcmVzdWx0CmFnZ19yZXN1bHQuc2hvdygp"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'># Perform an aggregation query
agg_result = spark.sql(&quot;&quot;&quot;
    SELECT department, AVG(salary) as avg_salary
    FROM another_table
    GROUP BY department
&quot;&quot;&quot;)

# Show the aggregation result
agg_result.show()</pre></div><div class='content'></div><h1>Conclusion</h1>
<div class='content'><p>Running SQL queries programmatically in Apache Spark allows you to leverage the power of distributed computing for data analysis and manipulation. By understanding how to create DataFrames, register them as temporary views, and execute SQL queries, you can perform complex data operations efficiently. As you advance, you can explore more sophisticated SQL functionalities to meet your data processing needs.</p>
</div><div class='row navigation'>
	<div class='col-4'>
					<a href='dataframes-api'>&#x25C4;DataFrames API</a>
			</div>
	<div class='col-4 text-center'>
		<a href="./" class="title">Running SQL Queries Programmatically</a>
	</div>
	<div class='col-4 text-end'>
					<a href='data-sources-and-sinks'>Data Sources and Sinks &#x25BA;</a>
			</div>
</div>

			</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Advertising</h1>
			<p>This space is reserved for advertising.</p>
			<p>If you want to be a sponsor, contact us to include links in this area: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Thank you for collaborating!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. All rights reserved</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir galetes per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Accept</a>
    <a href="/cookies">More Information</a>
</div>	

	</div>    
</body>
</html>
