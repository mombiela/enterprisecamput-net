<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consensus Algorithms</title>

    <link rel="alternate" href="https://campusempresa.com/mod/arquitecturas_distribuidas/03-02-algoritmos-consenso" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/mod/arquitecturas_distribuidas/03-02-algorismes-consens" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/mod/arquitecturas_distribuidas/03-02-consensus-algorithms" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="/js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body >
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-12 col-md-8 p-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo-header_enterprise.png"></a>
			</h1>
		</div>
		<div class="col-12 col-md-4 px-0 py-2 py-md-0 text-end">
			<h2 id="main_title"><cite>Building today's and tomorrow's society</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 px-0 py-2 py-md-0 m-0 text-end">
													<b id="lit_lang_es" class="px-2">EN</b>
				|
				<a href="https://campusempresa.com/mod/arquitecturas_distribuidas/03-02-algoritmos-consenso" class="px-2">ES</a></b>
				|
				<a href="https://campusempresa.cat/mod/arquitecturas_distribuidas/03-02-algorismes-consens" class="px-2">CA</a>
					</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="/objective">The Project</a>
				<a href="/about">About Us</a>
				<a href="/contribute">Contribute</a>
				<a href="/donate">Donations</a>
				<a href="/licence">License</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content">
								<div class='row navigation'>
	<div class='col-2'>
					<a href='03-01-consistency-models' title="Consistency Models">&#x25C4;Previous</a>
			</div>
	<div class='col-8 text-center'>
					<a href="./"><h2 style="text-decoration:underline">Consensus Algorithms</h2></a>
			</div>
	<div class='col-2 text-end'>
					<a href='03-03-data-replication' title="Data Replication">Next &#x25BA;</a>
			</div>
</div>
<div class='content'></div><h1>Introduction</h1>
<div class='content'><p>Consensus algorithms are fundamental in distributed systems to ensure that all nodes in the system agree on a single data value or a sequence of values. This agreement is crucial for maintaining consistency and reliability in the presence of failures. In this section, we will explore the key concepts, types, and practical implementations of consensus algorithms.</p>
</div><h1>Key Concepts</h1>
<div class='content'><ol>
<li><strong>Consensus</strong>: The process of achieving agreement among distributed nodes on a single data value.</li>
<li><strong>Fault Tolerance</strong>: The ability of a system to continue operating correctly in the presence of failures.</li>
<li><strong>Byzantine Fault Tolerance (BFT)</strong>: A property of a system that can tolerate Byzantine faults, where nodes may fail and provide incorrect or malicious responses.</li>
<li><strong>Leader Election</strong>: A process to designate a single node as the leader to coordinate the consensus process.</li>
</ol>
</div><h1>Types of Consensus Algorithms</h1>
<div class='content'></div><h2>1. Paxos</h2>
<div class='content'><ul>
<li><strong>Description</strong>: Paxos is a family of protocols for solving consensus in a network of unreliable processors. It is designed to handle failures and ensure that a single value is chosen.</li>
<li><strong>Key Components</strong>:
<ul>
<li><strong>Proposers</strong>: Nodes that propose values.</li>
<li><strong>Acceptors</strong>: Nodes that accept proposed values.</li>
<li><strong>Learners</strong>: Nodes that learn the chosen value.</li>
</ul>
</li>
<li><strong>Phases</strong>:
<ol>
<li><strong>Prepare Phase</strong>: Proposers send a prepare request to acceptors.</li>
<li><strong>Promise Phase</strong>: Acceptors respond with a promise not to accept proposals with a lower number.</li>
<li><strong>Accept Phase</strong>: Proposers send an accept request with a proposal number.</li>
<li><strong>Accepted Phase</strong>: Acceptors accept the proposal and notify learners.</li>
</ol>
</li>
</ul>
</div><h2>2. Raft</h2>
<div class='content'><ul>
<li><strong>Description</strong>: Raft is a consensus algorithm designed to be more understandable than Paxos. It achieves consensus by electing a leader who manages the replication of log entries.</li>
<li><strong>Key Components</strong>:
<ul>
<li><strong>Leader</strong>: The node responsible for managing the log replication.</li>
<li><strong>Followers</strong>: Nodes that replicate the log entries from the leader.</li>
<li><strong>Candidates</strong>: Nodes that can become leaders through an election process.</li>
</ul>
</li>
<li><strong>Phases</strong>:
<ol>
<li><strong>Leader Election</strong>: A candidate node requests votes from other nodes to become the leader.</li>
<li><strong>Log Replication</strong>: The leader appends log entries and replicates them to followers.</li>
<li><strong>Commitment</strong>: Once a majority of followers acknowledge the log entry, it is committed.</li>
</ol>
</li>
</ul>
</div><h2>3. Byzantine Fault Tolerance (BFT)</h2>
<div class='content'><ul>
<li><strong>Description</strong>: BFT algorithms are designed to handle Byzantine faults, where nodes may act arbitrarily or maliciously.</li>
<li><strong>Key Components</strong>:
<ul>
<li><strong>Primary</strong>: The node that proposes values.</li>
<li><strong>Replicas</strong>: Nodes that agree on the proposed values.</li>
</ul>
</li>
<li><strong>Phases</strong>:
<ol>
<li><strong>Pre-prepare Phase</strong>: The primary node proposes a value.</li>
<li><strong>Prepare Phase</strong>: Replicas prepare the value.</li>
<li><strong>Commit Phase</strong>: Replicas commit the value.</li>
</ol>
</li>
</ul>
</div><h1>Practical Examples</h1>
<div class='content'></div><h2>Example 1: Paxos Algorithm</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y2xhc3MgUGF4b3NOb2RlOgogICAgZGVmIF9faW5pdF9fKHNlbGYsIG5vZGVfaWQpOgogICAgICAgIHNlbGYubm9kZV9pZCA9IG5vZGVfaWQKICAgICAgICBzZWxmLnByb21pc2VkX2lkID0gTm9uZQogICAgICAgIHNlbGYuYWNjZXB0ZWRfaWQgPSBOb25lCiAgICAgICAgc2VsZi5hY2NlcHRlZF92YWx1ZSA9IE5vbmUKCiAgICBkZWYgcHJlcGFyZShzZWxmLCBwcm9wb3NhbF9pZCk6CiAgICAgICAgaWYgc2VsZi5wcm9taXNlZF9pZCBpcyBOb25lIG9yIHByb3Bvc2FsX2lkID4gc2VsZi5wcm9taXNlZF9pZDoKICAgICAgICAgICAgc2VsZi5wcm9taXNlZF9pZCA9IHByb3Bvc2FsX2lkCiAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgcmV0dXJuIEZhbHNlCgogICAgZGVmIGFjY2VwdChzZWxmLCBwcm9wb3NhbF9pZCwgdmFsdWUpOgogICAgICAgIGlmIHNlbGYucHJvbWlzZWRfaWQgaXMgTm9uZSBvciBwcm9wb3NhbF9pZCA+PSBzZWxmLnByb21pc2VkX2lkOgogICAgICAgICAgICBzZWxmLnByb21pc2VkX2lkID0gcHJvcG9zYWxfaWQKICAgICAgICAgICAgc2VsZi5hY2NlcHRlZF9pZCA9IHByb3Bvc2FsX2lkCiAgICAgICAgICAgIHNlbGYuYWNjZXB0ZWRfdmFsdWUgPSB2YWx1ZQogICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgIHJldHVybiBGYWxzZQoKIyBFeGFtcGxlIHVzYWdlCm5vZGUgPSBQYXhvc05vZGUobm9kZV9pZD0xKQpwcmludChub2RlLnByZXBhcmUocHJvcG9zYWxfaWQ9MSkpICAjIE91dHB1dDogVHJ1ZQpwcmludChub2RlLmFjY2VwdChwcm9wb3NhbF9pZD0xLCB2YWx1ZT0iVmFsdWUxIikpICAjIE91dHB1dDogVHJ1ZQ=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>class PaxosNode:
    def __init__(self, node_id):
        self.node_id = node_id
        self.promised_id = None
        self.accepted_id = None
        self.accepted_value = None

    def prepare(self, proposal_id):
        if self.promised_id is None or proposal_id &gt; self.promised_id:
            self.promised_id = proposal_id
            return True
        return False

    def accept(self, proposal_id, value):
        if self.promised_id is None or proposal_id &gt;= self.promised_id:
            self.promised_id = proposal_id
            self.accepted_id = proposal_id
            self.accepted_value = value
            return True
        return False

# Example usage
node = PaxosNode(node_id=1)
print(node.prepare(proposal_id=1))  # Output: True
print(node.accept(proposal_id=1, value=&quot;Value1&quot;))  # Output: True</pre></div><div class='content'></div><h2>Example 2: Raft Algorithm</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y2xhc3MgUmFmdE5vZGU6CiAgICBkZWYgX19pbml0X18oc2VsZiwgbm9kZV9pZCk6CiAgICAgICAgc2VsZi5ub2RlX2lkID0gbm9kZV9pZAogICAgICAgIHNlbGYuc3RhdGUgPSAiZm9sbG93ZXIiCiAgICAgICAgc2VsZi52b3RlZF9mb3IgPSBOb25lCiAgICAgICAgc2VsZi5sb2cgPSBbXQoKICAgIGRlZiByZXF1ZXN0X3ZvdGUoc2VsZiwgY2FuZGlkYXRlX2lkKToKICAgICAgICBpZiBzZWxmLnZvdGVkX2ZvciBpcyBOb25lOgogICAgICAgICAgICBzZWxmLnZvdGVkX2ZvciA9IGNhbmRpZGF0ZV9pZAogICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgIHJldHVybiBGYWxzZQoKICAgIGRlZiBhcHBlbmRfZW50cmllcyhzZWxmLCBsZWFkZXJfaWQsIGVudHJpZXMpOgogICAgICAgIGlmIHNlbGYuc3RhdGUgPT0gImZvbGxvd2VyIjoKICAgICAgICAgICAgc2VsZi5sb2cuZXh0ZW5kKGVudHJpZXMpCiAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgcmV0dXJuIEZhbHNlCgojIEV4YW1wbGUgdXNhZ2UKbm9kZSA9IFJhZnROb2RlKG5vZGVfaWQ9MSkKcHJpbnQobm9kZS5yZXF1ZXN0X3ZvdGUoY2FuZGlkYXRlX2lkPTIpKSAgIyBPdXRwdXQ6IFRydWUKcHJpbnQobm9kZS5hcHBlbmRfZW50cmllcyhsZWFkZXJfaWQ9MiwgZW50cmllcz1bIkVudHJ5MSJdKSkgICMgT3V0cHV0OiBUcnVl"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>class RaftNode:
    def __init__(self, node_id):
        self.node_id = node_id
        self.state = &quot;follower&quot;
        self.voted_for = None
        self.log = []

    def request_vote(self, candidate_id):
        if self.voted_for is None:
            self.voted_for = candidate_id
            return True
        return False

    def append_entries(self, leader_id, entries):
        if self.state == &quot;follower&quot;:
            self.log.extend(entries)
            return True
        return False

# Example usage
node = RaftNode(node_id=1)
print(node.request_vote(candidate_id=2))  # Output: True
print(node.append_entries(leader_id=2, entries=[&quot;Entry1&quot;]))  # Output: True</pre></div><div class='content'></div><h1>Practical Exercises</h1>
<div class='content'></div><h2>Exercise 1: Implement a Basic Paxos Node</h2>
<div class='content'><p><strong>Task</strong>: Implement a basic Paxos node that can handle prepare and accept requests.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y2xhc3MgUGF4b3NOb2RlOgogICAgZGVmIF9faW5pdF9fKHNlbGYsIG5vZGVfaWQpOgogICAgICAgIHNlbGYubm9kZV9pZCA9IG5vZGVfaWQKICAgICAgICBzZWxmLnByb21pc2VkX2lkID0gTm9uZQogICAgICAgIHNlbGYuYWNjZXB0ZWRfaWQgPSBOb25lCiAgICAgICAgc2VsZi5hY2NlcHRlZF92YWx1ZSA9IE5vbmUKCiAgICBkZWYgcHJlcGFyZShzZWxmLCBwcm9wb3NhbF9pZCk6CiAgICAgICAgaWYgc2VsZi5wcm9taXNlZF9pZCBpcyBOb25lIG9yIHByb3Bvc2FsX2lkID4gc2VsZi5wcm9taXNlZF9pZDoKICAgICAgICAgICAgc2VsZi5wcm9taXNlZF9pZCA9IHByb3Bvc2FsX2lkCiAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgcmV0dXJuIEZhbHNlCgogICAgZGVmIGFjY2VwdChzZWxmLCBwcm9wb3NhbF9pZCwgdmFsdWUpOgogICAgICAgIGlmIHNlbGYucHJvbWlzZWRfaWQgaXMgTm9uZSBvciBwcm9wb3NhbF9pZCA+PSBzZWxmLnByb21pc2VkX2lkOgogICAgICAgICAgICBzZWxmLnByb21pc2VkX2lkID0gcHJvcG9zYWxfaWQKICAgICAgICAgICAgc2VsZi5hY2NlcHRlZF9pZCA9IHByb3Bvc2FsX2lkCiAgICAgICAgICAgIHNlbGYuYWNjZXB0ZWRfdmFsdWUgPSB2YWx1ZQogICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgIHJldHVybiBGYWxzZQoKIyBUZXN0IHlvdXIgaW1wbGVtZW50YXRpb24Kbm9kZSA9IFBheG9zTm9kZShub2RlX2lkPTEpCmFzc2VydCBub2RlLnByZXBhcmUocHJvcG9zYWxfaWQ9MSkgPT0gVHJ1ZQphc3NlcnQgbm9kZS5hY2NlcHQocHJvcG9zYWxfaWQ9MSwgdmFsdWU9IlZhbHVlMSIpID09IFRydWUKYXNzZXJ0IG5vZGUucHJlcGFyZShwcm9wb3NhbF9pZD0wKSA9PSBGYWxzZQphc3NlcnQgbm9kZS5hY2NlcHQocHJvcG9zYWxfaWQ9MCwgdmFsdWU9IlZhbHVlMiIpID09IEZhbHNl"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>class PaxosNode:
    def __init__(self, node_id):
        self.node_id = node_id
        self.promised_id = None
        self.accepted_id = None
        self.accepted_value = None

    def prepare(self, proposal_id):
        if self.promised_id is None or proposal_id &gt; self.promised_id:
            self.promised_id = proposal_id
            return True
        return False

    def accept(self, proposal_id, value):
        if self.promised_id is None or proposal_id &gt;= self.promised_id:
            self.promised_id = proposal_id
            self.accepted_id = proposal_id
            self.accepted_value = value
            return True
        return False

# Test your implementation
node = PaxosNode(node_id=1)
assert node.prepare(proposal_id=1) == True
assert node.accept(proposal_id=1, value=&quot;Value1&quot;) == True
assert node.prepare(proposal_id=0) == False
assert node.accept(proposal_id=0, value=&quot;Value2&quot;) == False</pre></div><div class='content'></div><h2>Exercise 2: Implement a Basic Raft Node</h2>
<div class='content'><p><strong>Task</strong>: Implement a basic Raft node that can handle vote requests and log entries.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y2xhc3MgUmFmdE5vZGU6CiAgICBkZWYgX19pbml0X18oc2VsZiwgbm9kZV9pZCk6CiAgICAgICAgc2VsZi5ub2RlX2lkID0gbm9kZV9pZAogICAgICAgIHNlbGYuc3RhdGUgPSAiZm9sbG93ZXIiCiAgICAgICAgc2VsZi52b3RlZF9mb3IgPSBOb25lCiAgICAgICAgc2VsZi5sb2cgPSBbXQoKICAgIGRlZiByZXF1ZXN0X3ZvdGUoc2VsZiwgY2FuZGlkYXRlX2lkKToKICAgICAgICBpZiBzZWxmLnZvdGVkX2ZvciBpcyBOb25lOgogICAgICAgICAgICBzZWxmLnZvdGVkX2ZvciA9IGNhbmRpZGF0ZV9pZAogICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgIHJldHVybiBGYWxzZQoKICAgIGRlZiBhcHBlbmRfZW50cmllcyhzZWxmLCBsZWFkZXJfaWQsIGVudHJpZXMpOgogICAgICAgIGlmIHNlbGYuc3RhdGUgPT0gImZvbGxvd2VyIjoKICAgICAgICAgICAgc2VsZi5sb2cuZXh0ZW5kKGVudHJpZXMpCiAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgcmV0dXJuIEZhbHNlCgojIFRlc3QgeW91ciBpbXBsZW1lbnRhdGlvbgpub2RlID0gUmFmdE5vZGUobm9kZV9pZD0xKQphc3NlcnQgbm9kZS5yZXF1ZXN0X3ZvdGUoY2FuZGlkYXRlX2lkPTIpID09IFRydWUKYXNzZXJ0IG5vZGUuYXBwZW5kX2VudHJpZXMobGVhZGVyX2lkPTIsIGVudHJpZXM9WyJFbnRyeTEiXSkgPT0gVHJ1ZQphc3NlcnQgbm9kZS5yZXF1ZXN0X3ZvdGUoY2FuZGlkYXRlX2lkPTMpID09IEZhbHNlCmFzc2VydCBub2RlLmFwcGVuZF9lbnRyaWVzKGxlYWRlcl9pZD0yLCBlbnRyaWVzPVsiRW50cnkyIl0pID09IFRydWU="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>class RaftNode:
    def __init__(self, node_id):
        self.node_id = node_id
        self.state = &quot;follower&quot;
        self.voted_for = None
        self.log = []

    def request_vote(self, candidate_id):
        if self.voted_for is None:
            self.voted_for = candidate_id
            return True
        return False

    def append_entries(self, leader_id, entries):
        if self.state == &quot;follower&quot;:
            self.log.extend(entries)
            return True
        return False

# Test your implementation
node = RaftNode(node_id=1)
assert node.request_vote(candidate_id=2) == True
assert node.append_entries(leader_id=2, entries=[&quot;Entry1&quot;]) == True
assert node.request_vote(candidate_id=3) == False
assert node.append_entries(leader_id=2, entries=[&quot;Entry2&quot;]) == True</pre></div><div class='content'></div><h1>Common Mistakes and Tips</h1>
<div class='content'><ul>
<li><strong>Mistake</strong>: Not handling the case where a proposal ID is lower than the promised ID in Paxos.
<ul>
<li><strong>Tip</strong>: Always check if the proposal ID is greater than or equal to the promised ID before accepting it.</li>
</ul>
</li>
<li><strong>Mistake</strong>: Not resetting the voted_for field in Raft after an election.
<ul>
<li><strong>Tip</strong>: Ensure that the voted_for field is reset appropriately to allow for new elections.</li>
</ul>
</li>
</ul>
</div><h1>Conclusion</h1>
<div class='content'><p>In this section, we explored the fundamental concepts and types of consensus algorithms, including Paxos, Raft, and Byzantine Fault Tolerance. We provided practical examples and exercises to help solidify your understanding of these algorithms. Understanding consensus algorithms is crucial for building reliable and fault-tolerant distributed systems. In the next module, we will delve into data replication techniques to further enhance the reliability and availability of distributed systems.</p>
</div><div class='row navigation'>
	<div class='col-2'>
					<a href='03-01-consistency-models' title="Consistency Models">&#x25C4;Previous</a>
			</div>
	<div class='col-8 text-center'>
			</div>
	<div class='col-2 text-end'>
					<a href='03-03-data-replication' title="Data Replication">Next &#x25BA;</a>
			</div>
</div>

			</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Advertising</h1>
			<p>This space is reserved for advertising.</p>
			<p>If you want to be a sponsor, contact us to include links in this area: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Thank you for collaborating!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. All rights reserved</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir galetes per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Accept</a>
    <a href="/cookies">More Information</a>
</div>	

	</div>    
</body>
</html>
