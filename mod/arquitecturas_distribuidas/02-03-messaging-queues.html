<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Messaging and Message Queues</title>

    <link rel="alternate" href="https://campusempresa.com/mod/arquitecturas_distribuidas/02-03-mensajeria-colas" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/mod/arquitecturas_distribuidas/02-03-missatgeria-cues" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/mod/arquitecturas_distribuidas/02-03-messaging-queues" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body >
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-8 p-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo-header_enterprise.png"></a>
			</h1>
		</div>
		<div class="col-4 p-0 text-end">
			<h2 id="main_title"><cite>Building today's and tomorrow's society</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-0 m-0 text-end">
													<b id="lit_lang_es" class="px-2">EN</b>
				|
				<a href="https://campusempresa.com/mod/arquitecturas_distribuidas/02-03-mensajeria-colas" class="px-2">ES</a></b>
				|
				<a href="https://campusempresa.cat/mod/arquitecturas_distribuidas/02-03-missatgeria-cues" class="px-2">CA</a>
					</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="/objective">The Project</a>
				<a href="/about">About Us</a>
				<a href="/contribute">Contribute</a>
				<a href="/donate">Donations</a>
				<a href="/licence">License</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content">
								<div class='row navigation'>
	<div class='col-2'>
					<a href='02-02-rpc-rmi' title="RPC and RMI">&#x25C4;Previous</a>
			</div>
	<div class='col-8 text-center'>
					<a href="./"><h2 style="text-decoration:underline">Messaging and Message Queues</h2></a>
			</div>
	<div class='col-2 text-end'>
					<a href='03-01-consistency-models' title="Consistency Models">Next &#x25BA;</a>
			</div>
</div>
<div class='content'><p>In distributed systems, communication between different components is crucial for ensuring data consistency, reliability, and scalability. Messaging and message queues play a vital role in enabling asynchronous communication, decoupling components, and improving system resilience. This section will cover the fundamentals of messaging and message queues, their advantages, and practical examples.</p>
</div><h1>Key Concepts</h1>
<div class='content'></div><h2>Messaging</h2>
<div class='content'><p>Messaging refers to the process of exchanging data between different parts of a distributed system. Messages can be sent and received asynchronously, allowing components to operate independently and improving system performance.</p>
</div><h2>Message Queues</h2>
<div class='content'><p>A message queue is a form of asynchronous service-to-service communication used in serverless and microservices architectures. Messages are stored in a queue until they are processed and deleted. This ensures that messages are delivered reliably and in the correct order.</p>
</div><h2>Components of a Messaging System</h2>
<div class='content'><ol>
<li><strong>Producer</strong>: The component that sends messages to the queue.</li>
<li><strong>Consumer</strong>: The component that receives and processes messages from the queue.</li>
<li><strong>Queue</strong>: The buffer that stores messages until they are processed by consumers.</li>
<li><strong>Broker</strong>: The intermediary that manages the message queue and ensures message delivery.</li>
</ol>
</div><h1>Advantages of Messaging and Message Queues</h1>
<div class='content'><ul>
<li><strong>Decoupling</strong>: Producers and consumers can operate independently, allowing for more flexible and scalable system design.</li>
<li><strong>Scalability</strong>: Message queues can handle a large volume of messages, enabling systems to scale horizontally.</li>
<li><strong>Reliability</strong>: Messages are stored in the queue until they are successfully processed, ensuring reliable communication.</li>
<li><strong>Load Balancing</strong>: Multiple consumers can process messages from the queue, distributing the load evenly.</li>
<li><strong>Fault Tolerance</strong>: If a consumer fails, messages remain in the queue and can be processed by another consumer.</li>
</ul>
</div><h1>Common Messaging Protocols</h1>
<div class='content'><ul>
<li><strong>AMQP (Advanced Message Queuing Protocol)</strong>: A widely used protocol for message-oriented middleware.</li>
<li><strong>MQTT (Message Queuing Telemetry Transport)</strong>: A lightweight messaging protocol for small sensors and mobile devices.</li>
<li><strong>STOMP (Simple Text Oriented Messaging Protocol)</strong>: A simple and easy-to-implement protocol for message brokers.</li>
</ul>
</div><h1>Practical Example: Using RabbitMQ</h1>
<div class='content'><p>RabbitMQ is a popular open-source message broker that implements the AMQP protocol. Below is a simple example of how to set up a producer and consumer using RabbitMQ in Python.</p>
</div><h2>Setting Up RabbitMQ</h2>
<div class='content'><ol>
<li>
<p><strong>Install RabbitMQ</strong>:</p>
<pre><code class="language-bash">sudo apt-get install rabbitmq-server
sudo systemctl enable rabbitmq-server
sudo systemctl start rabbitmq-server
</code></pre>
</li>
<li>
<p><strong>Install Python Client Library</strong>:</p>
<pre><code class="language-bash">pip install pika
</code></pre>
</li>
</ol>
</div><h2>Producer Code</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("aW1wb3J0IHBpa2EKCiMgRXN0YWJsaXNoIGNvbm5lY3Rpb24gdG8gUmFiYml0TVEgc2VydmVyCmNvbm5lY3Rpb24gPSBwaWthLkJsb2NraW5nQ29ubmVjdGlvbihwaWthLkNvbm5lY3Rpb25QYXJhbWV0ZXJzKCdsb2NhbGhvc3QnKSkKY2hhbm5lbCA9IGNvbm5lY3Rpb24uY2hhbm5lbCgpCgojIERlY2xhcmUgYSBxdWV1ZQpjaGFubmVsLnF1ZXVlX2RlY2xhcmUocXVldWU9J2hlbGxvJykKCiMgU2VuZCBhIG1lc3NhZ2UgdG8gdGhlIHF1ZXVlCmNoYW5uZWwuYmFzaWNfcHVibGlzaChleGNoYW5nZT0nJywgcm91dGluZ19rZXk9J2hlbGxvJywgYm9keT0nSGVsbG8gV29ybGQhJykKcHJpbnQoIiBbeF0gU2VudCAnSGVsbG8gV29ybGQhJyIpCgojIENsb3NlIHRoZSBjb25uZWN0aW9uCmNvbm5lY3Rpb24uY2xvc2UoKQ=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>import pika

# Establish connection to RabbitMQ server
connection = pika.BlockingConnection(pika.ConnectionParameters('localhost'))
channel = connection.channel()

# Declare a queue
channel.queue_declare(queue='hello')

# Send a message to the queue
channel.basic_publish(exchange='', routing_key='hello', body='Hello World!')
print(&quot; [x] Sent 'Hello World!'&quot;)

# Close the connection
connection.close()</pre></div><div class='content'></div><h2>Consumer Code</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("aW1wb3J0IHBpa2EKCiMgRXN0YWJsaXNoIGNvbm5lY3Rpb24gdG8gUmFiYml0TVEgc2VydmVyCmNvbm5lY3Rpb24gPSBwaWthLkJsb2NraW5nQ29ubmVjdGlvbihwaWthLkNvbm5lY3Rpb25QYXJhbWV0ZXJzKCdsb2NhbGhvc3QnKSkKY2hhbm5lbCA9IGNvbm5lY3Rpb24uY2hhbm5lbCgpCgojIERlY2xhcmUgYSBxdWV1ZQpjaGFubmVsLnF1ZXVlX2RlY2xhcmUocXVldWU9J2hlbGxvJykKCiMgRGVmaW5lIGEgY2FsbGJhY2sgZnVuY3Rpb24gdG8gcHJvY2VzcyBtZXNzYWdlcwpkZWYgY2FsbGJhY2soY2gsIG1ldGhvZCwgcHJvcGVydGllcywgYm9keSk6CiAgICBwcmludChmIiBbeF0gUmVjZWl2ZWQge2JvZHl9IikKCiMgU2V0IHVwIHN1YnNjcmlwdGlvbiBvbiB0aGUgcXVldWUKY2hhbm5lbC5iYXNpY19jb25zdW1lKHF1ZXVlPSdoZWxsbycsIG9uX21lc3NhZ2VfY2FsbGJhY2s9Y2FsbGJhY2ssIGF1dG9fYWNrPVRydWUpCgpwcmludCgnIFsqXSBXYWl0aW5nIGZvciBtZXNzYWdlcy4gVG8gZXhpdCBwcmVzcyBDVFJMK0MnKQpjaGFubmVsLnN0YXJ0X2NvbnN1bWluZygp"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>import pika

# Establish connection to RabbitMQ server
connection = pika.BlockingConnection(pika.ConnectionParameters('localhost'))
channel = connection.channel()

# Declare a queue
channel.queue_declare(queue='hello')

# Define a callback function to process messages
def callback(ch, method, properties, body):
    print(f&quot; [x] Received {body}&quot;)

# Set up subscription on the queue
channel.basic_consume(queue='hello', on_message_callback=callback, auto_ack=True)

print(' [*] Waiting for messages. To exit press CTRL+C')
channel.start_consuming()</pre></div><div class='content'></div><h2>Explanation</h2>
<div class='content'><ul>
<li><strong>Producer</strong>: Connects to RabbitMQ, declares a queue named 'hello', and sends a message &quot;Hello World!&quot; to the queue.</li>
<li><strong>Consumer</strong>: Connects to RabbitMQ, declares the same queue, and waits for messages. When a message is received, it prints the message to the console.</li>
</ul>
</div><h1>Practical Exercise</h1>
<div class='content'></div><h2>Exercise: Implement a Task Queue</h2>
<div class='content'><ol>
<li><strong>Objective</strong>: Create a task queue where producers send tasks to the queue and consumers process these tasks.</li>
<li><strong>Steps</strong>:
<ul>
<li>Modify the producer to send multiple tasks (e.g., task1, task2, task3).</li>
<li>Modify the consumer to simulate task processing by adding a delay (e.g., <code>time.sleep(2)</code>).</li>
</ul>
</li>
</ol>
</div><h2>Solution</h2>
<div class='content'><h4>Producer Code</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("aW1wb3J0IHBpa2EKCmNvbm5lY3Rpb24gPSBwaWthLkJsb2NraW5nQ29ubmVjdGlvbihwaWthLkNvbm5lY3Rpb25QYXJhbWV0ZXJzKCdsb2NhbGhvc3QnKSkKY2hhbm5lbCA9IGNvbm5lY3Rpb24uY2hhbm5lbCgpCgpjaGFubmVsLnF1ZXVlX2RlY2xhcmUocXVldWU9J3Rhc2tfcXVldWUnKQoKdGFza3MgPSBbJ3Rhc2sxJywgJ3Rhc2syJywgJ3Rhc2szJ10KZm9yIHRhc2sgaW4gdGFza3M6CiAgICBjaGFubmVsLmJhc2ljX3B1Ymxpc2goZXhjaGFuZ2U9JycsIHJvdXRpbmdfa2V5PSd0YXNrX3F1ZXVlJywgYm9keT10YXNrKQogICAgcHJpbnQoZiIgW3hdIFNlbnQge3Rhc2t9IikKCmNvbm5lY3Rpb24uY2xvc2UoKQ=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>import pika

connection = pika.BlockingConnection(pika.ConnectionParameters('localhost'))
channel = connection.channel()

channel.queue_declare(queue='task_queue')

tasks = ['task1', 'task2', 'task3']
for task in tasks:
    channel.basic_publish(exchange='', routing_key='task_queue', body=task)
    print(f&quot; [x] Sent {task}&quot;)

connection.close()</pre></div><div class='content'><h4>Consumer Code</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("aW1wb3J0IHBpa2EKaW1wb3J0IHRpbWUKCmNvbm5lY3Rpb24gPSBwaWthLkJsb2NraW5nQ29ubmVjdGlvbihwaWthLkNvbm5lY3Rpb25QYXJhbWV0ZXJzKCdsb2NhbGhvc3QnKSkKY2hhbm5lbCA9IGNvbm5lY3Rpb24uY2hhbm5lbCgpCgpjaGFubmVsLnF1ZXVlX2RlY2xhcmUocXVldWU9J3Rhc2tfcXVldWUnKQoKZGVmIGNhbGxiYWNrKGNoLCBtZXRob2QsIHByb3BlcnRpZXMsIGJvZHkpOgogICAgcHJpbnQoZiIgW3hdIFJlY2VpdmVkIHtib2R5fSIpCiAgICB0aW1lLnNsZWVwKDIpICAjIFNpbXVsYXRlIHRhc2sgcHJvY2Vzc2luZwogICAgcHJpbnQoZiIgW3hdIERvbmUgcHJvY2Vzc2luZyB7Ym9keX0iKQoKY2hhbm5lbC5iYXNpY19jb25zdW1lKHF1ZXVlPSd0YXNrX3F1ZXVlJywgb25fbWVzc2FnZV9jYWxsYmFjaz1jYWxsYmFjaywgYXV0b19hY2s9VHJ1ZSkKCnByaW50KCcgWypdIFdhaXRpbmcgZm9yIG1lc3NhZ2VzLiBUbyBleGl0IHByZXNzIENUUkwrQycpCmNoYW5uZWwuc3RhcnRfY29uc3VtaW5nKCk="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>import pika
import time

connection = pika.BlockingConnection(pika.ConnectionParameters('localhost'))
channel = connection.channel()

channel.queue_declare(queue='task_queue')

def callback(ch, method, properties, body):
    print(f&quot; [x] Received {body}&quot;)
    time.sleep(2)  # Simulate task processing
    print(f&quot; [x] Done processing {body}&quot;)

channel.basic_consume(queue='task_queue', on_message_callback=callback, auto_ack=True)

print(' [*] Waiting for messages. To exit press CTRL+C')
channel.start_consuming()</pre></div><div class='content'></div><h1>Common Mistakes and Tips</h1>
<div class='content'><ul>
<li><strong>Queue Declaration</strong>: Ensure that both producer and consumer declare the same queue to avoid message delivery issues.</li>
<li><strong>Connection Management</strong>: Properly manage connections to avoid resource leaks. Always close connections after use.</li>
<li><strong>Error Handling</strong>: Implement error handling to manage message processing failures and ensure messages are not lost.</li>
</ul>
</div><h1>Conclusion</h1>
<div class='content'><p>In this section, we explored the fundamentals of messaging and message queues, their advantages, and practical implementation using RabbitMQ. Understanding these concepts is crucial for building scalable and reliable distributed systems. In the next module, we will delve into consistency models, which are essential for maintaining data integrity in distributed environments.</p>
</div><div class='row navigation'>
	<div class='col-2'>
					<a href='02-02-rpc-rmi' title="RPC and RMI">&#x25C4;Previous</a>
			</div>
	<div class='col-8 text-center'>
			</div>
	<div class='col-2 text-end'>
					<a href='03-01-consistency-models' title="Consistency Models">Next &#x25BA;</a>
			</div>
</div>

			</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Advertising</h1>
			<p>This space is reserved for advertising.</p>
			<p>If you want to be a sponsor, contact us to include links in this area: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Thank you for collaborating!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. All rights reserved</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir galetes per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Accept</a>
    <a href="/cookies">More Information</a>
</div>	

	</div>    
</body>
</html>
