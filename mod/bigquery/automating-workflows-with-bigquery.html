<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Automating Workflows with BigQuery</title>

    <link rel="alternate" href="https://campusempresa.com/mod/bigquery/automating-workflows-with-bigquery" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/mod/bigquery/automating-workflows-with-bigquery" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/mod/bigquery/automating-workflows-with-bigquery" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body>
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-8 p-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo_header.png" style="visibility:hiddenxx;"></a>
			</h1>
		</div>
		<div class="col-4 p-0 text-end">
			<h2 id="main_title"><cite>Building today's and tomorrow's society</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-0 m-0 text-end">
													<b id="lit_lang_es" class="px-2">EN</b>
				|
				<a href="https://campusempresa.com/mod/bigquery/automating-workflows-with-bigquery" class="px-2">ES</a></b>
				|
				<a href="https://campusempresa.cat/mod/bigquery/automating-workflows-with-bigquery" class="px-2">CA</a>
					</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="/objective">The Project</a>
				<a href="/about">About Us</a>
				<a href="/contribute">Contribute</a>
				<a href="/donate">Donations</a>
				<a href="/licence">License</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content"><div class='row navigation'>
	<div class='col-4'>
					<a href='using-bigquery-with-data-studio'>&#x25C4;Using BigQuery with Data Studio</a>
			</div>
	<div class='col-4 text-center'>
		<a href="./" class="title">Automating Workflows with BigQuery</a>
	</div>
	<div class='col-4 text-end'>
					<a href='scheduling-queries'>Scheduling Queries &#x25BA;</a>
			</div>
</div>
<div class='content'></div><h1>Introduction</h1>
<div class='content'><p>Automating workflows in BigQuery can significantly enhance productivity by reducing manual intervention and ensuring consistent data processing. This section will cover the essentials of automating tasks in BigQuery, from scheduling queries to integrating with other Google Cloud services.</p>
</div><h1>Key Concepts</h1>
<div class='content'><ul>
<li><strong>Scheduled Queries</strong>: Automate the execution of SQL queries at specified intervals.</li>
<li><strong>BigQuery Data Transfer Service</strong>: Automate data movement from various sources into BigQuery.</li>
<li><strong>Cloud Functions</strong>: Trigger BigQuery operations based on events.</li>
<li><strong>Cloud Composer</strong>: Orchestrate complex workflows involving BigQuery and other services.</li>
<li><strong>APIs and Client Libraries</strong>: Programmatically interact with BigQuery for automation.</li>
</ul>
</div><h1>Scheduled Queries</h1>
<div class='content'><p>Scheduled queries allow you to run SQL queries on a recurring schedule. This is useful for tasks like daily reporting or periodic data aggregation.</p>
</div><h2>Example: Creating a Scheduled Query</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("LS0gRXhhbXBsZSBTUUwgcXVlcnkgdG8gYWdncmVnYXRlIGRhaWx5IHNhbGVzIGRhdGEKU0VMRUNUIAogIERBVEUoVElNRVNUQU1QX1RSVU5DKG9yZGVyX3RpbWVzdGFtcCwgREFZKSkgQVMgb3JkZXJfZGF0ZSwKICBTVU0ob3JkZXJfYW1vdW50KSBBUyB0b3RhbF9zYWxlcwpGUk9NIAogIGBwcm9qZWN0LmRhdGFzZXQub3JkZXJzYApHUk9VUCBCWSAKICBvcmRlcl9kYXRlOw=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>-- Example SQL query to aggregate daily sales data
SELECT 
  DATE(TIMESTAMP_TRUNC(order_timestamp, DAY)) AS order_date,
  SUM(order_amount) AS total_sales
FROM 
  `project.dataset.orders`
GROUP BY 
  order_date;</pre></div><div class='content'><p>To schedule this query:</p>
<ol>
<li>Go to the BigQuery console.</li>
<li>Navigate to the &quot;Scheduled Queries&quot; section.</li>
<li>Click &quot;Create Scheduled Query&quot;.</li>
<li>Enter the SQL query and set the schedule (e.g., daily at midnight).</li>
</ol>
</div><h1>BigQuery Data Transfer Service</h1>
<div class='content'><p>The BigQuery Data Transfer Service automates data import from various sources, such as Google Ads, Google Analytics, and external databases.</p>
</div><h2>Example: Setting Up a Data Transfer</h2>
<div class='content'><ol>
<li>In the BigQuery console, go to the &quot;Transfers&quot; section.</li>
<li>Click &quot;Create Transfer&quot;.</li>
<li>Select the data source (e.g., Google Analytics).</li>
<li>Configure the transfer settings, including the destination dataset and schedule.</li>
</ol>
</div><h1>Cloud Functions</h1>
<div class='content'><p>Cloud Functions can be used to trigger BigQuery operations based on events, such as file uploads to Cloud Storage or changes in Firestore.</p>
</div><h2>Example: Triggering a BigQuery Query with Cloud Functions</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y29uc3Qge0JpZ1F1ZXJ5fSA9IHJlcXVpcmUoJ0Bnb29nbGUtY2xvdWQvYmlncXVlcnknKTsKY29uc3QgYmlncXVlcnkgPSBuZXcgQmlnUXVlcnkoKTsKCmV4cG9ydHMudHJpZ2dlckJpZ1F1ZXJ5ID0gYXN5bmMgKGV2ZW50LCBjb250ZXh0KSA9PiB7CiAgY29uc3QgcXVlcnkgPSBgU0VMRUNUICogRlJPTSBcYHByb2plY3QuZGF0YXNldC50YWJsZVxgIExJTUlUIDEwYDsKICBjb25zdCBvcHRpb25zID0gewogICAgcXVlcnk6IHF1ZXJ5LAogICAgbG9jYXRpb246ICdVUycsCiAgfTsKCiAgY29uc3QgW2pvYl0gPSBhd2FpdCBiaWdxdWVyeS5jcmVhdGVRdWVyeUpvYihvcHRpb25zKTsKICBjb25zb2xlLmxvZyhgSm9iICR7am9iLmlkfSBzdGFydGVkLmApOwp9Ow=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>const {BigQuery} = require('@google-cloud/bigquery');
const bigquery = new BigQuery();

exports.triggerBigQuery = async (event, context) =&gt; {
  const query = `SELECT * FROM \`project.dataset.table\` LIMIT 10`;
  const options = {
    query: query,
    location: 'US',
  };

  const [job] = await bigquery.createQueryJob(options);
  console.log(`Job ${job.id} started.`);
};</pre></div><div class='content'><ol>
<li>Deploy this function to Cloud Functions.</li>
<li>Set up a trigger, such as a Cloud Storage event.</li>
</ol>
</div><h1>Cloud Composer</h1>
<div class='content'><p>Cloud Composer is a managed workflow orchestration service built on Apache Airflow. It allows you to create, schedule, and monitor complex workflows.</p>
</div><h2>Example: Creating a Workflow with Cloud Composer</h2>
<div class='content'><ol>
<li>Create a new environment in Cloud Composer.</li>
<li>Define a DAG (Directed Acyclic Graph) in Python:</li>
</ol>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ZnJvbSBhaXJmbG93IGltcG9ydCBEQUcKZnJvbSBhaXJmbG93LnByb3ZpZGVycy5nb29nbGUuY2xvdWQub3BlcmF0b3JzLmJpZ3F1ZXJ5IGltcG9ydCBCaWdRdWVyeUV4ZWN1dGVRdWVyeU9wZXJhdG9yCmZyb20gZGF0ZXRpbWUgaW1wb3J0IGRhdGV0aW1lCgpkZWZhdWx0X2FyZ3MgPSB7CiAgICAnc3RhcnRfZGF0ZSc6IGRhdGV0aW1lKDIwMjMsIDEsIDEpLAp9Cgp3aXRoIERBRygnYmlncXVlcnlfd29ya2Zsb3cnLCBkZWZhdWx0X2FyZ3M9ZGVmYXVsdF9hcmdzLCBzY2hlZHVsZV9pbnRlcnZhbD0nQGRhaWx5JykgYXMgZGFnOgogICAgZXhlY3V0ZV9xdWVyeSA9IEJpZ1F1ZXJ5RXhlY3V0ZVF1ZXJ5T3BlcmF0b3IoCiAgICAgICAgdGFza19pZD0nZXhlY3V0ZV9xdWVyeScsCiAgICAgICAgc3FsPSdTRUxFQ1QgKiBGUk9NIGBwcm9qZWN0LmRhdGFzZXQudGFibGVgIExJTUlUIDEwJywKICAgICAgICB1c2VfbGVnYWN5X3NxbD1GYWxzZSwKICAgICk="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>from airflow import DAG
from airflow.providers.google.cloud.operators.bigquery import BigQueryExecuteQueryOperator
from datetime import datetime

default_args = {
    'start_date': datetime(2023, 1, 1),
}

with DAG('bigquery_workflow', default_args=default_args, schedule_interval='@daily') as dag:
    execute_query = BigQueryExecuteQueryOperator(
        task_id='execute_query',
        sql='SELECT * FROM `project.dataset.table` LIMIT 10',
        use_legacy_sql=False,
    )</pre></div><div class='content'><ol start="3">
<li>Deploy the DAG to your Cloud Composer environment.</li>
</ol>
</div><h1>APIs and Client Libraries</h1>
<div class='content'><p>BigQuery provides APIs and client libraries for various programming languages, allowing you to automate tasks programmatically.</p>
</div><h2>Example: Using Python Client Library</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ZnJvbSBnb29nbGUuY2xvdWQgaW1wb3J0IGJpZ3F1ZXJ5CgpjbGllbnQgPSBiaWdxdWVyeS5DbGllbnQoKQoKcXVlcnkgPSAiIiIKU0VMRUNUIAogIG5hbWUsIAogIFNVTShudW1iZXIpIGFzIHRvdGFsCkZST00gCiAgYGJpZ3F1ZXJ5LXB1YmxpYy1kYXRhLnVzYV9uYW1lcy51c2FfMTkxMF8yMDEzYApHUk9VUCBCWSAKICBuYW1lCk9SREVSIEJZIAogIHRvdGFsIERFU0MKTElNSVQgCiAgMTAKIiIiCgpxdWVyeV9qb2IgPSBjbGllbnQucXVlcnkocXVlcnkpCgpmb3Igcm93IGluIHF1ZXJ5X2pvYjoKICAgIHByaW50KGYie3Jvdy5uYW1lfToge3Jvdy50b3RhbH0iKQ=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>from google.cloud import bigquery

client = bigquery.Client()

query = &quot;&quot;&quot;
SELECT 
  name, 
  SUM(number) as total
FROM 
  `bigquery-public-data.usa_names.usa_1910_2013`
GROUP BY 
  name
ORDER BY 
  total DESC
LIMIT 
  10
&quot;&quot;&quot;

query_job = client.query(query)

for row in query_job:
    print(f&quot;{row.name}: {row.total}&quot;)</pre></div><div class='content'><ol>
<li>Install the BigQuery client library: <code>pip install google-cloud-bigquery</code>.</li>
<li>Run the script to execute the query and process the results.</li>
</ol>
</div><h1>Conclusion</h1>
<div class='content'><p>Automating workflows with BigQuery can streamline data processing and analysis, making it easier to handle large datasets and complex operations. By leveraging scheduled queries, the BigQuery Data Transfer Service, Cloud Functions, Cloud Composer, and APIs, you can create efficient and reliable data workflows. Start by identifying repetitive tasks in your data pipeline and explore how these tools can help automate them.</p>
</div><div class='row navigation'>
	<div class='col-4'>
					<a href='using-bigquery-with-data-studio'>&#x25C4;Using BigQuery with Data Studio</a>
			</div>
	<div class='col-4 text-center'>
		<a href="./" class="title">Automating Workflows with BigQuery</a>
	</div>
	<div class='col-4 text-end'>
					<a href='scheduling-queries'>Scheduling Queries &#x25BA;</a>
			</div>
</div>
</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Advertising</h1>
			<p>This space is reserved for advertising.</p>
			<p>If you want to be a sponsor, contact us to include links in this area: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Thank you for collaborating!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. All rights reserved</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir galetes per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Accept</a>
    <a href="/cookies">More Information</a>
</div>	

	</div>    
</body>
</html>
