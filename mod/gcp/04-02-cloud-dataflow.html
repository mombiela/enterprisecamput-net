<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cloud Dataflow</title>

    <link rel="alternate" href="https://campusempresa.com/mod/gcp/04-02-cloud-dataflow" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/mod/gcp/04-02-cloud-dataflow" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/mod/gcp/04-02-cloud-dataflow" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="/js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body >
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-12 col-md-8 p-2 p-md-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo-header_enterprise.png"></a>
			</h1>
		</div>
		<div class="col-12 col-md-4 p-2 p-md-0 text-end">
			<h2 id="main_title"><cite>Building today's and tomorrow's society</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-2 p-md-0 m-0 text-end">
													<b id="lit_lang_es" class="px-2">EN</b>
				|
				<a href="https://campusempresa.com/mod/gcp/04-02-cloud-dataflow" class="px-2">ES</a></b>
				|
				<a href="https://campusempresa.cat/mod/gcp/04-02-cloud-dataflow" class="px-2">CA</a>
					</div>
	</div>
</div>

<div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<!-- <a href="/">Home</a>  -->
									<a href="./">Course Content</a>
					<span class="sep">|</span>
								<a href="/all/competencias">Technical Skills</a>
				<a href="/all/conocimientos">Knowledge</a>
				<a href="/all/soft_skills">Social Skills</a>
			</div>
		</div>
	</div>
</div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content">
								<div class='row navigation'>
	<div class='col-1 col-md-2'>
					<a href='04-01-bigquery' title="BigQuery">
				<span class="d-none d-md-inline">&#x25C4; Previous</span>
				<span class="d-inline d-md-none"><i class="bi bi-caret-left-square-fill"></i></span>
			</a>
			</div>
	<div class='col-10 col-md-8 text-center'>
					<a href="./"><h2 style="text-decoration:underline">Cloud Dataflow</h2></a>
			</div>
	<div class='col-1 col-md-2 text-end'>
					<a href='04-03-cloud-dataproc' title="Cloud Dataproc">
				<span class="d-none d-md-inline">Next &#x25BA;</span>
				<span class="d-inline d-md-none"><i class="bi bi-caret-right-square-fill"></i></span>
			</a>
			</div>
</div>
<div class='content'></div><h1><p>Introduction to Cloud Dataflow</p>
</h1>
<div class='content'><p>Google Cloud Dataflow is a fully managed service for stream and batch data processing. It allows you to develop and execute a wide range of data processing patterns, including ETL, batch computation, and continuous computation. Dataflow is built on the Apache Beam SDK, which provides a unified programming model for both batch and stream processing.</p>
</div><h2><p>Key Concepts</p>
</h2>
<div class='content'><ol>
<li><strong>Apache Beam</strong>: An open-source, unified model for defining both batch and streaming data-parallel processing pipelines.</li>
<li><strong>Pipelines</strong>: A series of steps that define the data processing workflow.</li>
<li><strong>Transforms</strong>: Operations that process data within a pipeline.</li>
<li><strong>PCollections</strong>: Immutable collections of data that are processed in a pipeline.</li>
<li><strong>Runners</strong>: Execution engines that run the pipeline. Dataflow is one such runner.</li>
</ol>
</div><h1><p>Setting Up Cloud Dataflow</p>
</h1>
<div class='content'></div><h2><p>Prerequisites</p>
</h2>
<div class='content'><ul>
<li>A Google Cloud Platform account.</li>
<li>A project with billing enabled.</li>
<li>Basic knowledge of Python or Java (the languages supported by Apache Beam).</li>
</ul>
</div><h2><p>Steps to Set Up</p>
</h2>
<div class='content'><ol>
<li>
<p><strong>Enable the Dataflow API</strong>:</p>
<ul>
<li>Go to the GCP Console.</li>
<li>Navigate to the API &amp; Services dashboard.</li>
<li>Enable the Dataflow API.</li>
</ul>
</li>
<li>
<p><strong>Install Apache Beam SDK</strong>:</p>
<ul>
<li>For Python:
<pre><code class="language-bash">pip install apache-beam[gcp]
</code></pre>
</li>
<li>For Java:
Add the following dependency to your <code>pom.xml</code>:
<pre><code class="language-xml">&lt;dependency&gt;
  &lt;groupId&gt;org.apache.beam&lt;/groupId&gt;
  &lt;artifactId&gt;beam-sdks-java-core&lt;/artifactId&gt;
  &lt;version&gt;2.34.0&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>
</li>
</ul>
</li>
</ol>
</div><h1><p>Creating a Simple Dataflow Pipeline</p>
</h1>
<div class='content'></div><h2><p>Example: Word Count Pipeline</p>
</h2>
<div class='content'><h4>Python Example</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("aW1wb3J0IGFwYWNoZV9iZWFtIGFzIGJlYW0KZnJvbSBhcGFjaGVfYmVhbS5vcHRpb25zLnBpcGVsaW5lX29wdGlvbnMgaW1wb3J0IFBpcGVsaW5lT3B0aW9ucwoKIyBEZWZpbmUgdGhlIHBpcGVsaW5lIG9wdGlvbnMKb3B0aW9ucyA9IFBpcGVsaW5lT3B0aW9ucygpCgojIENyZWF0ZSB0aGUgcGlwZWxpbmUKd2l0aCBiZWFtLlBpcGVsaW5lKG9wdGlvbnM9b3B0aW9ucykgYXMgcDoKICAgICMgUmVhZCB0aGUgaW5wdXQgdGV4dCBmaWxlCiAgICBsaW5lcyA9IHAgfCAnUmVhZCcgPj4gYmVhbS5pby5SZWFkRnJvbVRleHQoJ2dzOi8veW91ci1idWNrZXQvaW5wdXQudHh0JykKICAgIAogICAgIyBTcGxpdCBlYWNoIGxpbmUgaW50byB3b3JkcwogICAgd29yZHMgPSBsaW5lcyB8ICdTcGxpdCcgPj4gYmVhbS5GbGF0TWFwKGxhbWJkYSB4OiB4LnNwbGl0KCkpCiAgICAKICAgICMgQ291bnQgdGhlIG9jY3VycmVuY2VzIG9mIGVhY2ggd29yZAogICAgd29yZF9jb3VudHMgPSAoCiAgICAgICAgd29yZHMKICAgICAgICB8ICdQYWlyV2l0aE9uZScgPj4gYmVhbS5NYXAobGFtYmRhIHg6ICh4LCAxKSkKICAgICAgICB8ICdHcm91cEFuZFN1bScgPj4gYmVhbS5Db21iaW5lUGVyS2V5KHN1bSkKICAgICkKICAgIAogICAgIyBXcml0ZSB0aGUgb3V0cHV0IHRvIGEgdGV4dCBmaWxlCiAgICB3b3JkX2NvdW50cyB8ICdXcml0ZScgPj4gYmVhbS5pby5Xcml0ZVRvVGV4dCgnZ3M6Ly95b3VyLWJ1Y2tldC9vdXRwdXQnKQ=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>import apache_beam as beam
from apache_beam.options.pipeline_options import PipelineOptions

# Define the pipeline options
options = PipelineOptions()

# Create the pipeline
with beam.Pipeline(options=options) as p:
    # Read the input text file
    lines = p | 'Read' &gt;&gt; beam.io.ReadFromText('gs://your-bucket/input.txt')
    
    # Split each line into words
    words = lines | 'Split' &gt;&gt; beam.FlatMap(lambda x: x.split())
    
    # Count the occurrences of each word
    word_counts = (
        words
        | 'PairWithOne' &gt;&gt; beam.Map(lambda x: (x, 1))
        | 'GroupAndSum' &gt;&gt; beam.CombinePerKey(sum)
    )
    
    # Write the output to a text file
    word_counts | 'Write' &gt;&gt; beam.io.WriteToText('gs://your-bucket/output')</pre></div><div class='content'><h4>Java Example</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("aW1wb3J0IG9yZy5hcGFjaGUuYmVhbS5zZGsuUGlwZWxpbmU7CmltcG9ydCBvcmcuYXBhY2hlLmJlYW0uc2RrLmlvLlRleHRJTzsKaW1wb3J0IG9yZy5hcGFjaGUuYmVhbS5zZGsudHJhbnNmb3Jtcy5Db3VudDsKaW1wb3J0IG9yZy5hcGFjaGUuYmVhbS5zZGsudHJhbnNmb3Jtcy5GbGF0TWFwRWxlbWVudHM7CmltcG9ydCBvcmcuYXBhY2hlLmJlYW0uc2RrLnRyYW5zZm9ybXMuTWFwRWxlbWVudHM7CmltcG9ydCBvcmcuYXBhY2hlLmJlYW0uc2RrLnZhbHVlcy5UeXBlRGVzY3JpcHRvcnM7CgpwdWJsaWMgY2xhc3MgV29yZENvdW50IHsKICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBtYWluKFN0cmluZ1tdIGFyZ3MpIHsKICAgICAgICBQaXBlbGluZSBwID0gUGlwZWxpbmUuY3JlYXRlKCk7CgogICAgICAgIHAuYXBwbHkoIlJlYWRMaW5lcyIsIFRleHRJTy5yZWFkKCkuZnJvbSgiZ3M6Ly95b3VyLWJ1Y2tldC9pbnB1dC50eHQiKSkKICAgICAgICAgLmFwcGx5KCJTcGxpdFdvcmRzIiwgRmxhdE1hcEVsZW1lbnRzLmludG8oVHlwZURlc2NyaXB0b3JzLnN0cmluZ3MoKSkKICAgICAgICAgICAgIC52aWEoKFN0cmluZyBsaW5lKSAtPiBBcnJheXMuYXNMaXN0KGxpbmUuc3BsaXQoIlxcVysiKSkpKQogICAgICAgICAuYXBwbHkoQ291bnQucGVyRWxlbWVudCgpKQogICAgICAgICAuYXBwbHkoTWFwRWxlbWVudHMuaW50byhUeXBlRGVzY3JpcHRvcnMuc3RyaW5ncygpKQogICAgICAgICAgICAgLnZpYSgod29yZENvdW50KSAtPiB3b3JkQ291bnQuZ2V0S2V5KCkgKyAiOiAiICsgd29yZENvdW50LmdldFZhbHVlKCkpKQogICAgICAgICAuYXBwbHkoIldyaXRlQ291bnRzIiwgVGV4dElPLndyaXRlKCkudG8oImdzOi8veW91ci1idWNrZXQvb3V0cHV0IikpOwoKICAgICAgICBwLnJ1bigpLndhaXRVbnRpbEZpbmlzaCgpOwogICAgfQp9"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>import org.apache.beam.sdk.Pipeline;
import org.apache.beam.sdk.io.TextIO;
import org.apache.beam.sdk.transforms.Count;
import org.apache.beam.sdk.transforms.FlatMapElements;
import org.apache.beam.sdk.transforms.MapElements;
import org.apache.beam.sdk.values.TypeDescriptors;

public class WordCount {
    public static void main(String[] args) {
        Pipeline p = Pipeline.create();

        p.apply(&quot;ReadLines&quot;, TextIO.read().from(&quot;gs://your-bucket/input.txt&quot;))
         .apply(&quot;SplitWords&quot;, FlatMapElements.into(TypeDescriptors.strings())
             .via((String line) -&gt; Arrays.asList(line.split(&quot;\\W+&quot;))))
         .apply(Count.perElement())
         .apply(MapElements.into(TypeDescriptors.strings())
             .via((wordCount) -&gt; wordCount.getKey() + &quot;: &quot; + wordCount.getValue()))
         .apply(&quot;WriteCounts&quot;, TextIO.write().to(&quot;gs://your-bucket/output&quot;));

        p.run().waitUntilFinish();
    }
}</pre></div><div class='content'></div><h2><p>Explanation</p>
</h2>
<div class='content'><ul>
<li><strong>ReadFromText / TextIO.read()</strong>: Reads input data from a text file in Google Cloud Storage.</li>
<li><strong>FlatMap / FlatMapElements</strong>: Splits each line into words.</li>
<li><strong>Map / MapElements</strong>: Maps each word to a key-value pair (word, 1).</li>
<li><strong>CombinePerKey / Count.perElement()</strong>: Aggregates the counts for each word.</li>
<li><strong>WriteToText / TextIO.write()</strong>: Writes the output to a text file in Google Cloud Storage.</li>
</ul>
</div><h1><p>Practical Exercises</p>
</h1>
<div class='content'></div><h2><p>Exercise 1: Word Count with Filtering</p>
</h2>
<div class='content'><p><strong>Task</strong>: Modify the word count pipeline to filter out common stop words (e.g., &quot;the&quot;, &quot;and&quot;, &quot;is&quot;).</p>
<p><strong>Solution</strong>:</p>
<h4>Python</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("c3RvcF93b3JkcyA9IHsndGhlJywgJ2FuZCcsICdpcyd9Cgp3aXRoIGJlYW0uUGlwZWxpbmUob3B0aW9ucz1vcHRpb25zKSBhcyBwOgogICAgbGluZXMgPSBwIHwgJ1JlYWQnID4+IGJlYW0uaW8uUmVhZEZyb21UZXh0KCdnczovL3lvdXItYnVja2V0L2lucHV0LnR4dCcpCiAgICB3b3JkcyA9IGxpbmVzIHwgJ1NwbGl0JyA+PiBiZWFtLkZsYXRNYXAobGFtYmRhIHg6IHguc3BsaXQoKSkKICAgIGZpbHRlcmVkX3dvcmRzID0gd29yZHMgfCAnRmlsdGVyU3RvcFdvcmRzJyA+PiBiZWFtLkZpbHRlcihsYW1iZGEgeDogeC5sb3dlcigpIG5vdCBpbiBzdG9wX3dvcmRzKQogICAgd29yZF9jb3VudHMgPSAoCiAgICAgICAgZmlsdGVyZWRfd29yZHMKICAgICAgICB8ICdQYWlyV2l0aE9uZScgPj4gYmVhbS5NYXAobGFtYmRhIHg6ICh4LCAxKSkKICAgICAgICB8ICdHcm91cEFuZFN1bScgPj4gYmVhbS5Db21iaW5lUGVyS2V5KHN1bSkKICAgICkKICAgIHdvcmRfY291bnRzIHwgJ1dyaXRlJyA+PiBiZWFtLmlvLldyaXRlVG9UZXh0KCdnczovL3lvdXItYnVja2V0L291dHB1dCcp"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>stop_words = {'the', 'and', 'is'}

with beam.Pipeline(options=options) as p:
    lines = p | 'Read' &gt;&gt; beam.io.ReadFromText('gs://your-bucket/input.txt')
    words = lines | 'Split' &gt;&gt; beam.FlatMap(lambda x: x.split())
    filtered_words = words | 'FilterStopWords' &gt;&gt; beam.Filter(lambda x: x.lower() not in stop_words)
    word_counts = (
        filtered_words
        | 'PairWithOne' &gt;&gt; beam.Map(lambda x: (x, 1))
        | 'GroupAndSum' &gt;&gt; beam.CombinePerKey(sum)
    )
    word_counts | 'Write' &gt;&gt; beam.io.WriteToText('gs://your-bucket/output')</pre></div><div class='content'><h4>Java</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("U2V0PFN0cmluZz4gc3RvcFdvcmRzID0gbmV3IEhhc2hTZXQ8PihBcnJheXMuYXNMaXN0KCJ0aGUiLCAiYW5kIiwgImlzIikpOwoKcC5hcHBseSgiUmVhZExpbmVzIiwgVGV4dElPLnJlYWQoKS5mcm9tKCJnczovL3lvdXItYnVja2V0L2lucHV0LnR4dCIpKQogLmFwcGx5KCJTcGxpdFdvcmRzIiwgRmxhdE1hcEVsZW1lbnRzLmludG8oVHlwZURlc2NyaXB0b3JzLnN0cmluZ3MoKSkKICAgICAudmlhKChTdHJpbmcgbGluZSkgLT4gQXJyYXlzLmFzTGlzdChsaW5lLnNwbGl0KCJcXFcrIikpKSkKIC5hcHBseSgiRmlsdGVyU3RvcFdvcmRzIiwgRmlsdGVyLmJ5KChTdHJpbmcgd29yZCkgLT4gIXN0b3BXb3Jkcy5jb250YWlucyh3b3JkLnRvTG93ZXJDYXNlKCkpKSkKIC5hcHBseShDb3VudC5wZXJFbGVtZW50KCkpCiAuYXBwbHkoTWFwRWxlbWVudHMuaW50byhUeXBlRGVzY3JpcHRvcnMuc3RyaW5ncygpKQogICAgIC52aWEoKHdvcmRDb3VudCkgLT4gd29yZENvdW50LmdldEtleSgpICsgIjogIiArIHdvcmRDb3VudC5nZXRWYWx1ZSgpKSkKIC5hcHBseSgiV3JpdGVDb3VudHMiLCBUZXh0SU8ud3JpdGUoKS50bygiZ3M6Ly95b3VyLWJ1Y2tldC9vdXRwdXQiKSk7CgpwLnJ1bigpLndhaXRVbnRpbEZpbmlzaCgpOw=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>Set&lt;String&gt; stopWords = new HashSet&lt;&gt;(Arrays.asList(&quot;the&quot;, &quot;and&quot;, &quot;is&quot;));

p.apply(&quot;ReadLines&quot;, TextIO.read().from(&quot;gs://your-bucket/input.txt&quot;))
 .apply(&quot;SplitWords&quot;, FlatMapElements.into(TypeDescriptors.strings())
     .via((String line) -&gt; Arrays.asList(line.split(&quot;\\W+&quot;))))
 .apply(&quot;FilterStopWords&quot;, Filter.by((String word) -&gt; !stopWords.contains(word.toLowerCase())))
 .apply(Count.perElement())
 .apply(MapElements.into(TypeDescriptors.strings())
     .via((wordCount) -&gt; wordCount.getKey() + &quot;: &quot; + wordCount.getValue()))
 .apply(&quot;WriteCounts&quot;, TextIO.write().to(&quot;gs://your-bucket/output&quot;));

p.run().waitUntilFinish();</pre></div><div class='content'></div><h2><p>Common Mistakes and Tips</p>
</h2>
<div class='content'><ul>
<li><strong>Common Mistake</strong>: Not enabling the Dataflow API.
<ul>
<li><strong>Tip</strong>: Ensure the Dataflow API is enabled in your GCP project.</li>
</ul>
</li>
<li><strong>Common Mistake</strong>: Incorrect file paths.
<ul>
<li><strong>Tip</strong>: Use the correct Google Cloud Storage paths (e.g., <code>gs://your-bucket/input.txt</code>).</li>
</ul>
</li>
<li><strong>Common Mistake</strong>: Not handling dependencies properly.
<ul>
<li><strong>Tip</strong>: Ensure all necessary dependencies are installed and included in your project.</li>
</ul>
</li>
</ul>
</div><h1><p>Conclusion</p>
</h1>
<div class='content'><p>In this section, you learned about Google Cloud Dataflow, its key concepts, and how to set up and create a simple data processing pipeline using Apache Beam. You also practiced modifying a pipeline to filter out common stop words. This knowledge prepares you for more advanced data processing tasks and integrating Dataflow into larger data workflows.</p>
<p>Next, you will explore other data and analytics services in GCP, such as Cloud Dataproc and Cloud Pub/Sub, to further enhance your data processing capabilities.</p>
</div><div class='row navigation'>
	<div class='col-1 col-md-2'>
					<a href='04-01-bigquery' title="BigQuery">
				<span class="d-none d-md-inline">&#x25C4; Previous</span>
				<span class="d-inline d-md-none"><i class="bi bi-caret-left-square-fill"></i></span>
			</a>
			</div>
	<div class='col-10 col-md-8 text-center'>
			</div>
	<div class='col-1 col-md-2 text-end'>
					<a href='04-03-cloud-dataproc' title="Cloud Dataproc">
				<span class="d-none d-md-inline">Next &#x25BA;</span>
				<span class="d-inline d-md-none"><i class="bi bi-caret-right-square-fill"></i></span>
			</a>
			</div>
</div>

			</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Advertising</h1>
			<p>This space is reserved for advertising.</p>
			<p>If you want to be a sponsor, contact us to include links in this area: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Thank you for collaborating!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. All rights reserved</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	We use cookies to improve your user experience and offer content tailored to your interests.
    <a href="#" id="btn_accept_cookies" class="button">Accept</a>
    <a href="/cookies">More Information</a>
</div>	

	</div>    
</body>
</html>
