<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Case Study: Social Network API</title>

    <link rel="alternate" href="https://campusempresa.com/mod/rest_api/06-02-caso-estudio-api-red-social" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/mod/rest_api/06-02-caso-estudio-api-red-social" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/mod/rest_api/06-02-case-study-social-network-api" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body >
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-8 p-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo-header_enterprise.png"></a>
			</h1>
		</div>
		<div class="col-4 p-0 text-end">
			<h2 id="main_title"><cite>Building today's and tomorrow's society</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-0 m-0 text-end">
													<b id="lit_lang_es" class="px-2">EN</b>
				|
				<a href="https://campusempresa.com/mod/rest_api/06-02-case-study-social-network-api" class="px-2">ES</a></b>
				|
				<a href="https://campusempresa.cat/mod/rest_api/06-02-case-study-social-network-api" class="px-2">CA</a>
					</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="/objective">The Project</a>
				<a href="/about">About Us</a>
				<a href="/contribute">Contribute</a>
				<a href="/donate">Donations</a>
				<a href="/licence">License</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content">
								<div class='row navigation'>
	<div class='col-2'>
					<a href='06-01-case-study-online-store-api' title="Case Study: Online Store API">&#x25C4;Previous</a>
			</div>
	<div class='col-8 text-center'>
					<a href="./"><h2 style="text-decoration:underline">Case Study: Social Network API</h2></a>
			</div>
	<div class='col-2 text-end'>
					<a href='06-03-final-project-design-develop-restful-api' title="Final Project: Design and Develop Your Own RESTful API">Next &#x25BA;</a>
			</div>
</div>
<div class='content'><p>In this case study, we will design and develop a RESTful API for a social network. This API will allow users to perform various actions such as creating profiles, posting updates, following other users, and liking posts. We will cover the following key aspects:</p>
<ol>
<li><strong>Defining Resources and Endpoints</strong></li>
<li><strong>Designing the Database Schema</strong></li>
<li><strong>Implementing the API Endpoints</strong></li>
<li><strong>Handling Authentication and Authorization</strong></li>
<li><strong>Testing the API</strong></li>
</ol>
</div><h1>1. Defining Resources and Endpoints</h1>
<div class='content'></div><h2>Resources</h2>
<div class='content'><p>The main resources for our social network API are:</p>
<ul>
<li><strong>Users</strong>: Represents the users of the social network.</li>
<li><strong>Posts</strong>: Represents the posts created by users.</li>
<li><strong>Followers</strong>: Represents the relationship between users (who follows whom).</li>
<li><strong>Likes</strong>: Represents the likes on posts.</li>
</ul>
</div><h2>Endpoints</h2>
<div class='content'><p>Here are the endpoints we will implement:</p>
<table>
<thead>
<tr>
<th>Resource</th>
<th>Endpoint</th>
<th>HTTP Method</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Users</td>
<td>/users</td>
<td>GET</td>
<td>Retrieve a list of users</td>
</tr>
<tr>
<td>Users</td>
<td>/users</td>
<td>POST</td>
<td>Create a new user</td>
</tr>
<tr>
<td>Users</td>
<td>/users/{id}</td>
<td>GET</td>
<td>Retrieve a specific user</td>
</tr>
<tr>
<td>Users</td>
<td>/users/{id}</td>
<td>PUT</td>
<td>Update a specific user</td>
</tr>
<tr>
<td>Users</td>
<td>/users/{id}</td>
<td>DELETE</td>
<td>Delete a specific user</td>
</tr>
<tr>
<td>Posts</td>
<td>/posts</td>
<td>GET</td>
<td>Retrieve a list of posts</td>
</tr>
<tr>
<td>Posts</td>
<td>/posts</td>
<td>POST</td>
<td>Create a new post</td>
</tr>
<tr>
<td>Posts</td>
<td>/posts/{id}</td>
<td>GET</td>
<td>Retrieve a specific post</td>
</tr>
<tr>
<td>Posts</td>
<td>/posts/{id}</td>
<td>PUT</td>
<td>Update a specific post</td>
</tr>
<tr>
<td>Posts</td>
<td>/posts/{id}</td>
<td>DELETE</td>
<td>Delete a specific post</td>
</tr>
<tr>
<td>Followers</td>
<td>/users/{id}/followers</td>
<td>GET</td>
<td>Retrieve a list of followers for a user</td>
</tr>
<tr>
<td>Followers</td>
<td>/users/{id}/follow</td>
<td>POST</td>
<td>Follow a user</td>
</tr>
<tr>
<td>Followers</td>
<td>/users/{id}/unfollow</td>
<td>POST</td>
<td>Unfollow a user</td>
</tr>
<tr>
<td>Likes</td>
<td>/posts/{id}/likes</td>
<td>GET</td>
<td>Retrieve a list of likes for a post</td>
</tr>
<tr>
<td>Likes</td>
<td>/posts/{id}/like</td>
<td>POST</td>
<td>Like a post</td>
</tr>
<tr>
<td>Likes</td>
<td>/posts/{id}/unlike</td>
<td>POST</td>
<td>Unlike a post</td>
</tr>
</tbody>
</table>
</div><h1>2. Designing the Database Schema</h1>
<div class='content'><p>We will use a relational database for this case study. Below is the schema for our database:</p>
</div><h2>Users Table</h2>
<div class='content'><table>
<thead>
<tr>
<th>Column</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>INT</td>
<td>Primary key</td>
</tr>
<tr>
<td>username</td>
<td>VARCHAR</td>
<td>Unique username</td>
</tr>
<tr>
<td>email</td>
<td>VARCHAR</td>
<td>Unique email address</td>
</tr>
<tr>
<td>password</td>
<td>VARCHAR</td>
<td>Hashed password</td>
</tr>
<tr>
<td>created_at</td>
<td>DATETIME</td>
<td>Timestamp of creation</td>
</tr>
</tbody>
</table>
</div><h2>Posts Table</h2>
<div class='content'><table>
<thead>
<tr>
<th>Column</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>INT</td>
<td>Primary key</td>
</tr>
<tr>
<td>user_id</td>
<td>INT</td>
<td>Foreign key to Users</td>
</tr>
<tr>
<td>content</td>
<td>TEXT</td>
<td>Content of the post</td>
</tr>
<tr>
<td>created_at</td>
<td>DATETIME</td>
<td>Timestamp of creation</td>
</tr>
</tbody>
</table>
</div><h2>Followers Table</h2>
<div class='content'><table>
<thead>
<tr>
<th>Column</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>INT</td>
<td>Primary key</td>
</tr>
<tr>
<td>user_id</td>
<td>INT</td>
<td>Foreign key to Users</td>
</tr>
<tr>
<td>follower_id</td>
<td>INT</td>
<td>Foreign key to Users</td>
</tr>
</tbody>
</table>
</div><h2>Likes Table</h2>
<div class='content'><table>
<thead>
<tr>
<th>Column</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>INT</td>
<td>Primary key</td>
</tr>
<tr>
<td>post_id</td>
<td>INT</td>
<td>Foreign key to Posts</td>
</tr>
<tr>
<td>user_id</td>
<td>INT</td>
<td>Foreign key to Users</td>
</tr>
</tbody>
</table>
</div><h1>3. Implementing the API Endpoints</h1>
<div class='content'></div><h2>Setting Up the Development Environment</h2>
<div class='content'><p>We will use Node.js and Express for our API. First, set up a new Node.js project and install the necessary dependencies:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("bWtkaXIgc29jaWFsLW5ldHdvcmstYXBpCmNkIHNvY2lhbC1uZXR3b3JrLWFwaQpucG0gaW5pdCAteQpucG0gaW5zdGFsbCBleHByZXNzIGJvZHktcGFyc2VyIG1vbmdvb3Nl"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>mkdir social-network-api
cd social-network-api
npm init -y
npm install express body-parser mongoose</pre></div><div class='content'></div><h2>Creating a Basic Server</h2>
<div class='content'><p>Create a file named <code>server.js</code> and set up a basic Express server:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y29uc3QgZXhwcmVzcyA9IHJlcXVpcmUoJ2V4cHJlc3MnKTsKY29uc3QgYm9keVBhcnNlciA9IHJlcXVpcmUoJ2JvZHktcGFyc2VyJyk7CmNvbnN0IG1vbmdvb3NlID0gcmVxdWlyZSgnbW9uZ29vc2UnKTsKCmNvbnN0IGFwcCA9IGV4cHJlc3MoKTsKYXBwLnVzZShib2R5UGFyc2VyLmpzb24oKSk7Cgptb25nb29zZS5jb25uZWN0KCdtb25nb2RiOi8vbG9jYWxob3N0OjI3MDE3L3NvY2lhbG5ldHdvcmsnLCB7IHVzZU5ld1VybFBhcnNlcjogdHJ1ZSwgdXNlVW5pZmllZFRvcG9sb2d5OiB0cnVlIH0pOwoKYXBwLmxpc3RlbigzMDAwLCAoKSA9PiB7CiAgICBjb25zb2xlLmxvZygnU2VydmVyIGlzIHJ1bm5pbmcgb24gcG9ydCAzMDAwJyk7Cn0pOw=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>const express = require('express');
const bodyParser = require('body-parser');
const mongoose = require('mongoose');

const app = express();
app.use(bodyParser.json());

mongoose.connect('mongodb://localhost:27017/socialnetwork', { useNewUrlParser: true, useUnifiedTopology: true });

app.listen(3000, () =&gt; {
    console.log('Server is running on port 3000');
});</pre></div><div class='content'></div><h2>Defining Models</h2>
<div class='content'><p>Create a directory named <code>models</code> and define the models for Users, Posts, Followers, and Likes.</p>
<h4>User Model (<code>models/User.js</code>)</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y29uc3QgbW9uZ29vc2UgPSByZXF1aXJlKCdtb25nb29zZScpOwoKY29uc3QgdXNlclNjaGVtYSA9IG5ldyBtb25nb29zZS5TY2hlbWEoewogICAgdXNlcm5hbWU6IHsgdHlwZTogU3RyaW5nLCByZXF1aXJlZDogdHJ1ZSwgdW5pcXVlOiB0cnVlIH0sCiAgICBlbWFpbDogeyB0eXBlOiBTdHJpbmcsIHJlcXVpcmVkOiB0cnVlLCB1bmlxdWU6IHRydWUgfSwKICAgIHBhc3N3b3JkOiB7IHR5cGU6IFN0cmluZywgcmVxdWlyZWQ6IHRydWUgfSwKICAgIGNyZWF0ZWRfYXQ6IHsgdHlwZTogRGF0ZSwgZGVmYXVsdDogRGF0ZS5ub3cgfQp9KTsKCm1vZHVsZS5leHBvcnRzID0gbW9uZ29vc2UubW9kZWwoJ1VzZXInLCB1c2VyU2NoZW1hKTs="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>const mongoose = require('mongoose');

const userSchema = new mongoose.Schema({
    username: { type: String, required: true, unique: true },
    email: { type: String, required: true, unique: true },
    password: { type: String, required: true },
    created_at: { type: Date, default: Date.now }
});

module.exports = mongoose.model('User', userSchema);</pre></div><div class='content'><h4>Post Model (<code>models/Post.js</code>)</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y29uc3QgbW9uZ29vc2UgPSByZXF1aXJlKCdtb25nb29zZScpOwoKY29uc3QgcG9zdFNjaGVtYSA9IG5ldyBtb25nb29zZS5TY2hlbWEoewogICAgdXNlcl9pZDogeyB0eXBlOiBtb25nb29zZS5TY2hlbWEuVHlwZXMuT2JqZWN0SWQsIHJlZjogJ1VzZXInLCByZXF1aXJlZDogdHJ1ZSB9LAogICAgY29udGVudDogeyB0eXBlOiBTdHJpbmcsIHJlcXVpcmVkOiB0cnVlIH0sCiAgICBjcmVhdGVkX2F0OiB7IHR5cGU6IERhdGUsIGRlZmF1bHQ6IERhdGUubm93IH0KfSk7Cgptb2R1bGUuZXhwb3J0cyA9IG1vbmdvb3NlLm1vZGVsKCdQb3N0JywgcG9zdFNjaGVtYSk7"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>const mongoose = require('mongoose');

const postSchema = new mongoose.Schema({
    user_id: { type: mongoose.Schema.Types.ObjectId, ref: 'User', required: true },
    content: { type: String, required: true },
    created_at: { type: Date, default: Date.now }
});

module.exports = mongoose.model('Post', postSchema);</pre></div><div class='content'><h4>Follower Model (<code>models/Follower.js</code>)</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y29uc3QgbW9uZ29vc2UgPSByZXF1aXJlKCdtb25nb29zZScpOwoKY29uc3QgZm9sbG93ZXJTY2hlbWEgPSBuZXcgbW9uZ29vc2UuU2NoZW1hKHsKICAgIHVzZXJfaWQ6IHsgdHlwZTogbW9uZ29vc2UuU2NoZW1hLlR5cGVzLk9iamVjdElkLCByZWY6ICdVc2VyJywgcmVxdWlyZWQ6IHRydWUgfSwKICAgIGZvbGxvd2VyX2lkOiB7IHR5cGU6IG1vbmdvb3NlLlNjaGVtYS5UeXBlcy5PYmplY3RJZCwgcmVmOiAnVXNlcicsIHJlcXVpcmVkOiB0cnVlIH0KfSk7Cgptb2R1bGUuZXhwb3J0cyA9IG1vbmdvb3NlLm1vZGVsKCdGb2xsb3dlcicsIGZvbGxvd2VyU2NoZW1hKTs="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>const mongoose = require('mongoose');

const followerSchema = new mongoose.Schema({
    user_id: { type: mongoose.Schema.Types.ObjectId, ref: 'User', required: true },
    follower_id: { type: mongoose.Schema.Types.ObjectId, ref: 'User', required: true }
});

module.exports = mongoose.model('Follower', followerSchema);</pre></div><div class='content'><h4>Like Model (<code>models/Like.js</code>)</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y29uc3QgbW9uZ29vc2UgPSByZXF1aXJlKCdtb25nb29zZScpOwoKY29uc3QgbGlrZVNjaGVtYSA9IG5ldyBtb25nb29zZS5TY2hlbWEoewogICAgcG9zdF9pZDogeyB0eXBlOiBtb25nb29zZS5TY2hlbWEuVHlwZXMuT2JqZWN0SWQsIHJlZjogJ1Bvc3QnLCByZXF1aXJlZDogdHJ1ZSB9LAogICAgdXNlcl9pZDogeyB0eXBlOiBtb25nb29zZS5TY2hlbWEuVHlwZXMuT2JqZWN0SWQsIHJlZjogJ1VzZXInLCByZXF1aXJlZDogdHJ1ZSB9Cn0pOwoKbW9kdWxlLmV4cG9ydHMgPSBtb25nb29zZS5tb2RlbCgnTGlrZScsIGxpa2VTY2hlbWEpOw=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>const mongoose = require('mongoose');

const likeSchema = new mongoose.Schema({
    post_id: { type: mongoose.Schema.Types.ObjectId, ref: 'Post', required: true },
    user_id: { type: mongoose.Schema.Types.ObjectId, ref: 'User', required: true }
});

module.exports = mongoose.model('Like', likeSchema);</pre></div><div class='content'></div><h2>Implementing Endpoints</h2>
<div class='content'><h4>User Endpoints</h4>
<p>Create a directory named <code>routes</code> and define the routes for users in <code>routes/users.js</code>:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y29uc3QgZXhwcmVzcyA9IHJlcXVpcmUoJ2V4cHJlc3MnKTsKY29uc3Qgcm91dGVyID0gZXhwcmVzcy5Sb3V0ZXIoKTsKY29uc3QgVXNlciA9IHJlcXVpcmUoJy4uL21vZGVscy9Vc2VyJyk7CgovLyBHZXQgYWxsIHVzZXJzCnJvdXRlci5nZXQoJy8nLCBhc3luYyAocmVxLCByZXMpID0+IHsKICAgIHRyeSB7CiAgICAgICAgY29uc3QgdXNlcnMgPSBhd2FpdCBVc2VyLmZpbmQoKTsKICAgICAgICByZXMuanNvbih1c2Vycyk7CiAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7IG1lc3NhZ2U6IGVyci5tZXNzYWdlIH0pOwogICAgfQp9KTsKCi8vIENyZWF0ZSBhIG5ldyB1c2VyCnJvdXRlci5wb3N0KCcvJywgYXN5bmMgKHJlcSwgcmVzKSA9PiB7CiAgICBjb25zdCB1c2VyID0gbmV3IFVzZXIoewogICAgICAgIHVzZXJuYW1lOiByZXEuYm9keS51c2VybmFtZSwKICAgICAgICBlbWFpbDogcmVxLmJvZHkuZW1haWwsCiAgICAgICAgcGFzc3dvcmQ6IHJlcS5ib2R5LnBhc3N3b3JkCiAgICB9KTsKCiAgICB0cnkgewogICAgICAgIGNvbnN0IG5ld1VzZXIgPSBhd2FpdCB1c2VyLnNhdmUoKTsKICAgICAgICByZXMuc3RhdHVzKDIwMSkuanNvbihuZXdVc2VyKTsKICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgIHJlcy5zdGF0dXMoNDAwKS5qc29uKHsgbWVzc2FnZTogZXJyLm1lc3NhZ2UgfSk7CiAgICB9Cn0pOwoKLy8gR2V0IGEgc3BlY2lmaWMgdXNlcgpyb3V0ZXIuZ2V0KCcvOmlkJywgZ2V0VXNlciwgKHJlcSwgcmVzKSA9PiB7CiAgICByZXMuanNvbihyZXMudXNlcik7Cn0pOwoKLy8gVXBkYXRlIGEgc3BlY2lmaWMgdXNlcgpyb3V0ZXIucHV0KCcvOmlkJywgZ2V0VXNlciwgYXN5bmMgKHJlcSwgcmVzKSA9PiB7CiAgICBpZiAocmVxLmJvZHkudXNlcm5hbWUgIT0gbnVsbCkgewogICAgICAgIHJlcy51c2VyLnVzZXJuYW1lID0gcmVxLmJvZHkudXNlcm5hbWU7CiAgICB9CiAgICBpZiAocmVxLmJvZHkuZW1haWwgIT0gbnVsbCkgewogICAgICAgIHJlcy51c2VyLmVtYWlsID0gcmVxLmJvZHkuZW1haWw7CiAgICB9CiAgICBpZiAocmVxLmJvZHkucGFzc3dvcmQgIT0gbnVsbCkgewogICAgICAgIHJlcy51c2VyLnBhc3N3b3JkID0gcmVxLmJvZHkucGFzc3dvcmQ7CiAgICB9CgogICAgdHJ5IHsKICAgICAgICBjb25zdCB1cGRhdGVkVXNlciA9IGF3YWl0IHJlcy51c2VyLnNhdmUoKTsKICAgICAgICByZXMuanNvbih1cGRhdGVkVXNlcik7CiAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICByZXMuc3RhdHVzKDQwMCkuanNvbih7IG1lc3NhZ2U6IGVyci5tZXNzYWdlIH0pOwogICAgfQp9KTsKCi8vIERlbGV0ZSBhIHNwZWNpZmljIHVzZXIKcm91dGVyLmRlbGV0ZSgnLzppZCcsIGdldFVzZXIsIGFzeW5jIChyZXEsIHJlcykgPT4gewogICAgdHJ5IHsKICAgICAgICBhd2FpdCByZXMudXNlci5yZW1vdmUoKTsKICAgICAgICByZXMuanNvbih7IG1lc3NhZ2U6ICdEZWxldGVkIFVzZXInIH0pOwogICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oeyBtZXNzYWdlOiBlcnIubWVzc2FnZSB9KTsKICAgIH0KfSk7CgovLyBNaWRkbGV3YXJlIHRvIGdldCB1c2VyIGJ5IElECmFzeW5jIGZ1bmN0aW9uIGdldFVzZXIocmVxLCByZXMsIG5leHQpIHsKICAgIGxldCB1c2VyOwogICAgdHJ5IHsKICAgICAgICB1c2VyID0gYXdhaXQgVXNlci5maW5kQnlJZChyZXEucGFyYW1zLmlkKTsKICAgICAgICBpZiAodXNlciA9PSBudWxsKSB7CiAgICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7IG1lc3NhZ2U6ICdDYW5ub3QgZmluZCB1c2VyJyB9KTsKICAgICAgICB9CiAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg1MDApLmpzb24oeyBtZXNzYWdlOiBlcnIubWVzc2FnZSB9KTsKICAgIH0KCiAgICByZXMudXNlciA9IHVzZXI7CiAgICBuZXh0KCk7Cn0KCm1vZHVsZS5leHBvcnRzID0gcm91dGVyOw=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>const express = require('express');
const router = express.Router();
const User = require('../models/User');

// Get all users
router.get('/', async (req, res) =&gt; {
    try {
        const users = await User.find();
        res.json(users);
    } catch (err) {
        res.status(500).json({ message: err.message });
    }
});

// Create a new user
router.post('/', async (req, res) =&gt; {
    const user = new User({
        username: req.body.username,
        email: req.body.email,
        password: req.body.password
    });

    try {
        const newUser = await user.save();
        res.status(201).json(newUser);
    } catch (err) {
        res.status(400).json({ message: err.message });
    }
});

// Get a specific user
router.get('/:id', getUser, (req, res) =&gt; {
    res.json(res.user);
});

// Update a specific user
router.put('/:id', getUser, async (req, res) =&gt; {
    if (req.body.username != null) {
        res.user.username = req.body.username;
    }
    if (req.body.email != null) {
        res.user.email = req.body.email;
    }
    if (req.body.password != null) {
        res.user.password = req.body.password;
    }

    try {
        const updatedUser = await res.user.save();
        res.json(updatedUser);
    } catch (err) {
        res.status(400).json({ message: err.message });
    }
});

// Delete a specific user
router.delete('/:id', getUser, async (req, res) =&gt; {
    try {
        await res.user.remove();
        res.json({ message: 'Deleted User' });
    } catch (err) {
        res.status(500).json({ message: err.message });
    }
});

// Middleware to get user by ID
async function getUser(req, res, next) {
    let user;
    try {
        user = await User.findById(req.params.id);
        if (user == null) {
            return res.status(404).json({ message: 'Cannot find user' });
        }
    } catch (err) {
        return res.status(500).json({ message: err.message });
    }

    res.user = user;
    next();
}

module.exports = router;</pre></div><div class='content'><h4>Integrating Routes</h4>
<p>In <code>server.js</code>, integrate the user routes:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y29uc3QgdXNlclJvdXRlciA9IHJlcXVpcmUoJy4vcm91dGVzL3VzZXJzJyk7CmFwcC51c2UoJy91c2VycycsIHVzZXJSb3V0ZXIpOw=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>const userRouter = require('./routes/users');
app.use('/users', userRouter);</pre></div><div class='content'><p>Repeat similar steps for implementing the routes for Posts, Followers, and Likes.</p>
</div><h1>4. Handling Authentication and Authorization</h1>
<div class='content'><p>For authentication, we will use JSON Web Tokens (JWT). Install the necessary packages:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("bnBtIGluc3RhbGwganNvbndlYnRva2VuIGJjcnlwdGpz"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>npm install jsonwebtoken bcryptjs</pre></div><div class='content'></div><h2>User Registration and Login</h2>
<div class='content'><p>Update the user routes to include registration and login:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y29uc3QgYmNyeXB0ID0gcmVxdWlyZSgnYmNyeXB0anMnKTsKY29uc3Qgand0ID0gcmVxdWlyZSgnanNvbndlYnRva2VuJyk7CgovLyBSZWdpc3RlciBhIG5ldyB1c2VyCnJvdXRlci5wb3N0KCcvcmVnaXN0ZXInLCBhc3luYyAocmVxLCByZXMpID0+IHsKICAgIGNvbnN0IGhhc2hlZFBhc3N3b3JkID0gYXdhaXQgYmNyeXB0Lmhhc2gocmVxLmJvZHkucGFzc3dvcmQsIDEwKTsKICAgIGNvbnN0IHVzZXIgPSBuZXcgVXNlcih7CiAgICAgICAgdXNlcm5hbWU6IHJlcS5ib2R5LnVzZXJuYW1lLAogICAgICAgIGVtYWlsOiByZXEuYm9keS5lbWFpbCwKICAgICAgICBwYXNzd29yZDogaGFzaGVkUGFzc3dvcmQKICAgIH0pOwoKICAgIHRyeSB7CiAgICAgICAgY29uc3QgbmV3VXNlciA9IGF3YWl0IHVzZXIuc2F2ZSgpOwogICAgICAgIHJlcy5zdGF0dXMoMjAxKS5qc29uKG5ld1VzZXIpOwogICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgcmVzLnN0YXR1cyg0MDApLmpzb24oeyBtZXNzYWdlOiBlcnIubWVzc2FnZSB9KTsKICAgIH0KfSk7CgovLyBMb2dpbiBhIHVzZXIKcm91dGVyLnBvc3QoJy9sb2dpbicsIGFzeW5jIChyZXEsIHJlcykgPT4gewogICAgY29uc3QgdXNlciA9IGF3YWl0IFVzZXIuZmluZE9uZSh7IGVtYWlsOiByZXEuYm9keS5lbWFpbCB9KTsKICAgIGlmICh1c2VyID09IG51bGwpIHsKICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBtZXNzYWdlOiAnQ2Fubm90IGZpbmQgdXNlcicgfSk7CiAgICB9CgogICAgdHJ5IHsKICAgICAgICBpZiAoYXdhaXQgYmNyeXB0LmNvbXBhcmUocmVxLmJvZHkucGFzc3dvcmQsIHVzZXIucGFzc3dvcmQpKSB7CiAgICAgICAgICAgIGNvbnN0IHRva2VuID0gand0LnNpZ24oeyBpZDogdXNlci5faWQgfSwgJ1NFQ1JFVF9LRVknKTsKICAgICAgICAgICAgcmVzLmpzb24oeyB0b2tlbiB9KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXMuc3RhdHVzKDQwMCkuanNvbih7IG1lc3NhZ2U6ICdJbnZhbGlkIGNyZWRlbnRpYWxzJyB9KTsKICAgICAgICB9CiAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7IG1lc3NhZ2U6IGVyci5tZXNzYWdlIH0pOwogICAgfQp9KTs="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>const bcrypt = require('bcryptjs');
const jwt = require('jsonwebtoken');

// Register a new user
router.post('/register', async (req, res) =&gt; {
    const hashedPassword = await bcrypt.hash(req.body.password, 10);
    const user = new User({
        username: req.body.username,
        email: req.body.email,
        password: hashedPassword
    });

    try {
        const newUser = await user.save();
        res.status(201).json(newUser);
    } catch (err) {
        res.status(400).json({ message: err.message });
    }
});

// Login a user
router.post('/login', async (req, res) =&gt; {
    const user = await User.findOne({ email: req.body.email });
    if (user == null) {
        return res.status(400).json({ message: 'Cannot find user' });
    }

    try {
        if (await bcrypt.compare(req.body.password, user.password)) {
            const token = jwt.sign({ id: user._id }, 'SECRET_KEY');
            res.json({ token });
        } else {
            res.status(400).json({ message: 'Invalid credentials' });
        }
    } catch (err) {
        res.status(500).json({ message: err.message });
    }
});</pre></div><div class='content'></div><h2>Protecting Routes</h2>
<div class='content'><p>Create a middleware to protect routes:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ZnVuY3Rpb24gYXV0aGVudGljYXRlVG9rZW4ocmVxLCByZXMsIG5leHQpIHsKICAgIGNvbnN0IHRva2VuID0gcmVxLmhlYWRlcignQXV0aG9yaXphdGlvbicpOwogICAgaWYgKCF0b2tlbikgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5qc29uKHsgbWVzc2FnZTogJ0FjY2VzcyBEZW5pZWQnIH0pOwoKICAgIHRyeSB7CiAgICAgICAgY29uc3QgdmVyaWZpZWQgPSBqd3QudmVyaWZ5KHRva2VuLCAnU0VDUkVUX0tFWScpOwogICAgICAgIHJlcS51c2VyID0gdmVyaWZpZWQ7CiAgICAgICAgbmV4dCgpOwogICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgcmVzLnN0YXR1cyg0MDApLmpzb24oeyBtZXNzYWdlOiAnSW52YWxpZCBUb2tlbicgfSk7CiAgICB9Cn0="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>function authenticateToken(req, res, next) {
    const token = req.header('Authorization');
    if (!token) return res.status(401).json({ message: 'Access Denied' });

    try {
        const verified = jwt.verify(token, 'SECRET_KEY');
        req.user = verified;
        next();
    } catch (err) {
        res.status(400).json({ message: 'Invalid Token' });
    }
}</pre></div><div class='content'><p>Use this middleware to protect routes that require authentication.</p>
</div><h1>5. Testing the API</h1>
<div class='content'><p>Use Postman to test the API endpoints. Create a collection and add requests for each endpoint. Ensure that you test both successful and error scenarios.</p>
</div><h1>Conclusion</h1>
<div class='content'><p>In this case study, we designed and developed a RESTful API for a social network. We covered defining resources and endpoints, designing the database schema, implementing the API endpoints, handling authentication and authorization, and testing the API. This comprehensive example provides a solid foundation for building more complex APIs in the future.</p>
</div><div class='row navigation'>
	<div class='col-2'>
					<a href='06-01-case-study-online-store-api' title="Case Study: Online Store API">&#x25C4;Previous</a>
			</div>
	<div class='col-8 text-center'>
			</div>
	<div class='col-2 text-end'>
					<a href='06-03-final-project-design-develop-restful-api' title="Final Project: Design and Develop Your Own RESTful API">Next &#x25BA;</a>
			</div>
</div>

			</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Advertising</h1>
			<p>This space is reserved for advertising.</p>
			<p>If you want to be a sponsor, contact us to include links in this area: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Thank you for collaborating!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. All rights reserved</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir galetes per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Accept</a>
    <a href="/cookies">More Information</a>
</div>	

	</div>    
</body>
</html>
