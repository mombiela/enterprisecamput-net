<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow, noarchive">
    <title>Authentication and Authorization</title>

    <link rel="alternate" href="https://campusempresa.com/mod/rest_api/03-04-autenticacion-autorizacion" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/mod/rest_api/03-04-autenticacion-autorizacion" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/mod/rest_api/03-04-authentication-authorization" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css?v=4" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="/js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
	<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-0611338592562725" crossorigin="anonymous"></script>  	
	</head>

<body >
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-12 col-md-6 p-2 p-md-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo-header_enterprise.png"></a>
			</h1>
		</div>
		<div class="col-12 col-md-6 p-2 p-md-0 text-end">
			<span>	<b id="lit_lang_es" class="px-2">EN</b>
	|
	<a href="https://campusempresa.com/mod/rest_api/03-04-autenticacion-autorizacion" class="px-2">ES</a></b>
	|
	<a href="https://campusempresa.cat/mod/rest_api/03-04-autenticacion-autorizacion" class="px-2">CA</a>
</span>
			<span class="d-none d-md-inline"><br><cite>All the knowledge within your reach</cite></span>
		</div>
	</div>
</div>
<div class="subheader container-xxl d-none d-md-block">
	<div class="row">
		<div class="col-12 p-2 p-md-0 m-0 text-end">
			<a href="/objective">The Project</a> | 
<a href="/about">About Us</a> | 
<a href="/contribute">Contribute</a> | 
<a href="/donate">Donations</a> | 
<a href="/licence">License</a>
		</div>
	</div>
</div>

<div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
					 				<a href="/"><i class="bi bi-house-fill"></i> HOME</a>
											</div>
		</div>
	</div>
</div>
		
<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content">
				<div class='row navigation'>
	<div class='col-1 col-md-2'>
					<a href='03-03-handling-requests-responses' title="Handling Requests and Responses">
				<span class="d-none d-md-inline">&#x25C4; Previous</span>
				<span class="d-inline d-md-none"><i class="bi bi-caret-left-square-fill"></i></span>
			</a>
			</div>
	<div class='col-10 col-md-8 text-center'>
					<a href="./"><h2 style="text-decoration:underline">Authentication and Authorization</h2></a>
			</div>
	<div class='col-1 col-md-2 text-end'>
					<a href='03-05-error-handling' title="Error Handling">
				<span class="d-none d-md-inline">Next &#x25BA;</span>
				<span class="d-inline d-md-none"><i class="bi bi-caret-right-square-fill"></i></span>
			</a>
			</div>
</div>
<div class='content'><p>Authentication and authorization are critical components of any RESTful API. They ensure that only authenticated users can access the API and that users have the appropriate permissions to perform specific actions. This section will cover the fundamental concepts, methods, and best practices for implementing authentication and authorization in RESTful APIs.</p>
</div><h1>Key Concepts</h1>
<div class='content'></div><h2>Authentication</h2>
<div class='content'><p>Authentication is the process of verifying the identity of a user or an application. It ensures that the entity making the request is who it claims to be.</p>
</div><h2>Authorization</h2>
<div class='content'><p>Authorization is the process of determining whether an authenticated user has the necessary permissions to perform a specific action or access a particular resource.</p>
</div><h1>Common Authentication Methods</h1>
<div class='content'></div><h2><ol>
<li>Basic Authentication</li>
</ol></h2>
<div class='content'><p>Basic Authentication involves sending the username and password encoded in Base64 with each request.</p>
<p><strong>Example:</strong></p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("R0VUIC9yZXNvdXJjZSBIVFRQLzEuMQpIb3N0OiBhcGkuZXhhbXBsZS5jb20KQXV0aG9yaXphdGlvbjogQmFzaWMgZFhObGNtNWhiV1U2Y0dGemMzZHZjbVE9"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>GET /resource HTTP/1.1
Host: api.example.com
Authorization: Basic dXNlcm5hbWU6cGFzc3dvcmQ=</pre></div><div class='content'><p><strong>Explanation:</strong></p>
<ul>
<li>The <code>Authorization</code> header contains the word <code>Basic</code> followed by a space and a Base64-encoded string of <code>username:password</code>.</li>
</ul>
<p><strong>Pros:</strong></p>
<ul>
<li>Simple to implement.</li>
</ul>
<p><strong>Cons:</strong></p>
<ul>
<li>Not secure unless used over HTTPS.</li>
<li>Credentials are sent with every request.</li>
</ul>
</div><h2><ol start="2">
<li>Token-Based Authentication</li>
</ol></h2>
<div class='content'><p>Token-Based Authentication involves issuing a token to the user upon successful login, which is then used for subsequent requests.</p>
<p><strong>Example:</strong></p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("UE9TVCAvbG9naW4gSFRUUC8xLjEKSG9zdDogYXBpLmV4YW1wbGUuY29tCkNvbnRlbnQtVHlwZTogYXBwbGljYXRpb24vanNvbgoKewogICJ1c2VybmFtZSI6ICJ1c2VyIiwKICAicGFzc3dvcmQiOiAicGFzcyIKfQ=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>POST /login HTTP/1.1
Host: api.example.com
Content-Type: application/json

{
  &quot;username&quot;: &quot;user&quot;,
  &quot;password&quot;: &quot;pass&quot;
}</pre></div><div class='content'><p><strong>Response:</strong></p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ewogICJ0b2tlbiI6ICJleUpoYkdjaU9pSklVekkxTmlJc0luUjVjQ0k2SWtwWFZDSjkuLi4iCn0="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>{
  &quot;token&quot;: &quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...&quot;
}</pre></div><div class='content'><p><strong>Subsequent Request:</strong></p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("R0VUIC9yZXNvdXJjZSBIVFRQLzEuMQpIb3N0OiBhcGkuZXhhbXBsZS5jb20KQXV0aG9yaXphdGlvbjogQmVhcmVyIGV5SmhiR2NpT2lKSVV6STFOaUlzSW5SNWNDSTZJa3BYVkNKOS4uLg=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>GET /resource HTTP/1.1
Host: api.example.com
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...</pre></div><div class='content'><p><strong>Explanation:</strong></p>
<ul>
<li>The user sends their credentials to the <code>/login</code> endpoint.</li>
<li>The server responds with a token.</li>
<li>The token is included in the <code>Authorization</code> header for subsequent requests.</li>
</ul>
<p><strong>Pros:</strong></p>
<ul>
<li>More secure than Basic Authentication.</li>
<li>Tokens can have an expiration time.</li>
</ul>
<p><strong>Cons:</strong></p>
<ul>
<li>Requires additional server-side logic to handle tokens.</li>
</ul>
</div><h2><ol start="3">
<li>OAuth 2.0</li>
</ol></h2>
<div class='content'><p>OAuth 2.0 is an authorization framework that allows third-party applications to obtain limited access to a user's resources without exposing their credentials.</p>
<p><strong>Example:</strong></p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("R0VUIC9hdXRob3JpemU/cmVzcG9uc2VfdHlwZT1jb2RlJmNsaWVudF9pZD1DTElFTlRfSUQmcmVkaXJlY3RfdXJpPVJFRElSRUNUX1VSSSZzY29wZT1TQ09QRSZzdGF0ZT1TVEFURQ=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>GET /authorize?response_type=code&amp;client_id=CLIENT_ID&amp;redirect_uri=REDIRECT_URI&amp;scope=SCOPE&amp;state=STATE</pre></div><div class='content'><p><strong>Explanation:</strong></p>
<ul>
<li>The client application redirects the user to the authorization server.</li>
<li>The user grants permission and is redirected back to the client with an authorization code.</li>
<li>The client exchanges the authorization code for an access token.</li>
</ul>
<p><strong>Pros:</strong></p>
<ul>
<li>Highly secure.</li>
<li>Supports various grant types for different use cases.</li>
</ul>
<p><strong>Cons:</strong></p>
<ul>
<li>More complex to implement.</li>
</ul>
</div><h1>Implementing Authentication and Authorization</h1>
<div class='content'></div><h2>Step-by-Step Guide</h2>
<div class='content'><ol>
<li>
<p><strong>Set Up User Authentication:</strong></p>
<ul>
<li>Create a user model and store user credentials securely (e.g., hashed passwords).</li>
<li>Implement a login endpoint to authenticate users and issue tokens.</li>
</ul>
</li>
<li>
<p><strong>Protect Endpoints:</strong></p>
<ul>
<li>Use middleware to check for the presence of a valid token in the <code>Authorization</code> header.</li>
<li>Decode and verify the token to authenticate the user.</li>
</ul>
</li>
<li>
<p><strong>Implement Role-Based Access Control (RBAC):</strong></p>
<ul>
<li>Define roles and permissions for different user types.</li>
<li>Check the user's role and permissions before allowing access to specific endpoints.</li>
</ul>
</li>
</ol>
</div><h2>Example Code: Token-Based Authentication with JWT</h2>
<div class='content'><p><strong>Setting Up the Environment:</strong></p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("bnBtIGluc3RhbGwgZXhwcmVzcyBqc29ud2VidG9rZW4gYmNyeXB0anM="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>npm install express jsonwebtoken bcryptjs</pre></div><div class='content'><p><strong>Server Code:</strong></p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y29uc3QgZXhwcmVzcyA9IHJlcXVpcmUoJ2V4cHJlc3MnKTsKY29uc3Qgand0ID0gcmVxdWlyZSgnanNvbndlYnRva2VuJyk7CmNvbnN0IGJjcnlwdCA9IHJlcXVpcmUoJ2JjcnlwdGpzJyk7Cgpjb25zdCBhcHAgPSBleHByZXNzKCk7CmFwcC51c2UoZXhwcmVzcy5qc29uKCkpOwoKY29uc3QgdXNlcnMgPSBbXTsgLy8gSW4tbWVtb3J5IHVzZXIgc3RvcmFnZSBmb3Igc2ltcGxpY2l0eQoKLy8gU2VjcmV0IGtleSBmb3IgSldUCmNvbnN0IFNFQ1JFVF9LRVkgPSAneW91cl9zZWNyZXRfa2V5JzsKCi8vIFJlZ2lzdGVyIGVuZHBvaW50CmFwcC5wb3N0KCcvcmVnaXN0ZXInLCBhc3luYyAocmVxLCByZXMpID0+IHsKICBjb25zdCB7IHVzZXJuYW1lLCBwYXNzd29yZCB9ID0gcmVxLmJvZHk7CiAgY29uc3QgaGFzaGVkUGFzc3dvcmQgPSBhd2FpdCBiY3J5cHQuaGFzaChwYXNzd29yZCwgMTApOwogIHVzZXJzLnB1c2goeyB1c2VybmFtZSwgcGFzc3dvcmQ6IGhhc2hlZFBhc3N3b3JkIH0pOwogIHJlcy5zdGF0dXMoMjAxKS5zZW5kKCdVc2VyIHJlZ2lzdGVyZWQnKTsKfSk7CgovLyBMb2dpbiBlbmRwb2ludAphcHAucG9zdCgnL2xvZ2luJywgYXN5bmMgKHJlcSwgcmVzKSA9PiB7CiAgY29uc3QgeyB1c2VybmFtZSwgcGFzc3dvcmQgfSA9IHJlcS5ib2R5OwogIGNvbnN0IHVzZXIgPSB1c2Vycy5maW5kKHUgPT4gdS51c2VybmFtZSA9PT0gdXNlcm5hbWUpOwogIGlmICh1c2VyICYmIGF3YWl0IGJjcnlwdC5jb21wYXJlKHBhc3N3b3JkLCB1c2VyLnBhc3N3b3JkKSkgewogICAgY29uc3QgdG9rZW4gPSBqd3Quc2lnbih7IHVzZXJuYW1lIH0sIFNFQ1JFVF9LRVksIHsgZXhwaXJlc0luOiAnMWgnIH0pOwogICAgcmVzLmpzb24oeyB0b2tlbiB9KTsKICB9IGVsc2UgewogICAgcmVzLnN0YXR1cyg0MDEpLnNlbmQoJ0ludmFsaWQgY3JlZGVudGlhbHMnKTsKICB9Cn0pOwoKLy8gTWlkZGxld2FyZSB0byBwcm90ZWN0IHJvdXRlcwpjb25zdCBhdXRoZW50aWNhdGVUb2tlbiA9IChyZXEsIHJlcywgbmV4dCkgPT4gewogIGNvbnN0IGF1dGhIZWFkZXIgPSByZXEuaGVhZGVyc1snYXV0aG9yaXphdGlvbiddOwogIGNvbnN0IHRva2VuID0gYXV0aEhlYWRlciAmJiBhdXRoSGVhZGVyLnNwbGl0KCcgJylbMV07CiAgaWYgKCF0b2tlbikgcmV0dXJuIHJlcy5zZW5kU3RhdHVzKDQwMSk7CgogIGp3dC52ZXJpZnkodG9rZW4sIFNFQ1JFVF9LRVksIChlcnIsIHVzZXIpID0+IHsKICAgIGlmIChlcnIpIHJldHVybiByZXMuc2VuZFN0YXR1cyg0MDMpOwogICAgcmVxLnVzZXIgPSB1c2VyOwogICAgbmV4dCgpOwogIH0pOwp9OwoKLy8gUHJvdGVjdGVkIHJvdXRlCmFwcC5nZXQoJy9wcm90ZWN0ZWQnLCBhdXRoZW50aWNhdGVUb2tlbiwgKHJlcSwgcmVzKSA9PiB7CiAgcmVzLnNlbmQoJ1RoaXMgaXMgYSBwcm90ZWN0ZWQgcm91dGUnKTsKfSk7CgphcHAubGlzdGVuKDMwMDAsICgpID0+IHsKICBjb25zb2xlLmxvZygnU2VydmVyIHJ1bm5pbmcgb24gcG9ydCAzMDAwJyk7Cn0pOw=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>const express = require('express');
const jwt = require('jsonwebtoken');
const bcrypt = require('bcryptjs');

const app = express();
app.use(express.json());

const users = []; // In-memory user storage for simplicity

// Secret key for JWT
const SECRET_KEY = 'your_secret_key';

// Register endpoint
app.post('/register', async (req, res) =&gt; {
  const { username, password } = req.body;
  const hashedPassword = await bcrypt.hash(password, 10);
  users.push({ username, password: hashedPassword });
  res.status(201).send('User registered');
});

// Login endpoint
app.post('/login', async (req, res) =&gt; {
  const { username, password } = req.body;
  const user = users.find(u =&gt; u.username === username);
  if (user &amp;&amp; await bcrypt.compare(password, user.password)) {
    const token = jwt.sign({ username }, SECRET_KEY, { expiresIn: '1h' });
    res.json({ token });
  } else {
    res.status(401).send('Invalid credentials');
  }
});

// Middleware to protect routes
const authenticateToken = (req, res, next) =&gt; {
  const authHeader = req.headers['authorization'];
  const token = authHeader &amp;&amp; authHeader.split(' ')[1];
  if (!token) return res.sendStatus(401);

  jwt.verify(token, SECRET_KEY, (err, user) =&gt; {
    if (err) return res.sendStatus(403);
    req.user = user;
    next();
  });
};

// Protected route
app.get('/protected', authenticateToken, (req, res) =&gt; {
  res.send('This is a protected route');
});

app.listen(3000, () =&gt; {
  console.log('Server running on port 3000');
});</pre></div><div class='content'><p><strong>Explanation:</strong></p>
<ul>
<li>Users register with a username and password, which are hashed and stored.</li>
<li>Users log in with their credentials, and a JWT token is issued upon successful authentication.</li>
<li>The <code>authenticateToken</code> middleware checks for the presence of a valid token and verifies it before allowing access to protected routes.</li>
</ul>
</div><h1>Practical Exercises</h1>
<div class='content'></div><h2>Exercise 1: Implement Basic Authentication</h2>
<div class='content'><ol>
<li>Create an endpoint that requires Basic Authentication.</li>
<li>Verify the credentials and respond with a success message if they are correct.</li>
</ol>
<p><strong>Solution:</strong></p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y29uc3QgZXhwcmVzcyA9IHJlcXVpcmUoJ2V4cHJlc3MnKTsKY29uc3QgYXBwID0gZXhwcmVzcygpOwoKY29uc3QgdXNlcnMgPSBbeyB1c2VybmFtZTogJ3VzZXInLCBwYXNzd29yZDogJ3Bhc3MnIH1dOwoKY29uc3QgYmFzaWNBdXRoID0gKHJlcSwgcmVzLCBuZXh0KSA9PiB7CiAgY29uc3QgYXV0aEhlYWRlciA9IHJlcS5oZWFkZXJzWydhdXRob3JpemF0aW9uJ107CiAgaWYgKCFhdXRoSGVhZGVyKSByZXR1cm4gcmVzLnNlbmRTdGF0dXMoNDAxKTsKCiAgY29uc3QgYmFzZTY0Q3JlZGVudGlhbHMgPSBhdXRoSGVhZGVyLnNwbGl0KCcgJylbMV07CiAgY29uc3QgY3JlZGVudGlhbHMgPSBCdWZmZXIuZnJvbShiYXNlNjRDcmVkZW50aWFscywgJ2Jhc2U2NCcpLnRvU3RyaW5nKCdhc2NpaScpOwogIGNvbnN0IFt1c2VybmFtZSwgcGFzc3dvcmRdID0gY3JlZGVudGlhbHMuc3BsaXQoJzonKTsKCiAgY29uc3QgdXNlciA9IHVzZXJzLmZpbmQodSA9PiB1LnVzZXJuYW1lID09PSB1c2VybmFtZSAmJiB1LnBhc3N3b3JkID09PSBwYXNzd29yZCk7CiAgaWYgKCF1c2VyKSByZXR1cm4gcmVzLnNlbmRTdGF0dXMoNDAxKTsKCiAgbmV4dCgpOwp9OwoKYXBwLmdldCgnL2Jhc2ljLXByb3RlY3RlZCcsIGJhc2ljQXV0aCwgKHJlcSwgcmVzKSA9PiB7CiAgcmVzLnNlbmQoJ1RoaXMgaXMgYSBwcm90ZWN0ZWQgcm91dGUgd2l0aCBCYXNpYyBBdXRoZW50aWNhdGlvbicpOwp9KTsKCmFwcC5saXN0ZW4oMzAwMCwgKCkgPT4gewogIGNvbnNvbGUubG9nKCdTZXJ2ZXIgcnVubmluZyBvbiBwb3J0IDMwMDAnKTsKfSk7"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>const express = require('express');
const app = express();

const users = [{ username: 'user', password: 'pass' }];

const basicAuth = (req, res, next) =&gt; {
  const authHeader = req.headers['authorization'];
  if (!authHeader) return res.sendStatus(401);

  const base64Credentials = authHeader.split(' ')[1];
  const credentials = Buffer.from(base64Credentials, 'base64').toString('ascii');
  const [username, password] = credentials.split(':');

  const user = users.find(u =&gt; u.username === username &amp;&amp; u.password === password);
  if (!user) return res.sendStatus(401);

  next();
};

app.get('/basic-protected', basicAuth, (req, res) =&gt; {
  res.send('This is a protected route with Basic Authentication');
});

app.listen(3000, () =&gt; {
  console.log('Server running on port 3000');
});</pre></div><div class='content'></div><h2>Exercise 2: Implement Role-Based Access Control</h2>
<div class='content'><ol>
<li>Extend the token-based authentication example to include user roles.</li>
<li>Create an endpoint that only allows access to users with a specific role.</li>
</ol>
<p><strong>Solution:</strong></p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y29uc3QgZXhwcmVzcyA9IHJlcXVpcmUoJ2V4cHJlc3MnKTsKY29uc3Qgand0ID0gcmVxdWlyZSgnanNvbndlYnRva2VuJyk7CmNvbnN0IGJjcnlwdCA9IHJlcXVpcmUoJ2JjcnlwdGpzJyk7Cgpjb25zdCBhcHAgPSBleHByZXNzKCk7CmFwcC51c2UoZXhwcmVzcy5qc29uKCkpOwoKY29uc3QgdXNlcnMgPSBbXTsgLy8gSW4tbWVtb3J5IHVzZXIgc3RvcmFnZSBmb3Igc2ltcGxpY2l0eQoKY29uc3QgU0VDUkVUX0tFWSA9ICd5b3VyX3NlY3JldF9rZXknOwoKLy8gUmVnaXN0ZXIgZW5kcG9pbnQKYXBwLnBvc3QoJy9yZWdpc3RlcicsIGFzeW5jIChyZXEsIHJlcykgPT4gewogIGNvbnN0IHsgdXNlcm5hbWUsIHBhc3N3b3JkLCByb2xlIH0gPSByZXEuYm9keTsKICBjb25zdCBoYXNoZWRQYXNzd29yZCA9IGF3YWl0IGJjcnlwdC5oYXNoKHBhc3N3b3JkLCAxMCk7CiAgdXNlcnMucHVzaCh7IHVzZXJuYW1lLCBwYXNzd29yZDogaGFzaGVkUGFzc3dvcmQsIHJvbGUgfSk7CiAgcmVzLnN0YXR1cygyMDEpLnNlbmQoJ1VzZXIgcmVnaXN0ZXJlZCcpOwp9KTsKCi8vIExvZ2luIGVuZHBvaW50CmFwcC5wb3N0KCcvbG9naW4nLCBhc3luYyAocmVxLCByZXMpID0+IHsKICBjb25zdCB7IHVzZXJuYW1lLCBwYXNzd29yZCB9ID0gcmVxLmJvZHk7CiAgY29uc3QgdXNlciA9IHVzZXJzLmZpbmQodSA9PiB1LnVzZXJuYW1lID09PSB1c2VybmFtZSk7CiAgaWYgKHVzZXIgJiYgYXdhaXQgYmNyeXB0LmNvbXBhcmUocGFzc3dvcmQsIHVzZXIucGFzc3dvcmQpKSB7CiAgICBjb25zdCB0b2tlbiA9IGp3dC5zaWduKHsgdXNlcm5hbWUsIHJvbGU6IHVzZXIucm9sZSB9LCBTRUNSRVRfS0VZLCB7IGV4cGlyZXNJbjogJzFoJyB9KTsKICAgIHJlcy5qc29uKHsgdG9rZW4gfSk7CiAgfSBlbHNlIHsKICAgIHJlcy5zdGF0dXMoNDAxKS5zZW5kKCdJbnZhbGlkIGNyZWRlbnRpYWxzJyk7CiAgfQp9KTsKCi8vIE1pZGRsZXdhcmUgdG8gcHJvdGVjdCByb3V0ZXMKY29uc3QgYXV0aGVudGljYXRlVG9rZW4gPSAocmVxLCByZXMsIG5leHQpID0+IHsKICBjb25zdCBhdXRoSGVhZGVyID0gcmVxLmhlYWRlcnNbJ2F1dGhvcml6YXRpb24nXTsKICBjb25zdCB0b2tlbiA9IGF1dGhIZWFkZXIgJiYgYXV0aEhlYWRlci5zcGxpdCgnICcpWzFdOwogIGlmICghdG9rZW4pIHJldHVybiByZXMuc2VuZFN0YXR1cyg0MDEpOwoKICBqd3QudmVyaWZ5KHRva2VuLCBTRUNSRVRfS0VZLCAoZXJyLCB1c2VyKSA9PiB7CiAgICBpZiAoZXJyKSByZXR1cm4gcmVzLnNlbmRTdGF0dXMoNDAzKTsKICAgIHJlcS51c2VyID0gdXNlcjsKICAgIG5leHQoKTsKICB9KTsKfTsKCi8vIE1pZGRsZXdhcmUgdG8gY2hlY2sgcm9sZXMKY29uc3QgYXV0aG9yaXplUm9sZSA9IChyb2xlKSA9PiB7CiAgcmV0dXJuIChyZXEsIHJlcywgbmV4dCkgPT4gewogICAgaWYgKHJlcS51c2VyLnJvbGUgIT09IHJvbGUpIHJldHVybiByZXMuc2VuZFN0YXR1cyg0MDMpOwogICAgbmV4dCgpOwogIH07Cn07CgovLyBQcm90ZWN0ZWQgcm91dGUKYXBwLmdldCgnL2FkbWluJywgYXV0aGVudGljYXRlVG9rZW4sIGF1dGhvcml6ZVJvbGUoJ2FkbWluJyksIChyZXEsIHJlcykgPT4gewogIHJlcy5zZW5kKCdUaGlzIGlzIGEgcHJvdGVjdGVkIHJvdXRlIGZvciBhZG1pbiB1c2VycycpOwp9KTsKCmFwcC5saXN0ZW4oMzAwMCwgKCkgPT4gewogIGNvbnNvbGUubG9nKCdTZXJ2ZXIgcnVubmluZyBvbiBwb3J0IDMwMDAnKTsKfSk7"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>const express = require('express');
const jwt = require('jsonwebtoken');
const bcrypt = require('bcryptjs');

const app = express();
app.use(express.json());

const users = []; // In-memory user storage for simplicity

const SECRET_KEY = 'your_secret_key';

// Register endpoint
app.post('/register', async (req, res) =&gt; {
  const { username, password, role } = req.body;
  const hashedPassword = await bcrypt.hash(password, 10);
  users.push({ username, password: hashedPassword, role });
  res.status(201).send('User registered');
});

// Login endpoint
app.post('/login', async (req, res) =&gt; {
  const { username, password } = req.body;
  const user = users.find(u =&gt; u.username === username);
  if (user &amp;&amp; await bcrypt.compare(password, user.password)) {
    const token = jwt.sign({ username, role: user.role }, SECRET_KEY, { expiresIn: '1h' });
    res.json({ token });
  } else {
    res.status(401).send('Invalid credentials');
  }
});

// Middleware to protect routes
const authenticateToken = (req, res, next) =&gt; {
  const authHeader = req.headers['authorization'];
  const token = authHeader &amp;&amp; authHeader.split(' ')[1];
  if (!token) return res.sendStatus(401);

  jwt.verify(token, SECRET_KEY, (err, user) =&gt; {
    if (err) return res.sendStatus(403);
    req.user = user;
    next();
  });
};

// Middleware to check roles
const authorizeRole = (role) =&gt; {
  return (req, res, next) =&gt; {
    if (req.user.role !== role) return res.sendStatus(403);
    next();
  };
};

// Protected route
app.get('/admin', authenticateToken, authorizeRole('admin'), (req, res) =&gt; {
  res.send('This is a protected route for admin users');
});

app.listen(3000, () =&gt; {
  console.log('Server running on port 3000');
});</pre></div><div class='content'><p><strong>Explanation:</strong></p>
<ul>
<li>Users register with a username, password, and role.</li>
<li>The JWT token includes the user's role.</li>
<li>The <code>authorizeRole</code> middleware checks the user's role before allowing access to specific routes.</li>
</ul>
</div><h1>Common Mistakes and Tips</h1>
<div class='content'></div><h2>Common Mistakes</h2>
<div class='content'><ul>
<li><strong>Not using HTTPS:</strong> Always use HTTPS to encrypt the data transmitted between the client and server.</li>
<li><strong>Storing plain text passwords:</strong> Always hash and salt passwords before storing them.</li>
<li><strong>Not validating tokens:</strong> Always validate tokens to ensure they are not expired or tampered with.</li>
</ul>
</div><h2>Tips</h2>
<div class='content'><ul>
<li><strong>Use environment variables:</strong> Store sensitive information like secret keys in environment variables.</li>
<li><strong>Implement token expiration:</strong> Tokens should have an expiration time to minimize the risk of misuse.</li>
<li><strong>Regularly update dependencies:</strong> Keep your dependencies up to date to avoid security vulnerabilities.</li>
</ul>
</div><h1>Conclusion</h1>
<div class='content'><p>In this section, we covered the fundamental concepts of authentication and authorization, explored common methods, and provided practical examples and exercises. Understanding and implementing these concepts is crucial for securing your RESTful APIs and ensuring that only authorized users can access your resources. In the next section, we will delve into error handling, which is essential for creating robust and user-friendly APIs.</p>
</div><div class='row navigation'>
	<div class='col-1 col-md-2'>
					<a href='03-03-handling-requests-responses' title="Handling Requests and Responses">
				<span class="d-none d-md-inline">&#x25C4; Previous</span>
				<span class="d-inline d-md-none"><i class="bi bi-caret-left-square-fill"></i></span>
			</a>
			</div>
	<div class='col-10 col-md-8 text-center'>
			</div>
	<div class='col-1 col-md-2 text-end'>
					<a href='03-05-error-handling' title="Error Handling">
				<span class="d-none d-md-inline">Next &#x25BA;</span>
				<span class="d-inline d-md-none"><i class="bi bi-caret-right-square-fill"></i></span>
			</a>
			</div>
</div>

			</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<!-- 
<h1>Advertising</h1>
<p>This space is reserved for advertising.</p>
<p>If you want to be a sponsor, contact us to include links in this area: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
<p>Thank you for collaborating!</p>
-->

<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-0611338592562725"
     crossorigin="anonymous"></script>
<!-- enterprise_campus -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-0611338592562725"
     data-ad-slot="6914733106"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
			









		</div>
	</div>
</div>

<div class="container-xxl d-block d-md-none">
	<div class="row">
		<div class="col-12 p-2 p-md-0 m-0 text-end">
			<a href="/objective">The Project</a> | 
<a href="/about">About Us</a> | 
<a href="/contribute">Contribute</a> | 
<a href="/donate">Donations</a> | 
<a href="/licence">License</a>
		</div>
	</div>
</div>

<div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. All rights reserved</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	We use cookies to improve your user experience and offer content tailored to your interests.
    <a href="#" id="btn_accept_cookies" class="button">Accept</a>
    <a href="/cookies">More Information</a>
</div>	

	</div>    
</body>
</html>
