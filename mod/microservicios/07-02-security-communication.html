<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Security in Communication</title>

    <link rel="alternate" href="https://campusempresa.com/mod/microservicios/07-02-seguridad-comunicacion" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/mod/microservicios/07-02-seguridad-comunicacion" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/mod/microservicios/07-02-security-communication" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body >
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-12 col-md-8 p-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo-header_enterprise.png"></a>
			</h1>
		</div>
		<div class="col-12 col-md-4 p-0 text-end">
			<h2 id="main_title"><cite>Building today's and tomorrow's society</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-0 m-0 text-end">
													<b id="lit_lang_es" class="px-2">EN</b>
				|
				<a href="https://campusempresa.com/mod/microservicios/07-02-seguridad-comunicacion" class="px-2">ES</a></b>
				|
				<a href="https://campusempresa.cat/mod/microservicios/07-02-seguridad-comunicacion" class="px-2">CA</a>
					</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="/objective">The Project</a>
				<a href="/about">About Us</a>
				<a href="/contribute">Contribute</a>
				<a href="/donate">Donations</a>
				<a href="/licence">License</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content">
								<div class='row navigation'>
	<div class='col-2'>
					<a href='07-01-authentication-authorization' title="Authentication and Authorization">&#x25C4;Previous</a>
			</div>
	<div class='col-8 text-center'>
					<a href="./"><h2 style="text-decoration:underline">Security in Communication</h2></a>
			</div>
	<div class='col-2 text-end'>
					<a href='07-03-security-practices' title="Security Practices">Next &#x25BA;</a>
			</div>
</div>
<div class='content'><p>In this section, we will explore the critical aspects of securing communication between microservices. Given the distributed nature of microservices, ensuring secure communication is paramount to protect data integrity and confidentiality. We will cover key concepts, practical examples, and exercises to solidify your understanding.</p>
</div><h1>Key Concepts</h1>
<div class='content'><ol>
<li>
<p><strong>Transport Layer Security (TLS)</strong></p>
<ul>
<li>Ensures encrypted communication between services.</li>
<li>Prevents eavesdropping and tampering.</li>
<li>Commonly used protocols: HTTPS, SSL/TLS.</li>
</ul>
</li>
<li>
<p><strong>Mutual TLS (mTLS)</strong></p>
<ul>
<li>Both client and server authenticate each other.</li>
<li>Adds an extra layer of security by verifying both ends of the communication.</li>
</ul>
</li>
<li>
<p><strong>API Gateways</strong></p>
<ul>
<li>Acts as a single entry point for all microservices.</li>
<li>Can enforce security policies, rate limiting, and logging.</li>
</ul>
</li>
<li>
<p><strong>Service Mesh</strong></p>
<ul>
<li>Manages service-to-service communication.</li>
<li>Provides built-in security features like mTLS, traffic encryption, and policy enforcement.</li>
</ul>
</li>
<li>
<p><strong>Token-based Authentication</strong></p>
<ul>
<li>Uses tokens (e.g., JWT) to authenticate and authorize requests.</li>
<li>Ensures that only authorized services can communicate.</li>
</ul>
</li>
</ol>
</div><h1>Practical Example: Implementing TLS</h1>
<div class='content'></div><h2>Step 1: Generate Certificates</h2>
<div class='content'><p>First, generate a self-signed certificate for your microservice. In a production environment, you should use certificates from a trusted Certificate Authority (CA).</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("b3BlbnNzbCByZXEgLXg1MDkgLW5ld2tleSByc2E6NDA5NiAta2V5b3V0IGtleS5wZW0gLW91dCBjZXJ0LnBlbSAtZGF5cyAzNjUgLW5vZGVz"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>openssl req -x509 -newkey rsa:4096 -keyout key.pem -out cert.pem -days 365 -nodes</pre></div><div class='content'></div><h2>Step 2: Configure Your Microservice to Use TLS</h2>
<div class='content'><p>Here is an example of configuring a Node.js microservice to use TLS:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y29uc3QgaHR0cHMgPSByZXF1aXJlKCdodHRwcycpOwpjb25zdCBmcyA9IHJlcXVpcmUoJ2ZzJyk7CmNvbnN0IGV4cHJlc3MgPSByZXF1aXJlKCdleHByZXNzJyk7Cgpjb25zdCBhcHAgPSBleHByZXNzKCk7CgovLyBMb2FkIHRoZSBjZXJ0aWZpY2F0ZSBhbmQga2V5CmNvbnN0IG9wdGlvbnMgPSB7CiAga2V5OiBmcy5yZWFkRmlsZVN5bmMoJ2tleS5wZW0nKSwKICBjZXJ0OiBmcy5yZWFkRmlsZVN5bmMoJ2NlcnQucGVtJykKfTsKCi8vIERlZmluZSBhIHNpbXBsZSByb3V0ZQphcHAuZ2V0KCcvJywgKHJlcSwgcmVzKSA9PiB7CiAgcmVzLnNlbmQoJ0hlbGxvLCBzZWN1cmUgd29ybGQhJyk7Cn0pOwoKLy8gQ3JlYXRlIGFuIEhUVFBTIHNlcnZlcgpodHRwcy5jcmVhdGVTZXJ2ZXIob3B0aW9ucywgYXBwKS5saXN0ZW4oMzAwMCwgKCkgPT4gewogIGNvbnNvbGUubG9nKCdTZXJ2ZXIgaXMgcnVubmluZyBvbiBodHRwczovL2xvY2FsaG9zdDozMDAwJyk7Cn0pOw=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>const https = require('https');
const fs = require('fs');
const express = require('express');

const app = express();

// Load the certificate and key
const options = {
  key: fs.readFileSync('key.pem'),
  cert: fs.readFileSync('cert.pem')
};

// Define a simple route
app.get('/', (req, res) =&gt; {
  res.send('Hello, secure world!');
});

// Create an HTTPS server
https.createServer(options, app).listen(3000, () =&gt; {
  console.log('Server is running on https://localhost:3000');
});</pre></div><div class='content'></div><h2>Step 3: Test the Secure Connection</h2>
<div class='content'><p>Access your microservice via <code>https://localhost:3000</code> to ensure that the connection is secure.</p>
</div><h1>Exercise: Implement mTLS</h1>
<div class='content'></div><h2>Task</h2>
<div class='content'><ol>
<li>Generate client and server certificates.</li>
<li>Configure a microservice to use mTLS for secure communication.</li>
</ol>
</div><h2>Solution</h2>
<div class='content'><h4>Step 1: Generate Client and Server Certificates</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("IyBHZW5lcmF0ZSBzZXJ2ZXIgY2VydGlmaWNhdGUKb3BlbnNzbCByZXEgLW5ld2tleSByc2E6NDA5NiAtbm9kZXMgLWtleW91dCBzZXJ2ZXIta2V5LnBlbSAteDUwOSAtZGF5cyAzNjUgLW91dCBzZXJ2ZXItY2VydC5wZW0KCiMgR2VuZXJhdGUgY2xpZW50IGNlcnRpZmljYXRlCm9wZW5zc2wgcmVxIC1uZXdrZXkgcnNhOjQwOTYgLW5vZGVzIC1rZXlvdXQgY2xpZW50LWtleS5wZW0gLXg1MDkgLWRheXMgMzY1IC1vdXQgY2xpZW50LWNlcnQucGVt"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'># Generate server certificate
openssl req -newkey rsa:4096 -nodes -keyout server-key.pem -x509 -days 365 -out server-cert.pem

# Generate client certificate
openssl req -newkey rsa:4096 -nodes -keyout client-key.pem -x509 -days 365 -out client-cert.pem</pre></div><div class='content'><h4>Step 2: Configure Server for mTLS</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y29uc3QgaHR0cHMgPSByZXF1aXJlKCdodHRwcycpOwpjb25zdCBmcyA9IHJlcXVpcmUoJ2ZzJyk7CmNvbnN0IGV4cHJlc3MgPSByZXF1aXJlKCdleHByZXNzJyk7Cgpjb25zdCBhcHAgPSBleHByZXNzKCk7CgovLyBMb2FkIHRoZSBzZXJ2ZXIgY2VydGlmaWNhdGUgYW5kIGtleQpjb25zdCBvcHRpb25zID0gewogIGtleTogZnMucmVhZEZpbGVTeW5jKCdzZXJ2ZXIta2V5LnBlbScpLAogIGNlcnQ6IGZzLnJlYWRGaWxlU3luYygnc2VydmVyLWNlcnQucGVtJyksCiAgY2E6IGZzLnJlYWRGaWxlU3luYygnY2xpZW50LWNlcnQucGVtJyksIC8vIENsaWVudCBjZXJ0aWZpY2F0ZQogIHJlcXVlc3RDZXJ0OiB0cnVlLAogIHJlamVjdFVuYXV0aG9yaXplZDogdHJ1ZQp9OwoKLy8gRGVmaW5lIGEgc2ltcGxlIHJvdXRlCmFwcC5nZXQoJy8nLCAocmVxLCByZXMpID0+IHsKICByZXMuc2VuZCgnSGVsbG8sIHNlY3VyZSB3b3JsZCB3aXRoIG1UTFMhJyk7Cn0pOwoKLy8gQ3JlYXRlIGFuIEhUVFBTIHNlcnZlcgpodHRwcy5jcmVhdGVTZXJ2ZXIob3B0aW9ucywgYXBwKS5saXN0ZW4oMzAwMCwgKCkgPT4gewogIGNvbnNvbGUubG9nKCdTZXJ2ZXIgaXMgcnVubmluZyBvbiBodHRwczovL2xvY2FsaG9zdDozMDAwJyk7Cn0pOw=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>const https = require('https');
const fs = require('fs');
const express = require('express');

const app = express();

// Load the server certificate and key
const options = {
  key: fs.readFileSync('server-key.pem'),
  cert: fs.readFileSync('server-cert.pem'),
  ca: fs.readFileSync('client-cert.pem'), // Client certificate
  requestCert: true,
  rejectUnauthorized: true
};

// Define a simple route
app.get('/', (req, res) =&gt; {
  res.send('Hello, secure world with mTLS!');
});

// Create an HTTPS server
https.createServer(options, app).listen(3000, () =&gt; {
  console.log('Server is running on https://localhost:3000');
});</pre></div><div class='content'><h4>Step 3: Configure Client for mTLS</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y29uc3QgaHR0cHMgPSByZXF1aXJlKCdodHRwcycpOwpjb25zdCBmcyA9IHJlcXVpcmUoJ2ZzJyk7CgovLyBMb2FkIHRoZSBjbGllbnQgY2VydGlmaWNhdGUgYW5kIGtleQpjb25zdCBvcHRpb25zID0gewogIGhvc3RuYW1lOiAnbG9jYWxob3N0JywKICBwb3J0OiAzMDAwLAogIHBhdGg6ICcvJywKICBtZXRob2Q6ICdHRVQnLAogIGtleTogZnMucmVhZEZpbGVTeW5jKCdjbGllbnQta2V5LnBlbScpLAogIGNlcnQ6IGZzLnJlYWRGaWxlU3luYygnY2xpZW50LWNlcnQucGVtJyksCiAgY2E6IGZzLnJlYWRGaWxlU3luYygnc2VydmVyLWNlcnQucGVtJykgLy8gU2VydmVyIGNlcnRpZmljYXRlCn07CgovLyBNYWtlIGEgcmVxdWVzdCB0byB0aGUgc2VydmVyCmNvbnN0IHJlcSA9IGh0dHBzLnJlcXVlc3Qob3B0aW9ucywgKHJlcykgPT4gewogIGxldCBkYXRhID0gJyc7CiAgcmVzLm9uKCdkYXRhJywgKGNodW5rKSA9PiB7CiAgICBkYXRhICs9IGNodW5rOwogIH0pOwogIHJlcy5vbignZW5kJywgKCkgPT4gewogICAgY29uc29sZS5sb2coZGF0YSk7CiAgfSk7Cn0pOwoKcmVxLm9uKCdlcnJvcicsIChlKSA9PiB7CiAgY29uc29sZS5lcnJvcihlKTsKfSk7CgpyZXEuZW5kKCk7"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>const https = require('https');
const fs = require('fs');

// Load the client certificate and key
const options = {
  hostname: 'localhost',
  port: 3000,
  path: '/',
  method: 'GET',
  key: fs.readFileSync('client-key.pem'),
  cert: fs.readFileSync('client-cert.pem'),
  ca: fs.readFileSync('server-cert.pem') // Server certificate
};

// Make a request to the server
const req = https.request(options, (res) =&gt; {
  let data = '';
  res.on('data', (chunk) =&gt; {
    data += chunk;
  });
  res.on('end', () =&gt; {
    console.log(data);
  });
});

req.on('error', (e) =&gt; {
  console.error(e);
});

req.end();</pre></div><div class='content'></div><h1>Common Mistakes and Tips</h1>
<div class='content'><ol>
<li>
<p><strong>Certificate Management</strong></p>
<ul>
<li>Ensure certificates are securely stored and managed.</li>
<li>Rotate certificates periodically to maintain security.</li>
</ul>
</li>
<li>
<p><strong>Configuration Errors</strong></p>
<ul>
<li>Double-check paths to certificate files.</li>
<li>Ensure that the server and client certificates are correctly configured.</li>
</ul>
</li>
<li>
<p><strong>Testing</strong></p>
<ul>
<li>Always test your setup in a staging environment before deploying to production.</li>
<li>Use tools like <code>curl</code> with <code>--cert</code> and <code>--key</code> options to test mTLS.</li>
</ul>
</li>
</ol>
</div><h1>Summary</h1>
<div class='content'><p>In this section, we covered the importance of securing communication between microservices. We explored key concepts such as TLS, mTLS, API gateways, service mesh, and token-based authentication. Practical examples and exercises were provided to help you implement these security measures in your microservices architecture. Ensuring secure communication is crucial for protecting data integrity and confidentiality in a distributed system.</p>
</div><div class='row navigation'>
	<div class='col-2'>
					<a href='07-01-authentication-authorization' title="Authentication and Authorization">&#x25C4;Previous</a>
			</div>
	<div class='col-8 text-center'>
			</div>
	<div class='col-2 text-end'>
					<a href='07-03-security-practices' title="Security Practices">Next &#x25BA;</a>
			</div>
</div>

			</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Advertising</h1>
			<p>This space is reserved for advertising.</p>
			<p>If you want to be a sponsor, contact us to include links in this area: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Thank you for collaborating!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. All rights reserved</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir galetes per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Accept</a>
    <a href="/cookies">More Information</a>
</div>	

	</div>    
</body>
</html>
