<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Authentication and Authorization</title>

    <link rel="alternate" href="https://campusempresa.com/mod/microservicios/07-01-autenticacion-autorizacion" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/mod/microservicios/07-01-autenticacion-autorizacion" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/mod/microservicios/07-01-authentication-authorization" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="/js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body >
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-12 col-md-8 p-2 p-md-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo-header_enterprise.png"></a>
			</h1>
		</div>
		<div class="col-12 col-md-4 p-2 p-md-0 text-end">
			<h2 id="main_title"><cite>Building today's and tomorrow's society</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-2 p-md-0 m-0 text-end">
													<b id="lit_lang_es" class="px-2">EN</b>
				|
				<a href="https://campusempresa.com/mod/microservicios/07-01-autenticacion-autorizacion" class="px-2">ES</a></b>
				|
				<a href="https://campusempresa.cat/mod/microservicios/07-01-autenticacion-autorizacion" class="px-2">CA</a>
					</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="/objective">The Project</a>
				<a href="/about">About Us</a>
				<a href="/contribute">Contribute</a>
				<a href="/donate">Donations</a>
				<a href="/licence">License</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content">
								<div class='row navigation'>
	<div class='col-2'>
					<a href='06-03-scalability-performance' title="Scalability and Performance">&#x25C4;Previous</a>
			</div>
	<div class='col-8 text-center'>
					<a href="./"><h2 style="text-decoration:underline">Authentication and Authorization</h2></a>
			</div>
	<div class='col-2 text-end'>
					<a href='07-02-security-communication' title="Security in Communication">Next &#x25BA;</a>
			</div>
</div>
<div class='content'></div><h1><p>Introduction</p>
</h1>
<div class='content'><p>In the context of microservices, ensuring secure access to services is paramount. Authentication and authorization are two critical components of security:</p>
<ul>
<li><strong>Authentication</strong>: Verifying the identity of a user or service.</li>
<li><strong>Authorization</strong>: Determining what an authenticated user or service is allowed to do.</li>
</ul>
<p>This section will cover the fundamental concepts, techniques, and best practices for implementing authentication and authorization in microservices.</p>
</div><h1><p>Key Concepts</p>
</h1>
<div class='content'></div><h2><p>Authentication</p>
</h2>
<div class='content'><ol>
<li><strong>User Authentication</strong>: Verifying the identity of a user, typically through credentials like username and password.</li>
<li><strong>Service Authentication</strong>: Ensuring that a service requesting access to another service is legitimate.</li>
<li><strong>Token-Based Authentication</strong>: Using tokens (e.g., JWT) to authenticate users and services.</li>
</ol>
</div><h2><p>Authorization</p>
</h2>
<div class='content'><ol>
<li><strong>Role-Based Access Control (RBAC)</strong>: Assigning permissions to roles rather than individual users.</li>
<li><strong>Attribute-Based Access Control (ABAC)</strong>: Using attributes (e.g., user role, resource type) to determine access.</li>
<li><strong>Policy-Based Access Control (PBAC)</strong>: Defining policies that specify access rules.</li>
</ol>
</div><h1><p>Implementing Authentication</p>
</h1>
<div class='content'></div><h2><p>Token-Based Authentication with JWT</p>
</h2>
<div class='content'><p>JSON Web Tokens (JWT) are a popular method for implementing token-based authentication. Here's a basic example:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("aW1wb3J0IGp3dAppbXBvcnQgZGF0ZXRpbWUKCiMgU2VjcmV0IGtleSBmb3IgZW5jb2RpbmcgYW5kIGRlY29kaW5nIEpXVApTRUNSRVRfS0VZID0gJ3lvdXJfc2VjcmV0X2tleScKCiMgRnVuY3Rpb24gdG8gZ2VuZXJhdGUgYSBKV1QKZGVmIGdlbmVyYXRlX2p3dCh1c2VyX2lkKToKICAgIHBheWxvYWQgPSB7CiAgICAgICAgJ3VzZXJfaWQnOiB1c2VyX2lkLAogICAgICAgICdleHAnOiBkYXRldGltZS5kYXRldGltZS51dGNub3coKSArIGRhdGV0aW1lLnRpbWVkZWx0YShob3Vycz0xKQogICAgfQogICAgdG9rZW4gPSBqd3QuZW5jb2RlKHBheWxvYWQsIFNFQ1JFVF9LRVksIGFsZ29yaXRobT0nSFMyNTYnKQogICAgcmV0dXJuIHRva2VuCgojIEZ1bmN0aW9uIHRvIGRlY29kZSBhIEpXVApkZWYgZGVjb2RlX2p3dCh0b2tlbik6CiAgICB0cnk6CiAgICAgICAgcGF5bG9hZCA9IGp3dC5kZWNvZGUodG9rZW4sIFNFQ1JFVF9LRVksIGFsZ29yaXRobXM9WydIUzI1NiddKQogICAgICAgIHJldHVybiBwYXlsb2FkCiAgICBleGNlcHQgand0LkV4cGlyZWRTaWduYXR1cmVFcnJvcjoKICAgICAgICByZXR1cm4gJ1Rva2VuIGhhcyBleHBpcmVkJwogICAgZXhjZXB0IGp3dC5JbnZhbGlkVG9rZW5FcnJvcjoKICAgICAgICByZXR1cm4gJ0ludmFsaWQgdG9rZW4nCgojIEV4YW1wbGUgdXNhZ2UKdG9rZW4gPSBnZW5lcmF0ZV9qd3QodXNlcl9pZD0xMjMpCnByaW50KGYiR2VuZXJhdGVkIFRva2VuOiB7dG9rZW59IikKCmRlY29kZWRfcGF5bG9hZCA9IGRlY29kZV9qd3QodG9rZW4pCnByaW50KGYiRGVjb2RlZCBQYXlsb2FkOiB7ZGVjb2RlZF9wYXlsb2FkfSIp"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>import jwt
import datetime

# Secret key for encoding and decoding JWT
SECRET_KEY = 'your_secret_key'

# Function to generate a JWT
def generate_jwt(user_id):
    payload = {
        'user_id': user_id,
        'exp': datetime.datetime.utcnow() + datetime.timedelta(hours=1)
    }
    token = jwt.encode(payload, SECRET_KEY, algorithm='HS256')
    return token

# Function to decode a JWT
def decode_jwt(token):
    try:
        payload = jwt.decode(token, SECRET_KEY, algorithms=['HS256'])
        return payload
    except jwt.ExpiredSignatureError:
        return 'Token has expired'
    except jwt.InvalidTokenError:
        return 'Invalid token'

# Example usage
token = generate_jwt(user_id=123)
print(f&quot;Generated Token: {token}&quot;)

decoded_payload = decode_jwt(token)
print(f&quot;Decoded Payload: {decoded_payload}&quot;)</pre></div><div class='content'></div><h2><p>Explanation</p>
</h2>
<div class='content'><ul>
<li><strong>generate_jwt</strong>: Creates a JWT with a user ID and an expiration time.</li>
<li><strong>decode_jwt</strong>: Decodes the JWT and handles errors like expired or invalid tokens.</li>
</ul>
</div><h2><p>Exercise</p>
</h2>
<div class='content'><ol>
<li>Modify the <code>generate_jwt</code> function to include additional user information (e.g., username, roles).</li>
<li>Implement a function to refresh the JWT before it expires.</li>
</ol>
</div><h1><p>Implementing Authorization</p>
</h1>
<div class='content'></div><h2><p>Role-Based Access Control (RBAC)</p>
</h2>
<div class='content'><p>RBAC is a common method for managing permissions. Here's a simple example:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("IyBEZWZpbmUgcm9sZXMgYW5kIHBlcm1pc3Npb25zCnJvbGVzX3Blcm1pc3Npb25zID0gewogICAgJ2FkbWluJzogWydyZWFkJywgJ3dyaXRlJywgJ2RlbGV0ZSddLAogICAgJ3VzZXInOiBbJ3JlYWQnLCAnd3JpdGUnXSwKICAgICdndWVzdCc6IFsncmVhZCddCn0KCiMgRnVuY3Rpb24gdG8gY2hlY2sgaWYgYSB1c2VyIGhhcyBhIHNwZWNpZmljIHBlcm1pc3Npb24KZGVmIGhhc19wZXJtaXNzaW9uKHVzZXJfcm9sZSwgcGVybWlzc2lvbik6CiAgICBpZiB1c2VyX3JvbGUgaW4gcm9sZXNfcGVybWlzc2lvbnM6CiAgICAgICAgcmV0dXJuIHBlcm1pc3Npb24gaW4gcm9sZXNfcGVybWlzc2lvbnNbdXNlcl9yb2xlXQogICAgcmV0dXJuIEZhbHNlCgojIEV4YW1wbGUgdXNhZ2UKdXNlcl9yb2xlID0gJ3VzZXInCnBlcm1pc3Npb24gPSAnZGVsZXRlJwoKaWYgaGFzX3Blcm1pc3Npb24odXNlcl9yb2xlLCBwZXJtaXNzaW9uKToKICAgIHByaW50KGYiVXNlciB3aXRoIHJvbGUgJ3t1c2VyX3JvbGV9JyBoYXMgJ3twZXJtaXNzaW9ufScgcGVybWlzc2lvbi4iKQplbHNlOgogICAgcHJpbnQoZiJVc2VyIHdpdGggcm9sZSAne3VzZXJfcm9sZX0nIGRvZXMgTk9UIGhhdmUgJ3twZXJtaXNzaW9ufScgcGVybWlzc2lvbi4iKQ=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'># Define roles and permissions
roles_permissions = {
    'admin': ['read', 'write', 'delete'],
    'user': ['read', 'write'],
    'guest': ['read']
}

# Function to check if a user has a specific permission
def has_permission(user_role, permission):
    if user_role in roles_permissions:
        return permission in roles_permissions[user_role]
    return False

# Example usage
user_role = 'user'
permission = 'delete'

if has_permission(user_role, permission):
    print(f&quot;User with role '{user_role}' has '{permission}' permission.&quot;)
else:
    print(f&quot;User with role '{user_role}' does NOT have '{permission}' permission.&quot;)</pre></div><div class='content'></div><h2><p>Explanation</p>
</h2>
<div class='content'><ul>
<li><strong>roles_permissions</strong>: A dictionary mapping roles to their respective permissions.</li>
<li><strong>has_permission</strong>: Checks if a given role has a specific permission.</li>
</ul>
</div><h2><p>Exercise</p>
</h2>
<div class='content'><ol>
<li>Extend the <code>roles_permissions</code> dictionary to include more roles and permissions.</li>
<li>Implement a function to dynamically add or remove permissions from roles.</li>
</ol>
</div><h1><p>Best Practices</p>
</h1>
<div class='content'><ol>
<li><strong>Use Strong Encryption</strong>: Ensure that tokens and sensitive data are encrypted using strong algorithms.</li>
<li><strong>Implement Token Expiry</strong>: Always set an expiration time for tokens to minimize the risk of misuse.</li>
<li><strong>Regularly Rotate Secrets</strong>: Change secret keys and credentials periodically to enhance security.</li>
<li><strong>Monitor and Log Access</strong>: Keep track of authentication and authorization events for auditing and troubleshooting.</li>
</ol>
</div><h1><p>Conclusion</p>
</h1>
<div class='content'><p>Authentication and authorization are crucial for securing microservices. By implementing robust token-based authentication and using RBAC for managing permissions, you can ensure that only authorized users and services have access to your microservices. Remember to follow best practices to maintain a high level of security.</p>
<p>In the next section, we will delve into securing communication between microservices to further enhance the security of your architecture.</p>
</div><div class='row navigation'>
	<div class='col-2'>
					<a href='06-03-scalability-performance' title="Scalability and Performance">&#x25C4;Previous</a>
			</div>
	<div class='col-8 text-center'>
			</div>
	<div class='col-2 text-end'>
					<a href='07-02-security-communication' title="Security in Communication">Next &#x25BA;</a>
			</div>
</div>

			</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Advertising</h1>
			<p>This space is reserved for advertising.</p>
			<p>If you want to be a sponsor, contact us to include links in this area: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Thank you for collaborating!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. All rights reserved</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	We use cookies to improve your user experience and offer content tailored to your interests.
    <a href="#" id="btn_accept_cookies" class="button">Accept</a>
    <a href="/cookies">More Information</a>
</div>	

	</div>    
</body>
</html>
