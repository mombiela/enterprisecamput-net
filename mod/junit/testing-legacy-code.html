<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Testing Legacy Code</title>

    <link rel="alternate" href="https://campusempresa.com/mod/junit/testing-legacy-code" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/mod/junit/testing-legacy-code" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/mod/junit/testing-legacy-code" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body>
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-8 p-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo_header.png" style="visibility:hiddenxx;"></a>
			</h1>
		</div>
		<div class="col-4 p-0 text-end">
			<h2 id="main_title"><cite>Building today's and tomorrow's society</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-0 m-0 text-end">
													<b id="lit_lang_es" class="px-2">EN</b>
				|
				<a href="https://campusempresa.com/mod/junit/testing-legacy-code" class="px-2">ES</a></b>
				|
				<a href="https://campusempresa.cat/mod/junit/testing-legacy-code" class="px-2">CA</a>
					</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="/objective">The Project</a>
				<a href="/about">About Us</a>
				<a href="/contribute">Contribute</a>
				<a href="/donate">Donations</a>
				<a href="/licence">License</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content"><div class='row navigation'>
	<div class='col-4'>
					<a href='testing-databases'>&#x25C4;Testing Databases</a>
			</div>
	<div class='col-4 text-center'>
		<a href="./" class="title">Testing Legacy Code</a>
	</div>
	<div class='col-4 text-end'>
					<a href='project-overview'>Project Overview &#x25BA;</a>
			</div>
</div>
<div class='content'></div><h1>Introduction</h1>
<div class='content'><p>Testing legacy code can be challenging but is crucial for maintaining and improving the quality of your software. Legacy code often lacks tests, making it difficult to refactor or extend without introducing bugs. This section will guide you through the process of testing legacy code using JUnit, from understanding the basics to implementing advanced techniques.</p>
</div><h1>Key Concepts</h1>
<div class='content'><ul>
<li><strong>Legacy Code</strong>: Code inherited from an older version of the software that may not have tests.</li>
<li><strong>Refactoring</strong>: The process of restructuring existing code without changing its external behavior.</li>
<li><strong>Test Coverage</strong>: A measure of how much of the code is tested by automated tests.</li>
<li><strong>Mocking</strong>: Creating objects that simulate the behavior of real objects in controlled ways.</li>
</ul>
</div><h1>Challenges of Testing Legacy Code</h1>
<div class='content'><ul>
<li>Lack of existing tests.</li>
<li>Tight coupling and dependencies.</li>
<li>Poor documentation.</li>
<li>Risk of introducing bugs during refactoring.</li>
</ul>
</div><h1>Strategies for Testing Legacy Code</h1>
<div class='content'><ol>
<li><strong>Characterization Tests</strong>: Write tests to understand the current behavior of the code.</li>
<li><strong>Incremental Refactoring</strong>: Gradually refactor the code while adding tests.</li>
<li><strong>Dependency Injection</strong>: Use dependency injection to make the code more testable.</li>
<li><strong>Mocking and Stubbing</strong>: Use mocks and stubs to isolate the code under test.</li>
</ol>
</div><h1>Writing Characterization Tests</h1>
<div class='content'><p>Characterization tests help you understand what the legacy code does. They capture the current behavior, which can be useful when refactoring.</p>
</div><h2>Example</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("cHVibGljIGNsYXNzIExlZ2FjeUNhbGN1bGF0b3IgewogICAgcHVibGljIGludCBhZGQoaW50IGEsIGludCBiKSB7CiAgICAgICAgcmV0dXJuIGEgKyBiOwogICAgfQp9CgovLyBDaGFyYWN0ZXJpemF0aW9uIFRlc3QKaW1wb3J0IHN0YXRpYyBvcmcuanVuaXQuanVwaXRlci5hcGkuQXNzZXJ0aW9ucy5hc3NlcnRFcXVhbHM7CmltcG9ydCBvcmcuanVuaXQuanVwaXRlci5hcGkuVGVzdDsKCnB1YmxpYyBjbGFzcyBMZWdhY3lDYWxjdWxhdG9yVGVzdCB7CiAgICBAVGVzdAogICAgcHVibGljIHZvaWQgdGVzdEFkZCgpIHsKICAgICAgICBMZWdhY3lDYWxjdWxhdG9yIGNhbGN1bGF0b3IgPSBuZXcgTGVnYWN5Q2FsY3VsYXRvcigpOwogICAgICAgIGFzc2VydEVxdWFscyg1LCBjYWxjdWxhdG9yLmFkZCgyLCAzKSk7CiAgICB9Cn0="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>public class LegacyCalculator {
    public int add(int a, int b) {
        return a + b;
    }
}

// Characterization Test
import static org.junit.jupiter.api.Assertions.assertEquals;
import org.junit.jupiter.api.Test;

public class LegacyCalculatorTest {
    @Test
    public void testAdd() {
        LegacyCalculator calculator = new LegacyCalculator();
        assertEquals(5, calculator.add(2, 3));
    }
}</pre></div><div class='content'><p>Explanation:</p>
<ul>
<li>We create a simple test for the <code>add</code> method to capture its current behavior.</li>
<li>This test ensures that any future changes to the <code>add</code> method will not alter its expected behavior.</li>
</ul>
</div><h1>Incremental Refactoring</h1>
<div class='content'><p>Refactor the code in small steps while ensuring that existing tests pass. This approach minimizes the risk of introducing bugs.</p>
</div><h2>Example</h2>
<div class='content'><p>Refactor a tightly coupled method by introducing dependency injection.</p>
<p>Before Refactoring:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("cHVibGljIGNsYXNzIE9yZGVyU2VydmljZSB7CiAgICBwcml2YXRlIERhdGFiYXNlIGRhdGFiYXNlID0gbmV3IERhdGFiYXNlKCk7CgogICAgcHVibGljIHZvaWQgcGxhY2VPcmRlcihPcmRlciBvcmRlcikgewogICAgICAgIGRhdGFiYXNlLnNhdmUob3JkZXIpOwogICAgfQp9"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>public class OrderService {
    private Database database = new Database();

    public void placeOrder(Order order) {
        database.save(order);
    }
}</pre></div><div class='content'><p>After Refactoring:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("cHVibGljIGNsYXNzIE9yZGVyU2VydmljZSB7CiAgICBwcml2YXRlIERhdGFiYXNlIGRhdGFiYXNlOwoKICAgIHB1YmxpYyBPcmRlclNlcnZpY2UoRGF0YWJhc2UgZGF0YWJhc2UpIHsKICAgICAgICB0aGlzLmRhdGFiYXNlID0gZGF0YWJhc2U7CiAgICB9CgogICAgcHVibGljIHZvaWQgcGxhY2VPcmRlcihPcmRlciBvcmRlcikgewogICAgICAgIGRhdGFiYXNlLnNhdmUob3JkZXIpOwogICAgfQp9"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>public class OrderService {
    private Database database;

    public OrderService(Database database) {
        this.database = database;
    }

    public void placeOrder(Order order) {
        database.save(order);
    }
}</pre></div><div class='content'></div><h2>Test for Refactored Code</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("aW1wb3J0IHN0YXRpYyBvcmcubW9ja2l0by5Nb2NraXRvLio7CmltcG9ydCBvcmcuanVuaXQuanVwaXRlci5hcGkuVGVzdDsKCnB1YmxpYyBjbGFzcyBPcmRlclNlcnZpY2VUZXN0IHsKICAgIEBUZXN0CiAgICBwdWJsaWMgdm9pZCB0ZXN0UGxhY2VPcmRlcigpIHsKICAgICAgICBEYXRhYmFzZSBtb2NrRGF0YWJhc2UgPSBtb2NrKERhdGFiYXNlLmNsYXNzKTsKICAgICAgICBPcmRlclNlcnZpY2Ugb3JkZXJTZXJ2aWNlID0gbmV3IE9yZGVyU2VydmljZShtb2NrRGF0YWJhc2UpOwogICAgICAgIE9yZGVyIG9yZGVyID0gbmV3IE9yZGVyKCk7CgogICAgICAgIG9yZGVyU2VydmljZS5wbGFjZU9yZGVyKG9yZGVyKTsKCiAgICAgICAgdmVyaWZ5KG1vY2tEYXRhYmFzZSkuc2F2ZShvcmRlcik7CiAgICB9Cn0="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>import static org.mockito.Mockito.*;
import org.junit.jupiter.api.Test;

public class OrderServiceTest {
    @Test
    public void testPlaceOrder() {
        Database mockDatabase = mock(Database.class);
        OrderService orderService = new OrderService(mockDatabase);
        Order order = new Order();

        orderService.placeOrder(order);

        verify(mockDatabase).save(order);
    }
}</pre></div><div class='content'><p>Explanation:</p>
<ul>
<li>We refactor <code>OrderService</code> to use dependency injection.</li>
<li>We create a mock <code>Database</code> object to test <code>OrderService</code> in isolation.</li>
</ul>
</div><h1>Mocking and Stubbing</h1>
<div class='content'><p>Use mocking frameworks like Mockito to create mocks and stubs for dependencies. This allows you to test the code in isolation.</p>
</div><h2>Example with Mockito</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("aW1wb3J0IHN0YXRpYyBvcmcubW9ja2l0by5Nb2NraXRvLio7CmltcG9ydCBvcmcuanVuaXQuanVwaXRlci5hcGkuVGVzdDsKCnB1YmxpYyBjbGFzcyBQYXltZW50U2VydmljZVRlc3QgewogICAgQFRlc3QKICAgIHB1YmxpYyB2b2lkIHRlc3RQcm9jZXNzUGF5bWVudCgpIHsKICAgICAgICBQYXltZW50R2F0ZXdheSBtb2NrR2F0ZXdheSA9IG1vY2soUGF5bWVudEdhdGV3YXkuY2xhc3MpOwogICAgICAgIFBheW1lbnRTZXJ2aWNlIHBheW1lbnRTZXJ2aWNlID0gbmV3IFBheW1lbnRTZXJ2aWNlKG1vY2tHYXRld2F5KTsKICAgICAgICBQYXltZW50IHBheW1lbnQgPSBuZXcgUGF5bWVudCgpOwoKICAgICAgICB3aGVuKG1vY2tHYXRld2F5LnByb2Nlc3MocGF5bWVudCkpLnRoZW5SZXR1cm4odHJ1ZSk7CgogICAgICAgIGJvb2xlYW4gcmVzdWx0ID0gcGF5bWVudFNlcnZpY2UucHJvY2Vzc1BheW1lbnQocGF5bWVudCk7CgogICAgICAgIGFzc2VydFRydWUocmVzdWx0KTsKICAgICAgICB2ZXJpZnkobW9ja0dhdGV3YXkpLnByb2Nlc3MocGF5bWVudCk7CiAgICB9Cn0="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>import static org.mockito.Mockito.*;
import org.junit.jupiter.api.Test;

public class PaymentServiceTest {
    @Test
    public void testProcessPayment() {
        PaymentGateway mockGateway = mock(PaymentGateway.class);
        PaymentService paymentService = new PaymentService(mockGateway);
        Payment payment = new Payment();

        when(mockGateway.process(payment)).thenReturn(true);

        boolean result = paymentService.processPayment(payment);

        assertTrue(result);
        verify(mockGateway).process(payment);
    }
}</pre></div><div class='content'><p>Explanation:</p>
<ul>
<li>We create a mock <code>PaymentGateway</code> object.</li>
<li>We stub the <code>process</code> method to return <code>true</code>.</li>
<li>We verify that the <code>process</code> method was called with the expected payment object.</li>
</ul>
</div><h1>Conclusion</h1>
<div class='content'><p>Testing legacy code is a critical skill for maintaining and improving software quality. By writing characterization tests, incrementally refactoring, and using mocking frameworks, you can effectively test and refactor legacy code. These techniques will help you ensure that your code remains reliable and maintainable over time.</p>
</div><div class='row navigation'>
	<div class='col-4'>
					<a href='testing-databases'>&#x25C4;Testing Databases</a>
			</div>
	<div class='col-4 text-center'>
		<a href="./" class="title">Testing Legacy Code</a>
	</div>
	<div class='col-4 text-end'>
					<a href='project-overview'>Project Overview &#x25BA;</a>
			</div>
</div>
</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Advertising</h1>
			<p>This space is reserved for advertising.</p>
			<p>If you want to be a sponsor, contact us to include links in this area: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Thank you for collaborating!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. All rights reserved</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir galetes per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Accept</a>
    <a href="/cookies">More Information</a>
</div>	

	</div>    
</body>
</html>
