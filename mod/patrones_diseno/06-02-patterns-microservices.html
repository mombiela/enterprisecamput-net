<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Design Patterns in Microservices</title>

    <link rel="alternate" href="https://campusempresa.com/mod/patrones_diseno/06-02-patrones-microservicios" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/mod/patrones_diseno/06-02-patrons-microserveis" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/mod/patrones_diseno/06-02-patterns-microservices" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="/js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body >
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-12 col-md-8 p-2 p-md-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo-header_enterprise.png"></a>
			</h1>
		</div>
		<div class="col-12 col-md-4 p-2 p-md-0 text-end">
			<h2 id="main_title"><cite>Building today's and tomorrow's society</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-2 p-md-0 m-0 text-end">
													<b id="lit_lang_es" class="px-2">EN</b>
				|
				<a href="https://campusempresa.com/mod/patrones_diseno/06-02-patrones-microservicios" class="px-2">ES</a></b>
				|
				<a href="https://campusempresa.cat/mod/patrones_diseno/06-02-patrons-microserveis" class="px-2">CA</a>
					</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="/objective">The Project</a>
				<a href="/about">About Us</a>
				<a href="/contribute">Contribute</a>
				<a href="/donate">Donations</a>
				<a href="/licence">License</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content">
								<div class='row navigation'>
	<div class='col-2'>
					<a href='06-01-patterns-modern-architectures' title="Design Patterns in Modern Architectures">&#x25C4;Previous</a>
			</div>
	<div class='col-8 text-center'>
					<a href="./"><h2 style="text-decoration:underline">Design Patterns in Microservices</h2></a>
			</div>
	<div class='col-2 text-end'>
					<a href='06-03-patterns-distributed-systems' title="Design Patterns in Distributed Systems">Next &#x25BA;</a>
			</div>
</div>
<div class='content'><p>Microservices architecture is a style that structures an application as a collection of loosely coupled services. This approach allows for the independent deployment, scaling, and development of services. Design patterns play a crucial role in addressing common challenges and improving the efficiency and reliability of microservices.</p>
</div><h1><p>Key Concepts</p>
</h1>
<div class='content'><ol>
<li><strong>Microservices Architecture</strong>: A design approach where an application is composed of small, independent services that communicate over a network.</li>
<li><strong>Service Independence</strong>: Each microservice can be developed, deployed, and scaled independently.</li>
<li><strong>Communication</strong>: Microservices communicate with each other using lightweight protocols such as HTTP/REST or messaging queues.</li>
</ol>
</div><h1><p>Common Design Patterns in Microservices</p>
</h1>
<div class='content'></div><h2><ol>
<li>API Gateway Pattern</li>
</ol>
</h2>
<div class='content'><p><strong>Description</strong>: The API Gateway acts as a single entry point for all client requests. It routes requests to the appropriate microservice and can handle cross-cutting concerns such as authentication, logging, and rate limiting.</p>
<p><strong>Example</strong>:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("IyBFeGFtcGxlIG9mIGEgc2ltcGxlIEFQSSBHYXRld2F5IHVzaW5nIEZsYXNrIGluIFB5dGhvbgoKZnJvbSBmbGFzayBpbXBvcnQgRmxhc2ssIHJlcXVlc3QsIGpzb25pZnkKaW1wb3J0IHJlcXVlc3RzCgphcHAgPSBGbGFzayhfX25hbWVfXykKCkBhcHAucm91dGUoJy9zZXJ2aWNlMS88cGF0aDpwYXRoPicsIG1ldGhvZHM9WydHRVQnLCAnUE9TVCddKQpkZWYgc2VydmljZTFfcHJveHkocGF0aCk6CiAgICByZXNwb25zZSA9IHJlcXVlc3RzLnJlcXVlc3QoCiAgICAgICAgbWV0aG9kPXJlcXVlc3QubWV0aG9kLAogICAgICAgIHVybD1mJ2h0dHA6Ly9zZXJ2aWNlMS97cGF0aH0nLAogICAgICAgIGhlYWRlcnM9cmVxdWVzdC5oZWFkZXJzLAogICAgICAgIGRhdGE9cmVxdWVzdC5nZXRfZGF0YSgpLAogICAgICAgIGNvb2tpZXM9cmVxdWVzdC5jb29raWVzLAogICAgICAgIGFsbG93X3JlZGlyZWN0cz1GYWxzZSkKICAgIHJldHVybiAocmVzcG9uc2UuY29udGVudCwgcmVzcG9uc2Uuc3RhdHVzX2NvZGUsIHJlc3BvbnNlLmhlYWRlcnMuaXRlbXMoKSkKCkBhcHAucm91dGUoJy9zZXJ2aWNlMi88cGF0aDpwYXRoPicsIG1ldGhvZHM9WydHRVQnLCAnUE9TVCddKQpkZWYgc2VydmljZTJfcHJveHkocGF0aCk6CiAgICByZXNwb25zZSA9IHJlcXVlc3RzLnJlcXVlc3QoCiAgICAgICAgbWV0aG9kPXJlcXVlc3QubWV0aG9kLAogICAgICAgIHVybD1mJ2h0dHA6Ly9zZXJ2aWNlMi97cGF0aH0nLAogICAgICAgIGhlYWRlcnM9cmVxdWVzdC5oZWFkZXJzLAogICAgICAgIGRhdGE9cmVxdWVzdC5nZXRfZGF0YSgpLAogICAgICAgIGNvb2tpZXM9cmVxdWVzdC5jb29raWVzLAogICAgICAgIGFsbG93X3JlZGlyZWN0cz1GYWxzZSkKICAgIHJldHVybiAocmVzcG9uc2UuY29udGVudCwgcmVzcG9uc2Uuc3RhdHVzX2NvZGUsIHJlc3BvbnNlLmhlYWRlcnMuaXRlbXMoKSkKCmlmIF9fbmFtZV9fID09ICdfX21haW5fXyc6CiAgICBhcHAucnVuKHBvcnQ9NTAwMCk="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'># Example of a simple API Gateway using Flask in Python

from flask import Flask, request, jsonify
import requests

app = Flask(__name__)

@app.route('/service1/&lt;path:path&gt;', methods=['GET', 'POST'])
def service1_proxy(path):
    response = requests.request(
        method=request.method,
        url=f'http://service1/{path}',
        headers=request.headers,
        data=request.get_data(),
        cookies=request.cookies,
        allow_redirects=False)
    return (response.content, response.status_code, response.headers.items())

@app.route('/service2/&lt;path:path&gt;', methods=['GET', 'POST'])
def service2_proxy(path):
    response = requests.request(
        method=request.method,
        url=f'http://service2/{path}',
        headers=request.headers,
        data=request.get_data(),
        cookies=request.cookies,
        allow_redirects=False)
    return (response.content, response.status_code, response.headers.items())

if __name__ == '__main__':
    app.run(port=5000)</pre></div><div class='content'><p><strong>Explanation</strong>: This example demonstrates a simple API Gateway using Flask. It proxies requests to <code>service1</code> and <code>service2</code> based on the URL path.</p>
</div><h2><ol start="2">
<li>Circuit Breaker Pattern</li>
</ol>
</h2>
<div class='content'><p><strong>Description</strong>: The Circuit Breaker pattern prevents an application from repeatedly trying to execute an operation that is likely to fail. It helps to maintain the stability and resilience of the system.</p>
<p><strong>Example</strong>:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("IyBFeGFtcGxlIG9mIGEgQ2lyY3VpdCBCcmVha2VyIHVzaW5nIFB5dGhvbgoKY2xhc3MgQ2lyY3VpdEJyZWFrZXI6CiAgICBkZWYgX19pbml0X18oc2VsZiwgZmFpbHVyZV90aHJlc2hvbGQsIHJlY292ZXJ5X3RpbWVvdXQpOgogICAgICAgIHNlbGYuZmFpbHVyZV90aHJlc2hvbGQgPSBmYWlsdXJlX3RocmVzaG9sZAogICAgICAgIHNlbGYucmVjb3ZlcnlfdGltZW91dCA9IHJlY292ZXJ5X3RpbWVvdXQKICAgICAgICBzZWxmLmZhaWx1cmVfY291bnQgPSAwCiAgICAgICAgc2VsZi5sYXN0X2ZhaWx1cmVfdGltZSA9IE5vbmUKICAgICAgICBzZWxmLnN0YXRlID0gJ0NMT1NFRCcKCiAgICBkZWYgY2FsbChzZWxmLCBmdW5jLCAqYXJncywgKiprd2FyZ3MpOgogICAgICAgIGlmIHNlbGYuc3RhdGUgPT0gJ09QRU4nIGFuZCAodGltZS50aW1lKCkgLSBzZWxmLmxhc3RfZmFpbHVyZV90aW1lKSA8IHNlbGYucmVjb3ZlcnlfdGltZW91dDoKICAgICAgICAgICAgcmFpc2UgRXhjZXB0aW9uKCJDaXJjdWl0IGlzIG9wZW4iKQogICAgICAgIAogICAgICAgIHRyeToKICAgICAgICAgICAgcmVzdWx0ID0gZnVuYygqYXJncywgKiprd2FyZ3MpCiAgICAgICAgICAgIHNlbGYuZmFpbHVyZV9jb3VudCA9IDAKICAgICAgICAgICAgc2VsZi5zdGF0ZSA9ICdDTE9TRUQnCiAgICAgICAgICAgIHJldHVybiByZXN1bHQKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHNlbGYuZmFpbHVyZV9jb3VudCArPSAxCiAgICAgICAgICAgIHNlbGYubGFzdF9mYWlsdXJlX3RpbWUgPSB0aW1lLnRpbWUoKQogICAgICAgICAgICBpZiBzZWxmLmZhaWx1cmVfY291bnQgPj0gc2VsZi5mYWlsdXJlX3RocmVzaG9sZDoKICAgICAgICAgICAgICAgIHNlbGYuc3RhdGUgPSAnT1BFTicKICAgICAgICAgICAgcmFpc2UgZQoKaW1wb3J0IHRpbWUKCmRlZiB1bnJlbGlhYmxlX3NlcnZpY2UoKToKICAgIGlmIHRpbWUudGltZSgpICUgMiA8IDE6CiAgICAgICAgcmFpc2UgRXhjZXB0aW9uKCJTZXJ2aWNlIGZhaWx1cmUiKQogICAgcmV0dXJuICJTZXJ2aWNlIHN1Y2Nlc3MiCgpjaXJjdWl0X2JyZWFrZXIgPSBDaXJjdWl0QnJlYWtlcihmYWlsdXJlX3RocmVzaG9sZD0zLCByZWNvdmVyeV90aW1lb3V0PTUpCgpmb3IgXyBpbiByYW5nZSgxMCk6CiAgICB0cnk6CiAgICAgICAgcHJpbnQoY2lyY3VpdF9icmVha2VyLmNhbGwodW5yZWxpYWJsZV9zZXJ2aWNlKSkKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBwcmludChlKQogICAgdGltZS5zbGVlcCgxKQ=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'># Example of a Circuit Breaker using Python

class CircuitBreaker:
    def __init__(self, failure_threshold, recovery_timeout):
        self.failure_threshold = failure_threshold
        self.recovery_timeout = recovery_timeout
        self.failure_count = 0
        self.last_failure_time = None
        self.state = 'CLOSED'

    def call(self, func, *args, **kwargs):
        if self.state == 'OPEN' and (time.time() - self.last_failure_time) &lt; self.recovery_timeout:
            raise Exception(&quot;Circuit is open&quot;)
        
        try:
            result = func(*args, **kwargs)
            self.failure_count = 0
            self.state = 'CLOSED'
            return result
        except Exception as e:
            self.failure_count += 1
            self.last_failure_time = time.time()
            if self.failure_count &gt;= self.failure_threshold:
                self.state = 'OPEN'
            raise e

import time

def unreliable_service():
    if time.time() % 2 &lt; 1:
        raise Exception(&quot;Service failure&quot;)
    return &quot;Service success&quot;

circuit_breaker = CircuitBreaker(failure_threshold=3, recovery_timeout=5)

for _ in range(10):
    try:
        print(circuit_breaker.call(unreliable_service))
    except Exception as e:
        print(e)
    time.sleep(1)</pre></div><div class='content'><p><strong>Explanation</strong>: This example demonstrates a simple Circuit Breaker implementation in Python. The <code>CircuitBreaker</code> class tracks failures and opens the circuit if the failure threshold is exceeded, preventing further calls until the recovery timeout has passed.</p>
</div><h2><ol start="3">
<li>Service Discovery Pattern</li>
</ol>
</h2>
<div class='content'><p><strong>Description</strong>: Service Discovery allows microservices to find and communicate with each other dynamically. It can be implemented using a service registry where services register themselves and discover other services.</p>
<p><strong>Example</strong>:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("IyBFeGFtcGxlIG9mIGEgc2ltcGxlIFNlcnZpY2UgUmVnaXN0cnkgdXNpbmcgRmxhc2sgaW4gUHl0aG9uCgpmcm9tIGZsYXNrIGltcG9ydCBGbGFzaywgcmVxdWVzdCwganNvbmlmeQoKYXBwID0gRmxhc2soX19uYW1lX18pCgpzZXJ2aWNlX3JlZ2lzdHJ5ID0ge30KCkBhcHAucm91dGUoJy9yZWdpc3RlcicsIG1ldGhvZHM9WydQT1NUJ10pCmRlZiByZWdpc3Rlcl9zZXJ2aWNlKCk6CiAgICBzZXJ2aWNlX2luZm8gPSByZXF1ZXN0Lmpzb24KICAgIHNlcnZpY2VfcmVnaXN0cnlbc2VydmljZV9pbmZvWyduYW1lJ11dID0gc2VydmljZV9pbmZvWyd1cmwnXQogICAgcmV0dXJuIGpzb25pZnkoeyJtZXNzYWdlIjogIlNlcnZpY2UgcmVnaXN0ZXJlZCBzdWNjZXNzZnVsbHkifSksIDIwMQoKQGFwcC5yb3V0ZSgnL2Rpc2NvdmVyLzxzZXJ2aWNlX25hbWU+JywgbWV0aG9kcz1bJ0dFVCddKQpkZWYgZGlzY292ZXJfc2VydmljZShzZXJ2aWNlX25hbWUpOgogICAgdXJsID0gc2VydmljZV9yZWdpc3RyeS5nZXQoc2VydmljZV9uYW1lKQogICAgaWYgdXJsOgogICAgICAgIHJldHVybiBqc29uaWZ5KHsidXJsIjogdXJsfSksIDIwMAogICAgcmV0dXJuIGpzb25pZnkoeyJtZXNzYWdlIjogIlNlcnZpY2Ugbm90IGZvdW5kIn0pLCA0MDQKCmlmIF9fbmFtZV9fID09ICdfX21haW5fXyc6CiAgICBhcHAucnVuKHBvcnQ9NTAwMSk="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'># Example of a simple Service Registry using Flask in Python

from flask import Flask, request, jsonify

app = Flask(__name__)

service_registry = {}

@app.route('/register', methods=['POST'])
def register_service():
    service_info = request.json
    service_registry[service_info['name']] = service_info['url']
    return jsonify({&quot;message&quot;: &quot;Service registered successfully&quot;}), 201

@app.route('/discover/&lt;service_name&gt;', methods=['GET'])
def discover_service(service_name):
    url = service_registry.get(service_name)
    if url:
        return jsonify({&quot;url&quot;: url}), 200
    return jsonify({&quot;message&quot;: &quot;Service not found&quot;}), 404

if __name__ == '__main__':
    app.run(port=5001)</pre></div><div class='content'><p><strong>Explanation</strong>: This example demonstrates a simple Service Registry using Flask. Services can register themselves with their name and URL, and other services can discover them by querying the registry.</p>
</div><h1><p>Practical Exercises</p>
</h1>
<div class='content'></div><h2><p>Exercise 1: Implement an API Gateway</p>
</h2>
<div class='content'><p><strong>Task</strong>: Implement an API Gateway that routes requests to two different microservices. Use Flask for the implementation.</p>
<p><strong>Solution</strong>:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("IyBTb2x1dGlvbiBjb2RlIHByb3ZpZGVkIGluIHRoZSBBUEkgR2F0ZXdheSBQYXR0ZXJuIGV4YW1wbGUgYWJvdmUu"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'># Solution code provided in the API Gateway Pattern example above.</pre></div><div class='content'></div><h2><p>Exercise 2: Implement a Circuit Breaker</p>
</h2>
<div class='content'><p><strong>Task</strong>: Implement a Circuit Breaker that prevents calls to an unreliable service after a certain number of failures. Use Python for the implementation.</p>
<p><strong>Solution</strong>:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("IyBTb2x1dGlvbiBjb2RlIHByb3ZpZGVkIGluIHRoZSBDaXJjdWl0IEJyZWFrZXIgUGF0dGVybiBleGFtcGxlIGFib3ZlLg=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'># Solution code provided in the Circuit Breaker Pattern example above.</pre></div><div class='content'></div><h2><p>Exercise 3: Implement Service Discovery</p>
</h2>
<div class='content'><p><strong>Task</strong>: Implement a Service Registry where microservices can register themselves and discover other services. Use Flask for the implementation.</p>
<p><strong>Solution</strong>:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("IyBTb2x1dGlvbiBjb2RlIHByb3ZpZGVkIGluIHRoZSBTZXJ2aWNlIERpc2NvdmVyeSBQYXR0ZXJuIGV4YW1wbGUgYWJvdmUu"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'># Solution code provided in the Service Discovery Pattern example above.</pre></div><div class='content'></div><h1><p>Common Mistakes and Tips</p>
</h1>
<div class='content'><ol>
<li><strong>Overcomplicating the API Gateway</strong>: Keep the API Gateway simple and focused on routing and cross-cutting concerns. Avoid adding business logic to the gateway.</li>
<li><strong>Ignoring Circuit Breaker States</strong>: Ensure that the Circuit Breaker transitions between states (CLOSED, OPEN, HALF-OPEN) correctly based on the failure and recovery conditions.</li>
<li><strong>Service Registry Scalability</strong>: Use a distributed service registry (e.g., Consul, Eureka) for better scalability and fault tolerance in production environments.</li>
</ol>
</div><h1><p>Conclusion</p>
</h1>
<div class='content'><p>Design patterns are essential in microservices architecture to address common challenges and improve the system's reliability, scalability, and maintainability. The API Gateway, Circuit Breaker, and Service Discovery patterns are fundamental in building robust microservices. By understanding and implementing these patterns, you can create more resilient and efficient microservices-based applications.</p>
</div><div class='row navigation'>
	<div class='col-2'>
					<a href='06-01-patterns-modern-architectures' title="Design Patterns in Modern Architectures">&#x25C4;Previous</a>
			</div>
	<div class='col-8 text-center'>
			</div>
	<div class='col-2 text-end'>
					<a href='06-03-patterns-distributed-systems' title="Design Patterns in Distributed Systems">Next &#x25BA;</a>
			</div>
</div>

			</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Advertising</h1>
			<p>This space is reserved for advertising.</p>
			<p>If you want to be a sponsor, contact us to include links in this area: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Thank you for collaborating!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. All rights reserved</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir galetes per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Accept</a>
    <a href="/cookies">More Information</a>
</div>	

	</div>    
</body>
</html>
