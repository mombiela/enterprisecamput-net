<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monitoring and Performance Tuning</title>

    <link rel="alternate" href="https://campusempresa.com/mod/flask/08-04-monitoring-performance" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/mod/flask/08-04-monitoring-performance" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/mod/flask/08-04-monitoring-performance" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="/js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body >
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-12 col-md-8 p-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo-header_enterprise.png"></a>
			</h1>
		</div>
		<div class="col-12 col-md-4 px-0 py-2 py-md-0 text-end">
			<h2 id="main_title"><cite>Building today's and tomorrow's society</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 px-0 py-2 py-md-0 m-0 text-end">
													<b id="lit_lang_es" class="px-2">EN</b>
				|
				<a href="https://campusempresa.com/mod/flask/08-04-monitoring-performance" class="px-2">ES</a></b>
				|
				<a href="https://campusempresa.cat/mod/flask/08-04-monitoring-performance" class="px-2">CA</a>
					</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="/objective">The Project</a>
				<a href="/about">About Us</a>
				<a href="/contribute">Contribute</a>
				<a href="/donate">Donations</a>
				<a href="/licence">License</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content">
								<div class='row navigation'>
	<div class='col-2'>
					<a href='08-03-deploying-aws' title="Deploying to AWS">&#x25C4;Previous</a>
			</div>
	<div class='col-8 text-center'>
					<a href="./"><h2 style="text-decoration:underline">Monitoring and Performance Tuning</h2></a>
			</div>
	<div class='col-2 text-end'>
					<a href='09-01-unit-testing' title="Unit Testing with Flask">Next &#x25BA;</a>
			</div>
</div>
<div class='content'><p>In this section, we will cover the essential aspects of monitoring and performance tuning for Flask applications. Ensuring that your application runs efficiently and remains reliable in a production environment is crucial. We will explore various tools and techniques to monitor your application and optimize its performance.</p>
</div><h1>Key Concepts</h1>
<div class='content'><ol>
<li><strong>Importance of Monitoring</strong>: Understanding why monitoring is essential for maintaining application health.</li>
<li><strong>Performance Metrics</strong>: Identifying key performance metrics to monitor.</li>
<li><strong>Monitoring Tools</strong>: Exploring tools and services for monitoring Flask applications.</li>
<li><strong>Performance Tuning</strong>: Techniques to optimize the performance of your Flask application.</li>
</ol>
</div><h1>Importance of Monitoring</h1>
<div class='content'><p>Monitoring your Flask application helps you:</p>
<ul>
<li>Detect and diagnose issues before they impact users.</li>
<li>Understand application performance and usage patterns.</li>
<li>Ensure the application is running smoothly and efficiently.</li>
<li>Make informed decisions about scaling and resource allocation.</li>
</ul>
</div><h1>Performance Metrics</h1>
<div class='content'><p>Key performance metrics to monitor include:</p>
<ul>
<li><strong>Response Time</strong>: The time it takes for the server to respond to a request.</li>
<li><strong>Throughput</strong>: The number of requests the application can handle per second.</li>
<li><strong>Error Rate</strong>: The percentage of requests that result in errors.</li>
<li><strong>CPU and Memory Usage</strong>: Resource consumption of the application.</li>
<li><strong>Database Performance</strong>: Query execution times and database load.</li>
</ul>
</div><h1>Monitoring Tools</h1>
<div class='content'></div><h2>1. **Flask-MonitoringDashboard**</h2>
<div class='content'><p>Flask-MonitoringDashboard is an extension that provides an out-of-the-box monitoring dashboard for Flask applications.</p>
<p><strong>Installation:</strong></p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("cGlwIGluc3RhbGwgZmxhc2tfbW9uaXRvcmluZ2Rhc2hib2FyZA=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>pip install flask_monitoringdashboard</pre></div><div class='content'><p><strong>Usage:</strong></p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ZnJvbSBmbGFzayBpbXBvcnQgRmxhc2sKaW1wb3J0IGZsYXNrX21vbml0b3JpbmdkYXNoYm9hcmQgYXMgZGFzaGJvYXJkCgphcHAgPSBGbGFzayhfX25hbWVfXykKZGFzaGJvYXJkLmJpbmQoYXBwKQoKQGFwcC5yb3V0ZSgnLycpCmRlZiBoZWxsbygpOgogICAgcmV0dXJuICJIZWxsbywgV29ybGQhIgoKaWYgX19uYW1lX18gPT0gJ19fbWFpbl9fJzoKICAgIGFwcC5ydW4oKQ=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>from flask import Flask
import flask_monitoringdashboard as dashboard

app = Flask(__name__)
dashboard.bind(app)

@app.route('/')
def hello():
    return &quot;Hello, World!&quot;

if __name__ == '__main__':
    app.run()</pre></div><div class='content'></div><h2>2. **Prometheus and Grafana**</h2>
<div class='content'><p>Prometheus is a powerful monitoring and alerting toolkit, and Grafana is a visualization tool that works well with Prometheus.</p>
<p><strong>Setting Up Prometheus:</strong></p>
<ul>
<li>Install Prometheus and configure it to scrape metrics from your Flask application.</li>
<li>Use the <code>prometheus_flask_exporter</code> library to expose metrics.</li>
</ul>
<p><strong>Installation:</strong></p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("cGlwIGluc3RhbGwgcHJvbWV0aGV1c19mbGFza19leHBvcnRlcg=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>pip install prometheus_flask_exporter</pre></div><div class='content'><p><strong>Usage:</strong></p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ZnJvbSBmbGFzayBpbXBvcnQgRmxhc2sKZnJvbSBwcm9tZXRoZXVzX2ZsYXNrX2V4cG9ydGVyIGltcG9ydCBQcm9tZXRoZXVzTWV0cmljcwoKYXBwID0gRmxhc2soX19uYW1lX18pCm1ldHJpY3MgPSBQcm9tZXRoZXVzTWV0cmljcyhhcHApCgpAYXBwLnJvdXRlKCcvJykKZGVmIGhlbGxvKCk6CiAgICByZXR1cm4gIkhlbGxvLCBXb3JsZCEiCgppZiBfX25hbWVfXyA9PSAnX19tYWluX18nOgogICAgYXBwLnJ1bigp"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>from flask import Flask
from prometheus_flask_exporter import PrometheusMetrics

app = Flask(__name__)
metrics = PrometheusMetrics(app)

@app.route('/')
def hello():
    return &quot;Hello, World!&quot;

if __name__ == '__main__':
    app.run()</pre></div><div class='content'><p><strong>Setting Up Grafana:</strong></p>
<ul>
<li>Install Grafana and configure it to use Prometheus as a data source.</li>
<li>Create dashboards to visualize the metrics collected by Prometheus.</li>
</ul>
</div><h2>3. **New Relic**</h2>
<div class='content'><p>New Relic is a comprehensive monitoring service that provides detailed insights into application performance.</p>
<p><strong>Installation:</strong></p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("cGlwIGluc3RhbGwgbmV3cmVsaWM="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>pip install newrelic</pre></div><div class='content'><p><strong>Usage:</strong></p>
<ul>
<li>Configure New Relic with your application by adding the New Relic agent and configuration file.</li>
<li>Start your application with the New Relic agent.</li>
</ul>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("TkVXX1JFTElDX0NPTkZJR19GSUxFPW5ld3JlbGljLmluaSBuZXdyZWxpYy1hZG1pbiBydW4tcHJvZ3JhbSBweXRob24gYXBwLnB5"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>NEW_RELIC_CONFIG_FILE=newrelic.ini newrelic-admin run-program python app.py</pre></div><div class='content'></div><h1>Performance Tuning</h1>
<div class='content'></div><h2>1. **Code Optimization**</h2>
<div class='content'><ul>
<li><strong>Profiling</strong>: Use profiling tools like <code>cProfile</code> to identify bottlenecks in your code.</li>
<li><strong>Caching</strong>: Implement caching strategies to reduce redundant computations and database queries.</li>
<li><strong>Database Indexing</strong>: Ensure that your database queries are optimized with proper indexing.</li>
</ul>
</div><h2>2. **Asynchronous Processing**</h2>
<div class='content'><ul>
<li>Use asynchronous processing for tasks that do not need to be completed immediately, such as sending emails or processing large files.</li>
<li>Libraries like <code>Celery</code> can help manage background tasks.</li>
</ul>
<p><strong>Example with Celery:</strong></p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ZnJvbSBjZWxlcnkgaW1wb3J0IENlbGVyeQoKYXBwID0gRmxhc2soX19uYW1lX18pCmFwcC5jb25maWdbJ0NFTEVSWV9CUk9LRVJfVVJMJ10gPSAncmVkaXM6Ly9sb2NhbGhvc3Q6NjM3OS8wJwphcHAuY29uZmlnWydDRUxFUllfUkVTVUxUX0JBQ0tFTkQnXSA9ICdyZWRpczovL2xvY2FsaG9zdDo2Mzc5LzAnCgpjZWxlcnkgPSBDZWxlcnkoYXBwLm5hbWUsIGJyb2tlcj1hcHAuY29uZmlnWydDRUxFUllfQlJPS0VSX1VSTCddKQpjZWxlcnkuY29uZi51cGRhdGUoYXBwLmNvbmZpZykKCkBjZWxlcnkudGFzawpkZWYgYmFja2dyb3VuZF90YXNrKCk6CiAgICAjIFBlcmZvcm0gc29tZSBiYWNrZ3JvdW5kIHRhc2sKICAgIHBhc3MKCkBhcHAucm91dGUoJy9zdGFydC10YXNrJykKZGVmIHN0YXJ0X3Rhc2soKToKICAgIGJhY2tncm91bmRfdGFzay5kZWxheSgpCiAgICByZXR1cm4gIlRhc2sgc3RhcnRlZCEi"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>from celery import Celery

app = Flask(__name__)
app.config['CELERY_BROKER_URL'] = 'redis://localhost:6379/0'
app.config['CELERY_RESULT_BACKEND'] = 'redis://localhost:6379/0'

celery = Celery(app.name, broker=app.config['CELERY_BROKER_URL'])
celery.conf.update(app.config)

@celery.task
def background_task():
    # Perform some background task
    pass

@app.route('/start-task')
def start_task():
    background_task.delay()
    return &quot;Task started!&quot;</pre></div><div class='content'></div><h2>3. **Load Balancing**</h2>
<div class='content'><ul>
<li>Distribute incoming traffic across multiple instances of your application to improve performance and reliability.</li>
<li>Use load balancers like Nginx, HAProxy, or cloud-based solutions like AWS Elastic Load Balancing.</li>
</ul>
</div><h2>4. **Database Connection Pooling**</h2>
<div class='content'><ul>
<li>Use connection pooling to manage database connections efficiently.</li>
<li>Libraries like <code>SQLAlchemy</code> support connection pooling out of the box.</li>
</ul>
<p><strong>Example with SQLAlchemy:</strong></p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ZnJvbSBmbGFza19zcWxhbGNoZW15IGltcG9ydCBTUUxBbGNoZW15CgphcHAgPSBGbGFzayhfX25hbWVfXykKYXBwLmNvbmZpZ1snU1FMQUxDSEVNWV9EQVRBQkFTRV9VUkknXSA9ICdwb3N0Z3Jlc3FsOi8vdXNlcjpwYXNzd29yZEBsb2NhbGhvc3QvZGJuYW1lJwphcHAuY29uZmlnWydTUUxBTENIRU1ZX1BPT0xfU0laRSddID0gMTAKYXBwLmNvbmZpZ1snU1FMQUxDSEVNWV9NQVhfT1ZFUkZMT1cnXSA9IDIwCgpkYiA9IFNRTEFsY2hlbXkoYXBwKQ=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>from flask_sqlalchemy import SQLAlchemy

app = Flask(__name__)
app.config['SQLALCHEMY_DATABASE_URI'] = 'postgresql://user:password@localhost/dbname'
app.config['SQLALCHEMY_POOL_SIZE'] = 10
app.config['SQLALCHEMY_MAX_OVERFLOW'] = 20

db = SQLAlchemy(app)</pre></div><div class='content'></div><h1>Practical Exercise</h1>
<div class='content'></div><h2>Exercise: Implement Monitoring with Prometheus and Grafana</h2>
<div class='content'><ol>
<li>
<p><strong>Set up Prometheus and Grafana</strong>:</p>
<ul>
<li>Install Prometheus and Grafana on your local machine or server.</li>
<li>Configure Prometheus to scrape metrics from your Flask application.</li>
</ul>
</li>
<li>
<p><strong>Expose Metrics in Flask</strong>:</p>
<ul>
<li>Install the <code>prometheus_flask_exporter</code> library.</li>
<li>Modify your Flask application to expose metrics.</li>
</ul>
</li>
<li>
<p><strong>Create a Grafana Dashboard</strong>:</p>
<ul>
<li>Add Prometheus as a data source in Grafana.</li>
<li>Create a dashboard to visualize key performance metrics.</li>
</ul>
</li>
</ol>
<p><strong>Solution:</strong></p>
<ol>
<li>
<p><strong>Prometheus Configuration (<code>prometheus.yml</code>)</strong>:</p>
<pre><code class="language-yaml">global:
  scrape_interval: 15s

scrape_configs:
  - job_name: 'flask_app'
    static_configs:
      - targets: ['localhost:5000']
</code></pre>
</li>
<li>
<p><strong>Flask Application (<code>app.py</code>)</strong>:</p>
<pre><code class="language-python">from flask import Flask
from prometheus_flask_exporter import PrometheusMetrics

app = Flask(__name__)
metrics = PrometheusMetrics(app)

@app.route('/')
def hello():
    return &quot;Hello, World!&quot;

if __name__ == '__main__':
    app.run()
</code></pre>
</li>
<li>
<p><strong>Grafana Dashboard</strong>:</p>
<ul>
<li>Add Prometheus as a data source.</li>
<li>Create a new dashboard and add panels to visualize metrics like response time, throughput, and error rate.</li>
</ul>
</li>
</ol>
</div><h1>Conclusion</h1>
<div class='content'><p>In this section, we covered the importance of monitoring and performance tuning for Flask applications. We explored various tools and techniques to monitor application performance and optimize it for better efficiency. By implementing these practices, you can ensure that your Flask application runs smoothly and reliably in a production environment.</p>
</div><div class='row navigation'>
	<div class='col-2'>
					<a href='08-03-deploying-aws' title="Deploying to AWS">&#x25C4;Previous</a>
			</div>
	<div class='col-8 text-center'>
			</div>
	<div class='col-2 text-end'>
					<a href='09-01-unit-testing' title="Unit Testing with Flask">Next &#x25BA;</a>
			</div>
</div>

			</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Advertising</h1>
			<p>This space is reserved for advertising.</p>
			<p>If you want to be a sponsor, contact us to include links in this area: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Thank you for collaborating!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. All rights reserved</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir galetes per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Accept</a>
    <a href="/cookies">More Information</a>
</div>	

	</div>    
</body>
</html>
