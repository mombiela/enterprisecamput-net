<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PostgreSQL in Microservices Architecture</title>

    <link rel="alternate" href="https://campusempresa.com/mod/postgresql/10-04-postgresql-in-microservices-architecture" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/mod/postgresql/10-04-postgresql-in-microservices-architecture" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/mod/postgresql/10-04-postgresql-in-microservices-architecture" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="/js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body >
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-12 col-md-8 p-2 p-md-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo-header_enterprise.png"></a>
			</h1>
		</div>
		<div class="col-12 col-md-4 p-2 p-md-0 text-end">
			<h2 id="main_title"><cite>Building today's and tomorrow's society</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-2 p-md-0 m-0 text-end">
													<b id="lit_lang_es" class="px-2">EN</b>
				|
				<a href="https://campusempresa.com/mod/postgresql/10-04-postgresql-in-microservices-architecture" class="px-2">ES</a></b>
				|
				<a href="https://campusempresa.cat/mod/postgresql/10-04-postgresql-in-microservices-architecture" class="px-2">CA</a>
					</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="/objective">The Project</a>
				<a href="/about">About Us</a>
				<a href="/contribute">Contribute</a>
				<a href="/donate">Donations</a>
				<a href="/licence">License</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content">
								<div class='row navigation'>
	<div class='col-2'>
					<a href='10-03-handling-big-data' title="Handling Big Data">&#x25C4;Previous</a>
			</div>
	<div class='col-8 text-center'>
					<a href="./"><h2 style="text-decoration:underline">PostgreSQL in Microservices Architecture</h2></a>
			</div>
	<div class='col-2 text-end'>
			</div>
</div>
<div class='content'></div><h1><p>Introduction</p>
</h1>
<div class='content'><p>Microservices architecture is a design pattern where a large application is divided into smaller, independent services that communicate with each other. Each service is responsible for a specific business function and can be developed, deployed, and scaled independently. PostgreSQL, with its robust feature set and scalability, is an excellent choice for managing data in a microservices architecture.</p>
<p>In this section, we will cover:</p>
<ol>
<li>The role of PostgreSQL in microservices.</li>
<li>Database design considerations.</li>
<li>Data consistency and transactions.</li>
<li>Communication between services.</li>
<li>Practical examples and exercises.</li>
</ol>
</div><h1><ol>
<li>The Role of PostgreSQL in Microservices</li>
</ol>
</h1>
<div class='content'></div><h2><p>Key Concepts</p>
</h2>
<div class='content'><ul>
<li><strong>Decentralized Data Management</strong>: Each microservice manages its own database, promoting autonomy and reducing dependencies.</li>
<li><strong>Polyglot Persistence</strong>: Different microservices can use different types of databases based on their specific needs, but PostgreSQL is often chosen for its versatility and reliability.</li>
<li><strong>Scalability</strong>: PostgreSQL supports horizontal scaling, which is crucial for handling the load in a microservices architecture.</li>
</ul>
</div><h2><p>Practical Example</p>
</h2>
<div class='content'><p>Imagine an e-commerce application with the following microservices:</p>
<ul>
<li><strong>User Service</strong>: Manages user accounts and authentication.</li>
<li><strong>Product Service</strong>: Manages product listings and inventory.</li>
<li><strong>Order Service</strong>: Handles order processing and transactions.</li>
</ul>
<p>Each service has its own PostgreSQL database to store relevant data.</p>
</div><h1><ol start="2">
<li>Database Design Considerations</li>
</ol>
</h1>
<div class='content'></div><h2><p>Key Concepts</p>
</h2>
<div class='content'><ul>
<li><strong>Schema Design</strong>: Design schemas that are specific to the microservice's domain.</li>
<li><strong>Data Isolation</strong>: Ensure that each microservice's database is isolated to prevent cross-service dependencies.</li>
<li><strong>Data Duplication</strong>: Accept some level of data duplication to maintain service autonomy.</li>
</ul>
</div><h2><p>Practical Example</p>
</h2>
<div class='content'><p>For the e-commerce application:</p>
<ul>
<li><strong>User Service Database</strong>: Contains tables for users, roles, and permissions.</li>
<li><strong>Product Service Database</strong>: Contains tables for products, categories, and inventory.</li>
<li><strong>Order Service Database</strong>: Contains tables for orders, order items, and transactions.</li>
</ul>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("LS0gVXNlciBTZXJ2aWNlIERhdGFiYXNlIFNjaGVtYQpDUkVBVEUgVEFCTEUgdXNlcnMgKAogICAgdXNlcl9pZCBTRVJJQUwgUFJJTUFSWSBLRVksCiAgICB1c2VybmFtZSBWQVJDSEFSKDUwKSBVTklRVUUgTk9UIE5VTEwsCiAgICBwYXNzd29yZF9oYXNoIFZBUkNIQVIoMjU1KSBOT1QgTlVMTCwKICAgIGVtYWlsIFZBUkNIQVIoMTAwKSBVTklRVUUgTk9UIE5VTEwsCiAgICBjcmVhdGVkX2F0IFRJTUVTVEFNUCBERUZBVUxUIENVUlJFTlRfVElNRVNUQU1QCik7CgotLSBQcm9kdWN0IFNlcnZpY2UgRGF0YWJhc2UgU2NoZW1hCkNSRUFURSBUQUJMRSBwcm9kdWN0cyAoCiAgICBwcm9kdWN0X2lkIFNFUklBTCBQUklNQVJZIEtFWSwKICAgIG5hbWUgVkFSQ0hBUigxMDApIE5PVCBOVUxMLAogICAgZGVzY3JpcHRpb24gVEVYVCwKICAgIHByaWNlIE5VTUVSSUMoMTAsIDIpIE5PVCBOVUxMLAogICAgc3RvY2sgSU5UIE5PVCBOVUxMLAogICAgY3JlYXRlZF9hdCBUSU1FU1RBTVAgREVGQVVMVCBDVVJSRU5UX1RJTUVTVEFNUAopOwoKLS0gT3JkZXIgU2VydmljZSBEYXRhYmFzZSBTY2hlbWEKQ1JFQVRFIFRBQkxFIG9yZGVycyAoCiAgICBvcmRlcl9pZCBTRVJJQUwgUFJJTUFSWSBLRVksCiAgICB1c2VyX2lkIElOVCBOT1QgTlVMTCwKICAgIHRvdGFsX2Ftb3VudCBOVU1FUklDKDEwLCAyKSBOT1QgTlVMTCwKICAgIHN0YXR1cyBWQVJDSEFSKDIwKSBOT1QgTlVMTCwKICAgIGNyZWF0ZWRfYXQgVElNRVNUQU1QIERFRkFVTFQgQ1VSUkVOVF9USU1FU1RBTVAsCiAgICBGT1JFSUdOIEtFWSAodXNlcl9pZCkgUkVGRVJFTkNFUyB1c2Vycyh1c2VyX2lkKQopOw=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>-- User Service Database Schema
CREATE TABLE users (
    user_id SERIAL PRIMARY KEY,
    username VARCHAR(50) UNIQUE NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    email VARCHAR(100) UNIQUE NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Product Service Database Schema
CREATE TABLE products (
    product_id SERIAL PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    description TEXT,
    price NUMERIC(10, 2) NOT NULL,
    stock INT NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Order Service Database Schema
CREATE TABLE orders (
    order_id SERIAL PRIMARY KEY,
    user_id INT NOT NULL,
    total_amount NUMERIC(10, 2) NOT NULL,
    status VARCHAR(20) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(user_id)
);</pre></div><div class='content'></div><h1><ol start="3">
<li>Data Consistency and Transactions</li>
</ol>
</h1>
<div class='content'></div><h2><p>Key Concepts</p>
</h2>
<div class='content'><ul>
<li><strong>Eventual Consistency</strong>: In a distributed system, immediate consistency is often sacrificed for availability and partition tolerance.</li>
<li><strong>Distributed Transactions</strong>: Use distributed transactions sparingly due to their complexity and performance overhead.</li>
<li><strong>Saga Pattern</strong>: Implement the saga pattern to manage long-running transactions and ensure data consistency across services.</li>
</ul>
</div><h2><p>Practical Example</p>
</h2>
<div class='content'><p>For the e-commerce application, use the saga pattern to handle order processing:</p>
<ol>
<li><strong>Order Service</strong> creates an order.</li>
<li><strong>Inventory Service</strong> reserves the items.</li>
<li><strong>Payment Service</strong> processes the payment.</li>
<li><strong>Order Service</strong> finalizes the order.</li>
</ol>
</div><h1><ol start="4">
<li>Communication Between Services</li>
</ol>
</h1>
<div class='content'></div><h2><p>Key Concepts</p>
</h2>
<div class='content'><ul>
<li><strong>Synchronous Communication</strong>: Use REST or gRPC for real-time communication.</li>
<li><strong>Asynchronous Communication</strong>: Use message brokers like RabbitMQ or Kafka for decoupled, asynchronous communication.</li>
</ul>
</div><h2><p>Practical Example</p>
</h2>
<div class='content'><p>For the e-commerce application:</p>
<ul>
<li><strong>REST API</strong>: User Service exposes endpoints for user management.</li>
<li><strong>Message Broker</strong>: Order Service publishes an event when an order is created, and Inventory Service subscribes to this event to reserve items.</li>
</ul>
</div><h1><ol start="5">
<li>Practical Examples and Exercises</li>
</ol>
</h1>
<div class='content'></div><h2><p>Example: Implementing a REST API with PostgreSQL</p>
</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("IyBGbGFzayBhcHBsaWNhdGlvbiBmb3IgVXNlciBTZXJ2aWNlCmZyb20gZmxhc2sgaW1wb3J0IEZsYXNrLCByZXF1ZXN0LCBqc29uaWZ5CmltcG9ydCBwc3ljb3BnMgoKYXBwID0gRmxhc2soX19uYW1lX18pCgojIERhdGFiYXNlIGNvbm5lY3Rpb24KY29ubiA9IHBzeWNvcGcyLmNvbm5lY3QoCiAgICBkYm5hbWU9InVzZXJfc2VydmljZV9kYiIsCiAgICB1c2VyPSJ5b3VydXNlcm5hbWUiLAogICAgcGFzc3dvcmQ9InlvdXJwYXNzd29yZCIsCiAgICBob3N0PSJsb2NhbGhvc3QiCikKCkBhcHAucm91dGUoJy91c2VycycsIG1ldGhvZHM9WydQT1NUJ10pCmRlZiBjcmVhdGVfdXNlcigpOgogICAgZGF0YSA9IHJlcXVlc3QuZ2V0X2pzb24oKQogICAgdXNlcm5hbWUgPSBkYXRhWyd1c2VybmFtZSddCiAgICBwYXNzd29yZF9oYXNoID0gZGF0YVsncGFzc3dvcmRfaGFzaCddCiAgICBlbWFpbCA9IGRhdGFbJ2VtYWlsJ10KICAgIAogICAgY3VyID0gY29ubi5jdXJzb3IoKQogICAgY3VyLmV4ZWN1dGUoIklOU0VSVCBJTlRPIHVzZXJzICh1c2VybmFtZSwgcGFzc3dvcmRfaGFzaCwgZW1haWwpIFZBTFVFUyAoJXMsICVzLCAlcykgUkVUVVJOSU5HIHVzZXJfaWQiLCAKICAgICAgICAgICAgICAgICh1c2VybmFtZSwgcGFzc3dvcmRfaGFzaCwgZW1haWwpKQogICAgdXNlcl9pZCA9IGN1ci5mZXRjaG9uZSgpWzBdCiAgICBjb25uLmNvbW1pdCgpCiAgICBjdXIuY2xvc2UoKQogICAgCiAgICByZXR1cm4ganNvbmlmeSh7InVzZXJfaWQiOiB1c2VyX2lkfSksIDIwMQoKaWYgX19uYW1lX18gPT0gJ19fbWFpbl9fJzoKICAgIGFwcC5ydW4oZGVidWc9VHJ1ZSk="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'># Flask application for User Service
from flask import Flask, request, jsonify
import psycopg2

app = Flask(__name__)

# Database connection
conn = psycopg2.connect(
    dbname=&quot;user_service_db&quot;,
    user=&quot;yourusername&quot;,
    password=&quot;yourpassword&quot;,
    host=&quot;localhost&quot;
)

@app.route('/users', methods=['POST'])
def create_user():
    data = request.get_json()
    username = data['username']
    password_hash = data['password_hash']
    email = data['email']
    
    cur = conn.cursor()
    cur.execute(&quot;INSERT INTO users (username, password_hash, email) VALUES (%s, %s, %s) RETURNING user_id&quot;, 
                (username, password_hash, email))
    user_id = cur.fetchone()[0]
    conn.commit()
    cur.close()
    
    return jsonify({&quot;user_id&quot;: user_id}), 201

if __name__ == '__main__':
    app.run(debug=True)</pre></div><div class='content'></div><h2><p>Exercise: Implementing a Message Broker</p>
</h2>
<div class='content'><ol>
<li>Set up RabbitMQ or Kafka.</li>
<li>Modify the Order Service to publish an event when an order is created.</li>
<li>Modify the Inventory Service to subscribe to the order created event and reserve items.</li>
</ol>
</div><h2><p>Solution Outline</p>
</h2>
<div class='content'><ul>
<li><strong>Order Service</strong>: Publish an event to RabbitMQ when an order is created.</li>
<li><strong>Inventory Service</strong>: Subscribe to the RabbitMQ queue and handle the event to reserve items.</li>
</ul>
</div><h1><p>Conclusion</p>
</h1>
<div class='content'><p>In this section, we explored how PostgreSQL can be effectively used in a microservices architecture. We covered the role of PostgreSQL, database design considerations, data consistency, and communication between services. By following these principles and examples, you can design and implement robust, scalable microservices with PostgreSQL.</p>
<p>Next, we will delve into case studies and real-world applications to see how these concepts are applied in practice.</p>
</div><div class='row navigation'>
	<div class='col-2'>
					<a href='10-03-handling-big-data' title="Handling Big Data">&#x25C4;Previous</a>
			</div>
	<div class='col-8 text-center'>
			</div>
	<div class='col-2 text-end'>
			</div>
</div>

			</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Advertising</h1>
			<p>This space is reserved for advertising.</p>
			<p>If you want to be a sponsor, contact us to include links in this area: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Thank you for collaborating!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. All rights reserved</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	We use cookies to improve your user experience and offer content tailored to your interests.
    <a href="#" id="btn_accept_cookies" class="button">Accept</a>
    <a href="/cookies">More Information</a>
</div>	

	</div>    
</body>
</html>
