<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stored Procedures and Triggers</title>

    <link rel="alternate" href="https://campusempresa.com/mod/postgresql/stored-procedures-and-triggers" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/mod/postgresql/stored-procedures-and-triggers" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/mod/postgresql/stored-procedures-and-triggers" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body>
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-8 p-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo_header.png" style="visibility:hiddenxx;"></a>
			</h1>
		</div>
		<div class="col-4 p-0 text-end">
			<h2 id="main_title"><cite>Building today's and tomorrow's society</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-0 m-0 text-end">
													<b id="lit_lang_es" class="px-2">EN</b>
				|
				<a href="https://campusempresa.com/mod/postgresql/stored-procedures-and-triggers" class="px-2">ES</a></b>
				|
				<a href="https://campusempresa.cat/mod/postgresql/stored-procedures-and-triggers" class="px-2">CA</a>
					</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="/objective">The Project</a>
				<a href="/about">About Us</a>
				<a href="/contribute">Contribute</a>
				<a href="/donate">Donations</a>
				<a href="/licence">License</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content"><div class='row navigation'>
	<div class='col-4'>
					<a href='views-and-materialized-views'>&#x25C4;Views and Materialized Views</a>
			</div>
	<div class='col-4 text-center'>
		<a href="./" class="title">Stored Procedures and Triggers</a>
	</div>
	<div class='col-4 text-end'>
					<a href='partitioning-tables'>Partitioning Tables &#x25BA;</a>
			</div>
</div>
<div class='content'></div><h1>Introduction</h1>
<div class='content'><p>Stored procedures and triggers are essential components in PostgreSQL that allow you to automate and encapsulate business logic at the database level. This section will guide you from the basics to advanced usage of stored procedures and triggers.</p>
</div><h1>Stored Procedures</h1>
<div class='content'></div><h2>What are Stored Procedures?</h2>
<div class='content'><ul>
<li>Stored procedures are a set of SQL statements that can be stored in the database and executed as a single unit.</li>
<li>They help in encapsulating complex business logic, improving performance, and ensuring code reusability.</li>
</ul>
</div><h2>Creating a Simple Stored Procedure</h2>
<div class='content'><p>To create a stored procedure in PostgreSQL, you use the <code>CREATE PROCEDURE</code> statement.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Q1JFQVRFIFBST0NFRFVSRSBhZGRfbnVtYmVycyhJTiBudW0xIElOVCwgSU4gbnVtMiBJTlQsIE9VVCBzdW0gSU5UKQpMQU5HVUFHRSBwbHBnc3FsCkFTICQkCkJFR0lOCiAgICBzdW0gOj0gbnVtMSArIG51bTI7CkVORDsKJCQ7"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>CREATE PROCEDURE add_numbers(IN num1 INT, IN num2 INT, OUT sum INT)
LANGUAGE plpgsql
AS $$
BEGIN
    sum := num1 + num2;
END;
$$;</pre></div><div class='content'><ul>
<li><code>IN</code> parameters are inputs to the procedure.</li>
<li><code>OUT</code> parameters are outputs from the procedure.</li>
<li><code>LANGUAGE plpgsql</code> specifies that the procedure is written in PL/pgSQL.</li>
</ul>
</div><h2>Executing a Stored Procedure</h2>
<div class='content'><p>To execute a stored procedure, you use the <code>CALL</code> statement.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Q0FMTCBhZGRfbnVtYmVycyg1LCAxMCwgc3VtKTs="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>CALL add_numbers(5, 10, sum);</pre></div><div class='content'></div><h2>Advantages of Stored Procedures</h2>
<div class='content'><ul>
<li><strong>Performance</strong>: Reduced client-server communication.</li>
<li><strong>Security</strong>: Encapsulation of business logic.</li>
<li><strong>Maintainability</strong>: Centralized code management.</li>
</ul>
</div><h2>Advanced Stored Procedures</h2>
<div class='content'><p>Stored procedures can also include control structures like loops and conditional statements.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Q1JFQVRFIFBST0NFRFVSRSBjYWxjdWxhdGVfZmFjdG9yaWFsKElOIG51bSBJTlQsIE9VVCByZXN1bHQgSU5UKQpMQU5HVUFHRSBwbHBnc3FsCkFTICQkCkRFQ0xBUkUKICAgIGkgSU5UIDo9IDE7CkJFR0lOCiAgICByZXN1bHQgOj0gMTsKICAgIFdISUxFIGkgPD0gbnVtIExPT1AKICAgICAgICByZXN1bHQgOj0gcmVzdWx0ICogaTsKICAgICAgICBpIDo9IGkgKyAxOwogICAgRU5EIExPT1A7CkVORDsKJCQ7"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>CREATE PROCEDURE calculate_factorial(IN num INT, OUT result INT)
LANGUAGE plpgsql
AS $$
DECLARE
    i INT := 1;
BEGIN
    result := 1;
    WHILE i &lt;= num LOOP
        result := result * i;
        i := i + 1;
    END LOOP;
END;
$$;</pre></div><div class='content'></div><h1>Triggers</h1>
<div class='content'></div><h2>What are Triggers?</h2>
<div class='content'><ul>
<li>Triggers are special types of stored procedures that automatically execute or &quot;fire&quot; when certain events occur in the database.</li>
<li>Events can be <code>INSERT</code>, <code>UPDATE</code>, or <code>DELETE</code>.</li>
</ul>
</div><h2>Creating a Simple Trigger</h2>
<div class='content'><p>To create a trigger, you need to define a trigger function and then bind it to a table event.</p>
<h4>Step 1: Create a Trigger Function</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Q1JFQVRFIEZVTkNUSU9OIGxvZ19jaGFuZ2VzKCkgUkVUVVJOUyB0cmlnZ2VyIEFTICQkCkJFR0lOCiAgICBJRiBUR19PUCA9ICdJTlNFUlQnIFRIRU4KICAgICAgICBJTlNFUlQgSU5UTyBhdWRpdF9sb2codGFibGVfbmFtZSwgb3BlcmF0aW9uLCBuZXdfZGF0YSkKICAgICAgICBWQUxVRVMgKFRHX1RBQkxFX05BTUUsIFRHX09QLCByb3dfdG9fanNvbihORVcpKTsKICAgIEVMU0lGIFRHX09QID0gJ1VQREFURScgVEhFTgogICAgICAgIElOU0VSVCBJTlRPIGF1ZGl0X2xvZyh0YWJsZV9uYW1lLCBvcGVyYXRpb24sIG9sZF9kYXRhLCBuZXdfZGF0YSkKICAgICAgICBWQUxVRVMgKFRHX1RBQkxFX05BTUUsIFRHX09QLCByb3dfdG9fanNvbihPTEQpLCByb3dfdG9fanNvbihORVcpKTsKICAgIEVMU0lGIFRHX09QID0gJ0RFTEVURScgVEhFTgogICAgICAgIElOU0VSVCBJTlRPIGF1ZGl0X2xvZyh0YWJsZV9uYW1lLCBvcGVyYXRpb24sIG9sZF9kYXRhKQogICAgICAgIFZBTFVFUyAoVEdfVEFCTEVfTkFNRSwgVEdfT1AsIHJvd190b19qc29uKE9MRCkpOwogICAgRU5EIElGOwogICAgUkVUVVJOIE5FVzsKRU5EOwokJCBMQU5HVUFHRSBwbHBnc3FsOw=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>CREATE FUNCTION log_changes() RETURNS trigger AS $$
BEGIN
    IF TG_OP = 'INSERT' THEN
        INSERT INTO audit_log(table_name, operation, new_data)
        VALUES (TG_TABLE_NAME, TG_OP, row_to_json(NEW));
    ELSIF TG_OP = 'UPDATE' THEN
        INSERT INTO audit_log(table_name, operation, old_data, new_data)
        VALUES (TG_TABLE_NAME, TG_OP, row_to_json(OLD), row_to_json(NEW));
    ELSIF TG_OP = 'DELETE' THEN
        INSERT INTO audit_log(table_name, operation, old_data)
        VALUES (TG_TABLE_NAME, TG_OP, row_to_json(OLD));
    END IF;
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;</pre></div><div class='content'><h4>Step 2: Bind the Trigger Function to a Table Event</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Q1JFQVRFIFRSSUdHRVIgYXVkaXRfdHJpZ2dlcgpBRlRFUiBJTlNFUlQgT1IgVVBEQVRFIE9SIERFTEVURSBPTiB5b3VyX3RhYmxlCkZPUiBFQUNIIFJPVyBFWEVDVVRFIEZVTkNUSU9OIGxvZ19jaGFuZ2VzKCk7"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>CREATE TRIGGER audit_trigger
AFTER INSERT OR UPDATE OR DELETE ON your_table
FOR EACH ROW EXECUTE FUNCTION log_changes();</pre></div><div class='content'></div><h2>Advantages of Triggers</h2>
<div class='content'><ul>
<li><strong>Automation</strong>: Automatically enforce business rules.</li>
<li><strong>Consistency</strong>: Ensure data integrity.</li>
<li><strong>Auditability</strong>: Track changes to data.</li>
</ul>
</div><h2>Advanced Triggers</h2>
<div class='content'><p>Triggers can be used for complex operations like cascading updates or maintaining summary tables.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Q1JFQVRFIEZVTkNUSU9OIHVwZGF0ZV9zdW1tYXJ5KCkgUkVUVVJOUyB0cmlnZ2VyIEFTICQkCkJFR0lOCiAgICBVUERBVEUgc3VtbWFyeV90YWJsZQogICAgU0VUIHRvdGFsID0gdG90YWwgKyBORVcuYW1vdW50CiAgICBXSEVSRSBpZCA9IE5FVy5pZDsKICAgIFJFVFVSTiBORVc7CkVORDsKJCQgTEFOR1VBR0UgcGxwZ3NxbDsKCkNSRUFURSBUUklHR0VSIHVwZGF0ZV9zdW1tYXJ5X3RyaWdnZXIKQUZURVIgSU5TRVJUIE9OIHRyYW5zYWN0aW9ucwpGT1IgRUFDSCBST1cgRVhFQ1VURSBGVU5DVElPTiB1cGRhdGVfc3VtbWFyeSgpOw=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>CREATE FUNCTION update_summary() RETURNS trigger AS $$
BEGIN
    UPDATE summary_table
    SET total = total + NEW.amount
    WHERE id = NEW.id;
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER update_summary_trigger
AFTER INSERT ON transactions
FOR EACH ROW EXECUTE FUNCTION update_summary();</pre></div><div class='content'></div><h1>Conclusion</h1>
<div class='content'><p>Stored procedures and triggers are powerful tools in PostgreSQL that help automate and encapsulate complex business logic. They improve performance, security, and maintainability of your database applications. By mastering these tools, you can create more efficient and robust database systems.</p>
</div><div class='row navigation'>
	<div class='col-4'>
					<a href='views-and-materialized-views'>&#x25C4;Views and Materialized Views</a>
			</div>
	<div class='col-4 text-center'>
		<a href="./" class="title">Stored Procedures and Triggers</a>
	</div>
	<div class='col-4 text-end'>
					<a href='partitioning-tables'>Partitioning Tables &#x25BA;</a>
			</div>
</div>
</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Advertising</h1>
			<p>This space is reserved for advertising.</p>
			<p>If you want to be a sponsor, contact us to include links in this area: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Thank you for collaborating!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. All rights reserved</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir galetes per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Accept</a>
    <a href="/cookies">More Information</a>
</div>	

	</div>    
</body>
</html>
