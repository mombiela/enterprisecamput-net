<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stored Procedures and Functions</title>

    <link rel="alternate" href="https://campusempresa.com/mod/postgresql/05-03-stored-procedures-and-functions" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/mod/postgresql/05-03-stored-procedures-and-functions" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/mod/postgresql/05-03-stored-procedures-and-functions" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="/js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body >
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-12 col-md-8 p-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo-header_enterprise.png"></a>
			</h1>
		</div>
		<div class="col-12 col-md-4 px-0 py-2 py-md-0 text-end">
			<h2 id="main_title"><cite>Building today's and tomorrow's society</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 px-0 py-2 py-md-0 m-0 text-end">
													<b id="lit_lang_es" class="px-2">EN</b>
				|
				<a href="https://campusempresa.com/mod/postgresql/05-03-stored-procedures-and-functions" class="px-2">ES</a></b>
				|
				<a href="https://campusempresa.cat/mod/postgresql/05-03-stored-procedures-and-functions" class="px-2">CA</a>
					</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="/objective">The Project</a>
				<a href="/about">About Us</a>
				<a href="/contribute">Contribute</a>
				<a href="/donate">Donations</a>
				<a href="/licence">License</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content">
								<div class='row navigation'>
	<div class='col-2'>
					<a href='05-02-triggers' title="Triggers">&#x25C4;Previous</a>
			</div>
	<div class='col-8 text-center'>
					<a href="./"><h2 style="text-decoration:underline">Stored Procedures and Functions</h2></a>
			</div>
	<div class='col-2 text-end'>
					<a href='05-04-transactions-and-concurrency' title="Transactions and Concurrency">Next &#x25BA;</a>
			</div>
</div>
<div class='content'><p>Stored procedures and functions are essential components in PostgreSQL that allow you to encapsulate complex logic within the database. They help in improving performance, maintaining consistency, and reusing code. This section will cover the basics of creating and using stored procedures and functions in PostgreSQL.</p>
</div><h1>Key Concepts</h1>
<div class='content'><ol>
<li>
<p><strong>Stored Procedures</strong>:</p>
<ul>
<li>A stored procedure is a set of SQL statements that can be executed as a single unit.</li>
<li>They can perform operations such as data manipulation, control flow, and error handling.</li>
<li>Stored procedures do not return a value.</li>
</ul>
</li>
<li>
<p><strong>Functions</strong>:</p>
<ul>
<li>Functions are similar to stored procedures but are designed to return a value.</li>
<li>They can be used in SQL queries, allowing for more flexible and reusable code.</li>
</ul>
</li>
</ol>
</div><h1>Creating Stored Procedures</h1>
<div class='content'></div><h2>Syntax</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Q1JFQVRFIFBST0NFRFVSRSBwcm9jZWR1cmVfbmFtZSAocGFyYW1ldGVyX2xpc3QpCkxBTkdVQUdFIHBscGdzcWwKQVMgJCQKQkVHSU4KICAgIC0tIFByb2NlZHVyZSBsb2dpYyBoZXJlCkVORDsKJCQ7"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>CREATE PROCEDURE procedure_name (parameter_list)
LANGUAGE plpgsql
AS $$
BEGIN
    -- Procedure logic here
END;
$$;</pre></div><div class='content'></div><h2>Example</h2>
<div class='content'><p>Let's create a stored procedure that inserts a new record into a table called <code>employees</code>.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Q1JFQVRFIFBST0NFRFVSRSBhZGRfZW1wbG95ZWUoCiAgICBlbXBfbmFtZSBWQVJDSEFSLAogICAgZW1wX3Bvc2l0aW9uIFZBUkNIQVIsCiAgICBlbXBfc2FsYXJ5IE5VTUVSSUMKKQpMQU5HVUFHRSBwbHBnc3FsCkFTICQkCkJFR0lOCiAgICBJTlNFUlQgSU5UTyBlbXBsb3llZXMgKG5hbWUsIHBvc2l0aW9uLCBzYWxhcnkpCiAgICBWQUxVRVMgKGVtcF9uYW1lLCBlbXBfcG9zaXRpb24sIGVtcF9zYWxhcnkpOwpFTkQ7CiQkOw=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>CREATE PROCEDURE add_employee(
    emp_name VARCHAR,
    emp_position VARCHAR,
    emp_salary NUMERIC
)
LANGUAGE plpgsql
AS $$
BEGIN
    INSERT INTO employees (name, position, salary)
    VALUES (emp_name, emp_position, emp_salary);
END;
$$;</pre></div><div class='content'></div><h2>Executing Stored Procedures</h2>
<div class='content'><p>To execute a stored procedure, use the <code>CALL</code> statement.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Q0FMTCBhZGRfZW1wbG95ZWUoJ0pvaG4gRG9lJywgJ1NvZnR3YXJlIEVuZ2luZWVyJywgNzUwMDApOw=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>CALL add_employee('John Doe', 'Software Engineer', 75000);</pre></div><div class='content'></div><h1>Creating Functions</h1>
<div class='content'></div><h2>Syntax</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Q1JFQVRFIEZVTkNUSU9OIGZ1bmN0aW9uX25hbWUgKHBhcmFtZXRlcl9saXN0KQpSRVRVUk5TIHJldHVybl90eXBlCkxBTkdVQUdFIHBscGdzcWwKQVMgJCQKQkVHSU4KICAgIC0tIEZ1bmN0aW9uIGxvZ2ljIGhlcmUKICAgIFJFVFVSTiBzb21lX3ZhbHVlOwpFTkQ7CiQkOw=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>CREATE FUNCTION function_name (parameter_list)
RETURNS return_type
LANGUAGE plpgsql
AS $$
BEGIN
    -- Function logic here
    RETURN some_value;
END;
$$;</pre></div><div class='content'></div><h2>Example</h2>
<div class='content'><p>Let's create a function that calculates the annual salary of an employee based on their monthly salary.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Q1JFQVRFIEZVTkNUSU9OIGNhbGN1bGF0ZV9hbm51YWxfc2FsYXJ5KG1vbnRobHlfc2FsYXJ5IE5VTUVSSUMpClJFVFVSTlMgTlVNRVJJQwpMQU5HVUFHRSBwbHBnc3FsCkFTICQkCkJFR0lOCiAgICBSRVRVUk4gbW9udGhseV9zYWxhcnkgKiAxMjsKRU5EOwokJDs="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>CREATE FUNCTION calculate_annual_salary(monthly_salary NUMERIC)
RETURNS NUMERIC
LANGUAGE plpgsql
AS $$
BEGIN
    RETURN monthly_salary * 12;
END;
$$;</pre></div><div class='content'></div><h2>Using Functions</h2>
<div class='content'><p>Functions can be used in SQL queries. For example:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("U0VMRUNUIGNhbGN1bGF0ZV9hbm51YWxfc2FsYXJ5KDUwMDApOw=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>SELECT calculate_annual_salary(5000);</pre></div><div class='content'></div><h1>Practical Exercises</h1>
<div class='content'></div><h2>Exercise 1: Create a Stored Procedure</h2>
<div class='content'><p><strong>Task</strong>: Create a stored procedure named <code>update_employee_salary</code> that updates the salary of an employee based on their ID.</p>
<p><strong>Solution</strong>:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Q1JFQVRFIFBST0NFRFVSRSB1cGRhdGVfZW1wbG95ZWVfc2FsYXJ5KAogICAgZW1wX2lkIElOVCwKICAgIG5ld19zYWxhcnkgTlVNRVJJQwopCkxBTkdVQUdFIHBscGdzcWwKQVMgJCQKQkVHSU4KICAgIFVQREFURSBlbXBsb3llZXMKICAgIFNFVCBzYWxhcnkgPSBuZXdfc2FsYXJ5CiAgICBXSEVSRSBpZCA9IGVtcF9pZDsKRU5EOwokJDs="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>CREATE PROCEDURE update_employee_salary(
    emp_id INT,
    new_salary NUMERIC
)
LANGUAGE plpgsql
AS $$
BEGIN
    UPDATE employees
    SET salary = new_salary
    WHERE id = emp_id;
END;
$$;</pre></div><div class='content'><p><strong>Execution</strong>:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Q0FMTCB1cGRhdGVfZW1wbG95ZWVfc2FsYXJ5KDEsIDgwMDAwKTs="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>CALL update_employee_salary(1, 80000);</pre></div><div class='content'></div><h2>Exercise 2: Create a Function</h2>
<div class='content'><p><strong>Task</strong>: Create a function named <code>get_employee_position</code> that returns the position of an employee based on their ID.</p>
<p><strong>Solution</strong>:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Q1JFQVRFIEZVTkNUSU9OIGdldF9lbXBsb3llZV9wb3NpdGlvbihlbXBfaWQgSU5UKQpSRVRVUk5TIFZBUkNIQVIKTEFOR1VBR0UgcGxwZ3NxbApBUyAkJApERUNMQVJFCiAgICBlbXBfcG9zaXRpb24gVkFSQ0hBUjsKQkVHSU4KICAgIFNFTEVDVCBwb3NpdGlvbiBJTlRPIGVtcF9wb3NpdGlvbgogICAgRlJPTSBlbXBsb3llZXMKICAgIFdIRVJFIGlkID0gZW1wX2lkOwogICAgCiAgICBSRVRVUk4gZW1wX3Bvc2l0aW9uOwpFTkQ7CiQkOw=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>CREATE FUNCTION get_employee_position(emp_id INT)
RETURNS VARCHAR
LANGUAGE plpgsql
AS $$
DECLARE
    emp_position VARCHAR;
BEGIN
    SELECT position INTO emp_position
    FROM employees
    WHERE id = emp_id;
    
    RETURN emp_position;
END;
$$;</pre></div><div class='content'><p><strong>Usage</strong>:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("U0VMRUNUIGdldF9lbXBsb3llZV9wb3NpdGlvbigxKTs="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>SELECT get_employee_position(1);</pre></div><div class='content'></div><h1>Common Mistakes and Tips</h1>
<div class='content'><ul>
<li><strong>Syntax Errors</strong>: Ensure that the syntax is correct, especially the use of <code>$$</code> to delimit the procedure or function body.</li>
<li><strong>Parameter Types</strong>: Make sure the parameter types match the data types in the table.</li>
<li><strong>Error Handling</strong>: Consider adding error handling within your procedures and functions to manage exceptions gracefully.</li>
<li><strong>Testing</strong>: Always test your stored procedures and functions with different inputs to ensure they work as expected.</li>
</ul>
</div><h1>Conclusion</h1>
<div class='content'><p>In this section, you learned how to create and use stored procedures and functions in PostgreSQL. These tools are powerful for encapsulating complex logic, improving performance, and maintaining consistency in your database operations. Practice creating and using stored procedures and functions to become proficient in managing database logic within PostgreSQL.</p>
</div><div class='row navigation'>
	<div class='col-2'>
					<a href='05-02-triggers' title="Triggers">&#x25C4;Previous</a>
			</div>
	<div class='col-8 text-center'>
			</div>
	<div class='col-2 text-end'>
					<a href='05-04-transactions-and-concurrency' title="Transactions and Concurrency">Next &#x25BA;</a>
			</div>
</div>

			</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Advertising</h1>
			<p>This space is reserved for advertising.</p>
			<p>If you want to be a sponsor, contact us to include links in this area: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Thank you for collaborating!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. All rights reserved</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir galetes per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Accept</a>
    <a href="/cookies">More Information</a>
</div>	

	</div>    
</body>
</html>
