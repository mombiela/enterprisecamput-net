<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow, noarchive">
    <title>Interfacing with C</title>

    <link rel="alternate" href="https://campusempresa.com/mod/fortran/07-04-interfacing-with-c" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/mod/fortran/07-04-interfacing-with-c" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/mod/fortran/07-04-interfacing-with-c" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css?v=3" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="/js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
	<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-0611338592562725" crossorigin="anonymous"></script>  	
	</head>

<body >
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-12 col-md-6 p-2 p-md-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo-header_enterprise.png"></a>
			</h1>
		</div>
		<div class="col-12 col-md-6 p-2 p-md-0 text-end">
			<span>	<b id="lit_lang_es" class="px-2">EN</b>
	|
	<a href="https://campusempresa.com/mod/fortran/07-04-interfacing-with-c" class="px-2">ES</a></b>
	|
	<a href="https://campusempresa.cat/mod/fortran/07-04-interfacing-with-c" class="px-2">CA</a>
</span>
			<span class="d-none d-md-inline"><br><cite>Building today's and tomorrow's society</cite></span>
		</div>
	</div>
</div>
<div class="subheader container-xxl d-none d-md-block">
	<div class="row">
		<div class="col-12 p-2 p-md-0 m-0 text-end">
			<a href="/objective">The Project</a> | 
<a href="/about">About Us</a> | 
<a href="/contribute">Contribute</a> | 
<a href="/donate">Donations</a> | 
<a href="/licence">License</a>
		</div>
	</div>
</div>

<div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				 					<a href="/categ/languages">Languages</a>
				 					<a href="/categ/frameworks">Frameworks</a>
				 					<a href="/categ/tech-tools">Tools</a>
				 					<a href="/categ/foundations">Foundations</a>
				 					<a href="/categ/soft-skills">Skills</a>
							</div>
		</div>
	</div>
</div>
		
<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content">
				<div class='row navigation'>
	<div class='col-1 col-md-2'>
					<a href='07-03-parallel-programming-coarrays' title="Parallel Programming with Coarrays">
				<span class="d-none d-md-inline">&#x25C4; Previous</span>
				<span class="d-inline d-md-none"><i class="bi bi-caret-left-square-fill"></i></span>
			</a>
			</div>
	<div class='col-10 col-md-8 text-center'>
					<a href="./"><h2 style="text-decoration:underline">Interfacing with C</h2></a>
			</div>
	<div class='col-1 col-md-2 text-end'>
					<a href='08-01-code-optimization-techniques' title="Code Optimization Techniques">
				<span class="d-none d-md-inline">Next &#x25BA;</span>
				<span class="d-inline d-md-none"><i class="bi bi-caret-right-square-fill"></i></span>
			</a>
			</div>
</div>
<div class='content'><p>Interfacing Fortran with C can be highly beneficial, as it allows you to leverage the strengths of both languages. Fortran is known for its performance in numerical computations, while C provides more control over system-level programming. This section will guide you through the process of calling C functions from Fortran and vice versa.</p>
</div><h1><p>Key Concepts</p>
</h1>
<div class='content'><ol>
<li><strong>Interoperability</strong>: Understanding how Fortran and C can work together.</li>
<li><strong>ISO_C_BINDING Module</strong>: Using the Fortran module that facilitates interoperability with C.</li>
<li><strong>Calling C Functions from Fortran</strong>: Steps and examples.</li>
<li><strong>Calling Fortran Functions from C</strong>: Steps and examples.</li>
<li><strong>Data Type Mapping</strong>: Ensuring compatibility between Fortran and C data types.</li>
</ol>
</div><h1><p>ISO_C_BINDING Module</p>
</h1>
<div class='content'><p>The <code>ISO_C_BINDING</code> module in Fortran provides the necessary tools to interface with C. It includes constants and derived types that map Fortran types to C types.</p>
</div><h2><p>Example</p>
</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("cHJvZ3JhbSBjX2ludGVyb3BfZXhhbXBsZQogIHVzZSBpc29fY19iaW5kaW5nCiAgaW1wbGljaXQgbm9uZQoKICBpbnRlcmZhY2UKICAgIHN1YnJvdXRpbmUgY19mdW5jdGlvbih4KSBiaW5kKEMsIG5hbWU9ImNfZnVuY3Rpb24iKQogICAgICB1c2UgaXNvX2NfYmluZGluZwogICAgICByZWFsKGNfZG91YmxlKSwgdmFsdWUgOjogeAogICAgZW5kIHN1YnJvdXRpbmUgY19mdW5jdGlvbgogIGVuZCBpbnRlcmZhY2UKCiAgcmVhbChjX2RvdWJsZSkgOjogeCA9IDMuMTQKCiAgY2FsbCBjX2Z1bmN0aW9uKHgpCgplbmQgcHJvZ3JhbSBjX2ludGVyb3BfZXhhbXBsZQ=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>program c_interop_example
  use iso_c_binding
  implicit none

  interface
    subroutine c_function(x) bind(C, name=&quot;c_function&quot;)
      use iso_c_binding
      real(c_double), value :: x
    end subroutine c_function
  end interface

  real(c_double) :: x = 3.14

  call c_function(x)

end program c_interop_example</pre></div><div class='content'><p>In this example:</p>
<ul>
<li>The <code>use iso_c_binding</code> statement imports the module.</li>
<li>The <code>interface</code> block declares the C function <code>c_function</code> with the <code>bind(C, name=&quot;c_function&quot;)</code> attribute, indicating that it is a C function.</li>
<li>The <code>real(c_double)</code> type ensures that the Fortran variable <code>x</code> is compatible with the C <code>double</code> type.</li>
</ul>
</div><h1><p>Calling C Functions from Fortran</p>
</h1>
<div class='content'></div><h2><p>Steps</p>
</h2>
<div class='content'><ol>
<li><strong>Declare the C Function</strong>: Use the <code>interface</code> block with the <code>bind(C)</code> attribute.</li>
<li><strong>Ensure Data Type Compatibility</strong>: Use <code>ISO_C_BINDING</code> to map Fortran types to C types.</li>
<li><strong>Call the Function</strong>: Use the <code>call</code> statement as you would with any Fortran subroutine.</li>
</ol>
</div><h2><p>Example</p>
</h2>
<div class='content'><p>C Code (<code>c_code.c</code>):</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("I2luY2x1ZGUgPHN0ZGlvLmg+Cgp2b2lkIGNfZnVuY3Rpb24oZG91YmxlIHgpIHsKICAgIHByaW50ZigiVmFsdWUgZnJvbSBGb3J0cmFuOiAlZlxuIiwgeCk7Cn0="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>#include &lt;stdio.h&gt;

void c_function(double x) {
    printf(&quot;Value from Fortran: %f\n&quot;, x);
}</pre></div><div class='content'><p>Fortran Code (<code>fortran_code.f90</code>):</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("cHJvZ3JhbSBjYWxsX2NfZnVuY3Rpb24KICB1c2UgaXNvX2NfYmluZGluZwogIGltcGxpY2l0IG5vbmUKCiAgaW50ZXJmYWNlCiAgICBzdWJyb3V0aW5lIGNfZnVuY3Rpb24oeCkgYmluZChDLCBuYW1lPSJjX2Z1bmN0aW9uIikKICAgICAgdXNlIGlzb19jX2JpbmRpbmcKICAgICAgcmVhbChjX2RvdWJsZSksIHZhbHVlIDo6IHgKICAgIGVuZCBzdWJyb3V0aW5lIGNfZnVuY3Rpb24KICBlbmQgaW50ZXJmYWNlCgogIHJlYWwoY19kb3VibGUpIDo6IHggPSAzLjE0CgogIGNhbGwgY19mdW5jdGlvbih4KQoKZW5kIHByb2dyYW0gY2FsbF9jX2Z1bmN0aW9u"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>program call_c_function
  use iso_c_binding
  implicit none

  interface
    subroutine c_function(x) bind(C, name=&quot;c_function&quot;)
      use iso_c_binding
      real(c_double), value :: x
    end subroutine c_function
  end interface

  real(c_double) :: x = 3.14

  call c_function(x)

end program call_c_function</pre></div><div class='content'></div><h2><p>Compilation and Execution</p>
</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Z2NjIC1jIGNfY29kZS5jCmdmb3J0cmFuIC1vIGNhbGxfY19mdW5jdGlvbiBmb3J0cmFuX2NvZGUuZjkwIGNfY29kZS5vCi4vY2FsbF9jX2Z1bmN0aW9u"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>gcc -c c_code.c
gfortran -o call_c_function fortran_code.f90 c_code.o
./call_c_function</pre></div><div class='content'></div><h1><p>Calling Fortran Functions from C</p>
</h1>
<div class='content'></div><h2><p>Steps</p>
</h2>
<div class='content'><ol>
<li><strong>Declare the Fortran Function</strong>: Use the <code>bind(C)</code> attribute in the Fortran code.</li>
<li><strong>Ensure Data Type Compatibility</strong>: Use <code>ISO_C_BINDING</code> to map Fortran types to C types.</li>
<li><strong>Call the Function</strong>: Use the function name in the C code.</li>
</ol>
</div><h2><p>Example</p>
</h2>
<div class='content'><p>Fortran Code (<code>fortran_code.f90</code>):</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("bW9kdWxlIGZvcnRyYW5fbW9kdWxlCiAgdXNlIGlzb19jX2JpbmRpbmcKICBpbXBsaWNpdCBub25lCgpjb250YWlucwoKICBzdWJyb3V0aW5lIGZvcnRyYW5fZnVuY3Rpb24oeCkgYmluZChDLCBuYW1lPSJmb3J0cmFuX2Z1bmN0aW9uIikKICAgIHJlYWwoY19kb3VibGUpLCBpbnRlbnQoaW4pIDo6IHgKICAgIHByaW50ICosICJWYWx1ZSBmcm9tIEM6ICIsIHgKICBlbmQgc3Vicm91dGluZSBmb3J0cmFuX2Z1bmN0aW9uCgplbmQgbW9kdWxlIGZvcnRyYW5fbW9kdWxl"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>module fortran_module
  use iso_c_binding
  implicit none

contains

  subroutine fortran_function(x) bind(C, name=&quot;fortran_function&quot;)
    real(c_double), intent(in) :: x
    print *, &quot;Value from C: &quot;, x
  end subroutine fortran_function

end module fortran_module</pre></div><div class='content'><p>C Code (<code>c_code.c</code>):</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("I2luY2x1ZGUgPHN0ZGlvLmg+Cgp2b2lkIGZvcnRyYW5fZnVuY3Rpb24oZG91YmxlICp4KTsKCmludCBtYWluKCkgewogICAgZG91YmxlIHggPSAzLjE0OwogICAgZm9ydHJhbl9mdW5jdGlvbigmeCk7CiAgICByZXR1cm4gMDsKfQ=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>#include &lt;stdio.h&gt;

void fortran_function(double *x);

int main() {
    double x = 3.14;
    fortran_function(&amp;x);
    return 0;
}</pre></div><div class='content'></div><h2><p>Compilation and Execution</p>
</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Z2ZvcnRyYW4gLWMgZm9ydHJhbl9jb2RlLmY5MApnY2MgLW8gY2FsbF9mb3J0cmFuIGNfY29kZS5jIGZvcnRyYW5fY29kZS5vIC1sZ2ZvcnRyYW4KLi9jYWxsX2ZvcnRyYW4="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>gfortran -c fortran_code.f90
gcc -o call_fortran c_code.c fortran_code.o -lgfortran
./call_fortran</pre></div><div class='content'></div><h1><p>Data Type Mapping</p>
</h1>
<div class='content'><p>The <code>ISO_C_BINDING</code> module provides constants to map Fortran types to C types. Here is a table of common mappings:</p>
<table>
<thead>
<tr>
<th>Fortran Type</th>
<th>C Type</th>
<th>ISO_C_BINDING Constant</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>integer</code></td>
<td><code>int</code></td>
<td><code>C_INT</code></td>
</tr>
<tr>
<td><code>real</code></td>
<td><code>float</code></td>
<td><code>C_FLOAT</code></td>
</tr>
<tr>
<td><code>double precision</code></td>
<td><code>double</code></td>
<td><code>C_DOUBLE</code></td>
</tr>
<tr>
<td><code>character(len=1)</code></td>
<td><code>char</code></td>
<td><code>C_CHAR</code></td>
</tr>
<tr>
<td><code>logical</code></td>
<td><code>_Bool</code></td>
<td><code>C_BOOL</code></td>
</tr>
</tbody>
</table>
</div><h1><p>Practical Exercise</p>
</h1>
<div class='content'></div><h2><p>Task</p>
</h2>
<div class='content'><p>Write a Fortran program that calls a C function to compute the square of a number.</p>
</div><h2><p>Solution</p>
</h2>
<div class='content'><p>C Code (<code>square.c</code>):</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ZG91YmxlIHNxdWFyZShkb3VibGUgeCkgewogICAgcmV0dXJuIHggKiB4Owp9"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>double square(double x) {
    return x * x;
}</pre></div><div class='content'><p>Fortran Code (<code>main.f90</code>):</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("cHJvZ3JhbSBjYWxsX3NxdWFyZQogIHVzZSBpc29fY19iaW5kaW5nCiAgaW1wbGljaXQgbm9uZQoKICBpbnRlcmZhY2UKICAgIGZ1bmN0aW9uIHNxdWFyZSh4KSBiaW5kKEMsIG5hbWU9InNxdWFyZSIpCiAgICAgIHVzZSBpc29fY19iaW5kaW5nCiAgICAgIHJlYWwoY19kb3VibGUpIDo6IHNxdWFyZQogICAgICByZWFsKGNfZG91YmxlKSwgdmFsdWUgOjogeAogICAgZW5kIGZ1bmN0aW9uIHNxdWFyZQogIGVuZCBpbnRlcmZhY2UKCiAgcmVhbChjX2RvdWJsZSkgOjogeCA9IDUuMAogIHJlYWwoY19kb3VibGUpIDo6IHJlc3VsdAoKICByZXN1bHQgPSBzcXVhcmUoeCkKICBwcmludCAqLCAiU3F1YXJlIG9mICIsIHgsICIgaXMgIiwgcmVzdWx0CgplbmQgcHJvZ3JhbSBjYWxsX3NxdWFyZQ=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>program call_square
  use iso_c_binding
  implicit none

  interface
    function square(x) bind(C, name=&quot;square&quot;)
      use iso_c_binding
      real(c_double) :: square
      real(c_double), value :: x
    end function square
  end interface

  real(c_double) :: x = 5.0
  real(c_double) :: result

  result = square(x)
  print *, &quot;Square of &quot;, x, &quot; is &quot;, result

end program call_square</pre></div><div class='content'></div><h2><p>Compilation and Execution</p>
</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Z2NjIC1jIHNxdWFyZS5jCmdmb3J0cmFuIC1vIGNhbGxfc3F1YXJlIG1haW4uZjkwIHNxdWFyZS5vCi4vY2FsbF9zcXVhcmU="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>gcc -c square.c
gfortran -o call_square main.f90 square.o
./call_square</pre></div><div class='content'></div><h1><p>Conclusion</p>
</h1>
<div class='content'><p>In this section, you learned how to interface Fortran with C using the <code>ISO_C_BINDING</code> module. You now know how to call C functions from Fortran and vice versa, ensuring data type compatibility. This knowledge allows you to leverage the strengths of both languages in your projects. In the next module, we will explore best practices and optimization techniques to enhance your Fortran programs.</p>
</div><div class='row navigation'>
	<div class='col-1 col-md-2'>
					<a href='07-03-parallel-programming-coarrays' title="Parallel Programming with Coarrays">
				<span class="d-none d-md-inline">&#x25C4; Previous</span>
				<span class="d-inline d-md-none"><i class="bi bi-caret-left-square-fill"></i></span>
			</a>
			</div>
	<div class='col-10 col-md-8 text-center'>
			</div>
	<div class='col-1 col-md-2 text-end'>
					<a href='08-01-code-optimization-techniques' title="Code Optimization Techniques">
				<span class="d-none d-md-inline">Next &#x25BA;</span>
				<span class="d-inline d-md-none"><i class="bi bi-caret-right-square-fill"></i></span>
			</a>
			</div>
</div>

			</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<!-- 
<h1>Advertising</h1>
<p>This space is reserved for advertising.</p>
<p>If you want to be a sponsor, contact us to include links in this area: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
<p>Thank you for collaborating!</p>
-->

<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-0611338592562725"
     crossorigin="anonymous"></script>
<!-- enterprise_campus -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-0611338592562725"
     data-ad-slot="6914733106"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
		</div>
	</div>
</div>

<div class="container-xxl d-block d-md-none">
	<div class="row">
		<div class="col-12 p-2 p-md-0 m-0 text-end">
			<a href="/objective">The Project</a> | 
<a href="/about">About Us</a> | 
<a href="/contribute">Contribute</a> | 
<a href="/donate">Donations</a> | 
<a href="/licence">License</a>
		</div>
	</div>
</div>

<div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. All rights reserved</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	We use cookies to improve your user experience and offer content tailored to your interests.
    <a href="#" id="btn_accept_cookies" class="button">Accept</a>
    <a href="/cookies">More Information</a>
</div>	

	</div>    
</body>
</html>
