<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Append-Only Files (AOF)</title>

    <link rel="alternate" href="https://campusempresa.com/mod/redis/append-only-files-aof" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/mod/redis/append-only-files-aof" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/mod/redis/append-only-files-aof" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body>
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-8 p-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo-header_enterprise.png"></a>
			</h1>
		</div>
		<div class="col-4 p-0 text-end">
			<h2 id="main_title"><cite>Building today's and tomorrow's society</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-0 m-0 text-end">
													<b id="lit_lang_es" class="px-2">EN</b>
				|
				<a href="https://campusempresa.com/mod/redis/append-only-files-aof" class="px-2">ES</a></b>
				|
				<a href="https://campusempresa.cat/mod/redis/append-only-files-aof" class="px-2">CA</a>
					</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="/objective">The Project</a>
				<a href="/about">About Us</a>
				<a href="/contribute">Contribute</a>
				<a href="/donate">Donations</a>
				<a href="/licence">License</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content"><div class='row navigation'>
	<div class='col-4'>
					<a href='snapshots-rdb'>&#x25C4;Snapshots (RDB)</a>
			</div>
	<div class='col-4 text-center'>
		<a href="./" class="title">Append-Only Files (AOF)</a>
	</div>
	<div class='col-4 text-end'>
					<a href='persistence-configuration'>Persistence Configuration &#x25BA;</a>
			</div>
</div>
<div class='content'></div><h1>Introduction to AOF</h1>
<div class='content'><p>Append-Only Files (AOF) is a persistence mechanism in Redis that logs every write operation received by the server. This log is then used to reconstruct the dataset when the server restarts. AOF provides a more durable way of persisting data compared to the default RDB (Redis Database) snapshots.</p>
</div><h1>Key Concepts</h1>
<div class='content'><ul>
<li><strong>Persistence</strong>: Ensuring data is not lost in case of a server crash.</li>
<li><strong>Write-Ahead Logging</strong>: Recording every write operation before it is applied to the dataset.</li>
<li><strong>Reconstruction</strong>: Using the AOF log to rebuild the dataset upon server restart.</li>
</ul>
</div><h1>Enabling AOF</h1>
<div class='content'><p>To enable AOF in Redis, you need to modify the Redis configuration file (<code>redis.conf</code>).</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("YXBwZW5kb25seSB5ZXM="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>appendonly yes</pre></div><div class='content'></div><h1>AOF Configuration Options</h1>
<div class='content'><p>Redis provides several configuration options to fine-tune AOF behavior:</p>
<ul>
<li><strong>appendfsync</strong>: Controls how often Redis will sync the AOF file to disk.
<ul>
<li><code>always</code>: Sync after every write operation (most durable, least performant).</li>
<li><code>everysec</code>: Sync every second (balance between durability and performance).</li>
<li><code>no</code>: Let the operating system decide when to sync (least durable, most performant).</li>
</ul>
</li>
</ul>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("YXBwZW5kZnN5bmMgZXZlcnlzZWM="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>appendfsync everysec</pre></div><div class='content'><ul>
<li><strong>auto-aof-rewrite-percentage</strong>: Triggers an AOF rewrite when the AOF file size grows by a certain percentage since the last rewrite.</li>
<li><strong>auto-aof-rewrite-min-size</strong>: Sets the minimum size the AOF file must reach before an automatic rewrite is triggered.</li>
</ul>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("YXV0by1hb2YtcmV3cml0ZS1wZXJjZW50YWdlIDEwMAphdXRvLWFvZi1yZXdyaXRlLW1pbi1zaXplIDY0bWI="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>auto-aof-rewrite-percentage 100
auto-aof-rewrite-min-size 64mb</pre></div><div class='content'></div><h1>How AOF Works</h1>
<div class='content'><ol>
<li><strong>Logging</strong>: Every write operation is logged to the AOF file.</li>
<li><strong>Syncing</strong>: The AOF file is synced to disk based on the <code>appendfsync</code> setting.</li>
<li><strong>Rewriting</strong>: Periodically, Redis rewrites the AOF file to optimize its size and performance.</li>
</ol>
</div><h1>Example: Basic AOF Configuration</h1>
<div class='content'><p>Here's an example of a basic AOF configuration in <code>redis.conf</code>:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("YXBwZW5kb25seSB5ZXMKYXBwZW5kZnN5bmMgZXZlcnlzZWMKYXV0by1hb2YtcmV3cml0ZS1wZXJjZW50YWdlIDEwMAphdXRvLWFvZi1yZXdyaXRlLW1pbi1zaXplIDY0bWI="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>appendonly yes
appendfsync everysec
auto-aof-rewrite-percentage 100
auto-aof-rewrite-min-size 64mb</pre></div><div class='content'></div><h1>AOF Rewrite</h1>
<div class='content'><p>AOF rewrite is a process where Redis creates a new AOF file by reading the current dataset in memory and writing it to a new file in a more compact form. This helps in reducing the size of the AOF file and improving performance.</p>
</div><h2>Triggering AOF Rewrite Manually</h2>
<div class='content'><p>You can trigger an AOF rewrite manually using the <code>BGREWRITEAOF</code> command:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("QkdSRVdSSVRFQU9G"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>BGREWRITEAOF</pre></div><div class='content'></div><h1>AOF vs RDB</h1>
<div class='content'><p>| Feature           | AOF                          | RDB                          |
|-------------------|------------------------------|------------------------------|
| Persistence       | Logs every write operation   | Periodic snapshots           |
| Durability        | Higher (depends on <code>appendfsync</code>) | Lower (depends on snapshot frequency) |
| Performance       | Lower (more disk I/O)        | Higher (less frequent disk I/O) |
| File Size         | Larger (contains all operations) | Smaller (snapshot of dataset) |
| Recovery Speed    | Slower (replays all operations) | Faster (loads snapshot)      |</p>
</div><h1>Code Example: Using AOF in Redis</h1>
<div class='content'><p>Here's a simple example to demonstrate how AOF works in Redis:</p>
<ol>
<li><strong>Enable AOF</strong>: Modify <code>redis.conf</code> to enable AOF.</li>
<li><strong>Start Redis Server</strong>: Start the Redis server with the modified configuration.</li>
<li><strong>Perform Write Operations</strong>: Execute some write operations.</li>
</ol>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("U0VUIHVzZXI6MSAiQWxpY2UiClNFVCB1c2VyOjIgIkJvYiI="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>SET user:1 &quot;Alice&quot;
SET user:2 &quot;Bob&quot;</pre></div><div class='content'><ol start="4">
<li><strong>Check AOF File</strong>: The AOF file (<code>appendonly.aof</code>) will contain the write operations.</li>
</ol>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("KjMKJDMKU0VUCiQ2CnVzZXI6MQokNQpBbGljZQoqMwokMwpTRVQKJDYKdXNlcjoyCiQzCkJvYg=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>*3
$3
SET
$6
user:1
$5
Alice
*3
$3
SET
$6
user:2
$3
Bob</pre></div><div class='content'></div><h1>Conclusion</h1>
<div class='content'><p>Append-Only Files (AOF) provide a robust mechanism for ensuring data durability in Redis. By logging every write operation, AOF allows for precise data recovery in the event of a server crash. Understanding how to configure and manage AOF is crucial for maintaining a reliable Redis deployment. While AOF offers higher durability compared to RDB snapshots, it comes with trade-offs in terms of performance and file size. Proper configuration and periodic rewrites can help balance these trade-offs to suit your application's needs.</p>
</div><div class='row navigation'>
	<div class='col-4'>
					<a href='snapshots-rdb'>&#x25C4;Snapshots (RDB)</a>
			</div>
	<div class='col-4 text-center'>
		<a href="./" class="title">Append-Only Files (AOF)</a>
	</div>
	<div class='col-4 text-end'>
					<a href='persistence-configuration'>Persistence Configuration &#x25BA;</a>
			</div>
</div>
</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Advertising</h1>
			<p>This space is reserved for advertising.</p>
			<p>If you want to be a sponsor, contact us to include links in this area: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Thank you for collaborating!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. All rights reserved</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir galetes per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Accept</a>
    <a href="/cookies">More Information</a>
</div>	

	</div>    
</body>
</html>
