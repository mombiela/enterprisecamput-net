<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Subroutines and Procedures</title>

    <link rel="alternate" href="https://campusempresa.com/mod/assembly/subroutines-and-procedures" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/mod/assembly/subroutines-and-procedures" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/mod/assembly/subroutines-and-procedures" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body>
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-8 p-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo_header.png" style="visibility:hiddenxx;"></a>
			</h1>
		</div>
		<div class="col-4 p-0 text-end">
			<h2 id="main_title"><cite>Building today's and tomorrow's society</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-0 m-0 text-end">
													<b id="lit_lang_es" class="px-2">EN</b>
				|
				<a href="https://campusempresa.com/mod/assembly/subroutines-and-procedures" class="px-2">ES</a></b>
				|
				<a href="https://campusempresa.cat/mod/assembly/subroutines-and-procedures" class="px-2">CA</a>
					</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="/objective">The Project</a>
				<a href="/about">About Us</a>
				<a href="/contribute">Contribute</a>
				<a href="/donate">Donations</a>
				<a href="/licence">License</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content"><div class='row navigation'>
	<div class='col-4'>
					<a href='loops-and-iteration'>&#x25C4;Loops and Iteration</a>
			</div>
	<div class='col-4 text-center'>
		<a href="./" class="title">Subroutines and Procedures</a>
	</div>
	<div class='col-4 text-end'>
					<a href='stack-operations'>Stack Operations &#x25BA;</a>
			</div>
</div>
<div class='content'></div><h1>Introduction to Subroutines and Procedures</h1>
<div class='content'><p>Subroutines and procedures are fundamental concepts in assembly language programming. They allow you to break down complex tasks into smaller, manageable pieces, making your code more modular, readable, and maintainable.</p>
</div><h1>Key Concepts</h1>
<div class='content'><ul>
<li><strong>Subroutine</strong>: A sequence of instructions designed to perform a specific task, which can be called from different parts of a program.</li>
<li><strong>Procedure</strong>: Another term for subroutine, often used interchangeably.</li>
<li><strong>Call</strong>: The instruction used to invoke a subroutine.</li>
<li><strong>Return</strong>: The instruction used to return control to the calling code after the subroutine has finished executing.</li>
<li><strong>Stack</strong>: A special memory structure used to store return addresses and local variables during subroutine calls.</li>
</ul>
</div><h1>Basic Structure of a Subroutine</h1>
<div class='content'><p>A subroutine typically consists of:</p>
<ol>
<li><strong>Prologue</strong>: Code that sets up the subroutine, such as saving registers and setting up the stack frame.</li>
<li><strong>Body</strong>: The main code of the subroutine that performs the specific task.</li>
<li><strong>Epilogue</strong>: Code that cleans up, restores registers, and returns control to the calling code.</li>
</ol>
</div><h2>Example: Simple Subroutine in x86 Assembly</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("c2VjdGlvbiAuZGF0YQogICAgbXNnIGRiICdIZWxsbywgV29ybGQhJywgMAoKc2VjdGlvbiAudGV4dAogICAgZ2xvYmFsIF9zdGFydAoKX3N0YXJ0OgogICAgY2FsbCBwcmludF9tZXNzYWdlCiAgICA7IEV4aXQgdGhlIHByb2dyYW0KICAgIG1vdiBlYXgsIDYwICAgICAgICAgOyBzeXNjYWxsOiBleGl0CiAgICB4b3IgZWRpLCBlZGkgICAgICAgIDsgc3RhdHVzOiAwCiAgICBzeXNjYWxsCgpwcmludF9tZXNzYWdlOgogICAgOyBQcm9sb2d1ZQogICAgcHVzaCByYnAgICAgICAgICAgICA7IFNhdmUgYmFzZSBwb2ludGVyCiAgICBtb3YgcmJwLCByc3AgICAgICAgIDsgU2V0IGJhc2UgcG9pbnRlciB0byBzdGFjayBwb2ludGVyCgogICAgOyBCb2R5CiAgICBtb3YgcmF4LCAxICAgICAgICAgIDsgc3lzY2FsbDogd3JpdGUKICAgIG1vdiByZGksIDEgICAgICAgICAgOyBmaWxlIGRlc2NyaXB0b3I6IHN0ZG91dAogICAgbW92IHJzaSwgbXNnICAgICAgICA7IG1lc3NhZ2UgdG8gd3JpdGUKICAgIG1vdiByZHgsIDEzICAgICAgICAgOyBtZXNzYWdlIGxlbmd0aAogICAgc3lzY2FsbAoKICAgIDsgRXBpbG9ndWUKICAgIG1vdiByc3AsIHJicCAgICAgICAgOyBSZXN0b3JlIHN0YWNrIHBvaW50ZXIKICAgIHBvcCByYnAgICAgICAgICAgICAgOyBSZXN0b3JlIGJhc2UgcG9pbnRlcgogICAgcmV0ICAgICAgICAgICAgICAgICA7IFJldHVybiB0byBjYWxsZXI="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>section .data
    msg db 'Hello, World!', 0

section .text
    global _start

_start:
    call print_message
    ; Exit the program
    mov eax, 60         ; syscall: exit
    xor edi, edi        ; status: 0
    syscall

print_message:
    ; Prologue
    push rbp            ; Save base pointer
    mov rbp, rsp        ; Set base pointer to stack pointer

    ; Body
    mov rax, 1          ; syscall: write
    mov rdi, 1          ; file descriptor: stdout
    mov rsi, msg        ; message to write
    mov rdx, 13         ; message length
    syscall

    ; Epilogue
    mov rsp, rbp        ; Restore stack pointer
    pop rbp             ; Restore base pointer
    ret                 ; Return to caller</pre></div><div class='content'></div><h2>Explanation</h2>
<div class='content'><ul>
<li><strong>Prologue</strong>: <code>push rbp</code> and <code>mov rbp, rsp</code> save the base pointer and set up the stack frame.</li>
<li><strong>Body</strong>: The code between the prologue and epilogue performs the task of printing a message.</li>
<li><strong>Epilogue</strong>: <code>mov rsp, rbp</code> and <code>pop rbp</code> restore the stack pointer and base pointer, and <code>ret</code> returns control to the caller.</li>
</ul>
</div><h1>Advanced Subroutine Concepts</h1>
<h2>Passing Arguments</h2>
<div class='content'><p>Arguments can be passed to subroutines using registers or the stack. In x86-64, the first six integer or pointer arguments are typically passed in registers <code>rdi</code>, <code>rsi</code>, <code>rdx</code>, <code>rcx</code>, <code>r8</code>, and <code>r9</code>.</p>
</div><h2>Example: Subroutine with Arguments</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("c2VjdGlvbiAudGV4dAogICAgZ2xvYmFsIF9zdGFydAoKX3N0YXJ0OgogICAgbW92IHJkaSwgNSAgICAgICAgICA7IEZpcnN0IGFyZ3VtZW50CiAgICBtb3YgcnNpLCAzICAgICAgICAgIDsgU2Vjb25kIGFyZ3VtZW50CiAgICBjYWxsIGFkZF9udW1iZXJzCiAgICA7IEV4aXQgdGhlIHByb2dyYW0KICAgIG1vdiBlYXgsIDYwICAgICAgICAgOyBzeXNjYWxsOiBleGl0CiAgICB4b3IgZWRpLCBlZGkgICAgICAgIDsgc3RhdHVzOiAwCiAgICBzeXNjYWxsCgphZGRfbnVtYmVyczoKICAgIDsgUHJvbG9ndWUKICAgIHB1c2ggcmJwCiAgICBtb3YgcmJwLCByc3AKCiAgICA7IEJvZHkKICAgIG1vdiByYXgsIHJkaSAgICAgICAgOyBMb2FkIGZpcnN0IGFyZ3VtZW50IGludG8gcmF4CiAgICBhZGQgcmF4LCByc2kgICAgICAgIDsgQWRkIHNlY29uZCBhcmd1bWVudCB0byByYXgKCiAgICA7IEVwaWxvZ3VlCiAgICBtb3YgcnNwLCByYnAKICAgIHBvcCByYnAKICAgIHJldA=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>section .text
    global _start

_start:
    mov rdi, 5          ; First argument
    mov rsi, 3          ; Second argument
    call add_numbers
    ; Exit the program
    mov eax, 60         ; syscall: exit
    xor edi, edi        ; status: 0
    syscall

add_numbers:
    ; Prologue
    push rbp
    mov rbp, rsp

    ; Body
    mov rax, rdi        ; Load first argument into rax
    add rax, rsi        ; Add second argument to rax

    ; Epilogue
    mov rsp, rbp
    pop rbp
    ret</pre></div><div class='content'></div><h2>Explanation</h2>
<div class='content'><ul>
<li>The arguments <code>5</code> and <code>3</code> are passed to the subroutine <code>add_numbers</code> using registers <code>rdi</code> and <code>rsi</code>.</li>
<li>The subroutine adds these two numbers and stores the result in <code>rax</code>.</li>
</ul>
</div><h2>Local Variables</h2>
<div class='content'><p>Local variables can be stored on the stack. This is done by adjusting the stack pointer in the prologue and epilogue.</p>
</div><h2>Example: Subroutine with Local Variables</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("c2VjdGlvbiAudGV4dAogICAgZ2xvYmFsIF9zdGFydAoKX3N0YXJ0OgogICAgY2FsbCBjYWxjdWxhdGUKICAgIDsgRXhpdCB0aGUgcHJvZ3JhbQogICAgbW92IGVheCwgNjAgICAgICAgICA7IHN5c2NhbGw6IGV4aXQKICAgIHhvciBlZGksIGVkaSAgICAgICAgOyBzdGF0dXM6IDAKICAgIHN5c2NhbGwKCmNhbGN1bGF0ZToKICAgIDsgUHJvbG9ndWUKICAgIHB1c2ggcmJwCiAgICBtb3YgcmJwLCByc3AKICAgIHN1YiByc3AsIDE2ICAgICAgICAgOyBBbGxvY2F0ZSBzcGFjZSBmb3IgbG9jYWwgdmFyaWFibGVzCgogICAgOyBCb2R5CiAgICBtb3YgZHdvcmQgW3JicC00XSwgMTAgICA7IExvY2FsIHZhcmlhYmxlIHggPSAxMAogICAgbW92IGR3b3JkIFtyYnAtOF0sIDIwICAgOyBMb2NhbCB2YXJpYWJsZSB5ID0gMjAKICAgIG1vdiBlYXgsIFtyYnAtNF0gICAgICAgIDsgTG9hZCB4IGludG8gZWF4CiAgICBhZGQgZWF4LCBbcmJwLThdICAgICAgICA7IEFkZCB5IHRvIGVheAoKICAgIDsgRXBpbG9ndWUKICAgIG1vdiByc3AsIHJicAogICAgcG9wIHJicAogICAgcmV0"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>section .text
    global _start

_start:
    call calculate
    ; Exit the program
    mov eax, 60         ; syscall: exit
    xor edi, edi        ; status: 0
    syscall

calculate:
    ; Prologue
    push rbp
    mov rbp, rsp
    sub rsp, 16         ; Allocate space for local variables

    ; Body
    mov dword [rbp-4], 10   ; Local variable x = 10
    mov dword [rbp-8], 20   ; Local variable y = 20
    mov eax, [rbp-4]        ; Load x into eax
    add eax, [rbp-8]        ; Add y to eax

    ; Epilogue
    mov rsp, rbp
    pop rbp
    ret</pre></div><div class='content'></div><h2>Explanation</h2>
<div class='content'><ul>
<li>The stack pointer is adjusted with <code>sub rsp, 16</code> to allocate space for local variables.</li>
<li>Local variables <code>x</code> and <code>y</code> are stored at <code>[rbp-4]</code> and <code>[rbp-8]</code>, respectively.</li>
</ul>
</div><h1>Conclusion</h1>
<div class='content'><p>Subroutines and procedures are essential for writing modular and maintainable assembly code. By understanding how to structure subroutines, pass arguments, and use local variables, you can create more complex and efficient programs. Practice writing and calling subroutines to become proficient in these techniques.</p>
</div><div class='row navigation'>
	<div class='col-4'>
					<a href='loops-and-iteration'>&#x25C4;Loops and Iteration</a>
			</div>
	<div class='col-4 text-center'>
		<a href="./" class="title">Subroutines and Procedures</a>
	</div>
	<div class='col-4 text-end'>
					<a href='stack-operations'>Stack Operations &#x25BA;</a>
			</div>
</div>
</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Advertising</h1>
			<p>This space is reserved for advertising.</p>
			<p>If you want to be a sponsor, contact us to include links in this area: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Thank you for collaborating!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. All rights reserved</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir galetes per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Accept</a>
    <a href="/cookies">More Information</a>
</div>	

	</div>    
</body>
</html>
