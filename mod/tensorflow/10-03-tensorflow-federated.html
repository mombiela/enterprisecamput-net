<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TensorFlow Federated</title>

    <link rel="alternate" href="https://campusempresa.com/mod/tensorflow/10-03-tensorflow-federated" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/mod/tensorflow/10-03-tensorflow-federated" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/mod/tensorflow/10-03-tensorflow-federated" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="/js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body >
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-12 col-md-8 p-2 p-md-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo-header_enterprise.png"></a>
			</h1>
		</div>
		<div class="col-12 col-md-4 p-2 p-md-0 text-end">
			<h2 id="main_title"><cite>Building today's and tomorrow's society</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-2 p-md-0 m-0 text-end">
													<b id="lit_lang_es" class="px-2">EN</b>
				|
				<a href="https://campusempresa.com/mod/tensorflow/10-03-tensorflow-federated" class="px-2">ES</a></b>
				|
				<a href="https://campusempresa.cat/mod/tensorflow/10-03-tensorflow-federated" class="px-2">CA</a>
					</div>
	</div>
</div>

<div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<!-- <a href="/">Home</a>  -->
									<a href="./">Course Content</a>
					<span class="sep">|</span>
								<a href="/all/competencias">Technical Skills</a>
				<a href="/all/conocimientos">Knowledge</a>
				<a href="/all/soft_skills">Social Skills</a>
			</div>
		</div>
	</div>
</div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content">
								<div class='row navigation'>
	<div class='col-1 col-md-2'>
					<a href='10-02-tensorflow-js' title="TensorFlow.js">
				<span class="d-none d-md-inline">&#x25C4; Previous</span>
				<span class="d-inline d-md-none"><i class="bi bi-caret-left-square-fill"></i></span>
			</a>
			</div>
	<div class='col-10 col-md-8 text-center'>
					<a href="./"><h2 style="text-decoration:underline">TensorFlow Federated</h2></a>
			</div>
	<div class='col-1 col-md-2 text-end'>
					<a href='10-04-tensorflow-quantum' title="TensorFlow Quantum">
				<span class="d-none d-md-inline">Next &#x25BA;</span>
				<span class="d-inline d-md-none"><i class="bi bi-caret-right-square-fill"></i></span>
			</a>
			</div>
</div>
<div class='content'></div><h1><p>Introduction to TensorFlow Federated</p>
</h1>
<div class='content'><p>TensorFlow Federated (TFF) is an open-source framework for machine learning and other computations on decentralized data. It enables developers to simulate and implement federated learning algorithms, which allow models to be trained across multiple devices or servers holding local data samples, without exchanging them.</p>
</div><h2><p>Key Concepts</p>
</h2>
<div class='content'><ol>
<li><strong>Federated Learning</strong>: A machine learning setting where the goal is to train a high-quality centralized model while keeping all the training data decentralized.</li>
<li><strong>Federated Computation</strong>: Computations that are distributed across multiple devices or servers.</li>
<li><strong>Federated Data</strong>: Data that is distributed across multiple devices or servers, often in a non-IID (Independent and Identically Distributed) manner.</li>
</ol>
</div><h1><p>Setting Up TensorFlow Federated</p>
</h1>
<div class='content'><p>To get started with TensorFlow Federated, you need to install the TFF package. You can do this using pip:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("cGlwIGluc3RhbGwgdGVuc29yZmxvdy1mZWRlcmF0ZWQ="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>pip install tensorflow-federated</pre></div><div class='content'></div><h1><p>Basic TensorFlow Federated Concepts</p>
</h1>
<div class='content'></div><h2><p>Federated Learning Process</p>
</h2>
<div class='content'><ol>
<li><strong>Initialization</strong>: Initialize the global model.</li>
<li><strong>Client Update</strong>: Each client computes an update to the model using its local data.</li>
<li><strong>Aggregation</strong>: The server aggregates the updates from all clients.</li>
<li><strong>Model Update</strong>: The server updates the global model based on the aggregated updates.</li>
<li><strong>Iteration</strong>: Repeat the process for a number of rounds.</li>
</ol>
</div><h2><p>Example: Federated Averaging</p>
</h2>
<div class='content'><p>Federated Averaging is a common algorithm used in federated learning. It involves averaging the model updates from multiple clients to update the global model.</p>
</div><h1><p>Practical Example: Federated Averaging</p>
</h1>
<div class='content'></div><h2><p>Step 1: Import Libraries</p>
</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("aW1wb3J0IHRlbnNvcmZsb3cgYXMgdGYKaW1wb3J0IHRlbnNvcmZsb3dfZmVkZXJhdGVkIGFzIHRmZg=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>import tensorflow as tf
import tensorflow_federated as tff</pre></div><div class='content'></div><h2><p>Step 2: Define the Model</p>
</h2>
<div class='content'><p>Define a simple model using Keras:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ZGVmIGNyZWF0ZV9rZXJhc19tb2RlbCgpOgogICAgcmV0dXJuIHRmLmtlcmFzLm1vZGVscy5TZXF1ZW50aWFsKFsKICAgICAgICB0Zi5rZXJhcy5sYXllcnMuSW5wdXRMYXllcihpbnB1dF9zaGFwZT0oNzg0LCkpLAogICAgICAgIHRmLmtlcmFzLmxheWVycy5EZW5zZSgxMCwgYWN0aXZhdGlvbj0nc29mdG1heCcpCiAgICBdKQ=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>def create_keras_model():
    return tf.keras.models.Sequential([
        tf.keras.layers.InputLayer(input_shape=(784,)),
        tf.keras.layers.Dense(10, activation='softmax')
    ])</pre></div><div class='content'></div><h2><p>Step 3: Convert Keras Model to TFF Model</p>
</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ZGVmIG1vZGVsX2ZuKCk6CiAgICBrZXJhc19tb2RlbCA9IGNyZWF0ZV9rZXJhc19tb2RlbCgpCiAgICByZXR1cm4gdGZmLmxlYXJuaW5nLmZyb21fa2VyYXNfbW9kZWwoCiAgICAgICAga2VyYXNfbW9kZWwsCiAgICAgICAgaW5wdXRfc3BlYz0oCiAgICAgICAgICAgIHRmLlRlbnNvclNwZWMoc2hhcGU9W05vbmUsIDc4NF0sIGR0eXBlPXRmLmZsb2F0MzIpLAogICAgICAgICAgICB0Zi5UZW5zb3JTcGVjKHNoYXBlPVtOb25lLCAxMF0sIGR0eXBlPXRmLmZsb2F0MzIpCiAgICAgICAgKSwKICAgICAgICBsb3NzPXRmLmtlcmFzLmxvc3Nlcy5TcGFyc2VDYXRlZ29yaWNhbENyb3NzZW50cm9weSgpLAogICAgICAgIG1ldHJpY3M9W3RmLmtlcmFzLm1ldHJpY3MuU3BhcnNlQ2F0ZWdvcmljYWxBY2N1cmFjeSgpXQogICAgKQ=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>def model_fn():
    keras_model = create_keras_model()
    return tff.learning.from_keras_model(
        keras_model,
        input_spec=(
            tf.TensorSpec(shape=[None, 784], dtype=tf.float32),
            tf.TensorSpec(shape=[None, 10], dtype=tf.float32)
        ),
        loss=tf.keras.losses.SparseCategoricalCrossentropy(),
        metrics=[tf.keras.metrics.SparseCategoricalAccuracy()]
    )</pre></div><div class='content'></div><h2><p>Step 4: Load and Preprocess Data</p>
</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ZGVmIHByZXByb2Nlc3MoZGF0YXNldCk6CiAgICBkZWYgYmF0Y2hfZm9ybWF0X2ZuKGVsZW1lbnQpOgogICAgICAgIHJldHVybiAodGYucmVzaGFwZShlbGVtZW50WydwaXhlbHMnXSwgWy0xLCA3ODRdKSwgZWxlbWVudFsnbGFiZWwnXSkKICAgIHJldHVybiBkYXRhc2V0LnJlcGVhdCgpLnNodWZmbGUoMTAwKS5iYXRjaCgyMCkubWFwKGJhdGNoX2Zvcm1hdF9mbikucHJlZmV0Y2goMTApCgplbW5pc3RfdHJhaW4sIGVtbmlzdF90ZXN0ID0gdGZmLnNpbXVsYXRpb24uZGF0YXNldHMuZW1uaXN0LmxvYWRfZGF0YSgpCmNsaWVudF9kYXRhID0gZW1uaXN0X3RyYWluLmNyZWF0ZV90Zl9kYXRhc2V0X2Zvcl9jbGllbnQoZW1uaXN0X3RyYWluLmNsaWVudF9pZHNbMF0pCnByZXByb2Nlc3NlZF9kYXRhID0gcHJlcHJvY2VzcyhjbGllbnRfZGF0YSk="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>def preprocess(dataset):
    def batch_format_fn(element):
        return (tf.reshape(element['pixels'], [-1, 784]), element['label'])
    return dataset.repeat().shuffle(100).batch(20).map(batch_format_fn).prefetch(10)

emnist_train, emnist_test = tff.simulation.datasets.emnist.load_data()
client_data = emnist_train.create_tf_dataset_for_client(emnist_train.client_ids[0])
preprocessed_data = preprocess(client_data)</pre></div><div class='content'></div><h2><p>Step 5: Federated Data</p>
</h2>
<div class='content'><p>Create federated data by sampling from multiple clients:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ZGVmIG1ha2VfZmVkZXJhdGVkX2RhdGEoY2xpZW50X2RhdGEsIGNsaWVudF9pZHMpOgogICAgcmV0dXJuIFtwcmVwcm9jZXNzKGNsaWVudF9kYXRhLmNyZWF0ZV90Zl9kYXRhc2V0X2Zvcl9jbGllbnQoeCkpIGZvciB4IGluIGNsaWVudF9pZHNdCgpmZWRlcmF0ZWRfdHJhaW5fZGF0YSA9IG1ha2VfZmVkZXJhdGVkX2RhdGEoZW1uaXN0X3RyYWluLCBlbW5pc3RfdHJhaW4uY2xpZW50X2lkc1s6MTBdKQ=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>def make_federated_data(client_data, client_ids):
    return [preprocess(client_data.create_tf_dataset_for_client(x)) for x in client_ids]

federated_train_data = make_federated_data(emnist_train, emnist_train.client_ids[:10])</pre></div><div class='content'></div><h2><p>Step 6: Federated Averaging Process</p>
</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("aXRlcmF0aXZlX3Byb2Nlc3MgPSB0ZmYubGVhcm5pbmcuYnVpbGRfZmVkZXJhdGVkX2F2ZXJhZ2luZ19wcm9jZXNzKG1vZGVsX2ZuKQpzdGF0ZSA9IGl0ZXJhdGl2ZV9wcm9jZXNzLmluaXRpYWxpemUoKQoKZm9yIHJvdW5kX251bSBpbiByYW5nZSgxLCAxMSk6CiAgICBzdGF0ZSwgbWV0cmljcyA9IGl0ZXJhdGl2ZV9wcm9jZXNzLm5leHQoc3RhdGUsIGZlZGVyYXRlZF90cmFpbl9kYXRhKQogICAgcHJpbnQoZidSb3VuZCB7cm91bmRfbnVtfSwgTWV0cmljcz17bWV0cmljc30nKQ=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>iterative_process = tff.learning.build_federated_averaging_process(model_fn)
state = iterative_process.initialize()

for round_num in range(1, 11):
    state, metrics = iterative_process.next(state, federated_train_data)
    print(f'Round {round_num}, Metrics={metrics}')</pre></div><div class='content'></div><h1><p>Practical Exercise</p>
</h1>
<div class='content'></div><h2><p>Exercise: Implement Federated Learning for a Custom Dataset</p>
</h2>
<div class='content'><ol>
<li><strong>Dataset</strong>: Use a custom dataset of your choice.</li>
<li><strong>Model</strong>: Define a simple neural network model.</li>
<li><strong>Federated Data</strong>: Create federated data from your dataset.</li>
<li><strong>Federated Averaging</strong>: Implement the federated averaging process.</li>
</ol>
</div><h2><p>Solution</p>
</h2>
<div class='content'><ol>
<li><strong>Dataset</strong>: Load your custom dataset.</li>
<li><strong>Model</strong>: Define the model using Keras.</li>
<li><strong>Federated Data</strong>: Preprocess and create federated data.</li>
<li><strong>Federated Averaging</strong>: Implement the federated averaging process similar to the example above.</li>
</ol>
</div><h1><p>Common Mistakes and Tips</p>
</h1>
<div class='content'><ul>
<li><strong>Data Preprocessing</strong>: Ensure that data preprocessing is consistent across all clients.</li>
<li><strong>Model Compatibility</strong>: Ensure that the model is compatible with TFF by using <code>tff.learning.from_keras_model</code>.</li>
<li><strong>Client Sampling</strong>: Properly sample clients to ensure a representative federated dataset.</li>
</ul>
</div><h1><p>Conclusion</p>
</h1>
<div class='content'><p>In this section, we introduced TensorFlow Federated and explored its key concepts. We walked through a practical example of implementing federated averaging using a simple neural network model. By understanding these basics, you are now equipped to explore more advanced federated learning techniques and apply them to your own datasets.</p>
</div><div class='row navigation'>
	<div class='col-1 col-md-2'>
					<a href='10-02-tensorflow-js' title="TensorFlow.js">
				<span class="d-none d-md-inline">&#x25C4; Previous</span>
				<span class="d-inline d-md-none"><i class="bi bi-caret-left-square-fill"></i></span>
			</a>
			</div>
	<div class='col-10 col-md-8 text-center'>
			</div>
	<div class='col-1 col-md-2 text-end'>
					<a href='10-04-tensorflow-quantum' title="TensorFlow Quantum">
				<span class="d-none d-md-inline">Next &#x25BA;</span>
				<span class="d-inline d-md-none"><i class="bi bi-caret-right-square-fill"></i></span>
			</a>
			</div>
</div>

			</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Advertising</h1>
			<p>This space is reserved for advertising.</p>
			<p>If you want to be a sponsor, contact us to include links in this area: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Thank you for collaborating!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. All rights reserved</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	We use cookies to improve your user experience and offer content tailored to your interests.
    <a href="#" id="btn_accept_cookies" class="button">Accept</a>
    <a href="/cookies">More Information</a>
</div>	

	</div>    
</body>
</html>
