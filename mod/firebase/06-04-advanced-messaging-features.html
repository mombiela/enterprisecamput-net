<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Messaging Features</title>

    <link rel="alternate" href="https://campusempresa.com/mod/firebase/06-04-advanced-messaging-features" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/mod/firebase/06-04-advanced-messaging-features" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/mod/firebase/06-04-advanced-messaging-features" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body >
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-12 col-md-8 p-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo-header_enterprise.png"></a>
			</h1>
		</div>
		<div class="col-12 col-md-4 p-0 text-end">
			<h2 id="main_title"><cite>Building today's and tomorrow's society</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-0 m-0 text-end">
													<b id="lit_lang_es" class="px-2">EN</b>
				|
				<a href="https://campusempresa.com/mod/firebase/06-04-advanced-messaging-features" class="px-2">ES</a></b>
				|
				<a href="https://campusempresa.cat/mod/firebase/06-04-advanced-messaging-features" class="px-2">CA</a>
					</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="/objective">The Project</a>
				<a href="/about">About Us</a>
				<a href="/contribute">Contribute</a>
				<a href="/donate">Donations</a>
				<a href="/licence">License</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content">
								<div class='row navigation'>
	<div class='col-2'>
					<a href='06-03-handling-notifications' title="Handling Notifications">&#x25C4;Previous</a>
			</div>
	<div class='col-8 text-center'>
					<a href="./"><h2 style="text-decoration:underline">Advanced Messaging Features</h2></a>
			</div>
	<div class='col-2 text-end'>
					<a href='07-01-introduction-to-firebase-analytics' title="Introduction to Firebase Analytics">Next &#x25BA;</a>
			</div>
</div>
<div class='content'><p>In this section, we will delve into the advanced features of Firebase Cloud Messaging (FCM) that allow you to create more sophisticated and targeted messaging solutions. These features include topics such as message scheduling, message targeting, and integrating with other Firebase services.</p>
</div><h1>Key Concepts</h1>
<div class='content'><ol>
<li><strong>Message Scheduling</strong>: Sending messages at a specific time.</li>
<li><strong>Message Targeting</strong>: Sending messages to specific groups of users.</li>
<li><strong>Data Messages</strong>: Sending messages that contain custom data.</li>
<li><strong>Integration with Other Firebase Services</strong>: Using FCM in conjunction with other Firebase services like Analytics and Remote Config.</li>
</ol>
</div><h1>Message Scheduling</h1>
<div class='content'><p>Message scheduling allows you to send messages at a specific time. This can be useful for sending reminders, promotional messages, or any time-sensitive information.</p>
</div><h2>Example: Scheduling a Message</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y29uc3QgYWRtaW4gPSByZXF1aXJlKCdmaXJlYmFzZS1hZG1pbicpOwphZG1pbi5pbml0aWFsaXplQXBwKCk7Cgpjb25zdCBtZXNzYWdlID0gewogIG5vdGlmaWNhdGlvbjogewogICAgdGl0bGU6ICdTY2hlZHVsZWQgTWVzc2FnZScsCiAgICBib2R5OiAnVGhpcyBpcyBhIHNjaGVkdWxlZCBtZXNzYWdlLicKICB9LAogIHRvcGljOiAnc2NoZWR1bGVkLW1lc3NhZ2VzJywKICBhbmRyb2lkOiB7CiAgICB0dGw6IDM2MDAgKiAxMDAwLCAvLyAxIGhvdXIgaW4gbWlsbGlzZWNvbmRzCiAgICBwcmlvcml0eTogJ2hpZ2gnLAogICAgdGltZVRvTGl2ZTogMzYwMCAvLyAxIGhvdXIgaW4gc2Vjb25kcwogIH0KfTsKCi8vIFNjaGVkdWxlIHRoZSBtZXNzYWdlIHRvIGJlIHNlbnQgaW4gMSBob3VyCmNvbnN0IHNlbmRUaW1lID0gRGF0ZS5ub3coKSArIDM2MDAgKiAxMDAwOwoKYWRtaW4ubWVzc2FnaW5nKCkuc2VuZChtZXNzYWdlLCB7IHNlbmRUaW1lIH0pCiAgLnRoZW4ocmVzcG9uc2UgPT4gewogICAgY29uc29sZS5sb2coJ1N1Y2Nlc3NmdWxseSBzY2hlZHVsZWQgbWVzc2FnZTonLCByZXNwb25zZSk7CiAgfSkKICAuY2F0Y2goZXJyb3IgPT4gewogICAgY29uc29sZS5sb2coJ0Vycm9yIHNjaGVkdWxpbmcgbWVzc2FnZTonLCBlcnJvcik7CiAgfSk7"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>const admin = require('firebase-admin');
admin.initializeApp();

const message = {
  notification: {
    title: 'Scheduled Message',
    body: 'This is a scheduled message.'
  },
  topic: 'scheduled-messages',
  android: {
    ttl: 3600 * 1000, // 1 hour in milliseconds
    priority: 'high',
    timeToLive: 3600 // 1 hour in seconds
  }
};

// Schedule the message to be sent in 1 hour
const sendTime = Date.now() + 3600 * 1000;

admin.messaging().send(message, { sendTime })
  .then(response =&gt; {
    console.log('Successfully scheduled message:', response);
  })
  .catch(error =&gt; {
    console.log('Error scheduling message:', error);
  });</pre></div><div class='content'></div><h2>Explanation</h2>
<div class='content'><ul>
<li><strong>ttl</strong>: Time-to-live for the message.</li>
<li><strong>priority</strong>: Priority of the message.</li>
<li><strong>sendTime</strong>: The time at which the message should be sent.</li>
</ul>
</div><h1>Message Targeting</h1>
<div class='content'><p>Message targeting allows you to send messages to specific groups of users based on various criteria such as user properties, topics, or device groups.</p>
</div><h2>Example: Targeting a Topic</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y29uc3QgbWVzc2FnZSA9IHsKICBub3RpZmljYXRpb246IHsKICAgIHRpdGxlOiAnVG9waWMgTWVzc2FnZScsCiAgICBib2R5OiAnVGhpcyBtZXNzYWdlIGlzIGZvciBhIHNwZWNpZmljIHRvcGljLicKICB9LAogIHRvcGljOiAnbmV3cycKfTsKCmFkbWluLm1lc3NhZ2luZygpLnNlbmQobWVzc2FnZSkKICAudGhlbihyZXNwb25zZSA9PiB7CiAgICBjb25zb2xlLmxvZygnU3VjY2Vzc2Z1bGx5IHNlbnQgbWVzc2FnZTonLCByZXNwb25zZSk7CiAgfSkKICAuY2F0Y2goZXJyb3IgPT4gewogICAgY29uc29sZS5sb2coJ0Vycm9yIHNlbmRpbmcgbWVzc2FnZTonLCBlcnJvcik7CiAgfSk7"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>const message = {
  notification: {
    title: 'Topic Message',
    body: 'This message is for a specific topic.'
  },
  topic: 'news'
};

admin.messaging().send(message)
  .then(response =&gt; {
    console.log('Successfully sent message:', response);
  })
  .catch(error =&gt; {
    console.log('Error sending message:', error);
  });</pre></div><div class='content'></div><h2>Explanation</h2>
<div class='content'><ul>
<li><strong>topic</strong>: The topic to which the message should be sent.</li>
</ul>
</div><h1>Data Messages</h1>
<div class='content'><p>Data messages allow you to send custom data to your app. These messages do not display notifications but can be used to trigger specific actions within your app.</p>
</div><h2>Example: Sending a Data Message</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y29uc3QgbWVzc2FnZSA9IHsKICBkYXRhOiB7CiAgICBrZXkxOiAndmFsdWUxJywKICAgIGtleTI6ICd2YWx1ZTInCiAgfSwKICB0b2tlbjogJ3VzZXItZGV2aWNlLXRva2VuJwp9OwoKYWRtaW4ubWVzc2FnaW5nKCkuc2VuZChtZXNzYWdlKQogIC50aGVuKHJlc3BvbnNlID0+IHsKICAgIGNvbnNvbGUubG9nKCdTdWNjZXNzZnVsbHkgc2VudCBkYXRhIG1lc3NhZ2U6JywgcmVzcG9uc2UpOwogIH0pCiAgLmNhdGNoKGVycm9yID0+IHsKICAgIGNvbnNvbGUubG9nKCdFcnJvciBzZW5kaW5nIGRhdGEgbWVzc2FnZTonLCBlcnJvcik7CiAgfSk7"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>const message = {
  data: {
    key1: 'value1',
    key2: 'value2'
  },
  token: 'user-device-token'
};

admin.messaging().send(message)
  .then(response =&gt; {
    console.log('Successfully sent data message:', response);
  })
  .catch(error =&gt; {
    console.log('Error sending data message:', error);
  });</pre></div><div class='content'></div><h2>Explanation</h2>
<div class='content'><ul>
<li><strong>data</strong>: Custom data to be sent.</li>
<li><strong>token</strong>: The device token of the recipient.</li>
</ul>
</div><h1>Integration with Other Firebase Services</h1>
<div class='content'><p>FCM can be integrated with other Firebase services to enhance your messaging capabilities.</p>
</div><h2>Example: Using FCM with Firebase Analytics</h2>
<div class='content'><p>You can use Firebase Analytics to create user segments and target them with FCM.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y29uc3QgYW5hbHl0aWNzID0gcmVxdWlyZSgnZmlyZWJhc2UtYW5hbHl0aWNzJyk7CmNvbnN0IG1lc3NhZ2luZyA9IHJlcXVpcmUoJ2ZpcmViYXNlLW1lc3NhZ2luZycpOwoKYW5hbHl0aWNzLmxvZ0V2ZW50KCdzZWxlY3RfY29udGVudCcsIHsKICBjb250ZW50X3R5cGU6ICdpbWFnZScsCiAgaXRlbV9pZDogJ1AxMjQ1MycKfSk7Cgpjb25zdCBtZXNzYWdlID0gewogIG5vdGlmaWNhdGlvbjogewogICAgdGl0bGU6ICdBbmFseXRpY3MgTWVzc2FnZScsCiAgICBib2R5OiAnVGhpcyBtZXNzYWdlIGlzIHRhcmdldGVkIGJhc2VkIG9uIGFuYWx5dGljcyBkYXRhLicKICB9LAogIHRvcGljOiAnYW5hbHl0aWNzLXVzZXJzJwp9OwoKbWVzc2FnaW5nLnNlbmQobWVzc2FnZSkKICAudGhlbihyZXNwb25zZSA9PiB7CiAgICBjb25zb2xlLmxvZygnU3VjY2Vzc2Z1bGx5IHNlbnQgbWVzc2FnZTonLCByZXNwb25zZSk7CiAgfSkKICAuY2F0Y2goZXJyb3IgPT4gewogICAgY29uc29sZS5sb2coJ0Vycm9yIHNlbmRpbmcgbWVzc2FnZTonLCBlcnJvcik7CiAgfSk7"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>const analytics = require('firebase-analytics');
const messaging = require('firebase-messaging');

analytics.logEvent('select_content', {
  content_type: 'image',
  item_id: 'P12453'
});

const message = {
  notification: {
    title: 'Analytics Message',
    body: 'This message is targeted based on analytics data.'
  },
  topic: 'analytics-users'
};

messaging.send(message)
  .then(response =&gt; {
    console.log('Successfully sent message:', response);
  })
  .catch(error =&gt; {
    console.log('Error sending message:', error);
  });</pre></div><div class='content'></div><h2>Explanation</h2>
<div class='content'><ul>
<li><strong>logEvent</strong>: Logs an event in Firebase Analytics.</li>
<li><strong>topic</strong>: The topic to which the message should be sent.</li>
</ul>
</div><h1>Practical Exercises</h1>
<div class='content'></div><h2>Exercise 1: Schedule a Promotional Message</h2>
<div class='content'><p><strong>Task</strong>: Schedule a promotional message to be sent at a specific time.</p>
<p><strong>Solution</strong>:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y29uc3QgbWVzc2FnZSA9IHsKICBub3RpZmljYXRpb246IHsKICAgIHRpdGxlOiAnUHJvbW90aW9uYWwgT2ZmZXInLAogICAgYm9keTogJ0dldCAyMCUgb2ZmIG9uIHlvdXIgbmV4dCBwdXJjaGFzZSEnCiAgfSwKICB0b3BpYzogJ3Byb21vdGlvbnMnLAogIGFuZHJvaWQ6IHsKICAgIHR0bDogNzIwMCAqIDEwMDAsIC8vIDIgaG91cnMgaW4gbWlsbGlzZWNvbmRzCiAgICBwcmlvcml0eTogJ2hpZ2gnLAogICAgdGltZVRvTGl2ZTogNzIwMCAvLyAyIGhvdXJzIGluIHNlY29uZHMKICB9Cn07CgovLyBTY2hlZHVsZSB0aGUgbWVzc2FnZSB0byBiZSBzZW50IGluIDIgaG91cnMKY29uc3Qgc2VuZFRpbWUgPSBEYXRlLm5vdygpICsgNzIwMCAqIDEwMDA7CgphZG1pbi5tZXNzYWdpbmcoKS5zZW5kKG1lc3NhZ2UsIHsgc2VuZFRpbWUgfSkKICAudGhlbihyZXNwb25zZSA9PiB7CiAgICBjb25zb2xlLmxvZygnU3VjY2Vzc2Z1bGx5IHNjaGVkdWxlZCBwcm9tb3Rpb25hbCBtZXNzYWdlOicsIHJlc3BvbnNlKTsKICB9KQogIC5jYXRjaChlcnJvciA9PiB7CiAgICBjb25zb2xlLmxvZygnRXJyb3Igc2NoZWR1bGluZyBwcm9tb3Rpb25hbCBtZXNzYWdlOicsIGVycm9yKTsKICB9KTs="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>const message = {
  notification: {
    title: 'Promotional Offer',
    body: 'Get 20% off on your next purchase!'
  },
  topic: 'promotions',
  android: {
    ttl: 7200 * 1000, // 2 hours in milliseconds
    priority: 'high',
    timeToLive: 7200 // 2 hours in seconds
  }
};

// Schedule the message to be sent in 2 hours
const sendTime = Date.now() + 7200 * 1000;

admin.messaging().send(message, { sendTime })
  .then(response =&gt; {
    console.log('Successfully scheduled promotional message:', response);
  })
  .catch(error =&gt; {
    console.log('Error scheduling promotional message:', error);
  });</pre></div><div class='content'></div><h2>Exercise 2: Send a Data Message to a Specific User</h2>
<div class='content'><p><strong>Task</strong>: Send a data message containing custom data to a specific user.</p>
<p><strong>Solution</strong>:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y29uc3QgbWVzc2FnZSA9IHsKICBkYXRhOiB7CiAgICBkaXNjb3VudENvZGU6ICdTQVZFMjAnLAogICAgZXhwaXJ5RGF0ZTogJzIwMjMtMTItMzEnCiAgfSwKICB0b2tlbjogJ3NwZWNpZmljLXVzZXItZGV2aWNlLXRva2VuJwp9OwoKYWRtaW4ubWVzc2FnaW5nKCkuc2VuZChtZXNzYWdlKQogIC50aGVuKHJlc3BvbnNlID0+IHsKICAgIGNvbnNvbGUubG9nKCdTdWNjZXNzZnVsbHkgc2VudCBkYXRhIG1lc3NhZ2U6JywgcmVzcG9uc2UpOwogIH0pCiAgLmNhdGNoKGVycm9yID0+IHsKICAgIGNvbnNvbGUubG9nKCdFcnJvciBzZW5kaW5nIGRhdGEgbWVzc2FnZTonLCBlcnJvcik7CiAgfSk7"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>const message = {
  data: {
    discountCode: 'SAVE20',
    expiryDate: '2023-12-31'
  },
  token: 'specific-user-device-token'
};

admin.messaging().send(message)
  .then(response =&gt; {
    console.log('Successfully sent data message:', response);
  })
  .catch(error =&gt; {
    console.log('Error sending data message:', error);
  });</pre></div><div class='content'></div><h1>Common Mistakes and Tips</h1>
<div class='content'><ul>
<li><strong>Incorrect Token</strong>: Ensure that the device token is correct and up-to-date.</li>
<li><strong>Time-to-Live (TTL)</strong>: Be mindful of the TTL value to ensure messages are delivered within the desired timeframe.</li>
<li><strong>Topic Subscription</strong>: Ensure users are subscribed to the correct topics to receive targeted messages.</li>
</ul>
</div><h1>Conclusion</h1>
<div class='content'><p>In this section, we explored advanced messaging features in Firebase Cloud Messaging, including message scheduling, targeting, data messages, and integration with other Firebase services. These features allow you to create more sophisticated and targeted messaging solutions, enhancing user engagement and experience. In the next module, we will dive into Firebase Analytics to understand how to log events, set user properties, and analyze data.</p>
</div><div class='row navigation'>
	<div class='col-2'>
					<a href='06-03-handling-notifications' title="Handling Notifications">&#x25C4;Previous</a>
			</div>
	<div class='col-8 text-center'>
			</div>
	<div class='col-2 text-end'>
					<a href='07-01-introduction-to-firebase-analytics' title="Introduction to Firebase Analytics">Next &#x25BA;</a>
			</div>
</div>

			</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Advertising</h1>
			<p>This space is reserved for advertising.</p>
			<p>If you want to be a sponsor, contact us to include links in this area: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Thank you for collaborating!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. All rights reserved</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir galetes per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Accept</a>
    <a href="/cookies">More Information</a>
</div>	

	</div>    
</body>
</html>
