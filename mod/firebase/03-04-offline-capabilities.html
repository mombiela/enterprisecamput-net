<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Offline Capabilities</title>

    <link rel="alternate" href="https://campusempresa.com/mod/firebase/03-04-offline-capabilities" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/mod/firebase/03-04-offline-capabilities" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/mod/firebase/03-04-offline-capabilities" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body >
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-8 p-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo-header_enterprise.png"></a>
			</h1>
		</div>
		<div class="col-4 p-0 text-end">
			<h2 id="main_title"><cite>Building today's and tomorrow's society</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-0 m-0 text-end">
													<b id="lit_lang_es" class="px-2">EN</b>
				|
				<a href="https://campusempresa.com/mod/firebase/03-04-offline-capabilities" class="px-2">ES</a></b>
				|
				<a href="https://campusempresa.cat/mod/firebase/03-04-offline-capabilities" class="px-2">CA</a>
					</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="/objective">The Project</a>
				<a href="/about">About Us</a>
				<a href="/contribute">Contribute</a>
				<a href="/donate">Donations</a>
				<a href="/licence">License</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content">
								<div class='row navigation'>
	<div class='col-2'>
					<a href='03-03-data-structure-and-security-rules' title="Data Structure and Security Rules">&#x25C4;Previous</a>
			</div>
	<div class='col-8 text-center'>
					<a href="./"><h2 style="text-decoration:underline">Offline Capabilities</h2></a>
			</div>
	<div class='col-2 text-end'>
					<a href='04-01-introduction-to-cloud-firestore' title="Introduction to Cloud Firestore">Next &#x25BA;</a>
			</div>
</div>
<div class='content'><p>In this section, we will explore the offline capabilities of Firebase Realtime Database. Firebase provides robust support for offline data access, ensuring that your app remains functional even when the user is not connected to the internet. This is particularly useful for mobile applications where connectivity can be intermittent.</p>
</div><h1>Key Concepts</h1>
<div class='content'><ol>
<li><strong>Local Data Storage</strong>: Firebase Realtime Database stores data locally on the device, allowing read and write operations to be performed even when offline.</li>
<li><strong>Data Synchronization</strong>: Once the device regains connectivity, Firebase automatically synchronizes the local data with the server.</li>
<li><strong>Persistence</strong>: Data is persisted across app restarts, ensuring that the user’s data is not lost.</li>
</ol>
</div><h1>Enabling Offline Capabilities</h1>
<div class='content'><p>To enable offline capabilities in your Firebase Realtime Database, you need to set the persistence to true. This can be done with a simple configuration in your app.</p>
</div><h2>Example: Enabling Offline Capabilities in Android</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Ly8gSW5pdGlhbGl6ZSBGaXJlYmFzZQpGaXJlYmFzZURhdGFiYXNlIGRhdGFiYXNlID0gRmlyZWJhc2VEYXRhYmFzZS5nZXRJbnN0YW5jZSgpOwoKLy8gRW5hYmxlIG9mZmxpbmUgY2FwYWJpbGl0aWVzCmRhdGFiYXNlLnNldFBlcnNpc3RlbmNlRW5hYmxlZCh0cnVlKTs="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>// Initialize Firebase
FirebaseDatabase database = FirebaseDatabase.getInstance();

// Enable offline capabilities
database.setPersistenceEnabled(true);</pre></div><div class='content'></div><h2>Example: Enabling Offline Capabilities in JavaScript</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Ly8gSW5pdGlhbGl6ZSBGaXJlYmFzZQp2YXIgZGF0YWJhc2UgPSBmaXJlYmFzZS5kYXRhYmFzZSgpOwoKLy8gRW5hYmxlIG9mZmxpbmUgY2FwYWJpbGl0aWVzCmZpcmViYXNlLmRhdGFiYXNlKCkucmVmKCkua2VlcFN5bmNlZCh0cnVlKTs="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>// Initialize Firebase
var database = firebase.database();

// Enable offline capabilities
firebase.database().ref().keepSynced(true);</pre></div><div class='content'></div><h1>Reading and Writing Data Offline</h1>
<div class='content'><p>When offline, Firebase Realtime Database allows you to read and write data as if you were online. The data is stored locally and synchronized with the server once the connection is restored.</p>
</div><h2>Example: Writing Data Offline in Android</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("RGF0YWJhc2VSZWZlcmVuY2UgbXlSZWYgPSBkYXRhYmFzZS5nZXRSZWZlcmVuY2UoIm1lc3NhZ2UiKTsKCi8vIFdyaXRlIGRhdGEgdG8gdGhlIGRhdGFiYXNlCm15UmVmLnNldFZhbHVlKCJIZWxsbywgV29ybGQhIik7"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>DatabaseReference myRef = database.getReference(&quot;message&quot;);

// Write data to the database
myRef.setValue(&quot;Hello, World!&quot;);</pre></div><div class='content'></div><h2>Example: Reading Data Offline in JavaScript</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("dmFyIG1lc3NhZ2VSZWYgPSBmaXJlYmFzZS5kYXRhYmFzZSgpLnJlZignbWVzc2FnZScpOwoKLy8gUmVhZCBkYXRhIGZyb20gdGhlIGRhdGFiYXNlCm1lc3NhZ2VSZWYub24oJ3ZhbHVlJywgKHNuYXBzaG90KSA9PiB7CiAgY29uc3QgZGF0YSA9IHNuYXBzaG90LnZhbCgpOwogIGNvbnNvbGUubG9nKGRhdGEpOwp9KTs="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>var messageRef = firebase.database().ref('message');

// Read data from the database
messageRef.on('value', (snapshot) =&gt; {
  const data = snapshot.val();
  console.log(data);
});</pre></div><div class='content'></div><h1>Handling Connectivity Changes</h1>
<div class='content'><p>Firebase provides listeners to handle connectivity changes, allowing you to update your app’s UI or perform specific actions when the connection state changes.</p>
</div><h2>Example: Handling Connectivity Changes in Android</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("RGF0YWJhc2VSZWZlcmVuY2UgY29ubmVjdGVkUmVmID0gRmlyZWJhc2VEYXRhYmFzZS5nZXRJbnN0YW5jZSgpLmdldFJlZmVyZW5jZSgiLmluZm8vY29ubmVjdGVkIik7CmNvbm5lY3RlZFJlZi5hZGRWYWx1ZUV2ZW50TGlzdGVuZXIobmV3IFZhbHVlRXZlbnRMaXN0ZW5lcigpIHsKICBAT3ZlcnJpZGUKICBwdWJsaWMgdm9pZCBvbkRhdGFDaGFuZ2UoRGF0YVNuYXBzaG90IHNuYXBzaG90KSB7CiAgICBib29sZWFuIGNvbm5lY3RlZCA9IHNuYXBzaG90LmdldFZhbHVlKEJvb2xlYW4uY2xhc3MpOwogICAgaWYgKGNvbm5lY3RlZCkgewogICAgICBTeXN0ZW0ub3V0LnByaW50bG4oIkNvbm5lY3RlZCB0byBGaXJlYmFzZSIpOwogICAgfSBlbHNlIHsKICAgICAgU3lzdGVtLm91dC5wcmludGxuKCJEaXNjb25uZWN0ZWQgZnJvbSBGaXJlYmFzZSIpOwogICAgfQogIH0KCiAgQE92ZXJyaWRlCiAgcHVibGljIHZvaWQgb25DYW5jZWxsZWQoRGF0YWJhc2VFcnJvciBlcnJvcikgewogICAgU3lzdGVtLmVyci5wcmludGxuKCJMaXN0ZW5lciB3YXMgY2FuY2VsbGVkIik7CiAgfQp9KTs="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>DatabaseReference connectedRef = FirebaseDatabase.getInstance().getReference(&quot;.info/connected&quot;);
connectedRef.addValueEventListener(new ValueEventListener() {
  @Override
  public void onDataChange(DataSnapshot snapshot) {
    boolean connected = snapshot.getValue(Boolean.class);
    if (connected) {
      System.out.println(&quot;Connected to Firebase&quot;);
    } else {
      System.out.println(&quot;Disconnected from Firebase&quot;);
    }
  }

  @Override
  public void onCancelled(DatabaseError error) {
    System.err.println(&quot;Listener was cancelled&quot;);
  }
});</pre></div><div class='content'></div><h2>Example: Handling Connectivity Changes in JavaScript</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("dmFyIGNvbm5lY3RlZFJlZiA9IGZpcmViYXNlLmRhdGFiYXNlKCkucmVmKCIuaW5mby9jb25uZWN0ZWQiKTsKY29ubmVjdGVkUmVmLm9uKCJ2YWx1ZSIsIGZ1bmN0aW9uKHNuYXBzaG90KSB7CiAgaWYgKHNuYXBzaG90LnZhbCgpID09PSB0cnVlKSB7CiAgICBjb25zb2xlLmxvZygiQ29ubmVjdGVkIHRvIEZpcmViYXNlIik7CiAgfSBlbHNlIHsKICAgIGNvbnNvbGUubG9nKCJEaXNjb25uZWN0ZWQgZnJvbSBGaXJlYmFzZSIpOwogIH0KfSk7"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>var connectedRef = firebase.database().ref(&quot;.info/connected&quot;);
connectedRef.on(&quot;value&quot;, function(snapshot) {
  if (snapshot.val() === true) {
    console.log(&quot;Connected to Firebase&quot;);
  } else {
    console.log(&quot;Disconnected from Firebase&quot;);
  }
});</pre></div><div class='content'></div><h1>Practical Exercise</h1>
<div class='content'></div><h2>Task: Implement Offline Capabilities</h2>
<div class='content'><ol>
<li><strong>Objective</strong>: Enable offline capabilities in a simple Firebase Realtime Database app.</li>
<li><strong>Steps</strong>:
<ul>
<li>Initialize Firebase in your app.</li>
<li>Enable offline capabilities.</li>
<li>Write a piece of data to the database.</li>
<li>Read the data from the database.</li>
<li>Handle connectivity changes and log the connection state.</li>
</ul>
</li>
</ol>
</div><h2>Solution</h2>
<div class='content'><h4>Android</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Ly8gSW5pdGlhbGl6ZSBGaXJlYmFzZQpGaXJlYmFzZURhdGFiYXNlIGRhdGFiYXNlID0gRmlyZWJhc2VEYXRhYmFzZS5nZXRJbnN0YW5jZSgpOwoKLy8gRW5hYmxlIG9mZmxpbmUgY2FwYWJpbGl0aWVzCmRhdGFiYXNlLnNldFBlcnNpc3RlbmNlRW5hYmxlZCh0cnVlKTsKCi8vIFJlZmVyZW5jZSB0byB0aGUgbWVzc2FnZSBub2RlCkRhdGFiYXNlUmVmZXJlbmNlIG15UmVmID0gZGF0YWJhc2UuZ2V0UmVmZXJlbmNlKCJtZXNzYWdlIik7CgovLyBXcml0ZSBkYXRhIHRvIHRoZSBkYXRhYmFzZQpteVJlZi5zZXRWYWx1ZSgiSGVsbG8sIFdvcmxkISIpOwoKLy8gUmVhZCBkYXRhIGZyb20gdGhlIGRhdGFiYXNlCm15UmVmLmFkZFZhbHVlRXZlbnRMaXN0ZW5lcihuZXcgVmFsdWVFdmVudExpc3RlbmVyKCkgewogIEBPdmVycmlkZQogIHB1YmxpYyB2b2lkIG9uRGF0YUNoYW5nZShEYXRhU25hcHNob3QgZGF0YVNuYXBzaG90KSB7CiAgICBTdHJpbmcgbWVzc2FnZSA9IGRhdGFTbmFwc2hvdC5nZXRWYWx1ZShTdHJpbmcuY2xhc3MpOwogICAgU3lzdGVtLm91dC5wcmludGxuKCJNZXNzYWdlOiAiICsgbWVzc2FnZSk7CiAgfQoKICBAT3ZlcnJpZGUKICBwdWJsaWMgdm9pZCBvbkNhbmNlbGxlZChEYXRhYmFzZUVycm9yIGVycm9yKSB7CiAgICBTeXN0ZW0uZXJyLnByaW50bG4oIkZhaWxlZCB0byByZWFkIHZhbHVlOiAiICsgZXJyb3IudG9FeGNlcHRpb24oKSk7CiAgfQp9KTsKCi8vIEhhbmRsZSBjb25uZWN0aXZpdHkgY2hhbmdlcwpEYXRhYmFzZVJlZmVyZW5jZSBjb25uZWN0ZWRSZWYgPSBGaXJlYmFzZURhdGFiYXNlLmdldEluc3RhbmNlKCkuZ2V0UmVmZXJlbmNlKCIuaW5mby9jb25uZWN0ZWQiKTsKY29ubmVjdGVkUmVmLmFkZFZhbHVlRXZlbnRMaXN0ZW5lcihuZXcgVmFsdWVFdmVudExpc3RlbmVyKCkgewogIEBPdmVycmlkZQogIHB1YmxpYyB2b2lkIG9uRGF0YUNoYW5nZShEYXRhU25hcHNob3Qgc25hcHNob3QpIHsKICAgIGJvb2xlYW4gY29ubmVjdGVkID0gc25hcHNob3QuZ2V0VmFsdWUoQm9vbGVhbi5jbGFzcyk7CiAgICBpZiAoY29ubmVjdGVkKSB7CiAgICAgIFN5c3RlbS5vdXQucHJpbnRsbigiQ29ubmVjdGVkIHRvIEZpcmViYXNlIik7CiAgICB9IGVsc2UgewogICAgICBTeXN0ZW0ub3V0LnByaW50bG4oIkRpc2Nvbm5lY3RlZCBmcm9tIEZpcmViYXNlIik7CiAgICB9CiAgfQoKICBAT3ZlcnJpZGUKICBwdWJsaWMgdm9pZCBvbkNhbmNlbGxlZChEYXRhYmFzZUVycm9yIGVycm9yKSB7CiAgICBTeXN0ZW0uZXJyLnByaW50bG4oIkxpc3RlbmVyIHdhcyBjYW5jZWxsZWQiKTsKICB9Cn0pOw=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>// Initialize Firebase
FirebaseDatabase database = FirebaseDatabase.getInstance();

// Enable offline capabilities
database.setPersistenceEnabled(true);

// Reference to the message node
DatabaseReference myRef = database.getReference(&quot;message&quot;);

// Write data to the database
myRef.setValue(&quot;Hello, World!&quot;);

// Read data from the database
myRef.addValueEventListener(new ValueEventListener() {
  @Override
  public void onDataChange(DataSnapshot dataSnapshot) {
    String message = dataSnapshot.getValue(String.class);
    System.out.println(&quot;Message: &quot; + message);
  }

  @Override
  public void onCancelled(DatabaseError error) {
    System.err.println(&quot;Failed to read value: &quot; + error.toException());
  }
});

// Handle connectivity changes
DatabaseReference connectedRef = FirebaseDatabase.getInstance().getReference(&quot;.info/connected&quot;);
connectedRef.addValueEventListener(new ValueEventListener() {
  @Override
  public void onDataChange(DataSnapshot snapshot) {
    boolean connected = snapshot.getValue(Boolean.class);
    if (connected) {
      System.out.println(&quot;Connected to Firebase&quot;);
    } else {
      System.out.println(&quot;Disconnected from Firebase&quot;);
    }
  }

  @Override
  public void onCancelled(DatabaseError error) {
    System.err.println(&quot;Listener was cancelled&quot;);
  }
});</pre></div><div class='content'><h4>JavaScript</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Ly8gSW5pdGlhbGl6ZSBGaXJlYmFzZQp2YXIgZGF0YWJhc2UgPSBmaXJlYmFzZS5kYXRhYmFzZSgpOwoKLy8gRW5hYmxlIG9mZmxpbmUgY2FwYWJpbGl0aWVzCmZpcmViYXNlLmRhdGFiYXNlKCkucmVmKCkua2VlcFN5bmNlZCh0cnVlKTsKCi8vIFJlZmVyZW5jZSB0byB0aGUgbWVzc2FnZSBub2RlCnZhciBtZXNzYWdlUmVmID0gZmlyZWJhc2UuZGF0YWJhc2UoKS5yZWYoJ21lc3NhZ2UnKTsKCi8vIFdyaXRlIGRhdGEgdG8gdGhlIGRhdGFiYXNlCm1lc3NhZ2VSZWYuc2V0KCJIZWxsbywgV29ybGQhIik7CgovLyBSZWFkIGRhdGEgZnJvbSB0aGUgZGF0YWJhc2UKbWVzc2FnZVJlZi5vbigndmFsdWUnLCAoc25hcHNob3QpID0+IHsKICBjb25zdCBkYXRhID0gc25hcHNob3QudmFsKCk7CiAgY29uc29sZS5sb2coIk1lc3NhZ2U6ICIgKyBkYXRhKTsKfSk7CgovLyBIYW5kbGUgY29ubmVjdGl2aXR5IGNoYW5nZXMKdmFyIGNvbm5lY3RlZFJlZiA9IGZpcmViYXNlLmRhdGFiYXNlKCkucmVmKCIuaW5mby9jb25uZWN0ZWQiKTsKY29ubmVjdGVkUmVmLm9uKCJ2YWx1ZSIsIGZ1bmN0aW9uKHNuYXBzaG90KSB7CiAgaWYgKHNuYXBzaG90LnZhbCgpID09PSB0cnVlKSB7CiAgICBjb25zb2xlLmxvZygiQ29ubmVjdGVkIHRvIEZpcmViYXNlIik7CiAgfSBlbHNlIHsKICAgIGNvbnNvbGUubG9nKCJEaXNjb25uZWN0ZWQgZnJvbSBGaXJlYmFzZSIpOwogIH0KfSk7"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>// Initialize Firebase
var database = firebase.database();

// Enable offline capabilities
firebase.database().ref().keepSynced(true);

// Reference to the message node
var messageRef = firebase.database().ref('message');

// Write data to the database
messageRef.set(&quot;Hello, World!&quot;);

// Read data from the database
messageRef.on('value', (snapshot) =&gt; {
  const data = snapshot.val();
  console.log(&quot;Message: &quot; + data);
});

// Handle connectivity changes
var connectedRef = firebase.database().ref(&quot;.info/connected&quot;);
connectedRef.on(&quot;value&quot;, function(snapshot) {
  if (snapshot.val() === true) {
    console.log(&quot;Connected to Firebase&quot;);
  } else {
    console.log(&quot;Disconnected from Firebase&quot;);
  }
});</pre></div><div class='content'></div><h1>Common Mistakes and Tips</h1>
<div class='content'><ul>
<li><strong>Not Enabling Persistence</strong>: Ensure that you enable persistence by setting <code>setPersistenceEnabled(true)</code> in Android or <code>keepSynced(true)</code> in JavaScript.</li>
<li><strong>Handling Data Conflicts</strong>: Be aware of potential data conflicts when the device reconnects. Firebase handles most conflicts automatically, but you may need to implement custom conflict resolution logic for complex scenarios.</li>
<li><strong>Testing Offline Scenarios</strong>: Test your app thoroughly in offline scenarios to ensure that it behaves as expected.</li>
</ul>
</div><h1>Conclusion</h1>
<div class='content'><p>In this section, we covered the offline capabilities of Firebase Realtime Database, including enabling offline support, reading and writing data offline, and handling connectivity changes. These features ensure that your app remains functional and provides a seamless user experience even when the user is offline. In the next module, we will dive into Cloud Firestore, another powerful database service provided by Firebase.</p>
</div><div class='row navigation'>
	<div class='col-2'>
					<a href='03-03-data-structure-and-security-rules' title="Data Structure and Security Rules">&#x25C4;Previous</a>
			</div>
	<div class='col-8 text-center'>
			</div>
	<div class='col-2 text-end'>
					<a href='04-01-introduction-to-cloud-firestore' title="Introduction to Cloud Firestore">Next &#x25BA;</a>
			</div>
</div>

			</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Advertising</h1>
			<p>This space is reserved for advertising.</p>
			<p>If you want to be a sponsor, contact us to include links in this area: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Thank you for collaborating!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. All rights reserved</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir galetes per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Accept</a>
    <a href="/cookies">More Information</a>
</div>	

	</div>    
</body>
</html>
