<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow, noarchive">
    <title>Advanced Queries</title>

    <link rel="alternate" href="https://campusempresa.com/mod/firebase/04-04-advanced-queries" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/mod/firebase/04-04-advanced-queries" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/mod/firebase/04-04-advanced-queries" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css?v=4" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="/js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
	<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-0611338592562725" crossorigin="anonymous"></script>  	
	</head>

<body >
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-12 col-md-6 p-2 p-md-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo-header_enterprise.png"></a>
			</h1>
		</div>
		<div class="col-12 col-md-6 p-2 p-md-0 text-end">
			<span>	<b id="lit_lang_es" class="px-2">EN</b>
	|
	<a href="https://campusempresa.com/mod/firebase/04-04-advanced-queries" class="px-2">ES</a></b>
	|
	<a href="https://campusempresa.cat/mod/firebase/04-04-advanced-queries" class="px-2">CA</a>
</span>
			<span class="d-none d-md-inline"><br><cite>All the knowledge within your reach</cite></span>
		</div>
	</div>
</div>
<div class="subheader container-xxl d-none d-md-block">
	<div class="row">
		<div class="col-12 p-2 p-md-0 m-0 text-end">
			<a href="/objective">The Project</a> | 
<a href="/about">About Us</a> | 
<a href="/contribute">Contribute</a> | 
<a href="/donate">Donations</a> | 
<a href="/licence">License</a>
		</div>
	</div>
</div>

<div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
					 				<a href="/"><i class="bi bi-house-fill"></i> HOME</a>
											</div>
		</div>
	</div>
</div>
		
<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content">
				<div class='row navigation'>
	<div class='col-1 col-md-2'>
					<a href='04-03-crud-operations' title="CRUD Operations">
				<span class="d-none d-md-inline">&#x25C4; Previous</span>
				<span class="d-inline d-md-none"><i class="bi bi-caret-left-square-fill"></i></span>
			</a>
			</div>
	<div class='col-10 col-md-8 text-center'>
					<a href="./"><h2 style="text-decoration:underline">Advanced Queries</h2></a>
			</div>
	<div class='col-1 col-md-2 text-end'>
					<a href='04-05-security-rules' title="Security Rules">
				<span class="d-none d-md-inline">Next &#x25BA;</span>
				<span class="d-inline d-md-none"><i class="bi bi-caret-right-square-fill"></i></span>
			</a>
			</div>
</div>
<div class='content'><p>In this section, we will delve into advanced querying techniques in Cloud Firestore. These techniques will help you retrieve data more efficiently and perform complex queries that go beyond basic CRUD operations.</p>
</div><h1>Key Concepts</h1>
<div class='content'><ol>
<li><strong>Compound Queries</strong>: Combining multiple conditions in a single query.</li>
<li><strong>Array-Contains Queries</strong>: Querying documents where a specific array field contains a certain value.</li>
<li><strong>In Queries</strong>: Querying documents where a field matches any value in a given list.</li>
<li><strong>Range Queries</strong>: Querying documents within a specific range of values.</li>
<li><strong>Pagination</strong>: Retrieving data in chunks to handle large datasets.</li>
<li><strong>Indexing</strong>: Optimizing queries with custom indexes.</li>
</ol>
</div><h1>Compound Queries</h1>
<div class='content'><p>Compound queries allow you to combine multiple conditions using logical operators.</p>
</div><h2>Example</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Ly8gUXVlcnkgZG9jdW1lbnRzIHdoZXJlICdhZ2UnIGlzIGdyZWF0ZXIgdGhhbiAyNSBhbmQgJ2NpdHknIGlzICdOZXcgWW9yaycKZGIuY29sbGVjdGlvbigidXNlcnMiKQogIC53aGVyZSgiYWdlIiwgIj4iLCAyNSkKICAud2hlcmUoImNpdHkiLCAiPT0iLCAiTmV3IFlvcmsiKQogIC5nZXQoKQogIC50aGVuKChxdWVyeVNuYXBzaG90KSA9PiB7CiAgICBxdWVyeVNuYXBzaG90LmZvckVhY2goKGRvYykgPT4gewogICAgICBjb25zb2xlLmxvZyhkb2MuaWQsICIgPT4gIiwgZG9jLmRhdGEoKSk7CiAgICB9KTsKICB9KQogIC5jYXRjaCgoZXJyb3IpID0+IHsKICAgIGNvbnNvbGUubG9nKCJFcnJvciBnZXR0aW5nIGRvY3VtZW50czogIiwgZXJyb3IpOwogIH0pOw=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>// Query documents where 'age' is greater than 25 and 'city' is 'New York'
db.collection(&quot;users&quot;)
  .where(&quot;age&quot;, &quot;&gt;&quot;, 25)
  .where(&quot;city&quot;, &quot;==&quot;, &quot;New York&quot;)
  .get()
  .then((querySnapshot) =&gt; {
    querySnapshot.forEach((doc) =&gt; {
      console.log(doc.id, &quot; =&gt; &quot;, doc.data());
    });
  })
  .catch((error) =&gt; {
    console.log(&quot;Error getting documents: &quot;, error);
  });</pre></div><div class='content'></div><h2>Explanation</h2>
<div class='content'><ul>
<li><code>where(&quot;age&quot;, &quot;&gt;&quot;, 25)</code>: Filters documents where the <code>age</code> field is greater than 25.</li>
<li><code>where(&quot;city&quot;, &quot;==&quot;, &quot;New York&quot;)</code>: Further filters documents where the <code>city</code> field is 'New York'.</li>
</ul>
</div><h1>Array-Contains Queries</h1>
<div class='content'><p>Array-contains queries allow you to filter documents where a specific array field contains a certain value.</p>
</div><h2>Example</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Ly8gUXVlcnkgZG9jdW1lbnRzIHdoZXJlICd0YWdzJyBhcnJheSBjb250YWlucyAnZmlyZWJhc2UnCmRiLmNvbGxlY3Rpb24oInBvc3RzIikKICAud2hlcmUoInRhZ3MiLCAiYXJyYXktY29udGFpbnMiLCAiZmlyZWJhc2UiKQogIC5nZXQoKQogIC50aGVuKChxdWVyeVNuYXBzaG90KSA9PiB7CiAgICBxdWVyeVNuYXBzaG90LmZvckVhY2goKGRvYykgPT4gewogICAgICBjb25zb2xlLmxvZyhkb2MuaWQsICIgPT4gIiwgZG9jLmRhdGEoKSk7CiAgICB9KTsKICB9KQogIC5jYXRjaCgoZXJyb3IpID0+IHsKICAgIGNvbnNvbGUubG9nKCJFcnJvciBnZXR0aW5nIGRvY3VtZW50czogIiwgZXJyb3IpOwogIH0pOw=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>// Query documents where 'tags' array contains 'firebase'
db.collection(&quot;posts&quot;)
  .where(&quot;tags&quot;, &quot;array-contains&quot;, &quot;firebase&quot;)
  .get()
  .then((querySnapshot) =&gt; {
    querySnapshot.forEach((doc) =&gt; {
      console.log(doc.id, &quot; =&gt; &quot;, doc.data());
    });
  })
  .catch((error) =&gt; {
    console.log(&quot;Error getting documents: &quot;, error);
  });</pre></div><div class='content'></div><h2>Explanation</h2>
<div class='content'><ul>
<li><code>where(&quot;tags&quot;, &quot;array-contains&quot;, &quot;firebase&quot;)</code>: Filters documents where the <code>tags</code> array contains the value 'firebase'.</li>
</ul>
</div><h1>In Queries</h1>
<div class='content'><p>In queries allow you to filter documents where a field matches any value in a given list.</p>
</div><h2>Example</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Ly8gUXVlcnkgZG9jdW1lbnRzIHdoZXJlICdzdGF0dXMnIGlzIGVpdGhlciAnYWN0aXZlJyBvciAncGVuZGluZycKZGIuY29sbGVjdGlvbigidGFza3MiKQogIC53aGVyZSgic3RhdHVzIiwgImluIiwgWyJhY3RpdmUiLCAicGVuZGluZyJdKQogIC5nZXQoKQogIC50aGVuKChxdWVyeVNuYXBzaG90KSA9PiB7CiAgICBxdWVyeVNuYXBzaG90LmZvckVhY2goKGRvYykgPT4gewogICAgICBjb25zb2xlLmxvZyhkb2MuaWQsICIgPT4gIiwgZG9jLmRhdGEoKSk7CiAgICB9KTsKICB9KQogIC5jYXRjaCgoZXJyb3IpID0+IHsKICAgIGNvbnNvbGUubG9nKCJFcnJvciBnZXR0aW5nIGRvY3VtZW50czogIiwgZXJyb3IpOwogIH0pOw=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>// Query documents where 'status' is either 'active' or 'pending'
db.collection(&quot;tasks&quot;)
  .where(&quot;status&quot;, &quot;in&quot;, [&quot;active&quot;, &quot;pending&quot;])
  .get()
  .then((querySnapshot) =&gt; {
    querySnapshot.forEach((doc) =&gt; {
      console.log(doc.id, &quot; =&gt; &quot;, doc.data());
    });
  })
  .catch((error) =&gt; {
    console.log(&quot;Error getting documents: &quot;, error);
  });</pre></div><div class='content'></div><h2>Explanation</h2>
<div class='content'><ul>
<li><code>where(&quot;status&quot;, &quot;in&quot;, [&quot;active&quot;, &quot;pending&quot;])</code>: Filters documents where the <code>status</code> field is either 'active' or 'pending'.</li>
</ul>
</div><h1>Range Queries</h1>
<div class='content'><p>Range queries allow you to filter documents within a specific range of values.</p>
</div><h2>Example</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Ly8gUXVlcnkgZG9jdW1lbnRzIHdoZXJlICdwcmljZScgaXMgYmV0d2VlbiAxMCBhbmQgNTAKZGIuY29sbGVjdGlvbigicHJvZHVjdHMiKQogIC53aGVyZSgicHJpY2UiLCAiPj0iLCAxMCkKICAud2hlcmUoInByaWNlIiwgIjw9IiwgNTApCiAgLmdldCgpCiAgLnRoZW4oKHF1ZXJ5U25hcHNob3QpID0+IHsKICAgIHF1ZXJ5U25hcHNob3QuZm9yRWFjaCgoZG9jKSA9PiB7CiAgICAgIGNvbnNvbGUubG9nKGRvYy5pZCwgIiA9PiAiLCBkb2MuZGF0YSgpKTsKICAgIH0pOwogIH0pCiAgLmNhdGNoKChlcnJvcikgPT4gewogICAgY29uc29sZS5sb2coIkVycm9yIGdldHRpbmcgZG9jdW1lbnRzOiAiLCBlcnJvcik7CiAgfSk7"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>// Query documents where 'price' is between 10 and 50
db.collection(&quot;products&quot;)
  .where(&quot;price&quot;, &quot;&gt;=&quot;, 10)
  .where(&quot;price&quot;, &quot;&lt;=&quot;, 50)
  .get()
  .then((querySnapshot) =&gt; {
    querySnapshot.forEach((doc) =&gt; {
      console.log(doc.id, &quot; =&gt; &quot;, doc.data());
    });
  })
  .catch((error) =&gt; {
    console.log(&quot;Error getting documents: &quot;, error);
  });</pre></div><div class='content'></div><h2>Explanation</h2>
<div class='content'><ul>
<li><code>where(&quot;price&quot;, &quot;&gt;=&quot;, 10)</code>: Filters documents where the <code>price</code> field is greater than or equal to 10.</li>
<li><code>where(&quot;price&quot;, &quot;&lt;=&quot;, 50)</code>: Further filters documents where the <code>price</code> field is less than or equal to 50.</li>
</ul>
</div><h1>Pagination</h1>
<div class='content'><p>Pagination helps in retrieving data in chunks, which is useful for handling large datasets.</p>
</div><h2>Example</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("bGV0IGZpcnN0ID0gZGIuY29sbGVjdGlvbigidXNlcnMiKQogIC5vcmRlckJ5KCJuYW1lIikKICAubGltaXQoMTApOwoKZmlyc3QuZ2V0KCkudGhlbigoZG9jdW1lbnRTbmFwc2hvdHMpID0+IHsKICAvLyBHZXQgdGhlIGxhc3QgdmlzaWJsZSBkb2N1bWVudAogIGxldCBsYXN0VmlzaWJsZSA9IGRvY3VtZW50U25hcHNob3RzLmRvY3NbZG9jdW1lbnRTbmFwc2hvdHMuZG9jcy5sZW5ndGgtMV07CgogIC8vIENvbnN0cnVjdCBhIG5ldyBxdWVyeSBzdGFydGluZyBhdCB0aGlzIGRvY3VtZW50CiAgbGV0IG5leHQgPSBkYi5jb2xsZWN0aW9uKCJ1c2VycyIpCiAgICAub3JkZXJCeSgibmFtZSIpCiAgICAuc3RhcnRBZnRlcihsYXN0VmlzaWJsZSkKICAgIC5saW1pdCgxMCk7CgogIG5leHQuZ2V0KCkudGhlbigocXVlcnlTbmFwc2hvdCkgPT4gewogICAgcXVlcnlTbmFwc2hvdC5mb3JFYWNoKChkb2MpID0+IHsKICAgICAgY29uc29sZS5sb2coZG9jLmlkLCAiID0+ICIsIGRvYy5kYXRhKCkpOwogICAgfSk7CiAgfSk7Cn0pOw=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>let first = db.collection(&quot;users&quot;)
  .orderBy(&quot;name&quot;)
  .limit(10);

first.get().then((documentSnapshots) =&gt; {
  // Get the last visible document
  let lastVisible = documentSnapshots.docs[documentSnapshots.docs.length-1];

  // Construct a new query starting at this document
  let next = db.collection(&quot;users&quot;)
    .orderBy(&quot;name&quot;)
    .startAfter(lastVisible)
    .limit(10);

  next.get().then((querySnapshot) =&gt; {
    querySnapshot.forEach((doc) =&gt; {
      console.log(doc.id, &quot; =&gt; &quot;, doc.data());
    });
  });
});</pre></div><div class='content'></div><h2>Explanation</h2>
<div class='content'><ul>
<li><code>orderBy(&quot;name&quot;)</code>: Orders the documents by the <code>name</code> field.</li>
<li><code>limit(10)</code>: Limits the query to 10 documents.</li>
<li><code>startAfter(lastVisible)</code>: Starts the next query after the last visible document from the previous query.</li>
</ul>
</div><h1>Indexing</h1>
<div class='content'><p>Custom indexes can optimize your queries, especially when using compound queries.</p>
</div><h2>Example</h2>
<div class='content'><p>To create a custom index, you need to use the Firebase Console. Navigate to the Firestore section, and under the Indexes tab, you can create a new index by specifying the fields and their order.</p>
</div><h2>Explanation</h2>
<div class='content'><ul>
<li>Custom indexes help in optimizing queries that involve multiple fields or complex conditions.</li>
</ul>
</div><h1>Practical Exercise</h1>
<div class='content'></div><h2>Task</h2>
<div class='content'><ol>
<li>Create a Firestore collection named <code>books</code>.</li>
<li>Add documents with the following fields: <code>title</code>, <code>author</code>, <code>genre</code>, <code>publishedYear</code>, and <code>ratings</code> (an array of numbers).</li>
<li>Write a query to retrieve books published after the year 2000 and have a rating of at least 4.</li>
</ol>
</div><h2>Solution</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Ly8gQWRkIHNhbXBsZSBkb2N1bWVudHMKZGIuY29sbGVjdGlvbigiYm9va3MiKS5hZGQoewogIHRpdGxlOiAiQm9vayBPbmUiLAogIGF1dGhvcjogIkF1dGhvciBBIiwKICBnZW5yZTogIkZpY3Rpb24iLAogIHB1Ymxpc2hlZFllYXI6IDIwMDEsCiAgcmF0aW5nczogWzQsIDVdCn0pOwoKZGIuY29sbGVjdGlvbigiYm9va3MiKS5hZGQoewogIHRpdGxlOiAiQm9vayBUd28iLAogIGF1dGhvcjogIkF1dGhvciBCIiwKICBnZW5yZTogIk5vbi1GaWN0aW9uIiwKICBwdWJsaXNoZWRZZWFyOiAxOTk5LAogIHJhdGluZ3M6IFszLCA0XQp9KTsKCi8vIFF1ZXJ5IGRvY3VtZW50cwpkYi5jb2xsZWN0aW9uKCJib29rcyIpCiAgLndoZXJlKCJwdWJsaXNoZWRZZWFyIiwgIj4iLCAyMDAwKQogIC53aGVyZSgicmF0aW5ncyIsICJhcnJheS1jb250YWlucyIsIDQpCiAgLmdldCgpCiAgLnRoZW4oKHF1ZXJ5U25hcHNob3QpID0+IHsKICAgIHF1ZXJ5U25hcHNob3QuZm9yRWFjaCgoZG9jKSA9PiB7CiAgICAgIGNvbnNvbGUubG9nKGRvYy5pZCwgIiA9PiAiLCBkb2MuZGF0YSgpKTsKICAgIH0pOwogIH0pCiAgLmNhdGNoKChlcnJvcikgPT4gewogICAgY29uc29sZS5sb2coIkVycm9yIGdldHRpbmcgZG9jdW1lbnRzOiAiLCBlcnJvcik7CiAgfSk7"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>// Add sample documents
db.collection(&quot;books&quot;).add({
  title: &quot;Book One&quot;,
  author: &quot;Author A&quot;,
  genre: &quot;Fiction&quot;,
  publishedYear: 2001,
  ratings: [4, 5]
});

db.collection(&quot;books&quot;).add({
  title: &quot;Book Two&quot;,
  author: &quot;Author B&quot;,
  genre: &quot;Non-Fiction&quot;,
  publishedYear: 1999,
  ratings: [3, 4]
});

// Query documents
db.collection(&quot;books&quot;)
  .where(&quot;publishedYear&quot;, &quot;&gt;&quot;, 2000)
  .where(&quot;ratings&quot;, &quot;array-contains&quot;, 4)
  .get()
  .then((querySnapshot) =&gt; {
    querySnapshot.forEach((doc) =&gt; {
      console.log(doc.id, &quot; =&gt; &quot;, doc.data());
    });
  })
  .catch((error) =&gt; {
    console.log(&quot;Error getting documents: &quot;, error);
  });</pre></div><div class='content'></div><h2>Explanation</h2>
<div class='content'><ul>
<li><code>where(&quot;publishedYear&quot;, &quot;&gt;&quot;, 2000)</code>: Filters books published after the year 2000.</li>
<li><code>where(&quot;ratings&quot;, &quot;array-contains&quot;, 4)</code>: Further filters books that have a rating of at least 4.</li>
</ul>
</div><h1>Conclusion</h1>
<div class='content'><p>In this section, we explored advanced querying techniques in Cloud Firestore, including compound queries, array-contains queries, in queries, range queries, pagination, and indexing. These techniques will help you retrieve data more efficiently and perform complex queries. In the next module, we will discuss security rules to protect your Firestore data.</p>
</div><div class='row navigation'>
	<div class='col-1 col-md-2'>
					<a href='04-03-crud-operations' title="CRUD Operations">
				<span class="d-none d-md-inline">&#x25C4; Previous</span>
				<span class="d-inline d-md-none"><i class="bi bi-caret-left-square-fill"></i></span>
			</a>
			</div>
	<div class='col-10 col-md-8 text-center'>
			</div>
	<div class='col-1 col-md-2 text-end'>
					<a href='04-05-security-rules' title="Security Rules">
				<span class="d-none d-md-inline">Next &#x25BA;</span>
				<span class="d-inline d-md-none"><i class="bi bi-caret-right-square-fill"></i></span>
			</a>
			</div>
</div>

			</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<!-- 
<h1>Advertising</h1>
<p>This space is reserved for advertising.</p>
<p>If you want to be a sponsor, contact us to include links in this area: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
<p>Thank you for collaborating!</p>
-->

<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-0611338592562725"
     crossorigin="anonymous"></script>
<!-- enterprise_campus -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-0611338592562725"
     data-ad-slot="6914733106"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
			









		</div>
	</div>
</div>

<div class="container-xxl d-block d-md-none">
	<div class="row">
		<div class="col-12 p-2 p-md-0 m-0 text-end">
			<a href="/objective">The Project</a> | 
<a href="/about">About Us</a> | 
<a href="/contribute">Contribute</a> | 
<a href="/donate">Donations</a> | 
<a href="/licence">License</a>
		</div>
	</div>
</div>

<div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. All rights reserved</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	We use cookies to improve your user experience and offer content tailored to your interests.
    <a href="#" id="btn_accept_cookies" class="button">Accept</a>
    <a href="/cookies">More Information</a>
</div>	

	</div>    
</body>
</html>
