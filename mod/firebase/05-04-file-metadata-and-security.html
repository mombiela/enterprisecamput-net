<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>File Metadata and Security</title>

    <link rel="alternate" href="https://campusempresa.com/mod/firebase/05-04-file-metadata-and-security" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/mod/firebase/05-04-file-metadata-and-security" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/mod/firebase/05-04-file-metadata-and-security" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="/js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body >
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-12 col-md-8 p-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo-header_enterprise.png"></a>
			</h1>
		</div>
		<div class="col-12 col-md-4 px-0 py-2 py-md-0 text-end">
			<h2 id="main_title"><cite>Building today's and tomorrow's society</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 px-0 py-2 py-md-0 m-0 text-end">
													<b id="lit_lang_es" class="px-2">EN</b>
				|
				<a href="https://campusempresa.com/mod/firebase/05-04-file-metadata-and-security" class="px-2">ES</a></b>
				|
				<a href="https://campusempresa.cat/mod/firebase/05-04-file-metadata-and-security" class="px-2">CA</a>
					</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="/objective">The Project</a>
				<a href="/about">About Us</a>
				<a href="/contribute">Contribute</a>
				<a href="/donate">Donations</a>
				<a href="/licence">License</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content">
								<div class='row navigation'>
	<div class='col-2'>
					<a href='05-03-downloading-files' title="Downloading Files">&#x25C4;Previous</a>
			</div>
	<div class='col-8 text-center'>
					<a href="./"><h2 style="text-decoration:underline">File Metadata and Security</h2></a>
			</div>
	<div class='col-2 text-end'>
					<a href='06-01-introduction-to-cloud-messaging' title="Introduction to Cloud Messaging">Next &#x25BA;</a>
			</div>
</div>
<div class='content'><p>In this section, we will explore how to handle file metadata and implement security measures in Firebase Storage. Understanding these concepts is crucial for managing files effectively and ensuring that your data is secure.</p>
</div><h1>What is File Metadata?</h1>
<div class='content'><p>File metadata is additional information about a file that is stored along with the file itself. This can include details such as:</p>
<ul>
<li><strong>File Name</strong>: The name of the file.</li>
<li><strong>Content Type</strong>: The MIME type of the file (e.g., <code>image/jpeg</code>).</li>
<li><strong>Size</strong>: The size of the file in bytes.</li>
<li><strong>Custom Metadata</strong>: User-defined key-value pairs.</li>
</ul>
</div><h2>Example of File Metadata</h2>
<div class='content'><p>Here is an example of how file metadata might look:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ewogICJuYW1lIjogImV4YW1wbGUuanBnIiwKICAiY29udGVudFR5cGUiOiAiaW1hZ2UvanBlZyIsCiAgInNpemUiOiAyMDQ4LAogICJjdXN0b21NZXRhZGF0YSI6IHsKICAgICJ1cGxvYWRlZEJ5IjogInVzZXIxMjMiLAogICAgImRlc2NyaXB0aW9uIjogIlByb2ZpbGUgcGljdHVyZSIKICB9Cn0="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>{
  &quot;name&quot;: &quot;example.jpg&quot;,
  &quot;contentType&quot;: &quot;image/jpeg&quot;,
  &quot;size&quot;: 2048,
  &quot;customMetadata&quot;: {
    &quot;uploadedBy&quot;: &quot;user123&quot;,
    &quot;description&quot;: &quot;Profile picture&quot;
  }
}</pre></div><div class='content'></div><h1>Setting File Metadata</h1>
<div class='content'><p>When uploading a file to Firebase Storage, you can set metadata using the <code>metadata</code> property. Here is an example in JavaScript:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Ly8gQ3JlYXRlIGEgcmVmZXJlbmNlIHRvIHRoZSBmaWxlCnZhciBzdG9yYWdlUmVmID0gZmlyZWJhc2Uuc3RvcmFnZSgpLnJlZignaW1hZ2VzL2V4YW1wbGUuanBnJyk7CgovLyBDcmVhdGUgZmlsZSBtZXRhZGF0YSBpbmNsdWRpbmcgdGhlIGNvbnRlbnQgdHlwZQp2YXIgbWV0YWRhdGEgPSB7CiAgY29udGVudFR5cGU6ICdpbWFnZS9qcGVnJywKICBjdXN0b21NZXRhZGF0YTogewogICAgJ3VwbG9hZGVkQnknOiAndXNlcjEyMycsCiAgICAnZGVzY3JpcHRpb24nOiAnUHJvZmlsZSBwaWN0dXJlJwogIH0KfTsKCi8vIFVwbG9hZCB0aGUgZmlsZSBhbmQgbWV0YWRhdGEKdmFyIGZpbGUgPSAuLi4gLy8gdXNlIHRoZSBCbG9iIG9yIEZpbGUgQVBJCnN0b3JhZ2VSZWYucHV0KGZpbGUsIG1ldGFkYXRhKS50aGVuKChzbmFwc2hvdCkgPT4gewogIGNvbnNvbGUubG9nKCdVcGxvYWRlZCBhIGJsb2Igb3IgZmlsZSB3aXRoIG1ldGFkYXRhIScpOwp9KTs="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>// Create a reference to the file
var storageRef = firebase.storage().ref('images/example.jpg');

// Create file metadata including the content type
var metadata = {
  contentType: 'image/jpeg',
  customMetadata: {
    'uploadedBy': 'user123',
    'description': 'Profile picture'
  }
};

// Upload the file and metadata
var file = ... // use the Blob or File API
storageRef.put(file, metadata).then((snapshot) =&gt; {
  console.log('Uploaded a blob or file with metadata!');
});</pre></div><div class='content'></div><h2>Explanation</h2>
<div class='content'><ol>
<li><strong>Create a reference</strong>: We create a reference to the file location in Firebase Storage.</li>
<li><strong>Define metadata</strong>: We define the metadata, including the content type and custom metadata.</li>
<li><strong>Upload the file</strong>: We upload the file along with the metadata.</li>
</ol>
</div><h1>Retrieving File Metadata</h1>
<div class='content'><p>You can retrieve the metadata of a file using the <code>getMetadata</code> method:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Ly8gQ3JlYXRlIGEgcmVmZXJlbmNlIHRvIHRoZSBmaWxlCnZhciBzdG9yYWdlUmVmID0gZmlyZWJhc2Uuc3RvcmFnZSgpLnJlZignaW1hZ2VzL2V4YW1wbGUuanBnJyk7CgovLyBHZXQgbWV0YWRhdGEgcHJvcGVydGllcwpzdG9yYWdlUmVmLmdldE1ldGFkYXRhKCkudGhlbigobWV0YWRhdGEpID0+IHsKICBjb25zb2xlLmxvZyhtZXRhZGF0YSk7Cn0pLmNhdGNoKChlcnJvcikgPT4gewogIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGdldHRpbmcgbWV0YWRhdGE6JywgZXJyb3IpOwp9KTs="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>// Create a reference to the file
var storageRef = firebase.storage().ref('images/example.jpg');

// Get metadata properties
storageRef.getMetadata().then((metadata) =&gt; {
  console.log(metadata);
}).catch((error) =&gt; {
  console.error('Error getting metadata:', error);
});</pre></div><div class='content'></div><h2>Explanation</h2>
<div class='content'><ol>
<li><strong>Create a reference</strong>: We create a reference to the file location in Firebase Storage.</li>
<li><strong>Get metadata</strong>: We retrieve the metadata using the <code>getMetadata</code> method.</li>
</ol>
</div><h1>Updating File Metadata</h1>
<div class='content'><p>To update the metadata of an existing file, use the <code>updateMetadata</code> method:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Ly8gQ3JlYXRlIGEgcmVmZXJlbmNlIHRvIHRoZSBmaWxlCnZhciBzdG9yYWdlUmVmID0gZmlyZWJhc2Uuc3RvcmFnZSgpLnJlZignaW1hZ2VzL2V4YW1wbGUuanBnJyk7CgovLyBDcmVhdGUgbmV3IG1ldGFkYXRhCnZhciBuZXdNZXRhZGF0YSA9IHsKICBjb250ZW50VHlwZTogJ2ltYWdlL2pwZWcnLAogIGN1c3RvbU1ldGFkYXRhOiB7CiAgICAndXBsb2FkZWRCeSc6ICd1c2VyNDU2JywKICAgICdkZXNjcmlwdGlvbic6ICdVcGRhdGVkIHByb2ZpbGUgcGljdHVyZScKICB9Cn07CgovLyBVcGRhdGUgbWV0YWRhdGEgcHJvcGVydGllcwpzdG9yYWdlUmVmLnVwZGF0ZU1ldGFkYXRhKG5ld01ldGFkYXRhKS50aGVuKChtZXRhZGF0YSkgPT4gewogIGNvbnNvbGUubG9nKCdNZXRhZGF0YSB1cGRhdGVkIHN1Y2Nlc3NmdWxseTonLCBtZXRhZGF0YSk7Cn0pLmNhdGNoKChlcnJvcikgPT4gewogIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHVwZGF0aW5nIG1ldGFkYXRhOicsIGVycm9yKTsKfSk7"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>// Create a reference to the file
var storageRef = firebase.storage().ref('images/example.jpg');

// Create new metadata
var newMetadata = {
  contentType: 'image/jpeg',
  customMetadata: {
    'uploadedBy': 'user456',
    'description': 'Updated profile picture'
  }
};

// Update metadata properties
storageRef.updateMetadata(newMetadata).then((metadata) =&gt; {
  console.log('Metadata updated successfully:', metadata);
}).catch((error) =&gt; {
  console.error('Error updating metadata:', error);
});</pre></div><div class='content'></div><h2>Explanation</h2>
<div class='content'><ol>
<li><strong>Create a reference</strong>: We create a reference to the file location in Firebase Storage.</li>
<li><strong>Define new metadata</strong>: We define the new metadata.</li>
<li><strong>Update metadata</strong>: We update the metadata using the <code>updateMetadata</code> method.</li>
</ol>
</div><h1>Security Rules</h1>
<div class='content'><p>Firebase Storage security rules determine who can access your files and what they can do with them. These rules are written in a simple, declarative language.</p>
</div><h2>Example Security Rules</h2>
<div class='content'><p>Here is an example of basic security rules:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("c2VydmljZSBmaXJlYmFzZS5zdG9yYWdlIHsKICBtYXRjaCAvYi97YnVja2V0fS9vIHsKICAgIG1hdGNoIC97YWxsUGF0aHM9Kip9IHsKICAgICAgLy8gQWxsb3cgcmVhZCBhY2Nlc3MgdG8gYWxsIHVzZXJzCiAgICAgIGFsbG93IHJlYWQ6IGlmIHRydWU7CiAgICAgIAogICAgICAvLyBBbGxvdyB3cml0ZSBhY2Nlc3MgdG8gYXV0aGVudGljYXRlZCB1c2VycwogICAgICBhbGxvdyB3cml0ZTogaWYgcmVxdWVzdC5hdXRoICE9IG51bGw7CiAgICB9CiAgfQp9"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>service firebase.storage {
  match /b/{bucket}/o {
    match /{allPaths=**} {
      // Allow read access to all users
      allow read: if true;
      
      // Allow write access to authenticated users
      allow write: if request.auth != null;
    }
  }
}</pre></div><div class='content'></div><h2>Explanation</h2>
<div class='content'><ol>
<li><strong>Read access</strong>: Allows read access to all users.</li>
<li><strong>Write access</strong>: Allows write access only to authenticated users.</li>
</ol>
</div><h2>Advanced Security Rules</h2>
<div class='content'><p>You can create more complex rules based on file metadata or user roles. For example:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("c2VydmljZSBmaXJlYmFzZS5zdG9yYWdlIHsKICBtYXRjaCAvYi97YnVja2V0fS9vIHsKICAgIG1hdGNoIC97YWxsUGF0aHM9Kip9IHsKICAgICAgLy8gQWxsb3cgcmVhZCBhY2Nlc3MgdG8gZmlsZXMgdXBsb2FkZWQgYnkgdGhlIHVzZXIKICAgICAgYWxsb3cgcmVhZDogaWYgcmVzb3VyY2UubWV0YWRhdGEudXBsb2FkZWRCeSA9PSByZXF1ZXN0LmF1dGgudWlkOwogICAgICAKICAgICAgLy8gQWxsb3cgd3JpdGUgYWNjZXNzIHRvIGZpbGVzIHdpdGggYSBzcGVjaWZpYyBjb250ZW50IHR5cGUKICAgICAgYWxsb3cgd3JpdGU6IGlmIHJlcXVlc3QucmVzb3VyY2UuY29udGVudFR5cGUubWF0Y2hlcygnaW1hZ2UvLionKTsKICAgIH0KICB9Cn0="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>service firebase.storage {
  match /b/{bucket}/o {
    match /{allPaths=**} {
      // Allow read access to files uploaded by the user
      allow read: if resource.metadata.uploadedBy == request.auth.uid;
      
      // Allow write access to files with a specific content type
      allow write: if request.resource.contentType.matches('image/.*');
    }
  }
}</pre></div><div class='content'></div><h2>Explanation</h2>
<div class='content'><ol>
<li><strong>Read access</strong>: Allows read access only to files uploaded by the authenticated user.</li>
<li><strong>Write access</strong>: Allows write access only to files with a content type that matches <code>image/*</code>.</li>
</ol>
</div><h1>Practical Exercise</h1>
<div class='content'></div><h2>Task</h2>
<div class='content'><ol>
<li>Upload a file with custom metadata.</li>
<li>Retrieve and log the metadata.</li>
<li>Update the metadata.</li>
<li>Implement security rules to restrict access based on metadata.</li>
</ol>
</div><h2>Solution</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Ly8gU3RlcCAxOiBVcGxvYWQgYSBmaWxlIHdpdGggY3VzdG9tIG1ldGFkYXRhCnZhciBzdG9yYWdlUmVmID0gZmlyZWJhc2Uuc3RvcmFnZSgpLnJlZignaW1hZ2VzL2V4YW1wbGUuanBnJyk7CnZhciBtZXRhZGF0YSA9IHsKICBjb250ZW50VHlwZTogJ2ltYWdlL2pwZWcnLAogIGN1c3RvbU1ldGFkYXRhOiB7CiAgICAndXBsb2FkZWRCeSc6ICd1c2VyMTIzJywKICAgICdkZXNjcmlwdGlvbic6ICdQcm9maWxlIHBpY3R1cmUnCiAgfQp9Owp2YXIgZmlsZSA9IC4uLiAvLyB1c2UgdGhlIEJsb2Igb3IgRmlsZSBBUEkKc3RvcmFnZVJlZi5wdXQoZmlsZSwgbWV0YWRhdGEpLnRoZW4oKHNuYXBzaG90KSA9PiB7CiAgY29uc29sZS5sb2coJ1VwbG9hZGVkIGEgYmxvYiBvciBmaWxlIHdpdGggbWV0YWRhdGEhJyk7CgogIC8vIFN0ZXAgMjogUmV0cmlldmUgYW5kIGxvZyB0aGUgbWV0YWRhdGEKICByZXR1cm4gc3RvcmFnZVJlZi5nZXRNZXRhZGF0YSgpOwp9KS50aGVuKChtZXRhZGF0YSkgPT4gewogIGNvbnNvbGUubG9nKCdNZXRhZGF0YTonLCBtZXRhZGF0YSk7CgogIC8vIFN0ZXAgMzogVXBkYXRlIHRoZSBtZXRhZGF0YQogIHZhciBuZXdNZXRhZGF0YSA9IHsKICAgIGNvbnRlbnRUeXBlOiAnaW1hZ2UvanBlZycsCiAgICBjdXN0b21NZXRhZGF0YTogewogICAgICAndXBsb2FkZWRCeSc6ICd1c2VyNDU2JywKICAgICAgJ2Rlc2NyaXB0aW9uJzogJ1VwZGF0ZWQgcHJvZmlsZSBwaWN0dXJlJwogICAgfQogIH07CiAgcmV0dXJuIHN0b3JhZ2VSZWYudXBkYXRlTWV0YWRhdGEobmV3TWV0YWRhdGEpOwp9KS50aGVuKChtZXRhZGF0YSkgPT4gewogIGNvbnNvbGUubG9nKCdNZXRhZGF0YSB1cGRhdGVkIHN1Y2Nlc3NmdWxseTonLCBtZXRhZGF0YSk7Cn0pLmNhdGNoKChlcnJvcikgPT4gewogIGNvbnNvbGUuZXJyb3IoJ0Vycm9yOicsIGVycm9yKTsKfSk7"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>// Step 1: Upload a file with custom metadata
var storageRef = firebase.storage().ref('images/example.jpg');
var metadata = {
  contentType: 'image/jpeg',
  customMetadata: {
    'uploadedBy': 'user123',
    'description': 'Profile picture'
  }
};
var file = ... // use the Blob or File API
storageRef.put(file, metadata).then((snapshot) =&gt; {
  console.log('Uploaded a blob or file with metadata!');

  // Step 2: Retrieve and log the metadata
  return storageRef.getMetadata();
}).then((metadata) =&gt; {
  console.log('Metadata:', metadata);

  // Step 3: Update the metadata
  var newMetadata = {
    contentType: 'image/jpeg',
    customMetadata: {
      'uploadedBy': 'user456',
      'description': 'Updated profile picture'
    }
  };
  return storageRef.updateMetadata(newMetadata);
}).then((metadata) =&gt; {
  console.log('Metadata updated successfully:', metadata);
}).catch((error) =&gt; {
  console.error('Error:', error);
});</pre></div><div class='content'></div><h2>Security Rules</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("c2VydmljZSBmaXJlYmFzZS5zdG9yYWdlIHsKICBtYXRjaCAvYi97YnVja2V0fS9vIHsKICAgIG1hdGNoIC97YWxsUGF0aHM9Kip9IHsKICAgICAgLy8gQWxsb3cgcmVhZCBhY2Nlc3MgdG8gZmlsZXMgdXBsb2FkZWQgYnkgdGhlIHVzZXIKICAgICAgYWxsb3cgcmVhZDogaWYgcmVzb3VyY2UubWV0YWRhdGEudXBsb2FkZWRCeSA9PSByZXF1ZXN0LmF1dGgudWlkOwogICAgICAKICAgICAgLy8gQWxsb3cgd3JpdGUgYWNjZXNzIHRvIGZpbGVzIHdpdGggYSBzcGVjaWZpYyBjb250ZW50IHR5cGUKICAgICAgYWxsb3cgd3JpdGU6IGlmIHJlcXVlc3QucmVzb3VyY2UuY29udGVudFR5cGUubWF0Y2hlcygnaW1hZ2UvLionKTsKICAgIH0KICB9Cn0="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>service firebase.storage {
  match /b/{bucket}/o {
    match /{allPaths=**} {
      // Allow read access to files uploaded by the user
      allow read: if resource.metadata.uploadedBy == request.auth.uid;
      
      // Allow write access to files with a specific content type
      allow write: if request.resource.contentType.matches('image/.*');
    }
  }
}</pre></div><div class='content'></div><h1>Conclusion</h1>
<div class='content'><p>In this section, we covered the basics of file metadata and security in Firebase Storage. You learned how to set, retrieve, and update metadata, as well as how to implement security rules to control access to your files. These skills are essential for managing files effectively and ensuring that your data is secure. In the next module, we will dive into Firebase Cloud Messaging and learn how to send and handle notifications.</p>
</div><div class='row navigation'>
	<div class='col-2'>
					<a href='05-03-downloading-files' title="Downloading Files">&#x25C4;Previous</a>
			</div>
	<div class='col-8 text-center'>
			</div>
	<div class='col-2 text-end'>
					<a href='06-01-introduction-to-cloud-messaging' title="Introduction to Cloud Messaging">Next &#x25BA;</a>
			</div>
</div>

			</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Advertising</h1>
			<p>This space is reserved for advertising.</p>
			<p>If you want to be a sponsor, contact us to include links in this area: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Thank you for collaborating!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. All rights reserved</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir galetes per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Accept</a>
    <a href="/cookies">More Information</a>
</div>	

	</div>    
</body>
</html>
