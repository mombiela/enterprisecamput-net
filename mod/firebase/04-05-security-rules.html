<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Security Rules</title>

    <link rel="alternate" href="https://campusempresa.com/mod/firebase/04-05-security-rules" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/mod/firebase/04-05-security-rules" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/mod/firebase/04-05-security-rules" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="/js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body >
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-12 col-md-8 p-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo-header_enterprise.png"></a>
			</h1>
		</div>
		<div class="col-12 col-md-4 px-0 py-2 py-md-0 text-end">
			<h2 id="main_title"><cite>Building today's and tomorrow's society</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 px-0 py-2 py-md-0 m-0 text-end">
													<b id="lit_lang_es" class="px-2">EN</b>
				|
				<a href="https://campusempresa.com/mod/firebase/04-05-security-rules" class="px-2">ES</a></b>
				|
				<a href="https://campusempresa.cat/mod/firebase/04-05-security-rules" class="px-2">CA</a>
					</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="/objective">The Project</a>
				<a href="/about">About Us</a>
				<a href="/contribute">Contribute</a>
				<a href="/donate">Donations</a>
				<a href="/licence">License</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content">
								<div class='row navigation'>
	<div class='col-2'>
					<a href='04-04-advanced-queries' title="Advanced Queries">&#x25C4;Previous</a>
			</div>
	<div class='col-8 text-center'>
					<a href="./"><h2 style="text-decoration:underline">Security Rules</h2></a>
			</div>
	<div class='col-2 text-end'>
					<a href='05-01-introduction-to-firebase-storage' title="Introduction to Firebase Storage">Next &#x25BA;</a>
			</div>
</div>
<div class='content'><p>In this section, we will delve into the security rules for Cloud Firestore. Security rules are essential for protecting your data and ensuring that only authorized users can access or modify it. Firebase provides a powerful and flexible rules language that allows you to define who has access to what data and under what conditions.</p>
</div><h1>Key Concepts</h1>
<div class='content'><ol>
<li><strong>Security Rules Language</strong>: Firebase uses a custom language to define security rules. This language allows you to specify conditions under which data can be read or written.</li>
<li><strong>Authentication</strong>: Security rules often rely on Firebase Authentication to identify users and enforce access controls.</li>
<li><strong>Granularity</strong>: Rules can be applied at various levels of your database, from the entire database down to individual documents.</li>
<li><strong>Conditions</strong>: Rules can include conditions based on the data being accessed, the user's authentication status, and other factors.</li>
</ol>
</div><h1>Basic Structure of Security Rules</h1>
<div class='content'><p>Security rules are defined in a JSON-like syntax. Here is a basic example:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("c2VydmljZSBjbG91ZC5maXJlc3RvcmUgewogIG1hdGNoIC9kYXRhYmFzZXMve2RhdGFiYXNlfS9kb2N1bWVudHMgewogICAgbWF0Y2ggL3tkb2N1bWVudD0qKn0gewogICAgICBhbGxvdyByZWFkLCB3cml0ZTogaWYgdHJ1ZTsKICAgIH0KICB9Cn0="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>service cloud.firestore {
  match /databases/{database}/documents {
    match /{document=**} {
      allow read, write: if true;
    }
  }
}</pre></div><div class='content'></div><h2>Explanation:</h2>
<div class='content'><ul>
<li><code>service cloud.firestore</code>: Specifies that these rules apply to Cloud Firestore.</li>
<li><code>match /databases/{database}/documents</code>: Applies the rules to all documents in the database.</li>
<li><code>match /{document=**}</code>: Applies the rules to all documents and subcollections.</li>
<li><code>allow read, write: if true;</code>: Allows all read and write operations unconditionally (not recommended for production).</li>
</ul>
</div><h1>Practical Example: User-Based Access Control</h1>
<div class='content'><p>Let's create a more practical example where users can only read and write their own data.</p>
</div><h2>Example Rule:</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("c2VydmljZSBjbG91ZC5maXJlc3RvcmUgewogIG1hdGNoIC9kYXRhYmFzZXMve2RhdGFiYXNlfS9kb2N1bWVudHMgewogICAgbWF0Y2ggL3VzZXJzL3t1c2VySWR9IHsKICAgICAgYWxsb3cgcmVhZCwgd3JpdGU6IGlmIHJlcXVlc3QuYXV0aCAhPSBudWxsICYmIHJlcXVlc3QuYXV0aC51aWQgPT0gdXNlcklkOwogICAgfQogIH0KfQ=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>service cloud.firestore {
  match /databases/{database}/documents {
    match /users/{userId} {
      allow read, write: if request.auth != null &amp;&amp; request.auth.uid == userId;
    }
  }
}</pre></div><div class='content'></div><h2>Explanation:</h2>
<div class='content'><ul>
<li><code>match /users/{userId}</code>: Applies the rules to documents in the <code>users</code> collection.</li>
<li><code>allow read, write: if request.auth != null &amp;&amp; request.auth.uid == userId;</code>: Allows read and write operations only if the user is authenticated and their UID matches the <code>userId</code> in the document path.</li>
</ul>
</div><h1>Advanced Conditions</h1>
<div class='content'><p>You can create more complex conditions using logical operators and functions.</p>
</div><h2>Example: Conditional Write Access</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("c2VydmljZSBjbG91ZC5maXJlc3RvcmUgewogIG1hdGNoIC9kYXRhYmFzZXMve2RhdGFiYXNlfS9kb2N1bWVudHMgewogICAgbWF0Y2ggL3Bvc3RzL3twb3N0SWR9IHsKICAgICAgYWxsb3cgcmVhZDogaWYgdHJ1ZTsKICAgICAgYWxsb3cgd3JpdGU6IGlmIHJlcXVlc3QuYXV0aCAhPSBudWxsICYmIHJlcXVlc3QuYXV0aC51aWQgPT0gcmVzb3VyY2UuZGF0YS5hdXRob3JJZDsKICAgIH0KICB9Cn0="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>service cloud.firestore {
  match /databases/{database}/documents {
    match /posts/{postId} {
      allow read: if true;
      allow write: if request.auth != null &amp;&amp; request.auth.uid == resource.data.authorId;
    }
  }
}</pre></div><div class='content'></div><h2>Explanation:</h2>
<div class='content'><ul>
<li><code>match /posts/{postId}</code>: Applies the rules to documents in the <code>posts</code> collection.</li>
<li><code>allow read: if true;</code>: Allows all read operations.</li>
<li><code>allow write: if request.auth != null &amp;&amp; request.auth.uid == resource.data.authorId;</code>: Allows write operations only if the user is authenticated and their UID matches the <code>authorId</code> field in the document.</li>
</ul>
</div><h1>Practical Exercise</h1>
<div class='content'></div><h2>Task:</h2>
<div class='content'><p>Create security rules for a <code>messages</code> collection where:</p>
<ol>
<li>Any authenticated user can read messages.</li>
<li>Only the user who created a message can edit or delete it.</li>
</ol>
</div><h2>Solution:</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("c2VydmljZSBjbG91ZC5maXJlc3RvcmUgewogIG1hdGNoIC9kYXRhYmFzZXMve2RhdGFiYXNlfS9kb2N1bWVudHMgewogICAgbWF0Y2ggL21lc3NhZ2VzL3ttZXNzYWdlSWR9IHsKICAgICAgYWxsb3cgcmVhZDogaWYgcmVxdWVzdC5hdXRoICE9IG51bGw7CiAgICAgIGFsbG93IHdyaXRlOiBpZiByZXF1ZXN0LmF1dGggIT0gbnVsbCAmJiByZXF1ZXN0LmF1dGgudWlkID09IHJlc291cmNlLmRhdGEudXNlcklkOwogICAgfQogIH0KfQ=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>service cloud.firestore {
  match /databases/{database}/documents {
    match /messages/{messageId} {
      allow read: if request.auth != null;
      allow write: if request.auth != null &amp;&amp; request.auth.uid == resource.data.userId;
    }
  }
}</pre></div><div class='content'></div><h2>Explanation:</h2>
<div class='content'><ul>
<li><code>allow read: if request.auth != null;</code>: Allows read operations for authenticated users.</li>
<li><code>allow write: if request.auth != null &amp;&amp; request.auth.uid == resource.data.userId;</code>: Allows write operations only if the user is authenticated and their UID matches the <code>userId</code> field in the document.</li>
</ul>
</div><h1>Common Mistakes and Tips</h1>
<div class='content'><ul>
<li><strong>Overly Permissive Rules</strong>: Avoid using <code>if true</code> in production as it allows unrestricted access.</li>
<li><strong>Testing Rules</strong>: Use the Firebase Emulator Suite to test your security rules locally before deploying them.</li>
<li><strong>Granularity</strong>: Apply rules at the most specific level possible to minimize the risk of unintended access.</li>
</ul>
</div><h1>Conclusion</h1>
<div class='content'><p>In this section, we covered the basics of Firebase security rules, including their structure, practical examples, and common mistakes. Security rules are a powerful tool for protecting your data and ensuring that only authorized users can access or modify it. In the next module, we will explore Firebase Storage and how to manage files securely.</p>
</div><div class='row navigation'>
	<div class='col-2'>
					<a href='04-04-advanced-queries' title="Advanced Queries">&#x25C4;Previous</a>
			</div>
	<div class='col-8 text-center'>
			</div>
	<div class='col-2 text-end'>
					<a href='05-01-introduction-to-firebase-storage' title="Introduction to Firebase Storage">Next &#x25BA;</a>
			</div>
</div>

			</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Advertising</h1>
			<p>This space is reserved for advertising.</p>
			<p>If you want to be a sponsor, contact us to include links in this area: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Thank you for collaborating!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. All rights reserved</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir galetes per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Accept</a>
    <a href="/cookies">More Information</a>
</div>	

	</div>    
</body>
</html>
