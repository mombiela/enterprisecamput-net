<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Queries</title>

    <link rel="alternate" href="https://campusempresa.com/mod/firebase/advanced-queries" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/mod/firebase/advanced-queries" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/mod/firebase/advanced-queries" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body>
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-8 p-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo-header_enterprise.png"></a>
			</h1>
		</div>
		<div class="col-4 p-0 text-end">
			<h2 id="main_title"><cite>Building today's and tomorrow's society</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-0 m-0 text-end">
													<b id="lit_lang_es" class="px-2">EN</b>
				|
				<a href="https://campusempresa.com/mod/firebase/advanced-queries" class="px-2">ES</a></b>
				|
				<a href="https://campusempresa.cat/mod/firebase/advanced-queries" class="px-2">CA</a>
					</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="/objective">The Project</a>
				<a href="/about">About Us</a>
				<a href="/contribute">Contribute</a>
				<a href="/donate">Donations</a>
				<a href="/licence">License</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content"><div class='row navigation'>
	<div class='col-4'>
					<a href='firestore-security-rules'>&#x25C4;Firestore Security Rules</a>
			</div>
	<div class='col-4 text-center'>
		<a href="./" class="title">Advanced Queries</a>
	</div>
	<div class='col-4 text-end'>
					<a href='data-modeling'>Data Modeling &#x25BA;</a>
			</div>
</div>
<div class='content'><p>In this section, we will dive deeper into advanced querying techniques in Firebase. This will include complex queries, indexing, and performance optimization. By the end of this section, you should be able to efficiently retrieve and manipulate data in Firebase using advanced querying methods.</p>
</div><h1>Key Concepts</h1>
<div class='content'><ul>
<li><strong>Compound Queries</strong>: Combining multiple query conditions.</li>
<li><strong>Indexing</strong>: Optimizing query performance.</li>
<li><strong>Pagination</strong>: Handling large datasets efficiently.</li>
<li><strong>Real-time Updates</strong>: Keeping data synchronized in real-time.</li>
<li><strong>Security Rules</strong>: Ensuring queries adhere to security constraints.</li>
</ul>
</div><h1>Compound Queries</h1>
<div class='content'><p>Compound queries allow you to combine multiple conditions to filter your data more precisely.</p>
</div><h2>Example: Combining Multiple Conditions</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y29uc3QgZGIgPSBmaXJlYmFzZS5maXJlc3RvcmUoKTsKY29uc3QgcXVlcnkgPSBkYi5jb2xsZWN0aW9uKCd1c2VycycpCiAgLndoZXJlKCdhZ2UnLCAnPj0nLCAxOCkKICAud2hlcmUoJ2NpdHknLCAnPT0nLCAnTmV3IFlvcmsnKTsKCnF1ZXJ5LmdldCgpLnRoZW4oKHF1ZXJ5U25hcHNob3QpID0+IHsKICBxdWVyeVNuYXBzaG90LmZvckVhY2goKGRvYykgPT4gewogICAgY29uc29sZS5sb2coZG9jLmlkLCAnID0+ICcsIGRvYy5kYXRhKCkpOwogIH0pOwp9KTs="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>const db = firebase.firestore();
const query = db.collection('users')
  .where('age', '&gt;=', 18)
  .where('city', '==', 'New York');

query.get().then((querySnapshot) =&gt; {
  querySnapshot.forEach((doc) =&gt; {
    console.log(doc.id, ' =&gt; ', doc.data());
  });
});</pre></div><div class='content'><p>In this example:</p>
<ul>
<li>We are querying the <code>users</code> collection.</li>
<li>We filter users who are 18 years or older and live in New York.</li>
</ul>
</div><h1>Indexing</h1>
<div class='content'><p>Indexing is crucial for optimizing the performance of your queries. Firebase automatically indexes some fields, but for compound queries, you may need to create custom indexes.</p>
</div><h2>Creating an Index</h2>
<div class='content'><ol>
<li>Perform a query that requires an index.</li>
<li>If an index is needed, Firebase will provide a link to create it.</li>
<li>Follow the link and create the index in the Firebase console.</li>
</ol>
</div><h2>Example: Indexing for Compound Queries</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y29uc3QgZGIgPSBmaXJlYmFzZS5maXJlc3RvcmUoKTsKY29uc3QgcXVlcnkgPSBkYi5jb2xsZWN0aW9uKCdvcmRlcnMnKQogIC53aGVyZSgnc3RhdHVzJywgJz09JywgJ3NoaXBwZWQnKQogIC53aGVyZSgndG90YWwnLCAnPicsIDEwMCk7CgpxdWVyeS5nZXQoKS50aGVuKChxdWVyeVNuYXBzaG90KSA9PiB7CiAgcXVlcnlTbmFwc2hvdC5mb3JFYWNoKChkb2MpID0+IHsKICAgIGNvbnNvbGUubG9nKGRvYy5pZCwgJyA9PiAnLCBkb2MuZGF0YSgpKTsKICB9KTsKfSk7"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>const db = firebase.firestore();
const query = db.collection('orders')
  .where('status', '==', 'shipped')
  .where('total', '&gt;', 100);

query.get().then((querySnapshot) =&gt; {
  querySnapshot.forEach((doc) =&gt; {
    console.log(doc.id, ' =&gt; ', doc.data());
  });
});</pre></div><div class='content'><p>For this query, you might need to create an index on <code>status</code> and <code>total</code>.</p>
</div><h1>Pagination</h1>
<div class='content'><p>Handling large datasets efficiently is essential for performance and user experience. Pagination helps in loading data in chunks.</p>
</div><h2>Example: Implementing Pagination</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y29uc3QgZGIgPSBmaXJlYmFzZS5maXJlc3RvcmUoKTsKY29uc3QgcGFnZVNpemUgPSAxMDsKbGV0IGxhc3RWaXNpYmxlID0gbnVsbDsKCmZ1bmN0aW9uIGdldE5leHRQYWdlKCkgewogIGxldCBxdWVyeSA9IGRiLmNvbGxlY3Rpb24oJ3Byb2R1Y3RzJykKICAgIC5vcmRlckJ5KCduYW1lJykKICAgIC5saW1pdChwYWdlU2l6ZSk7CgogIGlmIChsYXN0VmlzaWJsZSkgewogICAgcXVlcnkgPSBxdWVyeS5zdGFydEFmdGVyKGxhc3RWaXNpYmxlKTsKICB9CgogIHF1ZXJ5LmdldCgpLnRoZW4oKHF1ZXJ5U25hcHNob3QpID0+IHsKICAgIGxhc3RWaXNpYmxlID0gcXVlcnlTbmFwc2hvdC5kb2NzW3F1ZXJ5U25hcHNob3QuZG9jcy5sZW5ndGggLSAxXTsKICAgIHF1ZXJ5U25hcHNob3QuZm9yRWFjaCgoZG9jKSA9PiB7CiAgICAgIGNvbnNvbGUubG9nKGRvYy5pZCwgJyA9PiAnLCBkb2MuZGF0YSgpKTsKICAgIH0pOwogIH0pOwp9CgovLyBDYWxsIGdldE5leHRQYWdlKCkgdG8gbG9hZCB0aGUgZmlyc3QgcGFnZQpnZXROZXh0UGFnZSgpOw=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>const db = firebase.firestore();
const pageSize = 10;
let lastVisible = null;

function getNextPage() {
  let query = db.collection('products')
    .orderBy('name')
    .limit(pageSize);

  if (lastVisible) {
    query = query.startAfter(lastVisible);
  }

  query.get().then((querySnapshot) =&gt; {
    lastVisible = querySnapshot.docs[querySnapshot.docs.length - 1];
    querySnapshot.forEach((doc) =&gt; {
      console.log(doc.id, ' =&gt; ', doc.data());
    });
  });
}

// Call getNextPage() to load the first page
getNextPage();</pre></div><div class='content'><p>In this example:</p>
<ul>
<li>We load products in chunks of 10.</li>
<li><code>lastVisible</code> keeps track of the last document from the previous query to fetch the next set of documents.</li>
</ul>
</div><h1>Real-time Updates</h1>
<div class='content'><p>Firebase provides real-time synchronization, which is useful for applications that require live updates.</p>
</div><h2>Example: Listening for Real-time Updates</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y29uc3QgZGIgPSBmaXJlYmFzZS5maXJlc3RvcmUoKTsKZGIuY29sbGVjdGlvbignbWVzc2FnZXMnKQogIC53aGVyZSgnY2hhdElkJywgJz09JywgJ2NoYXQxMjMnKQogIC5vblNuYXBzaG90KChzbmFwc2hvdCkgPT4gewogICAgc25hcHNob3QuZG9jQ2hhbmdlcygpLmZvckVhY2goKGNoYW5nZSkgPT4gewogICAgICBpZiAoY2hhbmdlLnR5cGUgPT09ICdhZGRlZCcpIHsKICAgICAgICBjb25zb2xlLmxvZygnTmV3IG1lc3NhZ2U6ICcsIGNoYW5nZS5kb2MuZGF0YSgpKTsKICAgICAgfQogICAgICBpZiAoY2hhbmdlLnR5cGUgPT09ICdtb2RpZmllZCcpIHsKICAgICAgICBjb25zb2xlLmxvZygnTW9kaWZpZWQgbWVzc2FnZTogJywgY2hhbmdlLmRvYy5kYXRhKCkpOwogICAgICB9CiAgICAgIGlmIChjaGFuZ2UudHlwZSA9PT0gJ3JlbW92ZWQnKSB7CiAgICAgICAgY29uc29sZS5sb2coJ1JlbW92ZWQgbWVzc2FnZTogJywgY2hhbmdlLmRvYy5kYXRhKCkpOwogICAgICB9CiAgICB9KTsKICB9KTs="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>const db = firebase.firestore();
db.collection('messages')
  .where('chatId', '==', 'chat123')
  .onSnapshot((snapshot) =&gt; {
    snapshot.docChanges().forEach((change) =&gt; {
      if (change.type === 'added') {
        console.log('New message: ', change.doc.data());
      }
      if (change.type === 'modified') {
        console.log('Modified message: ', change.doc.data());
      }
      if (change.type === 'removed') {
        console.log('Removed message: ', change.doc.data());
      }
    });
  });</pre></div><div class='content'><p>In this example:</p>
<ul>
<li>We listen for changes in the <code>messages</code> collection for a specific chat.</li>
<li>The <code>onSnapshot</code> method provides real-time updates for added, modified, and removed messages.</li>
</ul>
</div><h1>Security Rules</h1>
<div class='content'><p>Ensuring that your queries adhere to security constraints is vital for protecting your data.</p>
</div><h2>Example: Security Rules for Queries</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("c2VydmljZSBjbG91ZC5maXJlc3RvcmUgewogIG1hdGNoIC9kYXRhYmFzZXMve2RhdGFiYXNlfS9kb2N1bWVudHMgewogICAgbWF0Y2ggL3VzZXJzL3t1c2VySWR9IHsKICAgICAgYWxsb3cgcmVhZDogaWYgcmVxdWVzdC5hdXRoLnVpZCA9PSB1c2VySWQ7CiAgICAgIGFsbG93IHdyaXRlOiBpZiByZXF1ZXN0LmF1dGgudWlkID09IHVzZXJJZDsKICAgIH0KICB9Cn0="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>service cloud.firestore {
  match /databases/{database}/documents {
    match /users/{userId} {
      allow read: if request.auth.uid == userId;
      allow write: if request.auth.uid == userId;
    }
  }
}</pre></div><div class='content'><p>In this example:</p>
<ul>
<li>Users can only read and write their own data.</li>
<li>The <code>request.auth.uid</code> ensures that the authenticated user can only access their documents.</li>
</ul>
</div><h1>Conclusion</h1>
<div class='content'><p>In this section, we covered advanced querying techniques in Firebase, including compound queries, indexing, pagination, real-time updates, and security rules. Mastering these techniques will help you build efficient and secure applications that can handle complex data retrieval and manipulation tasks. Remember to always consider performance and security when designing your queries.</p>
</div><div class='row navigation'>
	<div class='col-4'>
					<a href='firestore-security-rules'>&#x25C4;Firestore Security Rules</a>
			</div>
	<div class='col-4 text-center'>
		<a href="./" class="title">Advanced Queries</a>
	</div>
	<div class='col-4 text-end'>
					<a href='data-modeling'>Data Modeling &#x25BA;</a>
			</div>
</div>
</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Advertising</h1>
			<p>This space is reserved for advertising.</p>
			<p>If you want to be a sponsor, contact us to include links in this area: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Thank you for collaborating!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. All rights reserved</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir galetes per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Accept</a>
    <a href="/cookies">More Information</a>
</div>	

	</div>    
</body>
</html>
