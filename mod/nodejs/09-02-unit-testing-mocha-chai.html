<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unit Testing with Mocha and Chai</title>

    <link rel="alternate" href="https://campusempresa.com/mod/nodejs/09-02-unit-testing-mocha-chai" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/mod/nodejs/09-02-unit-testing-mocha-chai" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/mod/nodejs/09-02-unit-testing-mocha-chai" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="/js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body >
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-12 col-md-8 p-2 p-md-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo-header_enterprise.png"></a>
			</h1>
		</div>
		<div class="col-12 col-md-4 p-2 p-md-0 text-end">
			<h2 id="main_title"><cite>Building today's and tomorrow's society</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-2 p-md-0 m-0 text-end">
													<b id="lit_lang_es" class="px-2">EN</b>
				|
				<a href="https://campusempresa.com/mod/nodejs/09-02-unit-testing-mocha-chai" class="px-2">ES</a></b>
				|
				<a href="https://campusempresa.cat/mod/nodejs/09-02-unit-testing-mocha-chai" class="px-2">CA</a>
					</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="/objective">The Project</a>
				<a href="/about">About Us</a>
				<a href="/contribute">Contribute</a>
				<a href="/donate">Donations</a>
				<a href="/licence">License</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content">
								<div class='row navigation'>
	<div class='col-2'>
					<a href='09-01-introduction-testing' title="Introduction to Testing">&#x25C4;Previous</a>
			</div>
	<div class='col-8 text-center'>
					<a href="./"><h2 style="text-decoration:underline">Unit Testing with Mocha and Chai</h2></a>
			</div>
	<div class='col-2 text-end'>
					<a href='09-03-integration-testing' title="Integration Testing">Next &#x25BA;</a>
			</div>
</div>
<div class='content'><p>Unit testing is a crucial part of software development that ensures individual components of your application work as expected. In this section, we will explore how to perform unit testing in Node.js using Mocha and Chai.</p>
</div><h1><p>What is Mocha?</p>
</h1>
<div class='content'><p>Mocha is a feature-rich JavaScript test framework running on Node.js, making asynchronous testing simple and fun. It provides a variety of features such as:</p>
<ul>
<li><strong>Descriptive Test Cases</strong>: Allows you to write test cases in a readable and organized manner.</li>
<li><strong>Asynchronous Testing</strong>: Supports asynchronous tests, making it suitable for testing Node.js applications.</li>
<li><strong>Hooks</strong>: Provides hooks like <code>before</code>, <code>after</code>, <code>beforeEach</code>, and <code>afterEach</code> to set up preconditions and clean up after tests.</li>
</ul>
</div><h1><p>What is Chai?</p>
</h1>
<div class='content'><p>Chai is a BDD/TDD assertion library for Node.js that can be paired with any JavaScript testing framework. It provides:</p>
<ul>
<li><strong>Assertions</strong>: Allows you to write assertions in a readable and expressive manner.</li>
<li><strong>Plugins</strong>: Supports various plugins to extend its functionality.</li>
<li><strong>Styles</strong>: Offers different assertion styles like <code>should</code>, <code>expect</code>, and <code>assert</code>.</li>
</ul>
</div><h1><p>Setting Up Mocha and Chai</p>
</h1>
<div class='content'></div><h2><p>Step 1: Install Mocha and Chai</p>
</h2>
<div class='content'><p>First, you need to install Mocha and Chai using npm. Run the following commands in your project directory:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("bnBtIGluc3RhbGwgLS1zYXZlLWRldiBtb2NoYSBjaGFp"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>npm install --save-dev mocha chai</pre></div><div class='content'></div><h2><p>Step 2: Create a Test Directory</p>
</h2>
<div class='content'><p>Create a directory named <code>test</code> in your project root to store your test files:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("bWtkaXIgdGVzdA=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>mkdir test</pre></div><div class='content'></div><h2><p>Step 3: Write Your First Test</p>
</h2>
<div class='content'><p>Create a file named <code>test/sampleTest.js</code> and add the following code:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y29uc3QgeyBleHBlY3QgfSA9IHJlcXVpcmUoJ2NoYWknKTsKCmRlc2NyaWJlKCdBcnJheScsIGZ1bmN0aW9uKCkgewogIGRlc2NyaWJlKCcjaW5kZXhPZigpJywgZnVuY3Rpb24oKSB7CiAgICBpdCgnc2hvdWxkIHJldHVybiAtMSB3aGVuIHRoZSB2YWx1ZSBpcyBub3QgcHJlc2VudCcsIGZ1bmN0aW9uKCkgewogICAgICBleHBlY3QoWzEsIDIsIDNdLmluZGV4T2YoNCkpLnRvLmVxdWFsKC0xKTsKICAgIH0pOwogIH0pOwp9KTs="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>const { expect } = require('chai');

describe('Array', function() {
  describe('#indexOf()', function() {
    it('should return -1 when the value is not present', function() {
      expect([1, 2, 3].indexOf(4)).to.equal(-1);
    });
  });
});</pre></div><div class='content'></div><h2><p>Step 4: Run Your Tests</p>
</h2>
<div class='content'><p>Add a test script to your <code>package.json</code> file:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("InNjcmlwdHMiOiB7CiAgInRlc3QiOiAibW9jaGEiCn0="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>&quot;scripts&quot;: {
  &quot;test&quot;: &quot;mocha&quot;
}</pre></div><div class='content'><p>Now, run your tests using the following command:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("bnBtIHRlc3Q="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>npm test</pre></div><div class='content'><p>You should see output indicating that your test has passed.</p>
</div><h1><p>Writing More Complex Tests</p>
</h1>
<div class='content'></div><h2><p>Using Hooks</p>
</h2>
<div class='content'><p>Hooks allow you to run code before and after tests. Here’s an example:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y29uc3QgeyBleHBlY3QgfSA9IHJlcXVpcmUoJ2NoYWknKTsKCmRlc2NyaWJlKCdBcnJheScsIGZ1bmN0aW9uKCkgewogIGxldCBhcnI7CgogIGJlZm9yZUVhY2goZnVuY3Rpb24oKSB7CiAgICBhcnIgPSBbMSwgMiwgM107CiAgfSk7CgogIGRlc2NyaWJlKCcjcHVzaCgpJywgZnVuY3Rpb24oKSB7CiAgICBpdCgnc2hvdWxkIGFkZCBhIHZhbHVlIHRvIHRoZSBlbmQgb2YgdGhlIGFycmF5JywgZnVuY3Rpb24oKSB7CiAgICAgIGFyci5wdXNoKDQpOwogICAgICBleHBlY3QoYXJyKS50by5oYXZlLmxlbmd0aE9mKDQpOwogICAgICBleHBlY3QoYXJyWzNdKS50by5lcXVhbCg0KTsKICAgIH0pOwogIH0pOwoKICBkZXNjcmliZSgnI3BvcCgpJywgZnVuY3Rpb24oKSB7CiAgICBpdCgnc2hvdWxkIHJlbW92ZSB0aGUgbGFzdCB2YWx1ZSBmcm9tIHRoZSBhcnJheScsIGZ1bmN0aW9uKCkgewogICAgICBhcnIucG9wKCk7CiAgICAgIGV4cGVjdChhcnIpLnRvLmhhdmUubGVuZ3RoT2YoMik7CiAgICAgIGV4cGVjdChhcnIpLnRvLm5vdC5pbmNsdWRlKDMpOwogICAgfSk7CiAgfSk7Cn0pOw=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>const { expect } = require('chai');

describe('Array', function() {
  let arr;

  beforeEach(function() {
    arr = [1, 2, 3];
  });

  describe('#push()', function() {
    it('should add a value to the end of the array', function() {
      arr.push(4);
      expect(arr).to.have.lengthOf(4);
      expect(arr[3]).to.equal(4);
    });
  });

  describe('#pop()', function() {
    it('should remove the last value from the array', function() {
      arr.pop();
      expect(arr).to.have.lengthOf(2);
      expect(arr).to.not.include(3);
    });
  });
});</pre></div><div class='content'></div><h2><p>Testing Asynchronous Code</p>
</h2>
<div class='content'><p>Mocha supports testing asynchronous code using callbacks, promises, or async/await. Here’s an example using async/await:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y29uc3QgeyBleHBlY3QgfSA9IHJlcXVpcmUoJ2NoYWknKTsKCmRlc2NyaWJlKCdBc3luYyBGdW5jdGlvbicsIGZ1bmN0aW9uKCkgewogIGl0KCdzaG91bGQgcmV0dXJuIGEgcmVzb2x2ZWQgcHJvbWlzZScsIGFzeW5jIGZ1bmN0aW9uKCkgewogICAgY29uc3QgYXN5bmNGdW5jdGlvbiA9ICgpID0+IFByb21pc2UucmVzb2x2ZSgnSGVsbG8sIFdvcmxkIScpOwogICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgYXN5bmNGdW5jdGlvbigpOwogICAgZXhwZWN0KHJlc3VsdCkudG8uZXF1YWwoJ0hlbGxvLCBXb3JsZCEnKTsKICB9KTsKfSk7"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>const { expect } = require('chai');

describe('Async Function', function() {
  it('should return a resolved promise', async function() {
    const asyncFunction = () =&gt; Promise.resolve('Hello, World!');
    const result = await asyncFunction();
    expect(result).to.equal('Hello, World!');
  });
});</pre></div><div class='content'></div><h1><p>Practical Exercises</p>
</h1>
<div class='content'></div><h2><p>Exercise 1: Testing a Calculator Module</p>
</h2>
<div class='content'><p>Create a simple calculator module and write tests for its functions.</p>
<h4>Step 1: Create the Calculator Module</h4>
<p>Create a file named <code>calculator.js</code>:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y2xhc3MgQ2FsY3VsYXRvciB7CiAgYWRkKGEsIGIpIHsKICAgIHJldHVybiBhICsgYjsKICB9CgogIHN1YnRyYWN0KGEsIGIpIHsKICAgIHJldHVybiBhIC0gYjsKICB9CgogIG11bHRpcGx5KGEsIGIpIHsKICAgIHJldHVybiBhICogYjsKICB9CgogIGRpdmlkZShhLCBiKSB7CiAgICBpZiAoYiA9PT0gMCkgdGhyb3cgbmV3IEVycm9yKCdDYW5ub3QgZGl2aWRlIGJ5IHplcm8nKTsKICAgIHJldHVybiBhIC8gYjsKICB9Cn0KCm1vZHVsZS5leHBvcnRzID0gQ2FsY3VsYXRvcjs="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>class Calculator {
  add(a, b) {
    return a + b;
  }

  subtract(a, b) {
    return a - b;
  }

  multiply(a, b) {
    return a * b;
  }

  divide(a, b) {
    if (b === 0) throw new Error('Cannot divide by zero');
    return a / b;
  }
}

module.exports = Calculator;</pre></div><div class='content'><h4>Step 2: Write Tests for the Calculator Module</h4>
<p>Create a file named <code>test/calculatorTest.js</code>:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y29uc3QgeyBleHBlY3QgfSA9IHJlcXVpcmUoJ2NoYWknKTsKY29uc3QgQ2FsY3VsYXRvciA9IHJlcXVpcmUoJy4uL2NhbGN1bGF0b3InKTsKCmRlc2NyaWJlKCdDYWxjdWxhdG9yJywgZnVuY3Rpb24oKSB7CiAgbGV0IGNhbGN1bGF0b3I7CgogIGJlZm9yZUVhY2goZnVuY3Rpb24oKSB7CiAgICBjYWxjdWxhdG9yID0gbmV3IENhbGN1bGF0b3IoKTsKICB9KTsKCiAgZGVzY3JpYmUoJyNhZGQoKScsIGZ1bmN0aW9uKCkgewogICAgaXQoJ3Nob3VsZCByZXR1cm4gdGhlIHN1bSBvZiB0d28gbnVtYmVycycsIGZ1bmN0aW9uKCkgewogICAgICBleHBlY3QoY2FsY3VsYXRvci5hZGQoMiwgMykpLnRvLmVxdWFsKDUpOwogICAgfSk7CiAgfSk7CgogIGRlc2NyaWJlKCcjc3VidHJhY3QoKScsIGZ1bmN0aW9uKCkgewogICAgaXQoJ3Nob3VsZCByZXR1cm4gdGhlIGRpZmZlcmVuY2Ugb2YgdHdvIG51bWJlcnMnLCBmdW5jdGlvbigpIHsKICAgICAgZXhwZWN0KGNhbGN1bGF0b3Iuc3VidHJhY3QoNSwgMykpLnRvLmVxdWFsKDIpOwogICAgfSk7CiAgfSk7CgogIGRlc2NyaWJlKCcjbXVsdGlwbHkoKScsIGZ1bmN0aW9uKCkgewogICAgaXQoJ3Nob3VsZCByZXR1cm4gdGhlIHByb2R1Y3Qgb2YgdHdvIG51bWJlcnMnLCBmdW5jdGlvbigpIHsKICAgICAgZXhwZWN0KGNhbGN1bGF0b3IubXVsdGlwbHkoMiwgMykpLnRvLmVxdWFsKDYpOwogICAgfSk7CiAgfSk7CgogIGRlc2NyaWJlKCcjZGl2aWRlKCknLCBmdW5jdGlvbigpIHsKICAgIGl0KCdzaG91bGQgcmV0dXJuIHRoZSBxdW90aWVudCBvZiB0d28gbnVtYmVycycsIGZ1bmN0aW9uKCkgewogICAgICBleHBlY3QoY2FsY3VsYXRvci5kaXZpZGUoNiwgMykpLnRvLmVxdWFsKDIpOwogICAgfSk7CgogICAgaXQoJ3Nob3VsZCB0aHJvdyBhbiBlcnJvciB3aGVuIGRpdmlkaW5nIGJ5IHplcm8nLCBmdW5jdGlvbigpIHsKICAgICAgZXhwZWN0KCgpID0+IGNhbGN1bGF0b3IuZGl2aWRlKDYsIDApKS50by50aHJvdygnQ2Fubm90IGRpdmlkZSBieSB6ZXJvJyk7CiAgICB9KTsKICB9KTsKfSk7"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>const { expect } = require('chai');
const Calculator = require('../calculator');

describe('Calculator', function() {
  let calculator;

  beforeEach(function() {
    calculator = new Calculator();
  });

  describe('#add()', function() {
    it('should return the sum of two numbers', function() {
      expect(calculator.add(2, 3)).to.equal(5);
    });
  });

  describe('#subtract()', function() {
    it('should return the difference of two numbers', function() {
      expect(calculator.subtract(5, 3)).to.equal(2);
    });
  });

  describe('#multiply()', function() {
    it('should return the product of two numbers', function() {
      expect(calculator.multiply(2, 3)).to.equal(6);
    });
  });

  describe('#divide()', function() {
    it('should return the quotient of two numbers', function() {
      expect(calculator.divide(6, 3)).to.equal(2);
    });

    it('should throw an error when dividing by zero', function() {
      expect(() =&gt; calculator.divide(6, 0)).to.throw('Cannot divide by zero');
    });
  });
});</pre></div><div class='content'></div><h2><p>Exercise 2: Testing Asynchronous Functions</p>
</h2>
<div class='content'><p>Create a module with an asynchronous function and write tests for it.</p>
<h4>Step 1: Create the Async Module</h4>
<p>Create a file named <code>asyncModule.js</code>:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y2xhc3MgQXN5bmNNb2R1bGUgewogIGFzeW5jIGZldGNoRGF0YSgpIHsKICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gewogICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICByZXNvbHZlKCdEYXRhIGZldGNoZWQnKTsKICAgICAgfSwgMTAwMCk7CiAgICB9KTsKICB9Cn0KCm1vZHVsZS5leHBvcnRzID0gQXN5bmNNb2R1bGU7"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>class AsyncModule {
  async fetchData() {
    return new Promise((resolve) =&gt; {
      setTimeout(() =&gt; {
        resolve('Data fetched');
      }, 1000);
    });
  }
}

module.exports = AsyncModule;</pre></div><div class='content'><h4>Step 2: Write Tests for the Async Module</h4>
<p>Create a file named <code>test/asyncModuleTest.js</code>:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y29uc3QgeyBleHBlY3QgfSA9IHJlcXVpcmUoJ2NoYWknKTsKY29uc3QgQXN5bmNNb2R1bGUgPSByZXF1aXJlKCcuLi9hc3luY01vZHVsZScpOwoKZGVzY3JpYmUoJ0FzeW5jTW9kdWxlJywgZnVuY3Rpb24oKSB7CiAgbGV0IGFzeW5jTW9kdWxlOwoKICBiZWZvcmVFYWNoKGZ1bmN0aW9uKCkgewogICAgYXN5bmNNb2R1bGUgPSBuZXcgQXN5bmNNb2R1bGUoKTsKICB9KTsKCiAgZGVzY3JpYmUoJyNmZXRjaERhdGEoKScsIGZ1bmN0aW9uKCkgewogICAgaXQoJ3Nob3VsZCByZXR1cm4gIkRhdGEgZmV0Y2hlZCIgYWZ0ZXIgMSBzZWNvbmQnLCBhc3luYyBmdW5jdGlvbigpIHsKICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgYXN5bmNNb2R1bGUuZmV0Y2hEYXRhKCk7CiAgICAgIGV4cGVjdChyZXN1bHQpLnRvLmVxdWFsKCdEYXRhIGZldGNoZWQnKTsKICAgIH0pOwogIH0pOwp9KTs="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>const { expect } = require('chai');
const AsyncModule = require('../asyncModule');

describe('AsyncModule', function() {
  let asyncModule;

  beforeEach(function() {
    asyncModule = new AsyncModule();
  });

  describe('#fetchData()', function() {
    it('should return &quot;Data fetched&quot; after 1 second', async function() {
      const result = await asyncModule.fetchData();
      expect(result).to.equal('Data fetched');
    });
  });
});</pre></div><div class='content'></div><h1><p>Common Mistakes and Tips</p>
</h1>
<div class='content'><ul>
<li><strong>Forgetting to Return Promises</strong>: When testing asynchronous code, ensure you return the promise or use async/await.</li>
<li><strong>Not Using Hooks Properly</strong>: Use hooks like <code>beforeEach</code> to set up the state before each test to avoid code duplication.</li>
<li><strong>Ignoring Edge Cases</strong>: Always test edge cases, such as dividing by zero or handling null values.</li>
</ul>
</div><h1><p>Conclusion</p>
</h1>
<div class='content'><p>In this section, you learned how to set up and use Mocha and Chai for unit testing in Node.js. You wrote tests for both synchronous and asynchronous functions and explored the use of hooks to manage test state. By practicing with the provided exercises, you should now be comfortable writing and running unit tests for your Node.js applications.</p>
</div><div class='row navigation'>
	<div class='col-2'>
					<a href='09-01-introduction-testing' title="Introduction to Testing">&#x25C4;Previous</a>
			</div>
	<div class='col-8 text-center'>
			</div>
	<div class='col-2 text-end'>
					<a href='09-03-integration-testing' title="Integration Testing">Next &#x25BA;</a>
			</div>
</div>

			</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Advertising</h1>
			<p>This space is reserved for advertising.</p>
			<p>If you want to be a sponsor, contact us to include links in this area: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Thank you for collaborating!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. All rights reserved</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	We use cookies to improve your user experience and offer content tailored to your interests.
    <a href="#" id="btn_accept_cookies" class="button">Accept</a>
    <a href="/cookies">More Information</a>
</div>	

	</div>    
</body>
</html>
