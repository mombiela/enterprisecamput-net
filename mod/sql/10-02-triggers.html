<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Triggers</title>

    <link rel="alternate" href="https://campusempresa.com/mod/sql/10-02-triggers" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/mod/sql/10-02-triggers" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/mod/sql/10-02-triggers" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body >
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-8 p-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo-header_enterprise.png"></a>
			</h1>
		</div>
		<div class="col-4 p-0 text-end">
			<h2 id="main_title"><cite>Building today's and tomorrow's society</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-0 m-0 text-end">
													<b id="lit_lang_es" class="px-2">EN</b>
				|
				<a href="https://campusempresa.com/mod/sql/10-02-triggers" class="px-2">ES</a></b>
				|
				<a href="https://campusempresa.cat/mod/sql/10-02-triggers" class="px-2">CA</a>
					</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="/objective">The Project</a>
				<a href="/about">About Us</a>
				<a href="/contribute">Contribute</a>
				<a href="/donate">Donations</a>
				<a href="/licence">License</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content">
								<div class='row navigation'>
	<div class='col-2'>
					<a href='10-01-stored-procedures' title="Stored Procedures">&#x25C4;Previous</a>
			</div>
	<div class='col-8 text-center'>
					<a href="./"><h2 style="text-decoration:underline">Triggers</h2></a>
			</div>
	<div class='col-2 text-end'>
					<a href='10-03-views' title="Views">Next &#x25BA;</a>
			</div>
</div>
<div class='content'></div><h1>Introduction to Triggers</h1>
<div class='content'><p>Triggers are special types of stored procedures that automatically execute or &quot;fire&quot; when certain events occur in the database. They are used to enforce business rules, validate data, and maintain audit trails. Triggers can be set to activate before or after an insert, update, or delete operation on a table.</p>
</div><h2>Key Concepts</h2>
<div class='content'><ul>
<li><strong>Event</strong>: The database operation (INSERT, UPDATE, DELETE) that activates the trigger.</li>
<li><strong>Timing</strong>: Specifies when the trigger should be executed (BEFORE or AFTER the event).</li>
<li><strong>Action</strong>: The SQL statements that are executed when the trigger fires.</li>
</ul>
</div><h2>Types of Triggers</h2>
<div class='content'><ol>
<li><strong>BEFORE Triggers</strong>: Execute before the triggering event.</li>
<li><strong>AFTER Triggers</strong>: Execute after the triggering event.</li>
<li><strong>INSTEAD OF Triggers</strong>: Execute in place of the triggering event (commonly used with views).</li>
</ol>
</div><h1>Creating Triggers</h1>
<div class='content'></div><h2>Syntax</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Q1JFQVRFIFRSSUdHRVIgdHJpZ2dlcl9uYW1lCntCRUZPUkUgfCBBRlRFUiB8IElOU1RFQUQgT0Z9IHtJTlNFUlQgfCBVUERBVEUgfCBERUxFVEV9Ck9OIHRhYmxlX25hbWUKRk9SIEVBQ0ggUk9XCkJFR0lOCiAgICAtLSBTUUwgc3RhdGVtZW50cwpFTkQ7"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>CREATE TRIGGER trigger_name
{BEFORE | AFTER | INSTEAD OF} {INSERT | UPDATE | DELETE}
ON table_name
FOR EACH ROW
BEGIN
    -- SQL statements
END;</pre></div><div class='content'></div><h2>Example: BEFORE INSERT Trigger</h2>
<div class='content'><p>This example demonstrates a trigger that automatically sets the <code>created_at</code> column to the current timestamp before a new row is inserted into the <code>users</code> table.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Q1JFQVRFIFRSSUdHRVIgYmVmb3JlX2luc2VydF91c2VycwpCRUZPUkUgSU5TRVJUIE9OIHVzZXJzCkZPUiBFQUNIIFJPVwpCRUdJTgogICAgU0VUIE5FVy5jcmVhdGVkX2F0ID0gTk9XKCk7CkVORDs="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>CREATE TRIGGER before_insert_users
BEFORE INSERT ON users
FOR EACH ROW
BEGIN
    SET NEW.created_at = NOW();
END;</pre></div><div class='content'><p><strong>Explanation:</strong></p>
<ul>
<li><code>before_insert_users</code>: The name of the trigger.</li>
<li><code>BEFORE INSERT ON users</code>: Specifies that the trigger fires before an insert operation on the <code>users</code> table.</li>
<li><code>FOR EACH ROW</code>: Indicates that the trigger applies to each row affected by the insert operation.</li>
<li><code>SET NEW.created_at = NOW();</code>: Sets the <code>created_at</code> column of the new row to the current timestamp.</li>
</ul>
</div><h2>Example: AFTER UPDATE Trigger</h2>
<div class='content'><p>This example demonstrates a trigger that logs changes to the <code>salary</code> column in the <code>employees</code> table after an update operation.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Q1JFQVRFIFRSSUdHRVIgYWZ0ZXJfdXBkYXRlX2VtcGxveWVlcwpBRlRFUiBVUERBVEUgT04gZW1wbG95ZWVzCkZPUiBFQUNIIFJPVwpCRUdJTgogICAgSU5TRVJUIElOVE8gc2FsYXJ5X2NoYW5nZXMgKGVtcGxveWVlX2lkLCBvbGRfc2FsYXJ5LCBuZXdfc2FsYXJ5LCBjaGFuZ2VfZGF0ZSkKICAgIFZBTFVFUyAoT0xELmlkLCBPTEQuc2FsYXJ5LCBORVcuc2FsYXJ5LCBOT1coKSk7CkVORDs="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>CREATE TRIGGER after_update_employees
AFTER UPDATE ON employees
FOR EACH ROW
BEGIN
    INSERT INTO salary_changes (employee_id, old_salary, new_salary, change_date)
    VALUES (OLD.id, OLD.salary, NEW.salary, NOW());
END;</pre></div><div class='content'><p><strong>Explanation:</strong></p>
<ul>
<li><code>after_update_employees</code>: The name of the trigger.</li>
<li><code>AFTER UPDATE ON employees</code>: Specifies that the trigger fires after an update operation on the <code>employees</code> table.</li>
<li><code>FOR EACH ROW</code>: Indicates that the trigger applies to each row affected by the update operation.</li>
<li><code>INSERT INTO salary_changes ...</code>: Inserts a record into the <code>salary_changes</code> table, logging the old and new salary values along with the change date.</li>
</ul>
</div><h1>Practical Exercises</h1>
<div class='content'></div><h2>Exercise 1: Creating a BEFORE UPDATE Trigger</h2>
<div class='content'><p><strong>Task:</strong> Create a trigger that updates the <code>updated_at</code> column to the current timestamp before any row in the <code>products</code> table is updated.</p>
<p><strong>Solution:</strong></p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Q1JFQVRFIFRSSUdHRVIgYmVmb3JlX3VwZGF0ZV9wcm9kdWN0cwpCRUZPUkUgVVBEQVRFIE9OIHByb2R1Y3RzCkZPUiBFQUNIIFJPVwpCRUdJTgogICAgU0VUIE5FVy51cGRhdGVkX2F0ID0gTk9XKCk7CkVORDs="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>CREATE TRIGGER before_update_products
BEFORE UPDATE ON products
FOR EACH ROW
BEGIN
    SET NEW.updated_at = NOW();
END;</pre></div><div class='content'></div><h2>Exercise 2: Creating an AFTER DELETE Trigger</h2>
<div class='content'><p><strong>Task:</strong> Create a trigger that logs the deletion of rows from the <code>orders</code> table into a <code>deleted_orders</code> table.</p>
<p><strong>Solution:</strong></p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Q1JFQVRFIFRSSUdHRVIgYWZ0ZXJfZGVsZXRlX29yZGVycwpBRlRFUiBERUxFVEUgT04gb3JkZXJzCkZPUiBFQUNIIFJPVwpCRUdJTgogICAgSU5TRVJUIElOVE8gZGVsZXRlZF9vcmRlcnMgKG9yZGVyX2lkLCBkZWxldGVkX2F0KQogICAgVkFMVUVTIChPTEQuaWQsIE5PVygpKTsKRU5EOw=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>CREATE TRIGGER after_delete_orders
AFTER DELETE ON orders
FOR EACH ROW
BEGIN
    INSERT INTO deleted_orders (order_id, deleted_at)
    VALUES (OLD.id, NOW());
END;</pre></div><div class='content'></div><h1>Common Mistakes and Tips</h1>
<div class='content'><ul>
<li><strong>Misunderstanding Timing</strong>: Ensure you understand when the trigger should fire (BEFORE or AFTER the event).</li>
<li><strong>Using OLD and NEW</strong>: Use <code>OLD</code> to reference the values before the event and <code>NEW</code> to reference the values after the event.</li>
<li><strong>Performance Considerations</strong>: Triggers can impact performance, especially if they contain complex logic or affect many rows.</li>
</ul>
</div><h1>Conclusion</h1>
<div class='content'><p>Triggers are powerful tools for automating database tasks and enforcing business rules. By understanding how to create and use triggers effectively, you can ensure data integrity and streamline database operations. In the next topic, we will explore <strong>Views</strong>, another essential feature for managing and presenting data in SQL.</p>
</div><div class='row navigation'>
	<div class='col-2'>
					<a href='10-01-stored-procedures' title="Stored Procedures">&#x25C4;Previous</a>
			</div>
	<div class='col-8 text-center'>
			</div>
	<div class='col-2 text-end'>
					<a href='10-03-views' title="Views">Next &#x25BA;</a>
			</div>
</div>

			</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Advertising</h1>
			<p>This space is reserved for advertising.</p>
			<p>If you want to be a sponsor, contact us to include links in this area: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Thank you for collaborating!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. All rights reserved</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir galetes per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Accept</a>
    <a href="/cookies">More Information</a>
</div>	

	</div>    
</body>
</html>
