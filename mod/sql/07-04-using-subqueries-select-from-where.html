<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Using Subqueries in SELECT, FROM, and WHERE Clauses</title>

    <link rel="alternate" href="https://campusempresa.com/mod/sql/07-04-using-subqueries-select-from-where" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/mod/sql/07-04-using-subqueries-select-from-where" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/mod/sql/07-04-using-subqueries-select-from-where" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body >
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-12 col-md-8 p-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo-header_enterprise.png"></a>
			</h1>
		</div>
		<div class="col-12 col-md-4 p-0 text-end">
			<h2 id="main_title"><cite>Building today's and tomorrow's society</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-0 m-0 text-end">
													<b id="lit_lang_es" class="px-2">EN</b>
				|
				<a href="https://campusempresa.com/mod/sql/07-04-using-subqueries-select-from-where" class="px-2">ES</a></b>
				|
				<a href="https://campusempresa.cat/mod/sql/07-04-using-subqueries-select-from-where" class="px-2">CA</a>
					</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="/objective">The Project</a>
				<a href="/about">About Us</a>
				<a href="/contribute">Contribute</a>
				<a href="/donate">Donations</a>
				<a href="/licence">License</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content">
								<div class='row navigation'>
	<div class='col-2'>
					<a href='07-03-exists-not-exists' title="EXISTS and NOT EXISTS">&#x25C4;Previous</a>
			</div>
	<div class='col-8 text-center'>
					<a href="./"><h2 style="text-decoration:underline">Using Subqueries in SELECT, FROM, and WHERE Clauses</h2></a>
			</div>
	<div class='col-2 text-end'>
					<a href='08-01-understanding-indexes' title="Understanding Indexes">Next &#x25BA;</a>
			</div>
</div>
<div class='content'><p>Subqueries, also known as inner queries or nested queries, are queries within another SQL query. They are used to perform operations that require multiple steps, such as filtering data based on the results of another query. Subqueries can be used in various parts of a SQL statement, including the <code>SELECT</code>, <code>FROM</code>, and <code>WHERE</code> clauses. This section will cover how to use subqueries in these different contexts.</p>
</div><h1>Subqueries in the SELECT Clause</h1>
<div class='content'><p>Subqueries in the <code>SELECT</code> clause are used to return a single value that can be included in the result set of the main query. This is useful for calculations or retrieving related data.</p>
</div><h2>Example</h2>
<div class='content'><p>Suppose we have two tables: <code>employees</code> and <code>departments</code>.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Q1JFQVRFIFRBQkxFIGVtcGxveWVlcyAoCiAgICBpZCBJTlQgUFJJTUFSWSBLRVksCiAgICBuYW1lIFZBUkNIQVIoMTAwKSwKICAgIGRlcGFydG1lbnRfaWQgSU5ULAogICAgc2FsYXJ5IERFQ0lNQUwoMTAsIDIpCik7CgpDUkVBVEUgVEFCTEUgZGVwYXJ0bWVudHMgKAogICAgaWQgSU5UIFBSSU1BUlkgS0VZLAogICAgbmFtZSBWQVJDSEFSKDEwMCkKKTsKCklOU0VSVCBJTlRPIGVtcGxveWVlcyAoaWQsIG5hbWUsIGRlcGFydG1lbnRfaWQsIHNhbGFyeSkgVkFMVUVTCigxLCAnQWxpY2UnLCAxLCA2MDAwMCksCigyLCAnQm9iJywgMiwgNzAwMDApLAooMywgJ0NoYXJsaWUnLCAxLCA4MDAwMCk7CgpJTlNFUlQgSU5UTyBkZXBhcnRtZW50cyAoaWQsIG5hbWUpIFZBTFVFUwooMSwgJ0hSJyksCigyLCAnRW5naW5lZXJpbmcnKTs="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>CREATE TABLE employees (
    id INT PRIMARY KEY,
    name VARCHAR(100),
    department_id INT,
    salary DECIMAL(10, 2)
);

CREATE TABLE departments (
    id INT PRIMARY KEY,
    name VARCHAR(100)
);

INSERT INTO employees (id, name, department_id, salary) VALUES
(1, 'Alice', 1, 60000),
(2, 'Bob', 2, 70000),
(3, 'Charlie', 1, 80000);

INSERT INTO departments (id, name) VALUES
(1, 'HR'),
(2, 'Engineering');</pre></div><div class='content'><p>We want to retrieve the name of each employee along with the name of their department.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("U0VMRUNUIAogICAgZS5uYW1lIEFTIGVtcGxveWVlX25hbWUsCiAgICAoU0VMRUNUIGQubmFtZSBGUk9NIGRlcGFydG1lbnRzIGQgV0hFUkUgZC5pZCA9IGUuZGVwYXJ0bWVudF9pZCkgQVMgZGVwYXJ0bWVudF9uYW1lCkZST00gCiAgICBlbXBsb3llZXMgZTs="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>SELECT 
    e.name AS employee_name,
    (SELECT d.name FROM departments d WHERE d.id = e.department_id) AS department_name
FROM 
    employees e;</pre></div><div class='content'></div><h2>Explanation</h2>
<div class='content'><ul>
<li>The subquery <code>(SELECT d.name FROM departments d WHERE d.id = e.department_id)</code> retrieves the department name for each employee.</li>
<li>The main query selects the employee's name and the result of the subquery.</li>
</ul>
</div><h1>Subqueries in the FROM Clause</h1>
<div class='content'><p>Subqueries in the <code>FROM</code> clause are used to create a temporary table that can be referenced in the main query. This is useful for complex queries that require intermediate results.</p>
</div><h2>Example</h2>
<div class='content'><p>We want to find the average salary of employees in each department.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("U0VMRUNUIAogICAgZC5uYW1lIEFTIGRlcGFydG1lbnRfbmFtZSwKICAgIGF2Z19zYWxhcmllcy5hdmdfc2FsYXJ5CkZST00gCiAgICBkZXBhcnRtZW50cyBkCkpPSU4gCiAgICAoU0VMRUNUIGRlcGFydG1lbnRfaWQsIEFWRyhzYWxhcnkpIEFTIGF2Z19zYWxhcnkgRlJPTSBlbXBsb3llZXMgR1JPVVAgQlkgZGVwYXJ0bWVudF9pZCkgYXZnX3NhbGFyaWVzCk9OIAogICAgZC5pZCA9IGF2Z19zYWxhcmllcy5kZXBhcnRtZW50X2lkOw=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>SELECT 
    d.name AS department_name,
    avg_salaries.avg_salary
FROM 
    departments d
JOIN 
    (SELECT department_id, AVG(salary) AS avg_salary FROM employees GROUP BY department_id) avg_salaries
ON 
    d.id = avg_salaries.department_id;</pre></div><div class='content'></div><h2>Explanation</h2>
<div class='content'><ul>
<li>The subquery <code>(SELECT department_id, AVG(salary) AS avg_salary FROM employees GROUP BY department_id)</code> calculates the average salary for each department.</li>
<li>The main query joins the <code>departments</code> table with the result of the subquery to get the department name and the average salary.</li>
</ul>
</div><h1>Subqueries in the WHERE Clause</h1>
<div class='content'><p>Subqueries in the <code>WHERE</code> clause are used to filter the results of the main query based on the results of another query. This is useful for conditions that depend on the results of another query.</p>
</div><h2>Example</h2>
<div class='content'><p>We want to find employees who earn more than the average salary of their department.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("U0VMRUNUIAogICAgZS5uYW1lIEFTIGVtcGxveWVlX25hbWUsCiAgICBlLnNhbGFyeQpGUk9NIAogICAgZW1wbG95ZWVzIGUKV0hFUkUgCiAgICBlLnNhbGFyeSA+IChTRUxFQ1QgQVZHKHNhbGFyeSkgRlJPTSBlbXBsb3llZXMgV0hFUkUgZGVwYXJ0bWVudF9pZCA9IGUuZGVwYXJ0bWVudF9pZCk7"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>SELECT 
    e.name AS employee_name,
    e.salary
FROM 
    employees e
WHERE 
    e.salary &gt; (SELECT AVG(salary) FROM employees WHERE department_id = e.department_id);</pre></div><div class='content'></div><h2>Explanation</h2>
<div class='content'><ul>
<li>The subquery <code>(SELECT AVG(salary) FROM employees WHERE department_id = e.department_id)</code> calculates the average salary for the department of each employee.</li>
<li>The main query selects employees whose salary is greater than the average salary of their department.</li>
</ul>
</div><h1>Practical Exercises</h1>
<div class='content'></div><h2>Exercise 1</h2>
<div class='content'><p><strong>Task:</strong> Retrieve the names of employees who work in the 'Engineering' department.</p>
<p><strong>Solution:</strong></p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("U0VMRUNUIAogICAgbmFtZQpGUk9NIAogICAgZW1wbG95ZWVzCldIRVJFIAogICAgZGVwYXJ0bWVudF9pZCA9IChTRUxFQ1QgaWQgRlJPTSBkZXBhcnRtZW50cyBXSEVSRSBuYW1lID0gJ0VuZ2luZWVyaW5nJyk7"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>SELECT 
    name
FROM 
    employees
WHERE 
    department_id = (SELECT id FROM departments WHERE name = 'Engineering');</pre></div><div class='content'></div><h2>Exercise 2</h2>
<div class='content'><p><strong>Task:</strong> Find the department with the highest average salary.</p>
<p><strong>Solution:</strong></p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("U0VMRUNUIAogICAgZC5uYW1lIEFTIGRlcGFydG1lbnRfbmFtZQpGUk9NIAogICAgZGVwYXJ0bWVudHMgZApKT0lOIAogICAgKFNFTEVDVCBkZXBhcnRtZW50X2lkLCBBVkcoc2FsYXJ5KSBBUyBhdmdfc2FsYXJ5IEZST00gZW1wbG95ZWVzIEdST1VQIEJZIGRlcGFydG1lbnRfaWQpIGF2Z19zYWxhcmllcwpPTiAKICAgIGQuaWQgPSBhdmdfc2FsYXJpZXMuZGVwYXJ0bWVudF9pZApPUkRFUiBCWSAKICAgIGF2Z19zYWxhcmllcy5hdmdfc2FsYXJ5IERFU0MKTElNSVQgMTs="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>SELECT 
    d.name AS department_name
FROM 
    departments d
JOIN 
    (SELECT department_id, AVG(salary) AS avg_salary FROM employees GROUP BY department_id) avg_salaries
ON 
    d.id = avg_salaries.department_id
ORDER BY 
    avg_salaries.avg_salary DESC
LIMIT 1;</pre></div><div class='content'></div><h2>Exercise 3</h2>
<div class='content'><p><strong>Task:</strong> List the names of employees who earn more than the average salary of all employees.</p>
<p><strong>Solution:</strong></p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("U0VMRUNUIAogICAgbmFtZQpGUk9NIAogICAgZW1wbG95ZWVzCldIRVJFIAogICAgc2FsYXJ5ID4gKFNFTEVDVCBBVkcoc2FsYXJ5KSBGUk9NIGVtcGxveWVlcyk7"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>SELECT 
    name
FROM 
    employees
WHERE 
    salary &gt; (SELECT AVG(salary) FROM employees);</pre></div><div class='content'></div><h1>Common Mistakes and Tips</h1>
<div class='content'><ul>
<li>
<p><strong>Common Mistake:</strong> Using subqueries that return multiple rows where a single value is expected.</p>
<ul>
<li><strong>Tip:</strong> Ensure that subqueries used in the <code>SELECT</code> and <code>WHERE</code> clauses return a single value. Use aggregate functions like <code>MAX</code>, <code>MIN</code>, <code>AVG</code>, etc., if necessary.</li>
</ul>
</li>
<li>
<p><strong>Common Mistake:</strong> Not aliasing subqueries in the <code>FROM</code> clause.</p>
<ul>
<li><strong>Tip:</strong> Always use an alias for subqueries in the <code>FROM</code> clause to reference them easily in the main query.</li>
</ul>
</li>
</ul>
</div><h1>Conclusion</h1>
<div class='content'><p>Subqueries are powerful tools in SQL that allow you to perform complex queries by nesting one query within another. They can be used in the <code>SELECT</code>, <code>FROM</code>, and <code>WHERE</code> clauses to retrieve, filter, and manipulate data in various ways. Understanding how to use subqueries effectively will enhance your ability to write sophisticated SQL queries and solve complex data problems.</p>
</div><div class='row navigation'>
	<div class='col-2'>
					<a href='07-03-exists-not-exists' title="EXISTS and NOT EXISTS">&#x25C4;Previous</a>
			</div>
	<div class='col-8 text-center'>
			</div>
	<div class='col-2 text-end'>
					<a href='08-01-understanding-indexes' title="Understanding Indexes">Next &#x25BA;</a>
			</div>
</div>

			</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Advertising</h1>
			<p>This space is reserved for advertising.</p>
			<p>If you want to be a sponsor, contact us to include links in this area: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Thank you for collaborating!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. All rights reserved</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir galetes per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Accept</a>
    <a href="/cookies">More Information</a>
</div>	

	</div>    
</body>
</html>
