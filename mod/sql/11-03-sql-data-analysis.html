<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SQL for Data Analysis</title>

    <link rel="alternate" href="https://campusempresa.com/mod/sql/11-03-sql-data-analysis" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/mod/sql/11-03-sql-data-analysis" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/mod/sql/11-03-sql-data-analysis" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="/js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body >
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-12 col-md-8 p-2 p-md-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo-header_enterprise.png"></a>
			</h1>
		</div>
		<div class="col-12 col-md-4 p-2 p-md-0 text-end">
			<h2 id="main_title"><cite>Building today's and tomorrow's society</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-2 p-md-0 m-0 text-end">
													<b id="lit_lang_es" class="px-2">EN</b>
				|
				<a href="https://campusempresa.com/mod/sql/11-03-sql-data-analysis" class="px-2">ES</a></b>
				|
				<a href="https://campusempresa.cat/mod/sql/11-03-sql-data-analysis" class="px-2">CA</a>
					</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="/objective">The Project</a>
				<a href="/about">About Us</a>
				<a href="/contribute">Contribute</a>
				<a href="/donate">Donations</a>
				<a href="/licence">License</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content">
								<div class='row navigation'>
	<div class='col-2'>
					<a href='11-02-best-practices' title="Best Practices">&#x25C4;Previous</a>
			</div>
	<div class='col-8 text-center'>
					<a href="./"><h2 style="text-decoration:underline">SQL for Data Analysis</h2></a>
			</div>
	<div class='col-2 text-end'>
					<a href='11-04-sql-web-development' title="SQL in Web Development">Next &#x25BA;</a>
			</div>
</div>
<div class='content'><p>In this section, we will explore how SQL can be used for data analysis. SQL is a powerful tool for querying and manipulating data, making it an essential skill for data analysts. We will cover various techniques and functions that are commonly used in data analysis.</p>
</div><h1><p>Key Concepts</p>
</h1>
<div class='content'><ol>
<li><strong>Data Aggregation</strong>: Summarizing data using aggregate functions like <code>SUM</code>, <code>AVG</code>, <code>COUNT</code>, <code>MIN</code>, and <code>MAX</code>.</li>
<li><strong>Grouping Data</strong>: Using the <code>GROUP BY</code> clause to group rows that have the same values in specified columns.</li>
<li><strong>Filtering Groups</strong>: Applying the <code>HAVING</code> clause to filter groups based on aggregate values.</li>
<li><strong>Window Functions</strong>: Performing calculations across a set of table rows that are related to the current row.</li>
<li><strong>Subqueries</strong>: Using subqueries to perform complex queries and data transformations.</li>
<li><strong>Common Table Expressions (CTEs)</strong>: Simplifying complex queries by breaking them into simpler, reusable components.</li>
</ol>
</div><h1><p>Data Aggregation</p>
</h1>
<div class='content'></div><h2><p>Example: Summarizing Sales Data</p>
</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("U0VMRUNUIAogICAgcHJvZHVjdF9pZCwKICAgIFNVTShxdWFudGl0eSkgQVMgdG90YWxfcXVhbnRpdHksCiAgICBBVkcocHJpY2UpIEFTIGF2ZXJhZ2VfcHJpY2UKRlJPTSAKICAgIHNhbGVzCkdST1VQIEJZIAogICAgcHJvZHVjdF9pZDs="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>SELECT 
    product_id,
    SUM(quantity) AS total_quantity,
    AVG(price) AS average_price
FROM 
    sales
GROUP BY 
    product_id;</pre></div><div class='content'><p><strong>Explanation</strong>:</p>
<ul>
<li><code>SUM(quantity)</code>: Calculates the total quantity sold for each product.</li>
<li><code>AVG(price)</code>: Calculates the average price for each product.</li>
<li><code>GROUP BY product_id</code>: Groups the results by <code>product_id</code>.</li>
</ul>
</div><h1><p>Grouping Data</p>
</h1>
<div class='content'></div><h2><p>Example: Grouping Sales by Month</p>
</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("U0VMRUNUIAogICAgRVhUUkFDVChNT05USCBGUk9NIHNhbGVfZGF0ZSkgQVMgc2FsZV9tb250aCwKICAgIFNVTSh0b3RhbF9hbW91bnQpIEFTIG1vbnRobHlfc2FsZXMKRlJPTSAKICAgIHNhbGVzCkdST1VQIEJZIAogICAgRVhUUkFDVChNT05USCBGUk9NIHNhbGVfZGF0ZSk7"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>SELECT 
    EXTRACT(MONTH FROM sale_date) AS sale_month,
    SUM(total_amount) AS monthly_sales
FROM 
    sales
GROUP BY 
    EXTRACT(MONTH FROM sale_date);</pre></div><div class='content'><p><strong>Explanation</strong>:</p>
<ul>
<li><code>EXTRACT(MONTH FROM sale_date)</code>: Extracts the month from the <code>sale_date</code>.</li>
<li><code>SUM(total_amount)</code>: Calculates the total sales amount for each month.</li>
<li><code>GROUP BY EXTRACT(MONTH FROM sale_date)</code>: Groups the results by month.</li>
</ul>
</div><h1><p>Filtering Groups</p>
</h1>
<div class='content'></div><h2><p>Example: Filtering Groups with HAVING</p>
</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("U0VMRUNUIAogICAgcHJvZHVjdF9pZCwKICAgIFNVTShxdWFudGl0eSkgQVMgdG90YWxfcXVhbnRpdHkKRlJPTSAKICAgIHNhbGVzCkdST1VQIEJZIAogICAgcHJvZHVjdF9pZApIQVZJTkcgCiAgICBTVU0ocXVhbnRpdHkpID4gMTAwOw=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>SELECT 
    product_id,
    SUM(quantity) AS total_quantity
FROM 
    sales
GROUP BY 
    product_id
HAVING 
    SUM(quantity) &gt; 100;</pre></div><div class='content'><p><strong>Explanation</strong>:</p>
<ul>
<li><code>HAVING SUM(quantity) &gt; 100</code>: Filters the groups to include only those products with a total quantity sold greater than 100.</li>
</ul>
</div><h1><p>Window Functions</p>
</h1>
<div class='content'></div><h2><p>Example: Calculating Running Total</p>
</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("U0VMRUNUIAogICAgc2FsZV9kYXRlLAogICAgcHJvZHVjdF9pZCwKICAgIHF1YW50aXR5LAogICAgU1VNKHF1YW50aXR5KSBPVkVSIChPUkRFUiBCWSBzYWxlX2RhdGUpIEFTIHJ1bm5pbmdfdG90YWwKRlJPTSAKICAgIHNhbGVzOw=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>SELECT 
    sale_date,
    product_id,
    quantity,
    SUM(quantity) OVER (ORDER BY sale_date) AS running_total
FROM 
    sales;</pre></div><div class='content'><p><strong>Explanation</strong>:</p>
<ul>
<li><code>SUM(quantity) OVER (ORDER BY sale_date)</code>: Calculates the running total of quantities sold, ordered by <code>sale_date</code>.</li>
</ul>
</div><h1><p>Subqueries</p>
</h1>
<div class='content'></div><h2><p>Example: Using Subqueries for Data Transformation</p>
</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("U0VMRUNUIAogICAgcHJvZHVjdF9pZCwKICAgIHRvdGFsX3NhbGVzCkZST00gCiAgICAoU0VMRUNUIAogICAgICAgIHByb2R1Y3RfaWQsCiAgICAgICAgU1VNKHRvdGFsX2Ftb3VudCkgQVMgdG90YWxfc2FsZXMKICAgICBGUk9NIAogICAgICAgIHNhbGVzCiAgICAgR1JPVVAgQlkgCiAgICAgICAgcHJvZHVjdF9pZCkgQVMgc3VicXVlcnkKV0hFUkUgCiAgICB0b3RhbF9zYWxlcyA+IDEwMDA7"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>SELECT 
    product_id,
    total_sales
FROM 
    (SELECT 
        product_id,
        SUM(total_amount) AS total_sales
     FROM 
        sales
     GROUP BY 
        product_id) AS subquery
WHERE 
    total_sales &gt; 1000;</pre></div><div class='content'><p><strong>Explanation</strong>:</p>
<ul>
<li>The subquery calculates the total sales for each product.</li>
<li>The outer query filters the results to include only products with total sales greater than 1000.</li>
</ul>
</div><h1><p>Common Table Expressions (CTEs)</p>
</h1>
<div class='content'></div><h2><p>Example: Simplifying Complex Queries with CTEs</p>
</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("V0lUSCBzYWxlc19zdW1tYXJ5IEFTICgKICAgIFNFTEVDVCAKICAgICAgICBwcm9kdWN0X2lkLAogICAgICAgIFNVTSh0b3RhbF9hbW91bnQpIEFTIHRvdGFsX3NhbGVzCiAgICBGUk9NIAogICAgICAgIHNhbGVzCiAgICBHUk9VUCBCWSAKICAgICAgICBwcm9kdWN0X2lkCikKU0VMRUNUIAogICAgcHJvZHVjdF9pZCwKICAgIHRvdGFsX3NhbGVzCkZST00gCiAgICBzYWxlc19zdW1tYXJ5CldIRVJFIAogICAgdG90YWxfc2FsZXMgPiAxMDAwOw=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>WITH sales_summary AS (
    SELECT 
        product_id,
        SUM(total_amount) AS total_sales
    FROM 
        sales
    GROUP BY 
        product_id
)
SELECT 
    product_id,
    total_sales
FROM 
    sales_summary
WHERE 
    total_sales &gt; 1000;</pre></div><div class='content'><p><strong>Explanation</strong>:</p>
<ul>
<li>The CTE <code>sales_summary</code> calculates the total sales for each product.</li>
<li>The main query filters the results to include only products with total sales greater than 1000.</li>
</ul>
</div><h1><p>Practical Exercise</p>
</h1>
<div class='content'></div><h2><p>Exercise: Analyzing Customer Purchases</p>
</h2>
<div class='content'><p><strong>Task</strong>:</p>
<ol>
<li>Calculate the total amount spent by each customer.</li>
<li>Find the average amount spent per purchase for each customer.</li>
<li>Identify customers who have spent more than $500 in total.</li>
</ol>
<p><strong>Solution</strong>:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("LS0gU3RlcCAxOiBDYWxjdWxhdGUgdGhlIHRvdGFsIGFtb3VudCBzcGVudCBieSBlYWNoIGN1c3RvbWVyCldJVEggY3VzdG9tZXJfdG90YWxzIEFTICgKICAgIFNFTEVDVCAKICAgICAgICBjdXN0b21lcl9pZCwKICAgICAgICBTVU0odG90YWxfYW1vdW50KSBBUyB0b3RhbF9zcGVudAogICAgRlJPTSAKICAgICAgICBzYWxlcwogICAgR1JPVVAgQlkgCiAgICAgICAgY3VzdG9tZXJfaWQKKQoKLS0gU3RlcCAyOiBGaW5kIHRoZSBhdmVyYWdlIGFtb3VudCBzcGVudCBwZXIgcHVyY2hhc2UgZm9yIGVhY2ggY3VzdG9tZXIKLCBjdXN0b21lcl9hdmVyYWdlcyBBUyAoCiAgICBTRUxFQ1QgCiAgICAgICAgY3VzdG9tZXJfaWQsCiAgICAgICAgQVZHKHRvdGFsX2Ftb3VudCkgQVMgYXZlcmFnZV9zcGVudAogICAgRlJPTSAKICAgICAgICBzYWxlcwogICAgR1JPVVAgQlkgCiAgICAgICAgY3VzdG9tZXJfaWQKKQoKLS0gU3RlcCAzOiBJZGVudGlmeSBjdXN0b21lcnMgd2hvIGhhdmUgc3BlbnQgbW9yZSB0aGFuICQ1MDAgaW4gdG90YWwKU0VMRUNUIAogICAgY3QuY3VzdG9tZXJfaWQsCiAgICBjdC50b3RhbF9zcGVudCwKICAgIGNhLmF2ZXJhZ2Vfc3BlbnQKRlJPTSAKICAgIGN1c3RvbWVyX3RvdGFscyBjdApKT0lOIAogICAgY3VzdG9tZXJfYXZlcmFnZXMgY2EKT04gCiAgICBjdC5jdXN0b21lcl9pZCA9IGNhLmN1c3RvbWVyX2lkCldIRVJFIAogICAgY3QudG90YWxfc3BlbnQgPiA1MDA7"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>-- Step 1: Calculate the total amount spent by each customer
WITH customer_totals AS (
    SELECT 
        customer_id,
        SUM(total_amount) AS total_spent
    FROM 
        sales
    GROUP BY 
        customer_id
)

-- Step 2: Find the average amount spent per purchase for each customer
, customer_averages AS (
    SELECT 
        customer_id,
        AVG(total_amount) AS average_spent
    FROM 
        sales
    GROUP BY 
        customer_id
)

-- Step 3: Identify customers who have spent more than $500 in total
SELECT 
    ct.customer_id,
    ct.total_spent,
    ca.average_spent
FROM 
    customer_totals ct
JOIN 
    customer_averages ca
ON 
    ct.customer_id = ca.customer_id
WHERE 
    ct.total_spent &gt; 500;</pre></div><div class='content'><p><strong>Explanation</strong>:</p>
<ul>
<li>The first CTE <code>customer_totals</code> calculates the total amount spent by each customer.</li>
<li>The second CTE <code>customer_averages</code> calculates the average amount spent per purchase for each customer.</li>
<li>The main query joins the two CTEs and filters the results to include only customers who have spent more than $500 in total.</li>
</ul>
</div><h1><p>Conclusion</p>
</h1>
<div class='content'><p>In this section, we covered various SQL techniques and functions that are essential for data analysis. We learned how to aggregate data, group and filter data, use window functions, subqueries, and CTEs to simplify complex queries. These skills are crucial for performing effective data analysis using SQL. In the next section, we will explore how SQL is used in web development.</p>
</div><div class='row navigation'>
	<div class='col-2'>
					<a href='11-02-best-practices' title="Best Practices">&#x25C4;Previous</a>
			</div>
	<div class='col-8 text-center'>
			</div>
	<div class='col-2 text-end'>
					<a href='11-04-sql-web-development' title="SQL in Web Development">Next &#x25BA;</a>
			</div>
</div>

			</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Advertising</h1>
			<p>This space is reserved for advertising.</p>
			<p>If you want to be a sponsor, contact us to include links in this area: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Thank you for collaborating!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. All rights reserved</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir galetes per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Accept</a>
    <a href="/cookies">More Information</a>
</div>	

	</div>    
</body>
</html>
