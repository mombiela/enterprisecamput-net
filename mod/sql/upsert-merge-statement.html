<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UPSERT (MERGE) Statement</title>

    <link rel="alternate" href="https://campusempresa.com/mod/sql/upsert-merge-statement" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/mod/sql/upsert-merge-statement" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/mod/sql/upsert-merge-statement" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body>
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-8 p-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo_header.png" style="visibility:hiddenxx;"></a>
			</h1>
		</div>
		<div class="col-4 p-0 text-end">
			<h2 id="main_title"><cite>Building today's and tomorrow's society</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-0 m-0 text-end">
													<b id="lit_lang_es" class="px-2">EN</b>
				|
				<a href="https://campusempresa.com/mod/sql/upsert-merge-statement" class="px-2">ES</a></b>
				|
				<a href="https://campusempresa.cat/mod/sql/upsert-merge-statement" class="px-2">CA</a>
					</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="/objective">The Project</a>
				<a href="/about">About Us</a>
				<a href="/contribute">Contribute</a>
				<a href="/donate">Donations</a>
				<a href="/licence">License</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content"><div class='row navigation'>
	<div class='col-4'>
					<a href='delete-statement'>&#x25C4;DELETE Statement</a>
			</div>
	<div class='col-4 text-center'>
		<a href="./" class="title">UPSERT (MERGE) Statement</a>
	</div>
	<div class='col-4 text-end'>
					<a href='database-design-principles'>Database Design Principles &#x25BA;</a>
			</div>
</div>
<div class='content'></div><h1>Introduction to UPSERT (MERGE)</h1>
<div class='content'><p>The UPSERT (MERGE) statement is a powerful SQL command that allows you to insert new records or update existing records within a table. This is particularly useful when you need to synchronize data between tables or when you want to ensure that data is up-to-date without having to perform separate INSERT and UPDATE operations.</p>
</div><h2>Key Concepts</h2>
<div class='content'><ul>
<li><strong>UPSERT</strong>: A combination of &quot;UPDATE&quot; and &quot;INSERT&quot;. It ensures that if a record exists, it is updated; if it does not exist, it is inserted.</li>
<li><strong>MERGE</strong>: The SQL standard command that performs the UPSERT operation. It combines the functionality of both INSERT and UPDATE in a single statement.</li>
</ul>
</div><h1>Basic Syntax</h1>
<div class='content'><p>The basic syntax of the MERGE statement is as follows:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("TUVSR0UgSU5UTyB0YXJnZXRfdGFibGUgQVMgdGFyZ2V0ClVTSU5HIHNvdXJjZV90YWJsZSBBUyBzb3VyY2UKT04gdGFyZ2V0Lm1hdGNoaW5nX2NvbHVtbiA9IHNvdXJjZS5tYXRjaGluZ19jb2x1bW4KV0hFTiBNQVRDSEVEIFRIRU4KICAgIFVQREFURSBTRVQgdGFyZ2V0LmNvbHVtbjEgPSBzb3VyY2UuY29sdW1uMSwgdGFyZ2V0LmNvbHVtbjIgPSBzb3VyY2UuY29sdW1uMgpXSEVOIE5PVCBNQVRDSEVEIFRIRU4KICAgIElOU0VSVCAoY29sdW1uMSwgY29sdW1uMikgVkFMVUVTIChzb3VyY2UuY29sdW1uMSwgc291cmNlLmNvbHVtbjIpOw=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>MERGE INTO target_table AS target
USING source_table AS source
ON target.matching_column = source.matching_column
WHEN MATCHED THEN
    UPDATE SET target.column1 = source.column1, target.column2 = source.column2
WHEN NOT MATCHED THEN
    INSERT (column1, column2) VALUES (source.column1, source.column2);</pre></div><div class='content'></div><h2>Explanation</h2>
<div class='content'><ul>
<li><strong>MERGE INTO target_table</strong>: Specifies the target table where the data will be inserted or updated.</li>
<li><strong>USING source_table</strong>: Specifies the source table that contains the new data.</li>
<li><strong>ON target.matching_column = source.matching_column</strong>: Defines the condition to match records between the target and source tables.</li>
<li><strong>WHEN MATCHED THEN UPDATE</strong>: Specifies the action to take when a match is found.</li>
<li><strong>WHEN NOT MATCHED THEN INSERT</strong>: Specifies the action to take when no match is found.</li>
</ul>
</div><h1>Example</h1>
<div class='content'><p>Consider two tables: <code>employees</code> (target) and <code>new_employees</code> (source).</p>
</div><h2>Table Structures</h2>
<div class='content'><p><strong>employees</strong></p>
<p>| employee_id | name    | department |
|-------------|---------|------------|
| 1           | Alice   | HR         |
| 2           | Bob     | IT         |
| 3           | Charlie | Finance    |</p>
<p><strong>new_employees</strong></p>
<p>| employee_id | name    | department |
|-------------|---------|------------|
| 2           | Bob     | Marketing  |
| 4           | David   | IT         |</p>
</div><h2>MERGE Statement</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("TUVSR0UgSU5UTyBlbXBsb3llZXMgQVMgZQpVU0lORyBuZXdfZW1wbG95ZWVzIEFTIG5lCk9OIGUuZW1wbG95ZWVfaWQgPSBuZS5lbXBsb3llZV9pZApXSEVOIE1BVENIRUQgVEhFTgogICAgVVBEQVRFIFNFVCBlLm5hbWUgPSBuZS5uYW1lLCBlLmRlcGFydG1lbnQgPSBuZS5kZXBhcnRtZW50CldIRU4gTk9UIE1BVENIRUQgVEhFTgogICAgSU5TRVJUIChlbXBsb3llZV9pZCwgbmFtZSwgZGVwYXJ0bWVudCkgVkFMVUVTIChuZS5lbXBsb3llZV9pZCwgbmUubmFtZSwgbmUuZGVwYXJ0bWVudCk7"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>MERGE INTO employees AS e
USING new_employees AS ne
ON e.employee_id = ne.employee_id
WHEN MATCHED THEN
    UPDATE SET e.name = ne.name, e.department = ne.department
WHEN NOT MATCHED THEN
    INSERT (employee_id, name, department) VALUES (ne.employee_id, ne.name, ne.department);</pre></div><div class='content'></div><h2>Result</h2>
<div class='content'><p>After executing the above MERGE statement, the <code>employees</code> table will be updated as follows:</p>
<p>| employee_id | name    | department |
|-------------|---------|------------|
| 1           | Alice   | HR         |
| 2           | Bob     | Marketing  |
| 3           | Charlie | Finance    |
| 4           | David   | IT         |</p>
</div><h1>Advanced Usage</h1>
<div class='content'></div><h2>Handling Multiple Conditions</h2>
<div class='content'><p>You can handle multiple conditions within the MERGE statement to perform different actions based on various criteria.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("TUVSR0UgSU5UTyBlbXBsb3llZXMgQVMgZQpVU0lORyBuZXdfZW1wbG95ZWVzIEFTIG5lCk9OIGUuZW1wbG95ZWVfaWQgPSBuZS5lbXBsb3llZV9pZApXSEVOIE1BVENIRUQgQU5EIGUuZGVwYXJ0bWVudCAhPSBuZS5kZXBhcnRtZW50IFRIRU4KICAgIFVQREFURSBTRVQgZS5kZXBhcnRtZW50ID0gbmUuZGVwYXJ0bWVudApXSEVOIE1BVENIRUQgQU5EIGUuZGVwYXJ0bWVudCA9IG5lLmRlcGFydG1lbnQgVEhFTgogICAgVVBEQVRFIFNFVCBlLm5hbWUgPSBuZS5uYW1lCldIRU4gTk9UIE1BVENIRUQgVEhFTgogICAgSU5TRVJUIChlbXBsb3llZV9pZCwgbmFtZSwgZGVwYXJ0bWVudCkgVkFMVUVTIChuZS5lbXBsb3llZV9pZCwgbmUubmFtZSwgbmUuZGVwYXJ0bWVudCk7"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>MERGE INTO employees AS e
USING new_employees AS ne
ON e.employee_id = ne.employee_id
WHEN MATCHED AND e.department != ne.department THEN
    UPDATE SET e.department = ne.department
WHEN MATCHED AND e.department = ne.department THEN
    UPDATE SET e.name = ne.name
WHEN NOT MATCHED THEN
    INSERT (employee_id, name, department) VALUES (ne.employee_id, ne.name, ne.department);</pre></div><div class='content'></div><h2>Using Subqueries</h2>
<div class='content'><p>You can also use subqueries in the USING clause to dynamically generate the source data.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("TUVSR0UgSU5UTyBlbXBsb3llZXMgQVMgZQpVU0lORyAoU0VMRUNUIGVtcGxveWVlX2lkLCBuYW1lLCBkZXBhcnRtZW50IEZST00gbmV3X2VtcGxveWVlcyBXSEVSRSBkZXBhcnRtZW50ID0gJ0lUJykgQVMgbmUKT04gZS5lbXBsb3llZV9pZCA9IG5lLmVtcGxveWVlX2lkCldIRU4gTUFUQ0hFRCBUSEVOCiAgICBVUERBVEUgU0VUIGUubmFtZSA9IG5lLm5hbWUsIGUuZGVwYXJ0bWVudCA9IG5lLmRlcGFydG1lbnQKV0hFTiBOT1QgTUFUQ0hFRCBUSEVOCiAgICBJTlNFUlQgKGVtcGxveWVlX2lkLCBuYW1lLCBkZXBhcnRtZW50KSBWQUxVRVMgKG5lLmVtcGxveWVlX2lkLCBuZS5uYW1lLCBuZS5kZXBhcnRtZW50KTs="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>MERGE INTO employees AS e
USING (SELECT employee_id, name, department FROM new_employees WHERE department = 'IT') AS ne
ON e.employee_id = ne.employee_id
WHEN MATCHED THEN
    UPDATE SET e.name = ne.name, e.department = ne.department
WHEN NOT MATCHED THEN
    INSERT (employee_id, name, department) VALUES (ne.employee_id, ne.name, ne.department);</pre></div><div class='content'></div><h1>Conclusion</h1>
<div class='content'><p>The UPSERT (MERGE) statement is a versatile and efficient way to manage data synchronization and ensure data integrity in SQL databases. By combining the functionality of both INSERT and UPDATE operations, it simplifies the process of maintaining up-to-date records. Understanding and utilizing the MERGE statement can significantly enhance your SQL programming skills and streamline your database management tasks.</p>
</div><div class='row navigation'>
	<div class='col-4'>
					<a href='delete-statement'>&#x25C4;DELETE Statement</a>
			</div>
	<div class='col-4 text-center'>
		<a href="./" class="title">UPSERT (MERGE) Statement</a>
	</div>
	<div class='col-4 text-end'>
					<a href='database-design-principles'>Database Design Principles &#x25BA;</a>
			</div>
</div>
</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Advertising</h1>
			<p>This space is reserved for advertising.</p>
			<p>If you want to be a sponsor, contact us to include links in this area: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Thank you for collaborating!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. All rights reserved</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir galetes per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Accept</a>
    <a href="/cookies">More Information</a>
</div>	

	</div>    
</body>
</html>
