<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic SQL in RPG</title>

    <link rel="alternate" href="https://campusempresa.com/mod/rpg/dynamic-sql" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/mod/rpg/dynamic-sql" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/mod/rpg/dynamic-sql" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body>
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-8 p-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo-header_enterprise.png"></a>
			</h1>
		</div>
		<div class="col-4 p-0 text-end">
			<h2 id="main_title"><cite>Building today's and tomorrow's society</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-0 m-0 text-end">
													<b id="lit_lang_es" class="px-2">EN</b>
				|
				<a href="https://campusempresa.com/mod/rpg/dynamic-sql" class="px-2">ES</a></b>
				|
				<a href="https://campusempresa.cat/mod/rpg/dynamic-sql" class="px-2">CA</a>
					</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="/objective">The Project</a>
				<a href="/about">About Us</a>
				<a href="/contribute">Contribute</a>
				<a href="/donate">Donations</a>
				<a href="/licence">License</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content"><div class='row navigation'>
	<div class='col-4'>
					<a href='embedded-sql'>&#x25C4;Embedded SQL</a>
			</div>
	<div class='col-4 text-center'>
		<a href="./" class="title">Dynamic SQL in RPG</a>
	</div>
	<div class='col-4 text-end'>
					<a href='database-transactions'>Database Transactions &#x25BA;</a>
			</div>
</div>
<div class='content'><p>Dynamic SQL is a powerful feature in RPG that allows you to construct and execute SQL statements dynamically at runtime. This is particularly useful when the exact SQL statement cannot be determined until the program is running.</p>
</div><h1>Key Concepts</h1>
<div class='content'><ul>
<li><strong>Static SQL</strong>: SQL statements are hard-coded in the program and do not change.</li>
<li><strong>Dynamic SQL</strong>: SQL statements are constructed and executed at runtime, allowing for more flexibility.</li>
</ul>
</div><h1>Advantages of Dynamic SQL</h1>
<div class='content'><ul>
<li><strong>Flexibility</strong>: Allows the construction of SQL queries based on user input or other runtime conditions.</li>
<li><strong>Adaptability</strong>: Can handle varying query requirements without changing the source code.</li>
</ul>
</div><h1>Disadvantages of Dynamic SQL</h1>
<div class='content'><ul>
<li><strong>Complexity</strong>: More complex to write and debug compared to static SQL.</li>
<li><strong>Performance</strong>: May be slower due to the overhead of constructing and parsing SQL statements at runtime.</li>
<li><strong>Security</strong>: Higher risk of SQL injection attacks if not properly handled.</li>
</ul>
</div><h1>Constructing Dynamic SQL in RPG</h1>
<div class='content'></div><h2>Basic Example</h2>
<div class='content'><p>Here is a simple example of constructing and executing a dynamic SQL statement in RPG:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("RGNsLVMgc3FsU3RtdCBWYXJjaGFyKDUwMCk7CkRjbC1TIGN1c3RJZCBDaGFyKDEwKTsKRGNsLVMgY3VzdE5hbWUgQ2hhcig1MCk7CgpjdXN0SWQgPSAnQ1VTVDAwMSc7CgpzcWxTdG10ID0gJ1NFTEVDVCBDVVNUTkFNRSBGUk9NIENVU1RPTUVSUyBXSEVSRSBDVVNUSUQgPSAnJycgKyBjdXN0SWQgKyAnJycnOwoKRXhlYyBTUUwKICBQcmVwYXJlIHN0bXQxIEZyb20gOnNxbFN0bXQ7CgpFeGVjIFNRTAogIERlY2xhcmUgYzEgQ3Vyc29yIEZvciBzdG10MTsKCkV4ZWMgU1FMCiAgT3BlbiBjMTsKCkV4ZWMgU1FMCiAgRmV0Y2ggYzEgSW50byA6Y3VzdE5hbWU7CgpFeGVjIFNRTAogIENsb3NlIGMxOwoKRHNwbHkgY3VzdE5hbWU7"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>Dcl-S sqlStmt Varchar(500);
Dcl-S custId Char(10);
Dcl-S custName Char(50);

custId = 'CUST001';

sqlStmt = 'SELECT CUSTNAME FROM CUSTOMERS WHERE CUSTID = ''' + custId + '''';

Exec SQL
  Prepare stmt1 From :sqlStmt;

Exec SQL
  Declare c1 Cursor For stmt1;

Exec SQL
  Open c1;

Exec SQL
  Fetch c1 Into :custName;

Exec SQL
  Close c1;

Dsply custName;</pre></div><div class='content'></div><h2>Explanation</h2>
<div class='content'><ol>
<li><strong>Declare Variables</strong>: Declare necessary variables for SQL statement and data retrieval.</li>
<li><strong>Construct SQL Statement</strong>: Build the SQL statement dynamically using string concatenation.</li>
<li><strong>Prepare Statement</strong>: Use <code>Prepare</code> to compile the SQL statement.</li>
<li><strong>Declare Cursor</strong>: Declare a cursor for the prepared statement.</li>
<li><strong>Open Cursor</strong>: Open the cursor to execute the SQL statement.</li>
<li><strong>Fetch Data</strong>: Retrieve data from the cursor into RPG variables.</li>
<li><strong>Close Cursor</strong>: Close the cursor after fetching the data.</li>
</ol>
</div><h2>Handling User Input</h2>
<div class='content'><p>When dealing with user input, it is crucial to prevent SQL injection. Use parameter markers to safely include user input in SQL statements.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("RGNsLVMgc3FsU3RtdCBWYXJjaGFyKDUwMCk7CkRjbC1TIGN1c3RJZCBDaGFyKDEwKTsKRGNsLVMgY3VzdE5hbWUgQ2hhcig1MCk7CgpjdXN0SWQgPSAnQ1VTVDAwMSc7CgpzcWxTdG10ID0gJ1NFTEVDVCBDVVNUTkFNRSBGUk9NIENVU1RPTUVSUyBXSEVSRSBDVVNUSUQgPSA/JzsKCkV4ZWMgU1FMCiAgUHJlcGFyZSBzdG10MSBGcm9tIDpzcWxTdG10OwoKRXhlYyBTUUwKICBEZWNsYXJlIGMxIEN1cnNvciBGb3Igc3RtdDE7CgpFeGVjIFNRTAogIE9wZW4gYzEgVXNpbmcgOmN1c3RJZDsKCkV4ZWMgU1FMCiAgRmV0Y2ggYzEgSW50byA6Y3VzdE5hbWU7CgpFeGVjIFNRTAogIENsb3NlIGMxOwoKRHNwbHkgY3VzdE5hbWU7"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>Dcl-S sqlStmt Varchar(500);
Dcl-S custId Char(10);
Dcl-S custName Char(50);

custId = 'CUST001';

sqlStmt = 'SELECT CUSTNAME FROM CUSTOMERS WHERE CUSTID = ?';

Exec SQL
  Prepare stmt1 From :sqlStmt;

Exec SQL
  Declare c1 Cursor For stmt1;

Exec SQL
  Open c1 Using :custId;

Exec SQL
  Fetch c1 Into :custName;

Exec SQL
  Close c1;

Dsply custName;</pre></div><div class='content'></div><h2>Explanation</h2>
<div class='content'><ol>
<li><strong>Parameter Marker</strong>: Use <code>?</code> as a placeholder for the variable in the SQL statement.</li>
<li><strong>Open Cursor with Parameters</strong>: Use <code>Using</code> to pass the variable value safely to the SQL statement.</li>
</ol>
</div><h1>Advanced Dynamic SQL</h1>
<div class='content'></div><h2>Using Dynamic SQL with Multiple Parameters</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("RGNsLVMgc3FsU3RtdCBWYXJjaGFyKDUwMCk7CkRjbC1TIGN1c3RJZCBDaGFyKDEwKTsKRGNsLVMgb3JkZXJEYXRlIERhdGU7CkRjbC1TIG9yZGVyQW1vdW50IFBhY2tlZCg3OjIpOwoKY3VzdElkID0gJ0NVU1QwMDEnOwpvcmRlckRhdGUgPSAlRGF0ZSgnMjAyMy0wMS0wMScpOwoKc3FsU3RtdCA9ICdTRUxFQ1QgT1JERVJBTU9VTlQgRlJPTSBPUkRFUlMgV0hFUkUgQ1VTVElEID0gPyBBTkQgT1JERVJEQVRFID0gPyc7CgpFeGVjIFNRTAogIFByZXBhcmUgc3RtdDEgRnJvbSA6c3FsU3RtdDsKCkV4ZWMgU1FMCiAgRGVjbGFyZSBjMSBDdXJzb3IgRm9yIHN0bXQxOwoKRXhlYyBTUUwKICBPcGVuIGMxIFVzaW5nIDpjdXN0SWQsIDpvcmRlckRhdGU7CgpFeGVjIFNRTAogIEZldGNoIGMxIEludG8gOm9yZGVyQW1vdW50OwoKRXhlYyBTUUwKICBDbG9zZSBjMTsKCkRzcGx5ICVDaGFyKG9yZGVyQW1vdW50KTs="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>Dcl-S sqlStmt Varchar(500);
Dcl-S custId Char(10);
Dcl-S orderDate Date;
Dcl-S orderAmount Packed(7:2);

custId = 'CUST001';
orderDate = %Date('2023-01-01');

sqlStmt = 'SELECT ORDERAMOUNT FROM ORDERS WHERE CUSTID = ? AND ORDERDATE = ?';

Exec SQL
  Prepare stmt1 From :sqlStmt;

Exec SQL
  Declare c1 Cursor For stmt1;

Exec SQL
  Open c1 Using :custId, :orderDate;

Exec SQL
  Fetch c1 Into :orderAmount;

Exec SQL
  Close c1;

Dsply %Char(orderAmount);</pre></div><div class='content'></div><h2>Explanation</h2>
<div class='content'><ol>
<li><strong>Multiple Parameters</strong>: Use multiple <code>?</code> placeholders for different variables.</li>
<li><strong>Pass Multiple Variables</strong>: Use <code>Using</code> to pass multiple variables to the SQL statement.</li>
</ol>
</div><h1>Conclusion</h1>
<div class='content'><p>Dynamic SQL in RPG provides the flexibility to construct and execute SQL statements at runtime, making it a powerful tool for handling complex and variable query requirements. However, it comes with challenges such as increased complexity, potential performance issues, and security risks. Proper handling of user input and understanding the trade-offs are essential for effectively using dynamic SQL in your RPG programs.</p>
</div><div class='row navigation'>
	<div class='col-4'>
					<a href='embedded-sql'>&#x25C4;Embedded SQL</a>
			</div>
	<div class='col-4 text-center'>
		<a href="./" class="title">Dynamic SQL in RPG</a>
	</div>
	<div class='col-4 text-end'>
					<a href='database-transactions'>Database Transactions &#x25BA;</a>
			</div>
</div>
</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Advertising</h1>
			<p>This space is reserved for advertising.</p>
			<p>If you want to be a sponsor, contact us to include links in this area: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Thank you for collaborating!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. All rights reserved</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir galetes per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Accept</a>
    <a href="/cookies">More Information</a>
</div>	

	</div>    
</body>
</html>
