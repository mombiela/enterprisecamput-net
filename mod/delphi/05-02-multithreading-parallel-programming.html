<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multithreading and Parallel Programming</title>

    <link rel="alternate" href="https://campusempresa.com/mod/delphi/05-02-multithreading-parallel-programming" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/mod/delphi/05-02-multithreading-parallel-programming" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/mod/delphi/05-02-multithreading-parallel-programming" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="/js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body >
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-12 col-md-8 p-2 p-md-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo-header_enterprise.png"></a>
			</h1>
		</div>
		<div class="col-12 col-md-4 p-2 p-md-0 text-end">
			<h2 id="main_title"><cite>Building today's and tomorrow's society</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-2 p-md-0 m-0 text-end">
													<b id="lit_lang_es" class="px-2">EN</b>
				|
				<a href="https://campusempresa.com/mod/delphi/05-02-multithreading-parallel-programming" class="px-2">ES</a></b>
				|
				<a href="https://campusempresa.cat/mod/delphi/05-02-multithreading-parallel-programming" class="px-2">CA</a>
					</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="/objective">The Project</a>
				<a href="/about">About Us</a>
				<a href="/contribute">Contribute</a>
				<a href="/donate">Donations</a>
				<a href="/licence">License</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content">
								<div class='row navigation'>
	<div class='col-2'>
					<a href='05-01-generics-collections' title="Generics and Collections">&#x25C4;Previous</a>
			</div>
	<div class='col-8 text-center'>
					<a href="./"><h2 style="text-decoration:underline">Multithreading and Parallel Programming</h2></a>
			</div>
	<div class='col-2 text-end'>
					<a href='05-03-component-based-development' title="Component-Based Development">Next &#x25BA;</a>
			</div>
</div>
<div class='content'><p>Multithreading and parallel programming are essential concepts for creating efficient and responsive applications. In this section, we will explore how to implement multithreading in Delphi/Object Pascal, understand the benefits and challenges, and learn how to use parallel programming techniques to optimize performance.</p>
</div><h1><p>Key Concepts</p>
</h1>
<div class='content'><ol>
<li><strong>Thread</strong>: A thread is the smallest unit of a process that can be scheduled by the operating system. It allows multiple operations to run concurrently within a single process.</li>
<li><strong>Multithreading</strong>: The ability of a CPU or a single core in a multi-core processor to execute multiple threads simultaneously.</li>
<li><strong>Parallel Programming</strong>: A type of computation in which many calculations or processes are carried out simultaneously, leveraging multiple processors or cores.</li>
</ol>
</div><h1><p>Benefits of Multithreading and Parallel Programming</p>
</h1>
<div class='content'><ul>
<li><strong>Improved Performance</strong>: By dividing tasks into smaller threads, applications can perform multiple operations simultaneously, leading to faster execution.</li>
<li><strong>Responsiveness</strong>: Multithreading can keep the user interface responsive by offloading time-consuming tasks to background threads.</li>
<li><strong>Resource Utilization</strong>: Efficiently utilizes CPU resources by running multiple threads in parallel.</li>
</ul>
</div><h1><p>Setting Up Multithreading in Delphi</p>
</h1>
<div class='content'></div><h2><p>Creating a Simple Thread</p>
</h2>
<div class='content'><p>In Delphi, you can create a thread by defining a class that inherits from <code>TThread</code>. Here’s a basic example:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("dW5pdCBTaW1wbGVUaHJlYWRVbml0OwoKaW50ZXJmYWNlCgp1c2VzCiAgU3lzdGVtLkNsYXNzZXMsIFZjbC5EaWFsb2dzOwoKdHlwZQogIFRTaW1wbGVUaHJlYWQgPSBjbGFzcyhUVGhyZWFkKQogIHByb3RlY3RlZAogICAgcHJvY2VkdXJlIEV4ZWN1dGU7IG92ZXJyaWRlOwogIGVuZDsKCmltcGxlbWVudGF0aW9uCgpwcm9jZWR1cmUgVFNpbXBsZVRocmVhZC5FeGVjdXRlOwpiZWdpbgogIC8vIFRocmVhZCBjb2RlIGdvZXMgaGVyZQogIFN5bmNocm9uaXplKHByb2NlZHVyZQogIGJlZ2luCiAgICBTaG93TWVzc2FnZSgnSGVsbG8gZnJvbSB0aGUgdGhyZWFkIScpOwogIGVuZCk7CmVuZDsKCmVuZC4="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>unit SimpleThreadUnit;

interface

uses
  System.Classes, Vcl.Dialogs;

type
  TSimpleThread = class(TThread)
  protected
    procedure Execute; override;
  end;

implementation

procedure TSimpleThread.Execute;
begin
  // Thread code goes here
  Synchronize(procedure
  begin
    ShowMessage('Hello from the thread!');
  end);
end;

end.</pre></div><div class='content'></div><h2><p>Explanation</p>
</h2>
<div class='content'><ul>
<li><strong>TThread</strong>: The base class for all threads in Delphi.</li>
<li><strong>Execute</strong>: The method where the thread's code is written. This method is called when the thread starts.</li>
<li><strong>Synchronize</strong>: Ensures that the code inside the procedure runs in the main thread, which is necessary for updating the UI.</li>
</ul>
</div><h2><p>Starting the Thread</p>
</h2>
<div class='content'><p>To start the thread, you create an instance of the <code>TSimpleThread</code> class and call its <code>Start</code> method:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("cHJvY2VkdXJlIFRGb3JtMS5CdXR0b24xQ2xpY2soU2VuZGVyOiBUT2JqZWN0KTsKdmFyCiAgTXlUaHJlYWQ6IFRTaW1wbGVUaHJlYWQ7CmJlZ2luCiAgTXlUaHJlYWQgOj0gVFNpbXBsZVRocmVhZC5DcmVhdGUoVHJ1ZSk7IC8vIENyZWF0ZSB0aGUgdGhyZWFkIHN1c3BlbmRlZAogIE15VGhyZWFkLkZyZWVPblRlcm1pbmF0ZSA6PSBUcnVlOyAvLyBBdXRvbWF0aWNhbGx5IGZyZWUgdGhlIHRocmVhZCB3aGVuIGRvbmUKICBNeVRocmVhZC5TdGFydDsgLy8gU3RhcnQgdGhlIHRocmVhZAplbmQ7"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>procedure TForm1.Button1Click(Sender: TObject);
var
  MyThread: TSimpleThread;
begin
  MyThread := TSimpleThread.Create(True); // Create the thread suspended
  MyThread.FreeOnTerminate := True; // Automatically free the thread when done
  MyThread.Start; // Start the thread
end;</pre></div><div class='content'></div><h2><p>Practical Example: Background Calculation</p>
</h2>
<div class='content'><p>Let's create a thread that performs a background calculation and updates the UI with the result.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("dW5pdCBDYWxjdWxhdGlvblRocmVhZFVuaXQ7CgppbnRlcmZhY2UKCnVzZXMKICBTeXN0ZW0uQ2xhc3NlcywgVmNsLlN0ZEN0cmxzOwoKdHlwZQogIFRDYWxjdWxhdGlvblRocmVhZCA9IGNsYXNzKFRUaHJlYWQpCiAgcHJpdmF0ZQogICAgRlJlc3VsdDogSW50ZWdlcjsKICAgIEZMYWJlbDogVExhYmVsOwogIHByb3RlY3RlZAogICAgcHJvY2VkdXJlIEV4ZWN1dGU7IG92ZXJyaWRlOwogICAgcHJvY2VkdXJlIFVwZGF0ZUxhYmVsOwogIHB1YmxpYwogICAgY29uc3RydWN0b3IgQ3JlYXRlKEFMYWJlbDogVExhYmVsKTsKICBlbmQ7CgppbXBsZW1lbnRhdGlvbgoKY29uc3RydWN0b3IgVENhbGN1bGF0aW9uVGhyZWFkLkNyZWF0ZShBTGFiZWw6IFRMYWJlbCk7CmJlZ2luCiAgaW5oZXJpdGVkIENyZWF0ZShUcnVlKTsKICBGTGFiZWwgOj0gQUxhYmVsOwogIEZyZWVPblRlcm1pbmF0ZSA6PSBUcnVlOwplbmQ7Cgpwcm9jZWR1cmUgVENhbGN1bGF0aW9uVGhyZWFkLkV4ZWN1dGU7CnZhcgogIEk6IEludGVnZXI7CmJlZ2luCiAgRlJlc3VsdCA6PSAwOwogIGZvciBJIDo9IDEgdG8gMTAwMDAwMCBkbwogICAgSW5jKEZSZXN1bHQsIEkpOwogIFN5bmNocm9uaXplKFVwZGF0ZUxhYmVsKTsKZW5kOwoKcHJvY2VkdXJlIFRDYWxjdWxhdGlvblRocmVhZC5VcGRhdGVMYWJlbDsKYmVnaW4KICBGTGFiZWwuQ2FwdGlvbiA6PSAnUmVzdWx0OiAnICsgSW50VG9TdHIoRlJlc3VsdCk7CmVuZDsKCmVuZC4="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>unit CalculationThreadUnit;

interface

uses
  System.Classes, Vcl.StdCtrls;

type
  TCalculationThread = class(TThread)
  private
    FResult: Integer;
    FLabel: TLabel;
  protected
    procedure Execute; override;
    procedure UpdateLabel;
  public
    constructor Create(ALabel: TLabel);
  end;

implementation

constructor TCalculationThread.Create(ALabel: TLabel);
begin
  inherited Create(True);
  FLabel := ALabel;
  FreeOnTerminate := True;
end;

procedure TCalculationThread.Execute;
var
  I: Integer;
begin
  FResult := 0;
  for I := 1 to 1000000 do
    Inc(FResult, I);
  Synchronize(UpdateLabel);
end;

procedure TCalculationThread.UpdateLabel;
begin
  FLabel.Caption := 'Result: ' + IntToStr(FResult);
end;

end.</pre></div><div class='content'></div><h2><p>Starting the Calculation Thread</p>
</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("cHJvY2VkdXJlIFRGb3JtMS5CdXR0b24xQ2xpY2soU2VuZGVyOiBUT2JqZWN0KTsKdmFyCiAgQ2FsY1RocmVhZDogVENhbGN1bGF0aW9uVGhyZWFkOwpiZWdpbgogIENhbGNUaHJlYWQgOj0gVENhbGN1bGF0aW9uVGhyZWFkLkNyZWF0ZShMYWJlbDEpOwogIENhbGNUaHJlYWQuU3RhcnQ7CmVuZDs="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>procedure TForm1.Button1Click(Sender: TObject);
var
  CalcThread: TCalculationThread;
begin
  CalcThread := TCalculationThread.Create(Label1);
  CalcThread.Start;
end;</pre></div><div class='content'></div><h1><p>Parallel Programming with TParallel</p>
</h1>
<div class='content'><p>Delphi provides the <code>TParallel</code> class for parallel programming, which simplifies the process of running tasks in parallel.</p>
</div><h2><p>Parallel For Loop</p>
</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("dXNlcwogIFN5c3RlbS5UaHJlYWRpbmc7Cgpwcm9jZWR1cmUgVEZvcm0xLkJ1dHRvbjFDbGljayhTZW5kZXI6IFRPYmplY3QpOwp2YXIKICBTdW06IEludGVnZXI7CmJlZ2luCiAgU3VtIDo9IDA7CiAgVFBhcmFsbGVsLkZvcigxLCAxMDAwMDAwLAogICAgcHJvY2VkdXJlKEk6IEludGVnZXIpCiAgICBiZWdpbgogICAgICBUSW50ZXJsb2NrZWQuQWRkKFN1bSwgSSk7CiAgICBlbmQpOwogIFNob3dNZXNzYWdlKCdTdW06ICcgKyBJbnRUb1N0cihTdW0pKTsKZW5kOw=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>uses
  System.Threading;

procedure TForm1.Button1Click(Sender: TObject);
var
  Sum: Integer;
begin
  Sum := 0;
  TParallel.For(1, 1000000,
    procedure(I: Integer)
    begin
      TInterlocked.Add(Sum, I);
    end);
  ShowMessage('Sum: ' + IntToStr(Sum));
end;</pre></div><div class='content'></div><h2><p>Explanation</p>
</h2>
<div class='content'><ul>
<li><strong>TParallel.For</strong>: Executes a for loop in parallel.</li>
<li><strong>TInterlocked.Add</strong>: Ensures that the addition operation is thread-safe.</li>
</ul>
</div><h1><p>Practical Exercises</p>
</h1>
<div class='content'></div><h2><p>Exercise 1: Create a Thread to Perform a Background Task</p>
</h2>
<div class='content'><p><strong>Task</strong>: Create a thread that calculates the factorial of a number and updates a label with the result.</p>
<p><strong>Solution</strong>:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("dW5pdCBGYWN0b3JpYWxUaHJlYWRVbml0OwoKaW50ZXJmYWNlCgp1c2VzCiAgU3lzdGVtLkNsYXNzZXMsIFZjbC5TdGRDdHJsczsKCnR5cGUKICBURmFjdG9yaWFsVGhyZWFkID0gY2xhc3MoVFRocmVhZCkKICBwcml2YXRlCiAgICBGTnVtYmVyOiBJbnRlZ2VyOwogICAgRlJlc3VsdDogSW50NjQ7CiAgICBGTGFiZWw6IFRMYWJlbDsKICBwcm90ZWN0ZWQKICAgIHByb2NlZHVyZSBFeGVjdXRlOyBvdmVycmlkZTsKICAgIHByb2NlZHVyZSBVcGRhdGVMYWJlbDsKICBwdWJsaWMKICAgIGNvbnN0cnVjdG9yIENyZWF0ZShBTnVtYmVyOiBJbnRlZ2VyOyBBTGFiZWw6IFRMYWJlbCk7CiAgZW5kOwoKaW1wbGVtZW50YXRpb24KCmNvbnN0cnVjdG9yIFRGYWN0b3JpYWxUaHJlYWQuQ3JlYXRlKEFOdW1iZXI6IEludGVnZXI7IEFMYWJlbDogVExhYmVsKTsKYmVnaW4KICBpbmhlcml0ZWQgQ3JlYXRlKFRydWUpOwogIEZOdW1iZXIgOj0gQU51bWJlcjsKICBGTGFiZWwgOj0gQUxhYmVsOwogIEZyZWVPblRlcm1pbmF0ZSA6PSBUcnVlOwplbmQ7Cgpwcm9jZWR1cmUgVEZhY3RvcmlhbFRocmVhZC5FeGVjdXRlOwp2YXIKICBJOiBJbnRlZ2VyOwpiZWdpbgogIEZSZXN1bHQgOj0gMTsKICBmb3IgSSA6PSAxIHRvIEZOdW1iZXIgZG8KICAgIEZSZXN1bHQgOj0gRlJlc3VsdCAqIEk7CiAgU3luY2hyb25pemUoVXBkYXRlTGFiZWwpOwplbmQ7Cgpwcm9jZWR1cmUgVEZhY3RvcmlhbFRocmVhZC5VcGRhdGVMYWJlbDsKYmVnaW4KICBGTGFiZWwuQ2FwdGlvbiA6PSAnRmFjdG9yaWFsOiAnICsgSW50VG9TdHIoRlJlc3VsdCk7CmVuZDsKCmVuZC4="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>unit FactorialThreadUnit;

interface

uses
  System.Classes, Vcl.StdCtrls;

type
  TFactorialThread = class(TThread)
  private
    FNumber: Integer;
    FResult: Int64;
    FLabel: TLabel;
  protected
    procedure Execute; override;
    procedure UpdateLabel;
  public
    constructor Create(ANumber: Integer; ALabel: TLabel);
  end;

implementation

constructor TFactorialThread.Create(ANumber: Integer; ALabel: TLabel);
begin
  inherited Create(True);
  FNumber := ANumber;
  FLabel := ALabel;
  FreeOnTerminate := True;
end;

procedure TFactorialThread.Execute;
var
  I: Integer;
begin
  FResult := 1;
  for I := 1 to FNumber do
    FResult := FResult * I;
  Synchronize(UpdateLabel);
end;

procedure TFactorialThread.UpdateLabel;
begin
  FLabel.Caption := 'Factorial: ' + IntToStr(FResult);
end;

end.</pre></div><div class='content'></div><h2><p>Exercise 2: Use TParallel to Perform a Parallel Calculation</p>
</h2>
<div class='content'><p><strong>Task</strong>: Use <code>TParallel.For</code> to calculate the sum of squares from 1 to 1000000.</p>
<p><strong>Solution</strong>:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("dXNlcwogIFN5c3RlbS5UaHJlYWRpbmc7Cgpwcm9jZWR1cmUgVEZvcm0xLkJ1dHRvbjFDbGljayhTZW5kZXI6IFRPYmplY3QpOwp2YXIKICBTdW06IEludDY0OwpiZWdpbgogIFN1bSA6PSAwOwogIFRQYXJhbGxlbC5Gb3IoMSwgMTAwMDAwMCwKICAgIHByb2NlZHVyZShJOiBJbnRlZ2VyKQogICAgYmVnaW4KICAgICAgVEludGVybG9ja2VkLkFkZChTdW0sIEkgKiBJKTsKICAgIGVuZCk7CiAgU2hvd01lc3NhZ2UoJ1N1bSBvZiBzcXVhcmVzOiAnICsgSW50VG9TdHIoU3VtKSk7CmVuZDs="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>uses
  System.Threading;

procedure TForm1.Button1Click(Sender: TObject);
var
  Sum: Int64;
begin
  Sum := 0;
  TParallel.For(1, 1000000,
    procedure(I: Integer)
    begin
      TInterlocked.Add(Sum, I * I);
    end);
  ShowMessage('Sum of squares: ' + IntToStr(Sum));
end;</pre></div><div class='content'></div><h1><p>Common Mistakes and Tips</p>
</h1>
<div class='content'><ul>
<li><strong>UI Updates</strong>: Always use <code>Synchronize</code> or <code>Queue</code> to update the UI from a thread.</li>
<li><strong>Thread Safety</strong>: Ensure that shared resources are accessed in a thread-safe manner using synchronization mechanisms like <code>TInterlocked</code>, <code>TCriticalSection</code>, or <code>TMonitor</code>.</li>
<li><strong>Resource Management</strong>: Properly manage the lifecycle of threads to avoid memory leaks and ensure that threads are terminated correctly.</li>
</ul>
</div><h1><p>Conclusion</p>
</h1>
<div class='content'><p>In this section, we covered the basics of multithreading and parallel programming in Delphi/Object Pascal. We learned how to create and manage threads, perform background tasks, and use the <code>TParallel</code> class for parallel computations. By leveraging these techniques, you can create more efficient and responsive applications. In the next module, we will explore advanced Delphi features, including generics and collections.</p>
</div><div class='row navigation'>
	<div class='col-2'>
					<a href='05-01-generics-collections' title="Generics and Collections">&#x25C4;Previous</a>
			</div>
	<div class='col-8 text-center'>
			</div>
	<div class='col-2 text-end'>
					<a href='05-03-component-based-development' title="Component-Based Development">Next &#x25BA;</a>
			</div>
</div>

			</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Advertising</h1>
			<p>This space is reserved for advertising.</p>
			<p>If you want to be a sponsor, contact us to include links in this area: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Thank you for collaborating!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. All rights reserved</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir galetes per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Accept</a>
    <a href="/cookies">More Information</a>
</div>	

	</div>    
</body>
</html>
