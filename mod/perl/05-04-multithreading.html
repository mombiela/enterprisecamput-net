<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow, noarchive">
    <title>Multithreading</title>

    <link rel="alternate" href="https://campusempresa.com/mod/perl/05-04-multithreading" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/mod/perl/05-04-multithreading" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/mod/perl/05-04-multithreading" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css?v=4" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="/js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
	<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-0611338592562725" crossorigin="anonymous"></script>  	
	</head>

<body >
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-12 col-md-6 p-2 p-md-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo-header_enterprise.png"></a>
			</h1>
		</div>
		<div class="col-12 col-md-6 p-2 p-md-0 text-end">
			<span>	<b id="lit_lang_es" class="px-2">EN</b>
	|
	<a href="https://campusempresa.com/mod/perl/05-04-multithreading" class="px-2">ES</a></b>
	|
	<a href="https://campusempresa.cat/mod/perl/05-04-multithreading" class="px-2">CA</a>
</span>
			<span class="d-none d-md-inline"><br><cite>All the knowledge within your reach</cite></span>
		</div>
	</div>
</div>
<div class="subheader container-xxl d-none d-md-block">
	<div class="row">
		<div class="col-12 p-2 p-md-0 m-0 text-end">
			<a href="/objective">The Project</a> | 
<a href="/about">About Us</a> | 
<a href="/contribute">Contribute</a> | 
<a href="/donate">Donations</a> | 
<a href="/licence">License</a>
		</div>
	</div>
</div>

<div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
					 				<a href="/"><i class="bi bi-house-fill"></i> HOME</a>
											</div>
		</div>
	</div>
</div>
		
<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content">
				<div class='row navigation'>
	<div class='col-1 col-md-2'>
					<a href='05-03-web-programming-with-perl' title="Web Programming with Perl">
				<span class="d-none d-md-inline">&#x25C4; Previous</span>
				<span class="d-inline d-md-none"><i class="bi bi-caret-left-square-fill"></i></span>
			</a>
			</div>
	<div class='col-10 col-md-8 text-center'>
					<a href="./"><h2 style="text-decoration:underline">Multithreading</h2></a>
			</div>
	<div class='col-1 col-md-2 text-end'>
					<a href='06-01-debugging-and-error-handling' title="Debugging and Error Handling">
				<span class="d-none d-md-inline">Next &#x25BA;</span>
				<span class="d-inline d-md-none"><i class="bi bi-caret-right-square-fill"></i></span>
			</a>
			</div>
</div>
<div class='content'><p>Multithreading in Perl allows you to run multiple threads concurrently within a single program. This can be particularly useful for tasks that can be parallelized, such as processing large datasets, handling multiple network connections, or performing complex computations.</p>
</div><h1>Key Concepts</h1>
<div class='content'><ol>
<li><strong>Threads</strong>: Independent units of execution within a program.</li>
<li><strong>Concurrency</strong>: The ability to run multiple threads simultaneously.</li>
<li><strong>Thread Safety</strong>: Ensuring that shared data is accessed in a thread-safe manner to avoid race conditions.</li>
</ol>
</div><h1>Setting Up Multithreading in Perl</h1>
<div class='content'><p>To use multithreading in Perl, you need to use the <code>threads</code> module. This module provides a simple and efficient way to create and manage threads.</p>
</div><h2>Installing the <code>threads</code> Module</h2>
<div class='content'><p>If the <code>threads</code> module is not already installed, you can install it using CPAN:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y3BhbiBpbnN0YWxsIHRocmVhZHM="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>cpan install threads</pre></div><div class='content'></div><h2>Basic Example</h2>
<div class='content'><p>Here is a simple example to demonstrate the creation and execution of threads in Perl:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("dXNlIHN0cmljdDsKdXNlIHdhcm5pbmdzOwp1c2UgdGhyZWFkczsKCiMgU3Vicm91dGluZSB0byBiZSBleGVjdXRlZCBieSB0aHJlYWRzCnN1YiB0aHJlYWRfZnVuY3Rpb24gewogICAgbXkgJHRocmVhZF9pZCA9IHRocmVhZHMtPnNlbGYtPnRpZCgpOwogICAgcHJpbnQgIlRocmVhZCAkdGhyZWFkX2lkIGlzIHJ1bm5pbmdcbiI7CiAgICBzbGVlcCgyKTsKICAgIHByaW50ICJUaHJlYWQgJHRocmVhZF9pZCBoYXMgZmluaXNoZWRcbiI7Cn0KCiMgQ3JlYXRlIGFuZCBzdGFydCB0aHJlYWRzCm15IEB0aHJlYWRzOwpmb3IgKDEuLjMpIHsKICAgIHB1c2ggQHRocmVhZHMsIHRocmVhZHMtPmNyZWF0ZShcJnRocmVhZF9mdW5jdGlvbik7Cn0KCiMgV2FpdCBmb3IgYWxsIHRocmVhZHMgdG8gZmluaXNoCmZvcmVhY2ggbXkgJHRocmVhZCAoQHRocmVhZHMpIHsKICAgICR0aHJlYWQtPmpvaW4oKTsKfQoKcHJpbnQgIkFsbCB0aHJlYWRzIGhhdmUgY29tcGxldGVkIGV4ZWN1dGlvblxuIjs="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>use strict;
use warnings;
use threads;

# Subroutine to be executed by threads
sub thread_function {
    my $thread_id = threads-&gt;self-&gt;tid();
    print &quot;Thread $thread_id is running\n&quot;;
    sleep(2);
    print &quot;Thread $thread_id has finished\n&quot;;
}

# Create and start threads
my @threads;
for (1..3) {
    push @threads, threads-&gt;create(\&amp;thread_function);
}

# Wait for all threads to finish
foreach my $thread (@threads) {
    $thread-&gt;join();
}

print &quot;All threads have completed execution\n&quot;;</pre></div><div class='content'></div><h2>Explanation</h2>
<div class='content'><ul>
<li><strong>Creating Threads</strong>: <code>threads-&gt;create(\&amp;thread_function)</code> creates a new thread that runs the <code>thread_function</code> subroutine.</li>
<li><strong>Joining Threads</strong>: <code>$thread-&gt;join()</code> waits for the thread to finish execution.</li>
</ul>
</div><h1>Shared Variables</h1>
<div class='content'><p>When using threads, you often need to share data between them. The <code>threads::shared</code> module allows you to share variables safely.</p>
</div><h2>Example with Shared Variables</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("dXNlIHN0cmljdDsKdXNlIHdhcm5pbmdzOwp1c2UgdGhyZWFkczsKdXNlIHRocmVhZHM6OnNoYXJlZDsKCm15ICRzaGFyZWRfY291bnRlciA6c2hhcmVkID0gMDsKCnN1YiBpbmNyZW1lbnRfY291bnRlciB7CiAgICBmb3IgKDEuLjEwMCkgewogICAgICAgIHsKICAgICAgICAgICAgbG9jaygkc2hhcmVkX2NvdW50ZXIpOwogICAgICAgICAgICAkc2hhcmVkX2NvdW50ZXIrKzsKICAgICAgICB9CiAgICB9Cn0KCiMgQ3JlYXRlIGFuZCBzdGFydCB0aHJlYWRzCm15IEB0aHJlYWRzOwpmb3IgKDEuLjUpIHsKICAgIHB1c2ggQHRocmVhZHMsIHRocmVhZHMtPmNyZWF0ZShcJmluY3JlbWVudF9jb3VudGVyKTsKfQoKIyBXYWl0IGZvciBhbGwgdGhyZWFkcyB0byBmaW5pc2gKZm9yZWFjaCBteSAkdGhyZWFkIChAdGhyZWFkcykgewogICAgJHRocmVhZC0+am9pbigpOwp9CgpwcmludCAiRmluYWwgY291bnRlciB2YWx1ZTogJHNoYXJlZF9jb3VudGVyXG4iOw=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>use strict;
use warnings;
use threads;
use threads::shared;

my $shared_counter :shared = 0;

sub increment_counter {
    for (1..100) {
        {
            lock($shared_counter);
            $shared_counter++;
        }
    }
}

# Create and start threads
my @threads;
for (1..5) {
    push @threads, threads-&gt;create(\&amp;increment_counter);
}

# Wait for all threads to finish
foreach my $thread (@threads) {
    $thread-&gt;join();
}

print &quot;Final counter value: $shared_counter\n&quot;;</pre></div><div class='content'></div><h2>Explanation</h2>
<div class='content'><ul>
<li><strong>Shared Variable</strong>: <code>my $shared_counter :shared</code> declares a shared variable.</li>
<li><strong>Locking</strong>: <code>lock($shared_counter)</code> ensures that only one thread can modify the shared variable at a time.</li>
</ul>
</div><h1>Practical Exercise</h1>
<div class='content'></div><h2>Exercise: Multithreaded File Processing</h2>
<div class='content'><p>Write a Perl script that reads a list of file names from a text file and processes each file in a separate thread. The processing task can be as simple as counting the number of lines in each file.</p>
<h4>Solution</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("dXNlIHN0cmljdDsKdXNlIHdhcm5pbmdzOwp1c2UgdGhyZWFkczsKdXNlIHRocmVhZHM6OnNoYXJlZDsKCiMgU3Vicm91dGluZSB0byBjb3VudCBsaW5lcyBpbiBhIGZpbGUKc3ViIGNvdW50X2xpbmVzIHsKICAgIG15ICgkZmlsZSkgPSBAXzsKICAgIG9wZW4gbXkgJGZoLCAnPCcsICRmaWxlIG9yIGRpZSAiQ2Fubm90IG9wZW4gZmlsZSAkZmlsZTogJCEiOwogICAgbXkgJGNvdW50ID0gMDsKICAgICRjb3VudCsrIHdoaWxlIDwkZmg+OwogICAgY2xvc2UgJGZoOwogICAgcmV0dXJuICRjb3VudDsKfQoKIyBTdWJyb3V0aW5lIHRvIGJlIGV4ZWN1dGVkIGJ5IHRocmVhZHMKc3ViIHByb2Nlc3NfZmlsZSB7CiAgICBteSAoJGZpbGUpID0gQF87CiAgICBteSAkbGluZV9jb3VudCA9IGNvdW50X2xpbmVzKCRmaWxlKTsKICAgIHByaW50ICJGaWxlICRmaWxlIGhhcyAkbGluZV9jb3VudCBsaW5lc1xuIjsKfQoKIyBSZWFkIGZpbGUgbmFtZXMgZnJvbSBpbnB1dCBmaWxlCm15ICRpbnB1dF9maWxlID0gJ2ZpbGVfbGlzdC50eHQnOwpvcGVuIG15ICRmaCwgJzwnLCAkaW5wdXRfZmlsZSBvciBkaWUgIkNhbm5vdCBvcGVuIGZpbGUgJGlucHV0X2ZpbGU6ICQhIjsKbXkgQGZpbGVzID0gPCRmaD47CmNob21wIEBmaWxlczsKY2xvc2UgJGZoOwoKIyBDcmVhdGUgYW5kIHN0YXJ0IHRocmVhZHMKbXkgQHRocmVhZHM7CmZvcmVhY2ggbXkgJGZpbGUgKEBmaWxlcykgewogICAgcHVzaCBAdGhyZWFkcywgdGhyZWFkcy0+Y3JlYXRlKFwmcHJvY2Vzc19maWxlLCAkZmlsZSk7Cn0KCiMgV2FpdCBmb3IgYWxsIHRocmVhZHMgdG8gZmluaXNoCmZvcmVhY2ggbXkgJHRocmVhZCAoQHRocmVhZHMpIHsKICAgICR0aHJlYWQtPmpvaW4oKTsKfQoKcHJpbnQgIkFsbCBmaWxlcyBoYXZlIGJlZW4gcHJvY2Vzc2VkXG4iOw=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>use strict;
use warnings;
use threads;
use threads::shared;

# Subroutine to count lines in a file
sub count_lines {
    my ($file) = @_;
    open my $fh, '&lt;', $file or die &quot;Cannot open file $file: $!&quot;;
    my $count = 0;
    $count++ while &lt;$fh&gt;;
    close $fh;
    return $count;
}

# Subroutine to be executed by threads
sub process_file {
    my ($file) = @_;
    my $line_count = count_lines($file);
    print &quot;File $file has $line_count lines\n&quot;;
}

# Read file names from input file
my $input_file = 'file_list.txt';
open my $fh, '&lt;', $input_file or die &quot;Cannot open file $input_file: $!&quot;;
my @files = &lt;$fh&gt;;
chomp @files;
close $fh;

# Create and start threads
my @threads;
foreach my $file (@files) {
    push @threads, threads-&gt;create(\&amp;process_file, $file);
}

# Wait for all threads to finish
foreach my $thread (@threads) {
    $thread-&gt;join();
}

print &quot;All files have been processed\n&quot;;</pre></div><div class='content'></div><h2>Explanation</h2>
<div class='content'><ul>
<li><strong>File Reading</strong>: The script reads file names from <code>file_list.txt</code>.</li>
<li><strong>Thread Creation</strong>: Each file is processed in a separate thread using <code>threads-&gt;create(\&amp;process_file, $file)</code>.</li>
<li><strong>Line Counting</strong>: The <code>count_lines</code> subroutine counts the number of lines in a file.</li>
</ul>
</div><h1>Common Mistakes and Tips</h1>
<div class='content'><ul>
<li><strong>Race Conditions</strong>: Always use <code>lock</code> when modifying shared variables to avoid race conditions.</li>
<li><strong>Resource Management</strong>: Ensure that file handles and other resources are properly closed to avoid resource leaks.</li>
<li><strong>Thread Limits</strong>: Be mindful of the number of threads you create, as creating too many threads can lead to performance degradation.</li>
</ul>
</div><h1>Conclusion</h1>
<div class='content'><p>In this section, you learned the basics of multithreading in Perl, including how to create and manage threads, share variables safely, and avoid common pitfalls. Multithreading can significantly improve the performance of your Perl programs by allowing concurrent execution of tasks. In the next module, we will explore advanced topics such as debugging and error handling in Perl.</p>
</div><div class='row navigation'>
	<div class='col-1 col-md-2'>
					<a href='05-03-web-programming-with-perl' title="Web Programming with Perl">
				<span class="d-none d-md-inline">&#x25C4; Previous</span>
				<span class="d-inline d-md-none"><i class="bi bi-caret-left-square-fill"></i></span>
			</a>
			</div>
	<div class='col-10 col-md-8 text-center'>
			</div>
	<div class='col-1 col-md-2 text-end'>
					<a href='06-01-debugging-and-error-handling' title="Debugging and Error Handling">
				<span class="d-none d-md-inline">Next &#x25BA;</span>
				<span class="d-inline d-md-none"><i class="bi bi-caret-right-square-fill"></i></span>
			</a>
			</div>
</div>

			</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<!-- 
<h1>Advertising</h1>
<p>This space is reserved for advertising.</p>
<p>If you want to be a sponsor, contact us to include links in this area: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
<p>Thank you for collaborating!</p>
-->

<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-0611338592562725"
     crossorigin="anonymous"></script>
<!-- enterprise_campus -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-0611338592562725"
     data-ad-slot="6914733106"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
			









		</div>
	</div>
</div>

<div class="container-xxl d-block d-md-none">
	<div class="row">
		<div class="col-12 p-2 p-md-0 m-0 text-end">
			<a href="/objective">The Project</a> | 
<a href="/about">About Us</a> | 
<a href="/contribute">Contribute</a> | 
<a href="/donate">Donations</a> | 
<a href="/licence">License</a>
		</div>
	</div>
</div>

<div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. All rights reserved</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	We use cookies to improve your user experience and offer content tailored to your interests.
    <a href="#" id="btn_accept_cookies" class="button">Accept</a>
    <a href="/cookies">More Information</a>
</div>	

	</div>    
</body>
</html>
