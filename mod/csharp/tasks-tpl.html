<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tasks and Task Parallel Library (TPL)</title>

    <link rel="alternate" href="https://campusempresa.com/mod/csharp/tasks-tpl" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/mod/csharp/tasks-tpl" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/mod/csharp/tasks-tpl" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body>
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-8 p-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo-header_enterprise.png"></a>
			</h1>
		</div>
		<div class="col-4 p-0 text-end">
			<h2 id="main_title"><cite>Building today's and tomorrow's society</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-0 m-0 text-end">
													<b id="lit_lang_es" class="px-2">EN</b>
				|
				<a href="https://campusempresa.com/mod/csharp/tasks-tpl" class="px-2">ES</a></b>
				|
				<a href="https://campusempresa.cat/mod/csharp/tasks-tpl" class="px-2">CA</a>
					</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="/objective">The Project</a>
				<a href="/about">About Us</a>
				<a href="/contribute">Contribute</a>
				<a href="/donate">Donations</a>
				<a href="/licence">License</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content"><div class='row navigation'>
	<div class='col-4'>
					<a href='introduction-async'>&#x25C4;Introduction to Asynchronous Programming</a>
			</div>
	<div class='col-4 text-center'>
		<a href="./" class="title">Tasks and Task Parallel Library (TPL)</a>
	</div>
	<div class='col-4 text-end'>
					<a href='async-await'>Async and Await &#x25BA;</a>
			</div>
</div>
<div class='content'></div><h1>Introduction to Tasks and TPL</h1>
<div class='content'><p>The Task Parallel Library (TPL) is a set of public types and APIs in the <code>System.Threading.Tasks</code> namespace that simplifies the process of adding parallelism and concurrency to applications. It is a key component of the .NET Framework and is designed to make it easier to write efficient, scalable, and maintainable parallel code.</p>
</div><h2>Key Concepts</h2>
<div class='content'><ul>
<li><strong>Task</strong>: Represents an asynchronous operation.</li>
<li><strong>Task Parallel Library (TPL)</strong>: Provides a higher-level abstraction for parallel programming compared to traditional threading.</li>
<li><strong>Asynchronous Programming</strong>: Allows tasks to run independently of the main program flow, improving responsiveness and performance.</li>
</ul>
</div><h1>Creating and Running Tasks</h1>
<div class='content'><p>Creating and running tasks in C# is straightforward with the TPL.</p>
</div><h2>Example: Creating a Simple Task</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("dXNpbmcgU3lzdGVtOwp1c2luZyBTeXN0ZW0uVGhyZWFkaW5nLlRhc2tzOwoKY2xhc3MgUHJvZ3JhbQp7CiAgICBzdGF0aWMgdm9pZCBNYWluKCkKICAgIHsKICAgICAgICBUYXNrIG15VGFzayA9IG5ldyBUYXNrKCgpID0+IENvbnNvbGUuV3JpdGVMaW5lKCJIZWxsbyBmcm9tIFRhc2shIikpOwogICAgICAgIG15VGFzay5TdGFydCgpOwogICAgICAgIG15VGFzay5XYWl0KCk7IC8vIFdhaXQgZm9yIHRoZSB0YXNrIHRvIGNvbXBsZXRlCiAgICB9Cn0="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>using System;
using System.Threading.Tasks;

class Program
{
    static void Main()
    {
        Task myTask = new Task(() =&gt; Console.WriteLine(&quot;Hello from Task!&quot;));
        myTask.Start();
        myTask.Wait(); // Wait for the task to complete
    }
}</pre></div><div class='content'><ul>
<li><strong>Explanation</strong>:
<ul>
<li><code>Task myTask = new Task(...)</code>: Creates a new task.</li>
<li><code>myTask.Start()</code>: Starts the task.</li>
<li><code>myTask.Wait()</code>: Waits for the task to complete before proceeding.</li>
</ul>
</li>
</ul>
</div><h2>Example: Using Task.Run</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("dXNpbmcgU3lzdGVtOwp1c2luZyBTeXN0ZW0uVGhyZWFkaW5nLlRhc2tzOwoKY2xhc3MgUHJvZ3JhbQp7CiAgICBzdGF0aWMgdm9pZCBNYWluKCkKICAgIHsKICAgICAgICBUYXNrLlJ1bigoKSA9PiBDb25zb2xlLldyaXRlTGluZSgiSGVsbG8gZnJvbSBUYXNrLlJ1biEiKSkuV2FpdCgpOwogICAgfQp9"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>using System;
using System.Threading.Tasks;

class Program
{
    static void Main()
    {
        Task.Run(() =&gt; Console.WriteLine(&quot;Hello from Task.Run!&quot;)).Wait();
    }
}</pre></div><div class='content'><ul>
<li><strong>Explanation</strong>:
<ul>
<li><code>Task.Run(...)</code>: A shorthand for creating and starting a task in one step.</li>
<li><code>.Wait()</code>: Ensures the main thread waits for the task to complete.</li>
</ul>
</li>
</ul>
</div><h1>Task Continuations</h1>
<div class='content'><p>Tasks can be chained together using continuations, allowing you to specify actions to be performed after a task completes.</p>
</div><h2>Example: Task Continuation</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("dXNpbmcgU3lzdGVtOwp1c2luZyBTeXN0ZW0uVGhyZWFkaW5nLlRhc2tzOwoKY2xhc3MgUHJvZ3JhbQp7CiAgICBzdGF0aWMgdm9pZCBNYWluKCkKICAgIHsKICAgICAgICBUYXNrIGZpcnN0VGFzayA9IFRhc2suUnVuKCgpID0+IENvbnNvbGUuV3JpdGVMaW5lKCJGaXJzdCBUYXNrIikpOwogICAgICAgIFRhc2sgY29udGludWF0aW9uID0gZmlyc3RUYXNrLkNvbnRpbnVlV2l0aCh0ID0+IENvbnNvbGUuV3JpdGVMaW5lKCJDb250aW51YXRpb24gVGFzayIpKTsKICAgICAgICBjb250aW51YXRpb24uV2FpdCgpOwogICAgfQp9"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>using System;
using System.Threading.Tasks;

class Program
{
    static void Main()
    {
        Task firstTask = Task.Run(() =&gt; Console.WriteLine(&quot;First Task&quot;));
        Task continuation = firstTask.ContinueWith(t =&gt; Console.WriteLine(&quot;Continuation Task&quot;));
        continuation.Wait();
    }
}</pre></div><div class='content'><ul>
<li><strong>Explanation</strong>:
<ul>
<li><code>firstTask.ContinueWith(...)</code>: Specifies a continuation task that runs after <code>firstTask</code> completes.</li>
</ul>
</li>
</ul>
</div><h1>Handling Exceptions in Tasks</h1>
<div class='content'><p>Tasks can throw exceptions, and handling them properly is crucial for robust applications.</p>
</div><h2>Example: Exception Handling</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("dXNpbmcgU3lzdGVtOwp1c2luZyBTeXN0ZW0uVGhyZWFkaW5nLlRhc2tzOwoKY2xhc3MgUHJvZ3JhbQp7CiAgICBzdGF0aWMgdm9pZCBNYWluKCkKICAgIHsKICAgICAgICBUYXNrIHRhc2sgPSBUYXNrLlJ1bigoKSA9PiB7IHRocm93IG5ldyBJbnZhbGlkT3BlcmF0aW9uRXhjZXB0aW9uKCJUYXNrIGVycm9yISIpOyB9KTsKCiAgICAgICAgdHJ5CiAgICAgICAgewogICAgICAgICAgICB0YXNrLldhaXQoKTsKICAgICAgICB9CiAgICAgICAgY2F0Y2ggKEFnZ3JlZ2F0ZUV4Y2VwdGlvbiBleCkKICAgICAgICB7CiAgICAgICAgICAgIGZvcmVhY2ggKHZhciBpbm5lckV4IGluIGV4LklubmVyRXhjZXB0aW9ucykKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgQ29uc29sZS5Xcml0ZUxpbmUoaW5uZXJFeC5NZXNzYWdlKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KfQ=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>using System;
using System.Threading.Tasks;

class Program
{
    static void Main()
    {
        Task task = Task.Run(() =&gt; { throw new InvalidOperationException(&quot;Task error!&quot;); });

        try
        {
            task.Wait();
        }
        catch (AggregateException ex)
        {
            foreach (var innerEx in ex.InnerExceptions)
            {
                Console.WriteLine(innerEx.Message);
            }
        }
    }
}</pre></div><div class='content'><ul>
<li><strong>Explanation</strong>:
<ul>
<li><code>AggregateException</code>: When a task throws an exception, it is wrapped in an <code>AggregateException</code>.</li>
<li><code>ex.InnerExceptions</code>: Contains all exceptions thrown by the task.</li>
</ul>
</li>
</ul>
</div><h1>Parallel Programming with TPL</h1>
<div class='content'><p>The TPL also provides methods for parallel loops and other parallel constructs.</p>
</div><h2>Example: Parallel.For</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("dXNpbmcgU3lzdGVtOwp1c2luZyBTeXN0ZW0uVGhyZWFkaW5nLlRhc2tzOwoKY2xhc3MgUHJvZ3JhbQp7CiAgICBzdGF0aWMgdm9pZCBNYWluKCkKICAgIHsKICAgICAgICBQYXJhbGxlbC5Gb3IoMCwgMTAsIGkgPT4KICAgICAgICB7CiAgICAgICAgICAgIENvbnNvbGUuV3JpdGVMaW5lKCQiUHJvY2Vzc2luZyB7aX0iKTsKICAgICAgICB9KTsKICAgIH0KfQ=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>using System;
using System.Threading.Tasks;

class Program
{
    static void Main()
    {
        Parallel.For(0, 10, i =&gt;
        {
            Console.WriteLine($&quot;Processing {i}&quot;);
        });
    }
}</pre></div><div class='content'><ul>
<li><strong>Explanation</strong>:
<ul>
<li><code>Parallel.For(...)</code>: Executes a for loop in which iterations may run in parallel.</li>
</ul>
</li>
</ul>
</div><h2>Example: Parallel.ForEach</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("dXNpbmcgU3lzdGVtOwp1c2luZyBTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYzsKdXNpbmcgU3lzdGVtLlRocmVhZGluZy5UYXNrczsKCmNsYXNzIFByb2dyYW0KewogICAgc3RhdGljIHZvaWQgTWFpbigpCiAgICB7CiAgICAgICAgTGlzdDxpbnQ+IG51bWJlcnMgPSBuZXcgTGlzdDxpbnQ+IHsgMSwgMiwgMywgNCwgNSB9OwoKICAgICAgICBQYXJhbGxlbC5Gb3JFYWNoKG51bWJlcnMsIG51bWJlciA9PgogICAgICAgIHsKICAgICAgICAgICAgQ29uc29sZS5Xcml0ZUxpbmUoJCJQcm9jZXNzaW5nIHtudW1iZXJ9Iik7CiAgICAgICAgfSk7CiAgICB9Cn0="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>using System;
using System.Collections.Generic;
using System.Threading.Tasks;

class Program
{
    static void Main()
    {
        List&lt;int&gt; numbers = new List&lt;int&gt; { 1, 2, 3, 4, 5 };

        Parallel.ForEach(numbers, number =&gt;
        {
            Console.WriteLine($&quot;Processing {number}&quot;);
        });
    }
}</pre></div><div class='content'><ul>
<li><strong>Explanation</strong>:
<ul>
<li><code>Parallel.ForEach(...)</code>: Executes a foreach loop in which iterations may run in parallel.</li>
</ul>
</li>
</ul>
</div><h1>Advanced Task Features</h1>
<div class='content'><p>For advanced scenarios, TPL provides more sophisticated features like task cancellation and progress reporting.</p>
</div><h2>Example: Task Cancellation</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("dXNpbmcgU3lzdGVtOwp1c2luZyBTeXN0ZW0uVGhyZWFkaW5nOwp1c2luZyBTeXN0ZW0uVGhyZWFkaW5nLlRhc2tzOwoKY2xhc3MgUHJvZ3JhbQp7CiAgICBzdGF0aWMgdm9pZCBNYWluKCkKICAgIHsKICAgICAgICBDYW5jZWxsYXRpb25Ub2tlblNvdXJjZSBjdHMgPSBuZXcgQ2FuY2VsbGF0aW9uVG9rZW5Tb3VyY2UoKTsKCiAgICAgICAgVGFzayB0YXNrID0gVGFzay5SdW4oKCkgPT4KICAgICAgICB7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgMTA7IGkrKykKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgaWYgKGN0cy5Ub2tlbi5Jc0NhbmNlbGxhdGlvblJlcXVlc3RlZCkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBDb25zb2xlLldyaXRlTGluZSgiVGFzayB3YXMgY2FuY2VsbGVkIik7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgQ29uc29sZS5Xcml0ZUxpbmUoJCJQcm9jZXNzaW5nIHtpfSIpOwogICAgICAgICAgICAgICAgVGhyZWFkLlNsZWVwKDUwMCk7CiAgICAgICAgICAgIH0KICAgICAgICB9LCBjdHMuVG9rZW4pOwoKICAgICAgICBUaHJlYWQuU2xlZXAoMjAwMCk7IC8vIFNpbXVsYXRlIHNvbWUgd29yawogICAgICAgIGN0cy5DYW5jZWwoKTsgLy8gUmVxdWVzdCBjYW5jZWxsYXRpb24KCiAgICAgICAgdHJ5CiAgICAgICAgewogICAgICAgICAgICB0YXNrLldhaXQoKTsKICAgICAgICB9CiAgICAgICAgY2F0Y2ggKEFnZ3JlZ2F0ZUV4Y2VwdGlvbiBleCkKICAgICAgICB7CiAgICAgICAgICAgIGZvcmVhY2ggKHZhciBpbm5lckV4IGluIGV4LklubmVyRXhjZXB0aW9ucykKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgQ29uc29sZS5Xcml0ZUxpbmUoaW5uZXJFeC5NZXNzYWdlKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KfQ=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>using System;
using System.Threading;
using System.Threading.Tasks;

class Program
{
    static void Main()
    {
        CancellationTokenSource cts = new CancellationTokenSource();

        Task task = Task.Run(() =&gt;
        {
            for (int i = 0; i &lt; 10; i++)
            {
                if (cts.Token.IsCancellationRequested)
                {
                    Console.WriteLine(&quot;Task was cancelled&quot;);
                    return;
                }
                Console.WriteLine($&quot;Processing {i}&quot;);
                Thread.Sleep(500);
            }
        }, cts.Token);

        Thread.Sleep(2000); // Simulate some work
        cts.Cancel(); // Request cancellation

        try
        {
            task.Wait();
        }
        catch (AggregateException ex)
        {
            foreach (var innerEx in ex.InnerExceptions)
            {
                Console.WriteLine(innerEx.Message);
            }
        }
    }
}</pre></div><div class='content'><ul>
<li><strong>Explanation</strong>:
<ul>
<li><code>CancellationTokenSource</code>: Provides a way to signal cancellation.</li>
<li><code>cts.Token.IsCancellationRequested</code>: Checks if cancellation has been requested.</li>
</ul>
</li>
</ul>
</div><h1>Conclusion</h1>
<div class='content'><p>The Task Parallel Library (TPL) in C# provides a powerful and flexible way to write parallel and asynchronous code. By understanding tasks, continuations, exception handling, and advanced features like cancellation, you can create efficient and responsive applications. Whether you are a beginner or an advanced programmer, mastering TPL will significantly enhance your ability to write high-performance C# code.</p>
</div><div class='row navigation'>
	<div class='col-4'>
					<a href='introduction-async'>&#x25C4;Introduction to Asynchronous Programming</a>
			</div>
	<div class='col-4 text-center'>
		<a href="./" class="title">Tasks and Task Parallel Library (TPL)</a>
	</div>
	<div class='col-4 text-end'>
					<a href='async-await'>Async and Await &#x25BA;</a>
			</div>
</div>
</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Advertising</h1>
			<p>This space is reserved for advertising.</p>
			<p>If you want to be a sponsor, contact us to include links in this area: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Thank you for collaborating!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. All rights reserved</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir galetes per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Accept</a>
    <a href="/cookies">More Information</a>
</div>	

	</div>    
</body>
</html>
