<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jenkins as Code with Jenkinsfile</title>

    <link rel="alternate" href="https://campusempresa.com/mod/jenkins/08-03-jenkins-as-code-with-jenkinsfile" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/mod/jenkins/08-03-jenkins-as-code-with-jenkinsfile" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/mod/jenkins/08-03-jenkins-as-code-with-jenkinsfile" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body >
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-12 col-md-8 p-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo-header_enterprise.png"></a>
			</h1>
		</div>
		<div class="col-12 col-md-4 p-0 text-end">
			<h2 id="main_title"><cite>Building today's and tomorrow's society</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-0 m-0 text-end">
													<b id="lit_lang_es" class="px-2">EN</b>
				|
				<a href="https://campusempresa.com/mod/jenkins/08-03-jenkins-as-code-with-jenkinsfile" class="px-2">ES</a></b>
				|
				<a href="https://campusempresa.cat/mod/jenkins/08-03-jenkins-as-code-with-jenkinsfile" class="px-2">CA</a>
					</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="/objective">The Project</a>
				<a href="/about">About Us</a>
				<a href="/contribute">Contribute</a>
				<a href="/donate">Donations</a>
				<a href="/licence">License</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content">
								<div class='row navigation'>
	<div class='col-2'>
					<a href='08-02-jenkins-and-kubernetes' title="Jenkins and Kubernetes">&#x25C4;Previous</a>
			</div>
	<div class='col-8 text-center'>
					<a href="./"><h2 style="text-decoration:underline">Jenkins as Code with Jenkinsfile</h2></a>
			</div>
	<div class='col-2 text-end'>
					<a href='08-04-scaling-jenkins' title="Scaling Jenkins">Next &#x25BA;</a>
			</div>
</div>
<div class='content'><p>In this section, we will explore how to define Jenkins pipelines as code using Jenkinsfile. This approach allows you to version control your pipeline definitions, making them more maintainable and reproducible.</p>
</div><h1>What is a Jenkinsfile?</h1>
<div class='content'><p>A Jenkinsfile is a text file that contains the definition of a Jenkins pipeline. It is written using the Groovy-based Domain Specific Language (DSL) provided by Jenkins. By storing the Jenkinsfile in your version control system (VCS), you can manage your pipeline as code.</p>
</div><h2>Benefits of Using Jenkinsfile</h2>
<div class='content'><ul>
<li><strong>Version Control</strong>: Track changes and collaborate on pipeline definitions.</li>
<li><strong>Reusability</strong>: Share and reuse pipeline code across different projects.</li>
<li><strong>Consistency</strong>: Ensure consistent pipeline behavior across environments.</li>
<li><strong>Visibility</strong>: Make pipeline definitions visible to all team members.</li>
</ul>
</div><h1>Creating a Jenkinsfile</h1>
<div class='content'></div><h2>Basic Structure</h2>
<div class='content'><p>A Jenkinsfile can be written in two ways:</p>
<ol>
<li><strong>Declarative Pipeline</strong>: A more structured and simpler syntax.</li>
<li><strong>Scripted Pipeline</strong>: A more flexible and powerful syntax.</li>
</ol>
</div><h2>Declarative Pipeline Example</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("cGlwZWxpbmUgewogICAgYWdlbnQgYW55CgogICAgc3RhZ2VzIHsKICAgICAgICBzdGFnZSgnQnVpbGQnKSB7CiAgICAgICAgICAgIHN0ZXBzIHsKICAgICAgICAgICAgICAgIGVjaG8gJ0J1aWxkaW5nLi4uJwogICAgICAgICAgICAgICAgLy8gQWRkIGJ1aWxkIHN0ZXBzIGhlcmUKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBzdGFnZSgnVGVzdCcpIHsKICAgICAgICAgICAgc3RlcHMgewogICAgICAgICAgICAgICAgZWNobyAnVGVzdGluZy4uLicKICAgICAgICAgICAgICAgIC8vIEFkZCB0ZXN0IHN0ZXBzIGhlcmUKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBzdGFnZSgnRGVwbG95JykgewogICAgICAgICAgICBzdGVwcyB7CiAgICAgICAgICAgICAgICBlY2hvICdEZXBsb3lpbmcuLi4nCiAgICAgICAgICAgICAgICAvLyBBZGQgZGVwbG95IHN0ZXBzIGhlcmUKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KfQ=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>pipeline {
    agent any

    stages {
        stage('Build') {
            steps {
                echo 'Building...'
                // Add build steps here
            }
        }
        stage('Test') {
            steps {
                echo 'Testing...'
                // Add test steps here
            }
        }
        stage('Deploy') {
            steps {
                echo 'Deploying...'
                // Add deploy steps here
            }
        }
    }
}</pre></div><div class='content'></div><h2>Scripted Pipeline Example</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("bm9kZSB7CiAgICBzdGFnZSgnQnVpbGQnKSB7CiAgICAgICAgZWNobyAnQnVpbGRpbmcuLi4nCiAgICAgICAgLy8gQWRkIGJ1aWxkIHN0ZXBzIGhlcmUKICAgIH0KICAgIHN0YWdlKCdUZXN0JykgewogICAgICAgIGVjaG8gJ1Rlc3RpbmcuLi4nCiAgICAgICAgLy8gQWRkIHRlc3Qgc3RlcHMgaGVyZQogICAgfQogICAgc3RhZ2UoJ0RlcGxveScpIHsKICAgICAgICBlY2hvICdEZXBsb3lpbmcuLi4nCiAgICAgICAgLy8gQWRkIGRlcGxveSBzdGVwcyBoZXJlCiAgICB9Cn0="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>node {
    stage('Build') {
        echo 'Building...'
        // Add build steps here
    }
    stage('Test') {
        echo 'Testing...'
        // Add test steps here
    }
    stage('Deploy') {
        echo 'Deploying...'
        // Add deploy steps here
    }
}</pre></div><div class='content'></div><h1>Detailed Explanation</h1>
<div class='content'></div><h2>Declarative Pipeline</h2>
<div class='content'><ul>
<li><strong>pipeline</strong>: The root element that defines the pipeline.</li>
<li><strong>agent</strong>: Specifies where the pipeline or a specific stage will run. <code>any</code> means it can run on any available agent.</li>
<li><strong>stages</strong>: Contains a sequence of stages to be executed.</li>
<li><strong>stage</strong>: Represents a phase in the pipeline (e.g., Build, Test, Deploy).</li>
<li><strong>steps</strong>: Contains the actual steps to be executed within a stage.</li>
</ul>
</div><h2>Scripted Pipeline</h2>
<div class='content'><ul>
<li><strong>node</strong>: Allocates a Jenkins agent to execute the pipeline.</li>
<li><strong>stage</strong>: Similar to the declarative pipeline, it represents a phase in the pipeline.</li>
<li><strong>steps</strong>: Directly written within the stage block.</li>
</ul>
</div><h1>Practical Example</h1>
<div class='content'><p>Let's create a Jenkinsfile for a simple Java project that builds the code, runs tests, and deploys the application.</p>
</div><h2>Jenkinsfile</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("cGlwZWxpbmUgewogICAgYWdlbnQgYW55CgogICAgZW52aXJvbm1lbnQgewogICAgICAgIE1BVkVOX0hPTUUgPSB0b29sICdNYXZlbicKICAgIH0KCiAgICBzdGFnZXMgewogICAgICAgIHN0YWdlKCdDaGVja291dCcpIHsKICAgICAgICAgICAgc3RlcHMgewogICAgICAgICAgICAgICAgZ2l0ICdodHRwczovL2dpdGh1Yi5jb20veW91ci1yZXBvL3lvdXItcHJvamVjdC5naXQnCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgc3RhZ2UoJ0J1aWxkJykgewogICAgICAgICAgICBzdGVwcyB7CiAgICAgICAgICAgICAgICBzaCAiJHtNQVZFTl9IT01FfS9iaW4vbXZuIGNsZWFuIGluc3RhbGwiCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgc3RhZ2UoJ1Rlc3QnKSB7CiAgICAgICAgICAgIHN0ZXBzIHsKICAgICAgICAgICAgICAgIHNoICIke01BVkVOX0hPTUV9L2Jpbi9tdm4gdGVzdCIKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBzdGFnZSgnRGVwbG95JykgewogICAgICAgICAgICBzdGVwcyB7CiAgICAgICAgICAgICAgICBzaCAnc2NwIHRhcmdldC95b3VyLWFwcC5qYXIgdXNlckBzZXJ2ZXI6L3BhdGgvdG8vZGVwbG95JwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQp9"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>pipeline {
    agent any

    environment {
        MAVEN_HOME = tool 'Maven'
    }

    stages {
        stage('Checkout') {
            steps {
                git 'https://github.com/your-repo/your-project.git'
            }
        }
        stage('Build') {
            steps {
                sh &quot;${MAVEN_HOME}/bin/mvn clean install&quot;
            }
        }
        stage('Test') {
            steps {
                sh &quot;${MAVEN_HOME}/bin/mvn test&quot;
            }
        }
        stage('Deploy') {
            steps {
                sh 'scp target/your-app.jar user@server:/path/to/deploy'
            }
        }
    }
}</pre></div><div class='content'></div><h2>Explanation</h2>
<div class='content'><ul>
<li><strong>environment</strong>: Defines environment variables. <code>MAVEN_HOME</code> is set to the Maven tool configured in Jenkins.</li>
<li><strong>stage('Checkout')</strong>: Checks out the code from the Git repository.</li>
<li><strong>stage('Build')</strong>: Runs the Maven build command.</li>
<li><strong>stage('Test')</strong>: Runs the Maven test command.</li>
<li><strong>stage('Deploy')</strong>: Copies the built JAR file to the deployment server using <code>scp</code>.</li>
</ul>
</div><h1>Practical Exercise</h1>
<div class='content'></div><h2>Task</h2>
<div class='content'><ol>
<li>Create a new repository on GitHub.</li>
<li>Add a simple Java project to the repository.</li>
<li>Create a Jenkinsfile in the root of the repository with the following stages:
<ul>
<li>Checkout</li>
<li>Build</li>
<li>Test</li>
<li>Deploy</li>
</ul>
</li>
</ol>
</div><h2>Solution</h2>
<div class='content'><ol>
<li>Create a new repository on GitHub.</li>
<li>Add your Java project files.</li>
<li>Create a <code>Jenkinsfile</code> with the following content:</li>
</ol>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("cGlwZWxpbmUgewogICAgYWdlbnQgYW55CgogICAgZW52aXJvbm1lbnQgewogICAgICAgIE1BVkVOX0hPTUUgPSB0b29sICdNYXZlbicKICAgIH0KCiAgICBzdGFnZXMgewogICAgICAgIHN0YWdlKCdDaGVja291dCcpIHsKICAgICAgICAgICAgc3RlcHMgewogICAgICAgICAgICAgICAgZ2l0ICdodHRwczovL2dpdGh1Yi5jb20veW91ci1yZXBvL3lvdXItcHJvamVjdC5naXQnCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgc3RhZ2UoJ0J1aWxkJykgewogICAgICAgICAgICBzdGVwcyB7CiAgICAgICAgICAgICAgICBzaCAiJHtNQVZFTl9IT01FfS9iaW4vbXZuIGNsZWFuIGluc3RhbGwiCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgc3RhZ2UoJ1Rlc3QnKSB7CiAgICAgICAgICAgIHN0ZXBzIHsKICAgICAgICAgICAgICAgIHNoICIke01BVkVOX0hPTUV9L2Jpbi9tdm4gdGVzdCIKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBzdGFnZSgnRGVwbG95JykgewogICAgICAgICAgICBzdGVwcyB7CiAgICAgICAgICAgICAgICBzaCAnc2NwIHRhcmdldC95b3VyLWFwcC5qYXIgdXNlckBzZXJ2ZXI6L3BhdGgvdG8vZGVwbG95JwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQp9"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>pipeline {
    agent any

    environment {
        MAVEN_HOME = tool 'Maven'
    }

    stages {
        stage('Checkout') {
            steps {
                git 'https://github.com/your-repo/your-project.git'
            }
        }
        stage('Build') {
            steps {
                sh &quot;${MAVEN_HOME}/bin/mvn clean install&quot;
            }
        }
        stage('Test') {
            steps {
                sh &quot;${MAVEN_HOME}/bin/mvn test&quot;
            }
        }
        stage('Deploy') {
            steps {
                sh 'scp target/your-app.jar user@server:/path/to/deploy'
            }
        }
    }
}</pre></div><div class='content'></div><h1>Common Mistakes and Tips</h1>
<div class='content'><ul>
<li><strong>Syntax Errors</strong>: Ensure your Jenkinsfile syntax is correct. Use the Jenkins Pipeline Syntax tool for assistance.</li>
<li><strong>Environment Variables</strong>: Make sure environment variables are correctly defined and used.</li>
<li><strong>Permissions</strong>: Ensure the Jenkins agent has the necessary permissions to execute commands and access resources.</li>
</ul>
</div><h1>Conclusion</h1>
<div class='content'><p>In this section, we learned how to define Jenkins pipelines as code using Jenkinsfile. We explored the benefits of using Jenkinsfile, the basic structure of declarative and scripted pipelines, and provided a practical example. By using Jenkinsfile, you can version control your pipeline definitions, making them more maintainable and reproducible. In the next section, we will delve into advanced Jenkins topics, including using Jenkins with Docker and Kubernetes.</p>
</div><div class='row navigation'>
	<div class='col-2'>
					<a href='08-02-jenkins-and-kubernetes' title="Jenkins and Kubernetes">&#x25C4;Previous</a>
			</div>
	<div class='col-8 text-center'>
			</div>
	<div class='col-2 text-end'>
					<a href='08-04-scaling-jenkins' title="Scaling Jenkins">Next &#x25BA;</a>
			</div>
</div>

			</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Advertising</h1>
			<p>This space is reserved for advertising.</p>
			<p>If you want to be a sponsor, contact us to include links in this area: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Thank you for collaborating!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. All rights reserved</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir galetes per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Accept</a>
    <a href="/cookies">More Information</a>
</div>	

	</div>    
</body>
</html>
