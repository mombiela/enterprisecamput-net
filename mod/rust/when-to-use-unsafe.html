<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>When to Use Unsafe</title>

    <link rel="alternate" href="https://campusempresa.com/mod/rust/when-to-use-unsafe" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/mod/rust/when-to-use-unsafe" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/mod/rust/when-to-use-unsafe" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body >
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-8 p-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo-header_enterprise.png"></a>
			</h1>
		</div>
		<div class="col-4 p-0 text-end">
			<h2 id="main_title"><cite>Building today's and tomorrow's society</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-0 m-0 text-end">
													<b id="lit_lang_es" class="px-2">EN</b>
				|
				<a href="https://campusempresa.com/mod/rust/when-to-use-unsafe" class="px-2">ES</a></b>
				|
				<a href="https://campusempresa.cat/mod/rust/when-to-use-unsafe" class="px-2">CA</a>
					</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="/objective">The Project</a>
				<a href="/about">About Us</a>
				<a href="/contribute">Contribute</a>
				<a href="/donate">Donations</a>
				<a href="/licence">License</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content">
								<div class='row navigation'>
	<div class='col-4'>
					<a href='async-libraries'>&#x25C4;Async Libraries</a>
			</div>
	<div class='col-4 text-center'>
		<a href="./" class="title">When to Use Unsafe</a>
	</div>
	<div class='col-4 text-end'>
					<a href='raw-pointers'>Raw Pointers &#x25BA;</a>
			</div>
</div>
<div class='content'><p>Rust is known for its strong emphasis on safety, particularly memory safety. However, there are situations where you might need to use <code>unsafe</code> code to achieve certain goals. This section will guide you through understanding when and why you might need to use <code>unsafe</code> in Rust, and how to do so responsibly.</p>
</div><h1>What is Unsafe Code?</h1>
<div class='content'><p>Unsafe code in Rust allows you to perform operations that the Rust compiler cannot guarantee to be safe. This includes:</p>
<ul>
<li>Dereferencing raw pointers.</li>
<li>Calling unsafe functions or methods.</li>
<li>Accessing or modifying mutable static variables.</li>
<li>Implementing unsafe traits.</li>
<li>Performing inline assembly.</li>
</ul>
</div><h1>When to Use Unsafe Code</h1>
<div class='content'></div><h2>Performance Optimization</h2>
<div class='content'><p>Sometimes, you may need to use <code>unsafe</code> code to optimize performance-critical sections of your program. Rust's safety guarantees can introduce overhead, and in some cases, bypassing these checks can lead to significant performance gains.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Zm4gc3VtX3NsaWNlKHNsaWNlOiAmW2kzMl0pIC0+IGkzMiB7CiAgICBsZXQgbXV0IHN1bSA9IDA7CiAgICBmb3IgJml0ZW0gaW4gc2xpY2UgewogICAgICAgIHN1bSArPSBpdGVtOwogICAgfQogICAgc3VtCn0KCmZuIHN1bV9zbGljZV91bnNhZmUoc2xpY2U6ICZbaTMyXSkgLT4gaTMyIHsKICAgIGxldCBtdXQgc3VtID0gMDsKICAgIHVuc2FmZSB7CiAgICAgICAgbGV0IHB0ciA9IHNsaWNlLmFzX3B0cigpOwogICAgICAgIGZvciBpIGluIDAuLnNsaWNlLmxlbigpIHsKICAgICAgICAgICAgc3VtICs9ICpwdHIuYWRkKGkpOwogICAgICAgIH0KICAgIH0KICAgIHN1bQp9"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>fn sum_slice(slice: &amp;[i32]) -&gt; i32 {
    let mut sum = 0;
    for &amp;item in slice {
        sum += item;
    }
    sum
}

fn sum_slice_unsafe(slice: &amp;[i32]) -&gt; i32 {
    let mut sum = 0;
    unsafe {
        let ptr = slice.as_ptr();
        for i in 0..slice.len() {
            sum += *ptr.add(i);
        }
    }
    sum
}</pre></div><div class='content'><p>In the example above, <code>sum_slice_unsafe</code> uses raw pointers to iterate over the slice, which can be faster than the safe iteration in <code>sum_slice</code>.</p>
</div><h2>Interfacing with Other Languages</h2>
<div class='content'><p>When interfacing with other programming languages, such as C, you often need to use <code>unsafe</code> code. This is because Rust cannot guarantee the safety of foreign function interfaces (FFI).</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ZXh0ZXJuICJDIiB7CiAgICBmbiBhYnMoaW5wdXQ6IGkzMikgLT4gaTMyOwp9CgpmbiBtYWluKCkgewogICAgbGV0IHggPSAtNDI7CiAgICB1bnNhZmUgewogICAgICAgIHByaW50bG4hKCJUaGUgYWJzb2x1dGUgdmFsdWUgb2Yge30gaXMge30iLCB4LCBhYnMoeCkpOwogICAgfQp9"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>extern &quot;C&quot; {
    fn abs(input: i32) -&gt; i32;
}

fn main() {
    let x = -42;
    unsafe {
        println!(&quot;The absolute value of {} is {}&quot;, x, abs(x));
    }
}</pre></div><div class='content'><p>Here, the <code>abs</code> function from the C standard library is called within an <code>unsafe</code> block.</p>
</div><h2>Low-Level Memory Manipulation</h2>
<div class='content'><p>In some cases, you need to perform low-level memory manipulation that Rust's safe abstractions do not allow.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Zm4gY29weV9ub25vdmVybGFwcGluZyhzcmM6ICpjb25zdCB1OCwgZHN0OiAqbXV0IHU4LCBjb3VudDogdXNpemUpIHsKICAgIHVuc2FmZSB7CiAgICAgICAgc3RkOjpwdHI6OmNvcHlfbm9ub3ZlcmxhcHBpbmcoc3JjLCBkc3QsIGNvdW50KTsKICAgIH0KfQ=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>fn copy_nonoverlapping(src: *const u8, dst: *mut u8, count: usize) {
    unsafe {
        std::ptr::copy_nonoverlapping(src, dst, count);
    }
}</pre></div><div class='content'><p>This function uses <code>std::ptr::copy_nonoverlapping</code> to copy memory from one location to another, which is inherently unsafe.</p>
</div><h1>Guidelines for Using Unsafe Code</h1>
<div class='content'><ul>
<li><strong>Minimize Unsafe Code</strong>: Use <code>unsafe</code> only when absolutely necessary. Keep the unsafe code as small and isolated as possible.</li>
<li><strong>Review and Test Thoroughly</strong>: Unsafe code can introduce subtle bugs. Review it carefully and write extensive tests.</li>
<li><strong>Document Clearly</strong>: Clearly document why the code is unsafe and what invariants must be maintained.</li>
</ul>
</div><h1>Conclusion</h1>
<div class='content'><p>Using <code>unsafe</code> in Rust is a powerful tool that should be used sparingly and with caution. It allows you to perform operations that are not possible in safe Rust, but it comes with the risk of introducing bugs and undefined behavior. Always strive to write safe Rust code first, and resort to <code>unsafe</code> only when you have a compelling reason and understand the risks involved.</p>
</div><div class='row navigation'>
	<div class='col-4'>
					<a href='async-libraries'>&#x25C4;Async Libraries</a>
			</div>
	<div class='col-4 text-center'>
		<a href="./" class="title">When to Use Unsafe</a>
	</div>
	<div class='col-4 text-end'>
					<a href='raw-pointers'>Raw Pointers &#x25BA;</a>
			</div>
</div>

			</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Advertising</h1>
			<p>This space is reserved for advertising.</p>
			<p>If you want to be a sponsor, contact us to include links in this area: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Thank you for collaborating!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. All rights reserved</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir galetes per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Accept</a>
    <a href="/cookies">More Information</a>
</div>	

	</div>    
</body>
</html>
