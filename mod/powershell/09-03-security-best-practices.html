<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Security Best Practices</title>

    <link rel="alternate" href="https://campusempresa.com/mod/powershell/09-03-security-best-practices" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/mod/powershell/09-03-security-best-practices" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/mod/powershell/09-03-security-best-practices" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="/js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body >
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-12 col-md-8 p-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo-header_enterprise.png"></a>
			</h1>
		</div>
		<div class="col-12 col-md-4 px-0 py-2 py-md-0 text-end">
			<h2 id="main_title"><cite>Building today's and tomorrow's society</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 px-0 py-2 py-md-0 m-0 text-end">
													<b id="lit_lang_es" class="px-2">EN</b>
				|
				<a href="https://campusempresa.com/mod/powershell/09-03-security-best-practices" class="px-2">ES</a></b>
				|
				<a href="https://campusempresa.cat/mod/powershell/09-03-security-best-practices" class="px-2">CA</a>
					</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="/objective">The Project</a>
				<a href="/about">About Us</a>
				<a href="/contribute">Contribute</a>
				<a href="/donate">Donations</a>
				<a href="/licence">License</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content">
								<div class='row navigation'>
	<div class='col-2'>
					<a href='09-02-performance-optimization' title="Performance Optimization">&#x25C4;Previous</a>
			</div>
	<div class='col-8 text-center'>
					<a href="./"><h2 style="text-decoration:underline">Security Best Practices</h2></a>
			</div>
	<div class='col-2 text-end'>
					<a href='09-04-version-control-git' title="Version Control with Git">Next &#x25BA;</a>
			</div>
</div>
<div class='content'><p>In this section, we will cover essential security best practices for writing and executing PowerShell scripts. Security is a critical aspect of any scripting or programming environment, and PowerShell is no exception. By following these best practices, you can help ensure that your scripts are secure and minimize the risk of security vulnerabilities.</p>
</div><h1>1. Use the Principle of Least Privilege</h1>
<div class='content'></div><h2>Explanation</h2>
<div class='content'><p>The principle of least privilege means that you should run your scripts with the minimum level of permissions necessary to perform the required tasks. This reduces the risk of accidental or malicious actions that could compromise system security.</p>
</div><h2>Practical Example</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("IyBJbnN0ZWFkIG9mIHJ1bm5pbmcgdGhlIGVudGlyZSBzY3JpcHQgYXMgYW4gYWRtaW5pc3RyYXRvciwgZWxldmF0ZSBvbmx5IHRoZSBuZWNlc3NhcnkgcGFydHMKaWYgKC1ub3QgKFtTZWN1cml0eS5QcmluY2lwYWwuV2luZG93c1ByaW5jaXBhbF0gW1NlY3VyaXR5LlByaW5jaXBhbC5XaW5kb3dzSWRlbnRpdHldOjpHZXRDdXJyZW50KCkpLklzSW5Sb2xlKFtTZWN1cml0eS5QcmluY2lwYWwuV2luZG93c0J1aWx0SW5Sb2xlXSAiQWRtaW5pc3RyYXRvciIpKSB7CiAgICBXcml0ZS1Ib3N0ICJUaGlzIHNjcmlwdCByZXF1aXJlcyBhZG1pbmlzdHJhdGl2ZSBwcml2aWxlZ2VzLiBQbGVhc2UgcnVuIGFzIGFuIGFkbWluaXN0cmF0b3IuIgogICAgZXhpdAp9CgojIENvZGUgdGhhdCByZXF1aXJlcyBhZG1pbmlzdHJhdGl2ZSBwcml2aWxlZ2VzClN0YXJ0LVByb2Nlc3MgLUZpbGVQYXRoICJwb3dlcnNoZWxsIiAtQXJndW1lbnRMaXN0ICItTm9Qcm9maWxlIC1FeGVjdXRpb25Qb2xpY3kgQnlwYXNzIC1GaWxlIGAiJFBTQ29tbWFuZFBhdGhgIiIgLVZlcmIgUnVuQXM="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'># Instead of running the entire script as an administrator, elevate only the necessary parts
if (-not ([Security.Principal.WindowsPrincipal] [Security.Principal.WindowsIdentity]::GetCurrent()).IsInRole([Security.Principal.WindowsBuiltInRole] &quot;Administrator&quot;)) {
    Write-Host &quot;This script requires administrative privileges. Please run as an administrator.&quot;
    exit
}

# Code that requires administrative privileges
Start-Process -FilePath &quot;powershell&quot; -ArgumentList &quot;-NoProfile -ExecutionPolicy Bypass -File `&quot;$PSCommandPath`&quot;&quot; -Verb RunAs</pre></div><div class='content'></div><h1>2. Avoid Hardcoding Sensitive Information</h1>
<div class='content'></div><h2>Explanation</h2>
<div class='content'><p>Hardcoding sensitive information such as passwords, API keys, or connection strings in your scripts can lead to security breaches if the script is exposed. Instead, use secure methods to handle sensitive data.</p>
</div><h2>Practical Example</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("IyBVc2UgR2V0LUNyZWRlbnRpYWwgdG8gc2VjdXJlbHkgcHJvbXB0IGZvciBjcmVkZW50aWFscwokY3JlZGVudGlhbCA9IEdldC1DcmVkZW50aWFsCgojIFVzZSB0aGUgY3JlZGVudGlhbHMgaW4geW91ciBzY3JpcHQKSW52b2tlLUNvbW1hbmQgLUNvbXB1dGVyTmFtZSAiU2VydmVyMDEiIC1DcmVkZW50aWFsICRjcmVkZW50aWFsIC1TY3JpcHRCbG9jayB7CiAgICAjIFlvdXIgY29kZSBoZXJlCn0="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'># Use Get-Credential to securely prompt for credentials
$credential = Get-Credential

# Use the credentials in your script
Invoke-Command -ComputerName &quot;Server01&quot; -Credential $credential -ScriptBlock {
    # Your code here
}</pre></div><div class='content'></div><h1>3. Use Secure String for Sensitive Data</h1>
<div class='content'></div><h2>Explanation</h2>
<div class='content'><p>PowerShell provides the <code>ConvertTo-SecureString</code> cmdlet to convert plain text into a secure string, which can then be used securely within your scripts.</p>
</div><h2>Practical Example</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("IyBDb252ZXJ0IGEgcGxhaW4gdGV4dCBwYXNzd29yZCB0byBhIHNlY3VyZSBzdHJpbmcKJHNlY3VyZVBhc3N3b3JkID0gQ29udmVydFRvLVNlY3VyZVN0cmluZyAiUEBzc3cwcmQhIiAtQXNQbGFpblRleHQgLUZvcmNlCgojIFVzZSB0aGUgc2VjdXJlIHN0cmluZyBpbiBhIFBTQ3JlZGVudGlhbCBvYmplY3QKJGNyZWRlbnRpYWwgPSBOZXctT2JqZWN0IFN5c3RlbS5NYW5hZ2VtZW50LkF1dG9tYXRpb24uUFNDcmVkZW50aWFsICgidXNlcm5hbWUiLCAkc2VjdXJlUGFzc3dvcmQpCgojIFVzZSB0aGUgY3JlZGVudGlhbHMgaW4geW91ciBzY3JpcHQKSW52b2tlLUNvbW1hbmQgLUNvbXB1dGVyTmFtZSAiU2VydmVyMDEiIC1DcmVkZW50aWFsICRjcmVkZW50aWFsIC1TY3JpcHRCbG9jayB7CiAgICAjIFlvdXIgY29kZSBoZXJlCn0="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'># Convert a plain text password to a secure string
$securePassword = ConvertTo-SecureString &quot;P@ssw0rd!&quot; -AsPlainText -Force

# Use the secure string in a PSCredential object
$credential = New-Object System.Management.Automation.PSCredential (&quot;username&quot;, $securePassword)

# Use the credentials in your script
Invoke-Command -ComputerName &quot;Server01&quot; -Credential $credential -ScriptBlock {
    # Your code here
}</pre></div><div class='content'></div><h1>4. Validate Input Data</h1>
<div class='content'></div><h2>Explanation</h2>
<div class='content'><p>Always validate input data to ensure it meets expected formats and values. This helps prevent injection attacks and other malicious activities.</p>
</div><h2>Practical Example</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("IyBGdW5jdGlvbiB0byB2YWxpZGF0ZSBhbiBJUCBhZGRyZXNzCmZ1bmN0aW9uIFZhbGlkYXRlLUlQQWRkcmVzcyB7CiAgICBwYXJhbSAoCiAgICAgICAgW3N0cmluZ10kSVBBZGRyZXNzCiAgICApCiAgICBpZiAoJElQQWRkcmVzcyAtbWF0Y2ggJ14oMjVbMC01XXwyWzAtNF1bMC05XXxbMDFdP1swLTldWzAtOV0/KVwuKDI1WzAtNV18MlswLTRdWzAtOV18WzAxXT9bMC05XVswLTldPylcLigyNVswLTVdfDJbMC00XVswLTldfFswMV0/WzAtOV1bMC05XT8pXC4oMjVbMC01XXwyWzAtNF1bMC05XXxbMDFdP1swLTldWzAtOV0/KSQnKSB7CiAgICAgICAgcmV0dXJuICR0cnVlCiAgICB9IGVsc2UgewogICAgICAgIHJldHVybiAkZmFsc2UKICAgIH0KfQoKIyBFeGFtcGxlIHVzYWdlCiRpcCA9ICIxOTIuMTY4LjEuMSIKaWYgKFZhbGlkYXRlLUlQQWRkcmVzcyAtSVBBZGRyZXNzICRpcCkgewogICAgV3JpdGUtSG9zdCAiVmFsaWQgSVAgYWRkcmVzcyIKfSBlbHNlIHsKICAgIFdyaXRlLUhvc3QgIkludmFsaWQgSVAgYWRkcmVzcyIKfQ=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'># Function to validate an IP address
function Validate-IPAddress {
    param (
        [string]$IPAddress
    )
    if ($IPAddress -match '^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$') {
        return $true
    } else {
        return $false
    }
}

# Example usage
$ip = &quot;192.168.1.1&quot;
if (Validate-IPAddress -IPAddress $ip) {
    Write-Host &quot;Valid IP address&quot;
} else {
    Write-Host &quot;Invalid IP address&quot;
}</pre></div><div class='content'></div><h1>5. Use Code Signing</h1>
<div class='content'></div><h2>Explanation</h2>
<div class='content'><p>Code signing ensures the integrity and authenticity of your scripts. By signing your scripts, you can verify that they have not been tampered with and that they come from a trusted source.</p>
</div><h2>Practical Example</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("IyBTaWduIGEgc2NyaXB0IHVzaW5nIGEgY29kZS1zaWduaW5nIGNlcnRpZmljYXRlCiRjZXJ0ID0gR2V0LUNoaWxkSXRlbSAtUGF0aCBDZXJ0OlxDdXJyZW50VXNlclxNeSAtQ29kZVNpZ25pbmdDZXJ0ClNldC1BdXRoZW50aWNvZGVTaWduYXR1cmUgLUZpbGVQYXRoICJDOlxQYXRoXFRvXFlvdXJTY3JpcHQucHMxIiAtQ2VydGlmaWNhdGUgJGNlcnQ="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'># Sign a script using a code-signing certificate
$cert = Get-ChildItem -Path Cert:\CurrentUser\My -CodeSigningCert
Set-AuthenticodeSignature -FilePath &quot;C:\Path\To\YourScript.ps1&quot; -Certificate $cert</pre></div><div class='content'></div><h1>6. Regularly Update PowerShell and Modules</h1>
<div class='content'></div><h2>Explanation</h2>
<div class='content'><p>Keeping PowerShell and its modules up to date ensures that you have the latest security patches and features. Regular updates help protect against known vulnerabilities.</p>
</div><h2>Practical Example</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("IyBVcGRhdGUgUG93ZXJTaGVsbEdldCBtb2R1bGUKSW5zdGFsbC1Nb2R1bGUgLU5hbWUgUG93ZXJTaGVsbEdldCAtRm9yY2UgLUFsbG93Q2xvYmJlcgoKIyBVcGRhdGUgYWxsIGluc3RhbGxlZCBtb2R1bGVzClVwZGF0ZS1Nb2R1bGU="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'># Update PowerShellGet module
Install-Module -Name PowerShellGet -Force -AllowClobber

# Update all installed modules
Update-Module</pre></div><div class='content'></div><h1>7. Restrict Script Execution Policy</h1>
<div class='content'></div><h2>Explanation</h2>
<div class='content'><p>PowerShell's execution policy determines which scripts can be run on your system. Setting a restrictive execution policy can help prevent unauthorized scripts from running.</p>
</div><h2>Practical Example</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("IyBTZXQgdGhlIGV4ZWN1dGlvbiBwb2xpY3kgdG8gUmVtb3RlU2lnbmVkClNldC1FeGVjdXRpb25Qb2xpY3kgLUV4ZWN1dGlvblBvbGljeSBSZW1vdGVTaWduZWQgLVNjb3BlIEN1cnJlbnRVc2Vy"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'># Set the execution policy to RemoteSigned
Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser</pre></div><div class='content'></div><h1>Practical Exercise</h1>
<div class='content'></div><h2>Exercise</h2>
<div class='content'><ol>
<li>Create a PowerShell script that:
<ul>
<li>Prompts the user for credentials using <code>Get-Credential</code>.</li>
<li>Validates an IP address input.</li>
<li>Uses a secure string for a password.</li>
<li>Signs the script with a code-signing certificate.</li>
</ul>
</li>
</ol>
</div><h2>Solution</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("IyBQcm9tcHQgZm9yIGNyZWRlbnRpYWxzCiRjcmVkZW50aWFsID0gR2V0LUNyZWRlbnRpYWwKCiMgRnVuY3Rpb24gdG8gdmFsaWRhdGUgYW4gSVAgYWRkcmVzcwpmdW5jdGlvbiBWYWxpZGF0ZS1JUEFkZHJlc3MgewogICAgcGFyYW0gKAogICAgICAgIFtzdHJpbmddJElQQWRkcmVzcwogICAgKQogICAgaWYgKCRJUEFkZHJlc3MgLW1hdGNoICdeKDI1WzAtNV18MlswLTRdWzAtOV18WzAxXT9bMC05XVswLTldPylcLigyNVswLTVdfDJbMC00XVswLTldfFswMV0/WzAtOV1bMC05XT8pXC4oMjVbMC01XXwyWzAtNF1bMC05XXxbMDFdP1swLTldWzAtOV0/KVwuKDI1WzAtNV18MlswLTRdWzAtOV18WzAxXT9bMC05XVswLTldPykkJykgewogICAgICAgIHJldHVybiAkdHJ1ZQogICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gJGZhbHNlCiAgICB9Cn0KCiMgRXhhbXBsZSB1c2FnZQokaXAgPSBSZWFkLUhvc3QgIkVudGVyIGFuIElQIGFkZHJlc3MiCmlmIChWYWxpZGF0ZS1JUEFkZHJlc3MgLUlQQWRkcmVzcyAkaXApIHsKICAgIFdyaXRlLUhvc3QgIlZhbGlkIElQIGFkZHJlc3MiCn0gZWxzZSB7CiAgICBXcml0ZS1Ib3N0ICJJbnZhbGlkIElQIGFkZHJlc3MiCn0KCiMgQ29udmVydCBhIHBsYWluIHRleHQgcGFzc3dvcmQgdG8gYSBzZWN1cmUgc3RyaW5nCiRzZWN1cmVQYXNzd29yZCA9IENvbnZlcnRUby1TZWN1cmVTdHJpbmcgIlBAc3N3MHJkISIgLUFzUGxhaW5UZXh0IC1Gb3JjZQoKIyBVc2UgdGhlIHNlY3VyZSBzdHJpbmcgaW4gYSBQU0NyZWRlbnRpYWwgb2JqZWN0CiRjcmVkZW50aWFsID0gTmV3LU9iamVjdCBTeXN0ZW0uTWFuYWdlbWVudC5BdXRvbWF0aW9uLlBTQ3JlZGVudGlhbCAoInVzZXJuYW1lIiwgJHNlY3VyZVBhc3N3b3JkKQoKIyBTaWduIHRoZSBzY3JpcHQgdXNpbmcgYSBjb2RlLXNpZ25pbmcgY2VydGlmaWNhdGUKJGNlcnQgPSBHZXQtQ2hpbGRJdGVtIC1QYXRoIENlcnQ6XEN1cnJlbnRVc2VyXE15IC1Db2RlU2lnbmluZ0NlcnQKU2V0LUF1dGhlbnRpY29kZVNpZ25hdHVyZSAtRmlsZVBhdGggIkM6XFBhdGhcVG9cWW91clNjcmlwdC5wczEiIC1DZXJ0aWZpY2F0ZSAkY2VydA=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'># Prompt for credentials
$credential = Get-Credential

# Function to validate an IP address
function Validate-IPAddress {
    param (
        [string]$IPAddress
    )
    if ($IPAddress -match '^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$') {
        return $true
    } else {
        return $false
    }
}

# Example usage
$ip = Read-Host &quot;Enter an IP address&quot;
if (Validate-IPAddress -IPAddress $ip) {
    Write-Host &quot;Valid IP address&quot;
} else {
    Write-Host &quot;Invalid IP address&quot;
}

# Convert a plain text password to a secure string
$securePassword = ConvertTo-SecureString &quot;P@ssw0rd!&quot; -AsPlainText -Force

# Use the secure string in a PSCredential object
$credential = New-Object System.Management.Automation.PSCredential (&quot;username&quot;, $securePassword)

# Sign the script using a code-signing certificate
$cert = Get-ChildItem -Path Cert:\CurrentUser\My -CodeSigningCert
Set-AuthenticodeSignature -FilePath &quot;C:\Path\To\YourScript.ps1&quot; -Certificate $cert</pre></div><div class='content'></div><h1>Conclusion</h1>
<div class='content'><p>In this section, we covered several security best practices for PowerShell scripting, including using the principle of least privilege, avoiding hardcoding sensitive information, using secure strings, validating input data, code signing, regularly updating PowerShell and modules, and restricting script execution policies. By following these best practices, you can help ensure that your PowerShell scripts are secure and minimize the risk of security vulnerabilities.</p>
</div><div class='row navigation'>
	<div class='col-2'>
					<a href='09-02-performance-optimization' title="Performance Optimization">&#x25C4;Previous</a>
			</div>
	<div class='col-8 text-center'>
			</div>
	<div class='col-2 text-end'>
					<a href='09-04-version-control-git' title="Version Control with Git">Next &#x25BA;</a>
			</div>
</div>

			</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Advertising</h1>
			<p>This space is reserved for advertising.</p>
			<p>If you want to be a sponsor, contact us to include links in this area: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Thank you for collaborating!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. All rights reserved</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir galetes per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Accept</a>
    <a href="/cookies">More Information</a>
</div>	

	</div>    
</body>
</html>
