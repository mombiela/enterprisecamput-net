<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Synchronization</title>

    <link rel="alternate" href="https://campusempresa.com/mod/java/08-04-synchronization" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/mod/java/08-04-synchronization" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/mod/java/08-04-synchronization" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="/js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body >
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-12 col-md-8 p-2 p-md-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo-header_enterprise.png"></a>
			</h1>
		</div>
		<div class="col-12 col-md-4 p-2 p-md-0 text-end">
			<h2 id="main_title"><cite>Building today's and tomorrow's society</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-2 p-md-0 m-0 text-end">
													<b id="lit_lang_es" class="px-2">EN</b>
				|
				<a href="https://campusempresa.com/mod/java/08-04-synchronization" class="px-2">ES</a></b>
				|
				<a href="https://campusempresa.cat/mod/java/08-04-synchronization" class="px-2">CA</a>
					</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="/objective">The Project</a>
				<a href="/about">About Us</a>
				<a href="/contribute">Contribute</a>
				<a href="/donate">Donations</a>
				<a href="/licence">License</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content">
								<div class='row navigation'>
	<div class='col-2'>
					<a href='08-03-thread-lifecycle' title="Thread Lifecycle">&#x25C4;Previous</a>
			</div>
	<div class='col-8 text-center'>
					<a href="./"><h2 style="text-decoration:underline">Synchronization</h2></a>
			</div>
	<div class='col-2 text-end'>
					<a href='08-05-concurrency-utilities' title="Concurrency Utilities">Next &#x25BA;</a>
			</div>
</div>
<div class='content'><p>Synchronization in Java is a mechanism that ensures that two or more concurrent threads do not simultaneously execute some particular program segment known as a critical section. This is crucial in a multithreaded environment to prevent thread interference and memory consistency errors.</p>
</div><h1><p>Key Concepts</p>
</h1>
<div class='content'><ol>
<li><strong>Thread Interference</strong>: Occurs when multiple threads try to modify shared data simultaneously.</li>
<li><strong>Memory Consistency Errors</strong>: Occur when different threads have inconsistent views of what should be the same data.</li>
<li><strong>Critical Section</strong>: A part of the program where shared resources are accessed.</li>
<li><strong>Locks</strong>: Mechanisms to control access to the critical section.</li>
</ol>
</div><h1><p>Synchronized Methods</p>
</h1>
<div class='content'><p>A synchronized method ensures that only one thread can execute it at a time for a given object.</p>
</div><h2><p>Example</p>
</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("cHVibGljIGNsYXNzIENvdW50ZXIgewogICAgcHJpdmF0ZSBpbnQgY291bnQgPSAwOwoKICAgIHB1YmxpYyBzeW5jaHJvbml6ZWQgdm9pZCBpbmNyZW1lbnQoKSB7CiAgICAgICAgY291bnQrKzsKICAgIH0KCiAgICBwdWJsaWMgaW50IGdldENvdW50KCkgewogICAgICAgIHJldHVybiBjb3VudDsKICAgIH0KfQoKcHVibGljIGNsYXNzIE1haW4gewogICAgcHVibGljIHN0YXRpYyB2b2lkIG1haW4oU3RyaW5nW10gYXJncykgdGhyb3dzIEludGVycnVwdGVkRXhjZXB0aW9uIHsKICAgICAgICBDb3VudGVyIGNvdW50ZXIgPSBuZXcgQ291bnRlcigpOwoKICAgICAgICBSdW5uYWJsZSB0YXNrID0gKCkgLT4gewogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IDEwMDA7IGkrKykgewogICAgICAgICAgICAgICAgY291bnRlci5pbmNyZW1lbnQoKTsKICAgICAgICAgICAgfQogICAgICAgIH07CgogICAgICAgIFRocmVhZCB0aHJlYWQxID0gbmV3IFRocmVhZCh0YXNrKTsKICAgICAgICBUaHJlYWQgdGhyZWFkMiA9IG5ldyBUaHJlYWQodGFzayk7CgogICAgICAgIHRocmVhZDEuc3RhcnQoKTsKICAgICAgICB0aHJlYWQyLnN0YXJ0KCk7CgogICAgICAgIHRocmVhZDEuam9pbigpOwogICAgICAgIHRocmVhZDIuam9pbigpOwoKICAgICAgICBTeXN0ZW0ub3V0LnByaW50bG4oIkZpbmFsIGNvdW50OiAiICsgY291bnRlci5nZXRDb3VudCgpKTsKICAgIH0KfQ=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>public class Counter {
    private int count = 0;

    public synchronized void increment() {
        count++;
    }

    public int getCount() {
        return count;
    }
}

public class Main {
    public static void main(String[] args) throws InterruptedException {
        Counter counter = new Counter();

        Runnable task = () -&gt; {
            for (int i = 0; i &lt; 1000; i++) {
                counter.increment();
            }
        };

        Thread thread1 = new Thread(task);
        Thread thread2 = new Thread(task);

        thread1.start();
        thread2.start();

        thread1.join();
        thread2.join();

        System.out.println(&quot;Final count: &quot; + counter.getCount());
    }
}</pre></div><div class='content'></div><h2><p>Explanation</p>
</h2>
<div class='content'><ul>
<li><strong>Counter Class</strong>: Contains a synchronized method <code>increment()</code> which ensures that only one thread can increment the count at a time.</li>
<li><strong>Main Class</strong>: Creates two threads that run the same task of incrementing the counter 1000 times. The <code>join()</code> method ensures that the main thread waits for both threads to finish before printing the final count.</li>
</ul>
</div><h1><p>Synchronized Blocks</p>
</h1>
<div class='content'><p>Synchronized blocks provide more granular control over the synchronization. They can be used to synchronize only a part of the method.</p>
</div><h2><p>Example</p>
</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("cHVibGljIGNsYXNzIENvdW50ZXIgewogICAgcHJpdmF0ZSBpbnQgY291bnQgPSAwOwoKICAgIHB1YmxpYyB2b2lkIGluY3JlbWVudCgpIHsKICAgICAgICBzeW5jaHJvbml6ZWQgKHRoaXMpIHsKICAgICAgICAgICAgY291bnQrKzsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGludCBnZXRDb3VudCgpIHsKICAgICAgICByZXR1cm4gY291bnQ7CiAgICB9Cn0KCnB1YmxpYyBjbGFzcyBNYWluIHsKICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBtYWluKFN0cmluZ1tdIGFyZ3MpIHRocm93cyBJbnRlcnJ1cHRlZEV4Y2VwdGlvbiB7CiAgICAgICAgQ291bnRlciBjb3VudGVyID0gbmV3IENvdW50ZXIoKTsKCiAgICAgICAgUnVubmFibGUgdGFzayA9ICgpIC0+IHsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDEwMDA7IGkgPiAwOyBpLS0pIHsKICAgICAgICAgICAgICAgIGNvdW50ZXIuaW5jcmVtZW50KCk7CiAgICAgICAgICAgIH0KICAgICAgICB9OwoKICAgICAgICBUaHJlYWQgdGhyZWFkMSA9IG5ldyBUaHJlYWQodGFzayk7CiAgICAgICAgVGhyZWFkIHRocmVhZDIgPSBuZXcgVGhyZWFkKHRhc2spOwoKICAgICAgICB0aHJlYWQxLnN0YXJ0KCk7CiAgICAgICAgdGhyZWFkMi5zdGFydCgpOwoKICAgICAgICB0aHJlYWQxLmpvaW4oKTsKICAgICAgICB0aHJlYWQyLmpvaW4oKTsKCiAgICAgICAgU3lzdGVtLm91dC5wcmludGxuKCJGaW5hbCBjb3VudDogIiArIGNvdW50ZXIuZ2V0Q291bnQoKSk7CiAgICB9Cn0="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>public class Counter {
    private int count = 0;

    public void increment() {
        synchronized (this) {
            count++;
        }
    }

    public int getCount() {
        return count;
    }
}

public class Main {
    public static void main(String[] args) throws InterruptedException {
        Counter counter = new Counter();

        Runnable task = () -&gt; {
            for (int i = 1000; i &gt; 0; i--) {
                counter.increment();
            }
        };

        Thread thread1 = new Thread(task);
        Thread thread2 = new Thread(task);

        thread1.start();
        thread2.start();

        thread1.join();
        thread2.join();

        System.out.println(&quot;Final count: &quot; + counter.getCount());
    }
}</pre></div><div class='content'></div><h2><p>Explanation</p>
</h2>
<div class='content'><ul>
<li><strong>Synchronized Block</strong>: The <code>synchronized (this)</code> block ensures that only one thread can execute the block at a time, providing more control over which part of the method is synchronized.</li>
</ul>
</div><h1><p>Static Synchronization</p>
</h1>
<div class='content'><p>Static synchronization is used to synchronize static methods. The lock is on the class object.</p>
</div><h2><p>Example</p>
</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("cHVibGljIGNsYXNzIENvdW50ZXIgewogICAgcHJpdmF0ZSBzdGF0aWMgaW50IGNvdW50ID0gMDsKCiAgICBwdWJsaWMgc3RhdGljIHN5bmNocm9uaXplZCB2b2lkIGluY3JlbWVudCgpIHsKICAgICAgICBjb3VudCsrOwogICAgfQoKICAgIHB1YmxpYyBzdGF0aWMgaW50IGdldENvdW50KCkgewogICAgICAgIHJldHVybiBjb3VudDsKICAgIH0KfQoKcHVibGljIGNsYXNzIE1haW4gewogICAgcHVibGljIHN0YXRpYyB2b2lkIG1haW4oU3RyaW5nW10gYXJncykgdGhyb3dzIEludGVycnVwdGVkRXhjZXB0aW9uIHsKICAgICAgICBSdW5uYWJsZSB0YXNrID0gKCkgLT4gewogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IDEwMDA7IGkrKykgewogICAgICAgICAgICAgICAgQ291bnRlci5pbmNyZW1lbnQoKTsKICAgICAgICAgICAgfQogICAgICAgIH07CgogICAgICAgIFRocmVhZCB0aHJlYWQxID0gbmV3IFRocmVhZCh0YXNrKTsKICAgICAgICBUaHJlYWQgdGhyZWFkMiA9IG5ldyBUaHJlYWQodGFzayk7CgogICAgICAgIHRocmVhZDEuc3RhcnQoKTsKICAgICAgICB0aHJlYWQyLnN0YXJ0KCk7CgogICAgICAgIHRocmVhZDEuam9pbigpOwogICAgICAgIHRocmVhZDIuam9pbigpOwoKICAgICAgICBTeXN0ZW0ub3V0LnByaW50bG4oIkZpbmFsIGNvdW50OiAiICsgQ291bnRlci5nZXRDb3VudCgpKTsKICAgIH0KfQ=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>public class Counter {
    private static int count = 0;

    public static synchronized void increment() {
        count++;
    }

    public static int getCount() {
        return count;
    }
}

public class Main {
    public static void main(String[] args) throws InterruptedException {
        Runnable task = () -&gt; {
            for (int i = 0; i &lt; 1000; i++) {
                Counter.increment();
            }
        };

        Thread thread1 = new Thread(task);
        Thread thread2 = new Thread(task);

        thread1.start();
        thread2.start();

        thread1.join();
        thread2.join();

        System.out.println(&quot;Final count: &quot; + Counter.getCount());
    }
}</pre></div><div class='content'></div><h2><p>Explanation</p>
</h2>
<div class='content'><ul>
<li><strong>Static Synchronized Method</strong>: The <code>increment()</code> method is synchronized and static, ensuring that only one thread can execute it at a time across all instances of the class.</li>
</ul>
</div><h1><p>Practical Exercises</p>
</h1>
<div class='content'></div><h2><p>Exercise 1: Synchronized Method</p>
</h2>
<div class='content'><p><strong>Task</strong>: Create a class <code>BankAccount</code> with a synchronized method <code>deposit</code> and a method <code>getBalance</code>. Create multiple threads to deposit money into the account and ensure the final balance is correct.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("cHVibGljIGNsYXNzIEJhbmtBY2NvdW50IHsKICAgIHByaXZhdGUgaW50IGJhbGFuY2UgPSAwOwoKICAgIHB1YmxpYyBzeW5jaHJvbml6ZWQgdm9pZCBkZXBvc2l0KGludCBhbW91bnQpIHsKICAgICAgICBiYWxhbmNlICs9IGFtb3VudDsKICAgIH0KCiAgICBwdWJsaWMgaW50IGdldEJhbGFuY2UoKSB7CiAgICAgICAgcmV0dXJuIGJhbGFuY2U7CiAgICB9Cn0KCnB1YmxpYyBjbGFzcyBNYWluIHsKICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBtYWluKFN0cmluZ1tdIGFyZ3MpIHRocm93cyBJbnRlcnJ1cHRlZEV4Y2VwdGlvbiB7CiAgICAgICAgQmFua0FjY291bnQgYWNjb3VudCA9IG5ldyBCYW5rQWNjb3VudCgpOwoKICAgICAgICBSdW5uYWJsZSB0YXNrID0gKCkgLT4gewogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IDEwMDA7IGkrKykgewogICAgICAgICAgICAgICAgYWNjb3VudC5kZXBvc2l0KDEpOwogICAgICAgICAgICB9CiAgICAgICAgfTsKCiAgICAgICAgVGhyZWFkIHRocmVhZDEgPSBuZXcgVGhyZWFkKHRhc2spOwogICAgICAgIFRocmVhZCB0aHJlYWQyID0gbmV3IFRocmVhZCh0YXNrKTsKCiAgICAgICAgdGhyZWFkMS5zdGFydCgpOwogICAgICAgIHRocmVhZDIuc3RhcnQoKTsKCiAgICAgICAgdGhyZWFkMS5qb2luKCk7CiAgICAgICAgdGhyZWFkMi5qb2luKCk7CgogICAgICAgIFN5c3RlbS5vdXQucHJpbnRsbigiRmluYWwgYmFsYW5jZTogIiArIGFjY291bnQuZ2V0QmFsYW5jZSgpKTsKICAgIH0KfQ=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>public class BankAccount {
    private int balance = 0;

    public synchronized void deposit(int amount) {
        balance += amount;
    }

    public int getBalance() {
        return balance;
    }
}

public class Main {
    public static void main(String[] args) throws InterruptedException {
        BankAccount account = new BankAccount();

        Runnable task = () -&gt; {
            for (int i = 0; i &lt; 1000; i++) {
                account.deposit(1);
            }
        };

        Thread thread1 = new Thread(task);
        Thread thread2 = new Thread(task);

        thread1.start();
        thread2.start();

        thread1.join();
        thread2.join();

        System.out.println(&quot;Final balance: &quot; + account.getBalance());
    }
}</pre></div><div class='content'></div><h2><p>Solution</p>
</h2>
<div class='content'><ul>
<li><strong>BankAccount Class</strong>: Contains a synchronized method <code>deposit()</code> to ensure thread-safe deposits.</li>
<li><strong>Main Class</strong>: Creates two threads that deposit money into the account. The final balance should be 2000.</li>
</ul>
</div><h2><p>Exercise 2: Synchronized Block</p>
</h2>
<div class='content'><p><strong>Task</strong>: Modify the <code>BankAccount</code> class to use a synchronized block instead of a synchronized method.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("cHVibGljIGNsYXNzIEJhbmtBY2NvdW50IHsKICAgIHByaXZhdGUgaW50IGJhbGFuY2UgPSAwOwoKICAgIHB1YmxpYyB2b2lkIGRlcG9zaXQoaW50IGFtb3VudCkgewogICAgICAgIHN5bmNocm9uaXplZCAodGhpcykgewogICAgICAgICAgICBiYWxhbmNlICs9IGFtb3VudDsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGludCBnZXRCYWxhbmNlKCkgewogICAgICAgIHJldHVybiBiYWxhbmNlOwogICAgfQp9CgpwdWJsaWMgY2xhc3MgTWFpbiB7CiAgICBwdWJsaWMgc3RhdGljIHZvaWQgbWFpbihTdHJpbmdbXSBhcmdzKSB0aHJvd3MgSW50ZXJydXB0ZWRFeGNlcHRpb24gewogICAgICAgIEJhbmtBY2NvdW50IGFjY291bnQgPSBuZXcgQmFua0FjY291bnQoKTsKCiAgICAgICAgUnVubmFibGUgdGFzayA9ICgpIC0+IHsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCAxMDAwOyBpKyspIHsKICAgICAgICAgICAgICAgIGFjY291bnQuZGVwb3NpdCgxKTsKICAgICAgICAgICAgfQogICAgICAgIH07CgogICAgICAgIFRocmVhZCB0aHJlYWQxID0gbmV3IFRocmVhZCh0YXNrKTsKICAgICAgICBUaHJlYWQgdGhyZWFkMiA9IG5ldyBUaHJlYWQodGFzayk7CgogICAgICAgIHRocmVhZDEuc3RhcnQoKTsKICAgICAgICB0aHJlYWQyLnN0YXJ0KCk7CgogICAgICAgIHRocmVhZDEuam9pbigpOwogICAgICAgIHRocmVhZDIuam9pbigpOwoKICAgICAgICBTeXN0ZW0ub3V0LnByaW50bG4oIkZpbmFsIGJhbGFuY2U6ICIgKyBhY2NvdW50LmdldEJhbGFuY2UoKSk7CiAgICB9Cn0="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>public class BankAccount {
    private int balance = 0;

    public void deposit(int amount) {
        synchronized (this) {
            balance += amount;
        }
    }

    public int getBalance() {
        return balance;
    }
}

public class Main {
    public static void main(String[] args) throws InterruptedException {
        BankAccount account = new BankAccount();

        Runnable task = () -&gt; {
            for (int i = 0; i &lt; 1000; i++) {
                account.deposit(1);
            }
        };

        Thread thread1 = new Thread(task);
        Thread thread2 = new Thread(task);

        thread1.start();
        thread2.start();

        thread1.join();
        thread2.join();

        System.out.println(&quot;Final balance: &quot; + account.getBalance());
    }
}</pre></div><div class='content'></div><h2><p>Solution</p>
</h2>
<div class='content'><ul>
<li><strong>Synchronized Block</strong>: The <code>deposit()</code> method now uses a synchronized block to ensure thread-safe deposits.</li>
</ul>
</div><h1><p>Common Mistakes and Tips</p>
</h1>
<div class='content'><ol>
<li><strong>Over-Synchronization</strong>: Synchronizing more than necessary can lead to performance issues. Use synchronized blocks instead of synchronized methods when possible.</li>
<li><strong>Deadlocks</strong>: Be cautious of deadlocks, which occur when two or more threads are waiting for each other to release locks.</li>
<li><strong>Atomic Variables</strong>: For simple operations, consider using atomic variables from <code>java.util.concurrent.atomic</code> package.</li>
</ol>
</div><h1><p>Conclusion</p>
</h1>
<div class='content'><p>Synchronization is a fundamental concept in Java for ensuring thread safety in a multithreaded environment. By using synchronized methods, synchronized blocks, and static synchronization, you can control access to critical sections and prevent thread interference and memory consistency errors. Practice with the provided exercises to reinforce your understanding and become proficient in handling synchronization in Java.</p>
</div><div class='row navigation'>
	<div class='col-2'>
					<a href='08-03-thread-lifecycle' title="Thread Lifecycle">&#x25C4;Previous</a>
			</div>
	<div class='col-8 text-center'>
			</div>
	<div class='col-2 text-end'>
					<a href='08-05-concurrency-utilities' title="Concurrency Utilities">Next &#x25BA;</a>
			</div>
</div>

			</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Advertising</h1>
			<p>This space is reserved for advertising.</p>
			<p>If you want to be a sponsor, contact us to include links in this area: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Thank you for collaborating!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. All rights reserved</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir galetes per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Accept</a>
    <a href="/cookies">More Information</a>
</div>	

	</div>    
</body>
</html>
