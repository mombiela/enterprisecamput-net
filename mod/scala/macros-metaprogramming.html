<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Macros and Metaprogramming in Scala</title>

    <link rel="alternate" href="https://campusempresa.com/mod/scala/macros-metaprogramming" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/mod/scala/macros-metaprogramming" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/mod/scala/macros-metaprogramming" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body >
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-8 p-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo-header_enterprise.png"></a>
			</h1>
		</div>
		<div class="col-4 p-0 text-end">
			<h2 id="main_title"><cite>Building today's and tomorrow's society</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-0 m-0 text-end">
													<b id="lit_lang_es" class="px-2">EN</b>
				|
				<a href="https://campusempresa.com/mod/scala/macros-metaprogramming" class="px-2">ES</a></b>
				|
				<a href="https://campusempresa.cat/mod/scala/macros-metaprogramming" class="px-2">CA</a>
					</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="/objective">The Project</a>
				<a href="/about">About Us</a>
				<a href="/contribute">Contribute</a>
				<a href="/donate">Donations</a>
				<a href="/licence">License</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content">
								<div class='row navigation'>
	<div class='col-4'>
					<a href='parallel-collections'>&#x25C4;Parallel Collections</a>
			</div>
	<div class='col-4 text-center'>
		<a href="./" class="title">Macros and Metaprogramming in Scala</a>
	</div>
	<div class='col-4 text-end'>
					<a href='type-system-advanced-types'>Type System and Advanced Types &#x25BA;</a>
			</div>
</div>
<div class='content'></div><h1>Introduction to Macros and Metaprogramming</h1>
<div class='content'><p>Macros and metaprogramming are powerful features in Scala that allow you to write code that generates other code at compile time. This can lead to more efficient and reusable code. In this section, we'll explore the basics of macros and metaprogramming, understand their use cases, and see how they can be implemented in Scala.</p>
</div><h1>What are Macros?</h1>
<div class='content'><p>Macros in Scala are methods that are expanded at compile time. They allow you to manipulate abstract syntax trees (ASTs) to generate code dynamically.</p>
</div><h2>Key Concepts</h2>
<div class='content'><ul>
<li><strong>Compile-time Code Generation</strong>: Macros generate code during the compilation process, not at runtime.</li>
<li><strong>Abstract Syntax Trees (ASTs)</strong>: Macros work by manipulating the ASTs of the code.</li>
<li><strong>Type Safety</strong>: Macros provide type safety by ensuring that the generated code is type-checked during compilation.</li>
</ul>
</div><h2>Example of a Simple Macro</h2>
<div class='content'><p>Let's start with a simple macro example that prints the code it is given.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("aW1wb3J0IHNjYWxhLmxhbmd1YWdlLmV4cGVyaW1lbnRhbC5tYWNyb3MKaW1wb3J0IHNjYWxhLnJlZmxlY3QubWFjcm9zLmJsYWNrYm94LkNvbnRleHQKCm9iamVjdCBNYWNyb3MgewogIGRlZiBwcmludENvZGUoY29kZTogQW55KTogVW5pdCA9IG1hY3JvIHByaW50Q29kZUltcGwKCiAgZGVmIHByaW50Q29kZUltcGwoYzogQ29udGV4dCkoY29kZTogYy5FeHByW0FueV0pOiBjLkV4cHJbVW5pdF0gPSB7CiAgICBpbXBvcnQgYy51bml2ZXJzZS5fCiAgICBwcmludGxuKHNob3dDb2RlKGNvZGUudHJlZSkpCiAgICByZWlmeShwcmludGxuKGNvZGUuc3BsaWNlKSkKICB9Cn0KCm9iamVjdCBNYWluIGV4dGVuZHMgQXBwIHsKICBNYWNyb3MucHJpbnRDb2RlKCJIZWxsbywgTWFjcm9zISIpCn0="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>import scala.language.experimental.macros
import scala.reflect.macros.blackbox.Context

object Macros {
  def printCode(code: Any): Unit = macro printCodeImpl

  def printCodeImpl(c: Context)(code: c.Expr[Any]): c.Expr[Unit] = {
    import c.universe._
    println(showCode(code.tree))
    reify(println(code.splice))
  }
}

object Main extends App {
  Macros.printCode(&quot;Hello, Macros!&quot;)
}</pre></div><div class='content'><p>In this example:</p>
<ul>
<li><code>printCode</code> is a macro method.</li>
<li><code>printCodeImpl</code> is the macro implementation that manipulates the AST.</li>
<li><code>showCode</code> is used to print the code passed to the macro.</li>
<li><code>reify</code> and <code>splice</code> are used to generate and insert code.</li>
</ul>
</div><h1>Advanced Macros</h1>
<div class='content'><p>As you become more comfortable with macros, you can start creating more complex macros that perform sophisticated code transformations.</p>
</div><h2>Key Concepts</h2>
<div class='content'><ul>
<li><strong>Macro Bundles</strong>: Grouping related macros together.</li>
<li><strong>Type Macros</strong>: Generating types dynamically.</li>
<li><strong>Contextual Macros</strong>: Using the macro context to access additional information.</li>
</ul>
</div><h2>Example of an Advanced Macro</h2>
<div class='content'><p>Here’s an example of a macro that generates a case class from a map of field names and types.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("aW1wb3J0IHNjYWxhLmxhbmd1YWdlLmV4cGVyaW1lbnRhbC5tYWNyb3MKaW1wb3J0IHNjYWxhLnJlZmxlY3QubWFjcm9zLmJsYWNrYm94LkNvbnRleHQKCm9iamVjdCBDYXNlQ2xhc3NHZW5lcmF0b3IgewogIGRlZiBnZW5lcmF0ZUNhc2VDbGFzcyhuYW1lOiBTdHJpbmcsIGZpZWxkczogTWFwW1N0cmluZywgU3RyaW5nXSk6IEFueSA9IG1hY3JvIGdlbmVyYXRlQ2FzZUNsYXNzSW1wbAoKICBkZWYgZ2VuZXJhdGVDYXNlQ2xhc3NJbXBsKGM6IENvbnRleHQpKG5hbWU6IGMuRXhwcltTdHJpbmddLCBmaWVsZHM6IGMuRXhwcltNYXBbU3RyaW5nLCBTdHJpbmddXSk6IGMuRXhwcltBbnldID0gewogICAgaW1wb3J0IGMudW5pdmVyc2UuXwoKICAgIHZhbCBMaXRlcmFsKENvbnN0YW50KGNsYXNzTmFtZTogU3RyaW5nKSkgPSBuYW1lLnRyZWUKICAgIHZhbCBMaXRlcmFsKENvbnN0YW50KGZpZWxkTWFwOiBNYXBbU3RyaW5nLCBTdHJpbmddKSkgPSBmaWVsZHMudHJlZQoKICAgIHZhbCBjbGFzc0RlZiA9IHEiIiIKICAgICAgY2FzZSBjbGFzcyAke1R5cGVOYW1lKGNsYXNzTmFtZSl9KC4uJHtmaWVsZE1hcC5tYXAgeyBjYXNlIChmaWVsZE5hbWUsIGZpZWxkVHlwZSkgPT4KICAgICAgICBxInZhbCAke1Rlcm1OYW1lKGZpZWxkTmFtZSl9OiAke1R5cGVOYW1lKGZpZWxkVHlwZSl9IgogICAgICB9fSkKICAgICIiIgoKICAgIGMuRXhwcltBbnldKGNsYXNzRGVmKQogIH0KfQoKb2JqZWN0IE1haW4gZXh0ZW5kcyBBcHAgewogIENhc2VDbGFzc0dlbmVyYXRvci5nZW5lcmF0ZUNhc2VDbGFzcygiUGVyc29uIiwgTWFwKCJuYW1lIiAtPiAiU3RyaW5nIiwgImFnZSIgLT4gIkludCIpKQp9"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>import scala.language.experimental.macros
import scala.reflect.macros.blackbox.Context

object CaseClassGenerator {
  def generateCaseClass(name: String, fields: Map[String, String]): Any = macro generateCaseClassImpl

  def generateCaseClassImpl(c: Context)(name: c.Expr[String], fields: c.Expr[Map[String, String]]): c.Expr[Any] = {
    import c.universe._

    val Literal(Constant(className: String)) = name.tree
    val Literal(Constant(fieldMap: Map[String, String])) = fields.tree

    val classDef = q&quot;&quot;&quot;
      case class ${TypeName(className)}(..${fieldMap.map { case (fieldName, fieldType) =&gt;
        q&quot;val ${TermName(fieldName)}: ${TypeName(fieldType)}&quot;
      }})
    &quot;&quot;&quot;

    c.Expr[Any](classDef)
  }
}

object Main extends App {
  CaseClassGenerator.generateCaseClass(&quot;Person&quot;, Map(&quot;name&quot; -&gt; &quot;String&quot;, &quot;age&quot; -&gt; &quot;Int&quot;))
}</pre></div><div class='content'><p>In this example:</p>
<ul>
<li><code>generateCaseClass</code> is a macro that generates a case class.</li>
<li><code>generateCaseClassImpl</code> is the macro implementation that constructs the case class definition.</li>
<li>The macro uses quasiquotes (<code>q&quot;...&quot;</code>) to generate the case class code.</li>
</ul>
</div><h1>Metaprogramming in Scala</h1>
<div class='content'><p>Metaprogramming involves writing programs that write or manipulate other programs. In Scala, this is often done using macros, but it can also involve other techniques such as reflection.</p>
</div><h2>Key Concepts</h2>
<div class='content'><ul>
<li><strong>Reflection</strong>: Inspecting and modifying the program structure at runtime.</li>
<li><strong>Quasiquotes</strong>: A powerful tool for generating and manipulating code.</li>
<li><strong>Annotations</strong>: Adding metadata to code elements that can be processed at compile time or runtime.</li>
</ul>
</div><h2>Example of Metaprogramming with Reflection</h2>
<div class='content'><p>Here’s an example of using reflection to inspect the fields of a case class at runtime.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("aW1wb3J0IHNjYWxhLnJlZmxlY3QucnVudGltZS51bml2ZXJzZS5fCgpjYXNlIGNsYXNzIFBlcnNvbihuYW1lOiBTdHJpbmcsIGFnZTogSW50KQoKb2JqZWN0IFJlZmxlY3Rpb25FeGFtcGxlIGV4dGVuZHMgQXBwIHsKICB2YWwgcGVyc29uID0gUGVyc29uKCJBbGljZSIsIDMwKQogIHZhbCBtaXJyb3IgPSBydW50aW1lTWlycm9yKHBlcnNvbi5nZXRDbGFzcy5nZXRDbGFzc0xvYWRlcikKICB2YWwgaW5zdGFuY2VNaXJyb3IgPSBtaXJyb3IucmVmbGVjdChwZXJzb24pCiAgdmFsIGNsYXNzU3ltYm9sID0gaW5zdGFuY2VNaXJyb3Iuc3ltYm9sCgogIGNsYXNzU3ltYm9sLnR5cGVTaWduYXR1cmUubWVtYmVycy5jb2xsZWN0IHsKICAgIGNhc2UgbTogTWV0aG9kU3ltYm9sIGlmIG0uaXNDYXNlQWNjZXNzb3IgPT4KICAgICAgdmFsIGZpZWxkTWlycm9yID0gaW5zdGFuY2VNaXJyb3IucmVmbGVjdEZpZWxkKG0pCiAgICAgIHByaW50bG4ocyIke20ubmFtZX06ICR7ZmllbGRNaXJyb3IuZ2V0fSIpCiAgfQp9"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>import scala.reflect.runtime.universe._

case class Person(name: String, age: Int)

object ReflectionExample extends App {
  val person = Person(&quot;Alice&quot;, 30)
  val mirror = runtimeMirror(person.getClass.getClassLoader)
  val instanceMirror = mirror.reflect(person)
  val classSymbol = instanceMirror.symbol

  classSymbol.typeSignature.members.collect {
    case m: MethodSymbol if m.isCaseAccessor =&gt;
      val fieldMirror = instanceMirror.reflectField(m)
      println(s&quot;${m.name}: ${fieldMirror.get}&quot;)
  }
}</pre></div><div class='content'><p>In this example:</p>
<ul>
<li><code>runtimeMirror</code> is used to get a mirror for the runtime environment.</li>
<li><code>reflect</code> is used to get a mirror for the instance.</li>
<li><code>typeSignature.members</code> is used to get the members of the class.</li>
<li><code>reflectField</code> is used to get the value of a field.</li>
</ul>
</div><h1>Conclusion</h1>
<div class='content'><p>Macros and metaprogramming are advanced features in Scala that can greatly enhance the flexibility and efficiency of your code. By understanding and utilizing these features, you can write more powerful and reusable code. Start with simple macros to get a feel for how they work, and gradually move on to more complex scenarios as you become more comfortable with the concepts. Remember to always consider the trade-offs, as macros can make your code harder to read and debug.</p>
</div><div class='row navigation'>
	<div class='col-4'>
					<a href='parallel-collections'>&#x25C4;Parallel Collections</a>
			</div>
	<div class='col-4 text-center'>
		<a href="./" class="title">Macros and Metaprogramming in Scala</a>
	</div>
	<div class='col-4 text-end'>
					<a href='type-system-advanced-types'>Type System and Advanced Types &#x25BA;</a>
			</div>
</div>

			</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Advertising</h1>
			<p>This space is reserved for advertising.</p>
			<p>If you want to be a sponsor, contact us to include links in this area: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Thank you for collaborating!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. All rights reserved</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir galetes per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Accept</a>
    <a href="/cookies">More Information</a>
</div>	

	</div>    
</body>
</html>
