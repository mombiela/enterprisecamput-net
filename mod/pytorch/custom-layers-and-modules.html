<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Custom Layers and Modules</title>

    <link rel="alternate" href="https://campusempresa.com/mod/pytorch/custom-layers-and-modules" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/mod/pytorch/custom-layers-and-modules" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/mod/pytorch/custom-layers-and-modules" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body>
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-8 p-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo-header_enterprise.png"></a>
			</h1>
		</div>
		<div class="col-4 p-0 text-end">
			<h2 id="main_title"><cite>Building today's and tomorrow's society</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-0 m-0 text-end">
													<b id="lit_lang_es" class="px-2">EN</b>
				|
				<a href="https://campusempresa.com/mod/pytorch/custom-layers-and-modules" class="px-2">ES</a></b>
				|
				<a href="https://campusempresa.cat/mod/pytorch/custom-layers-and-modules" class="px-2">CA</a>
					</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="/objective">The Project</a>
				<a href="/about">About Us</a>
				<a href="/contribute">Contribute</a>
				<a href="/donate">Donations</a>
				<a href="/licence">License</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content"><div class='row navigation'>
	<div class='col-4'>
					<a href='custom-loss-functions'>&#x25C4;Custom Loss Functions</a>
			</div>
	<div class='col-4 text-center'>
		<a href="./" class="title">Custom Layers and Modules</a>
	</div>
	<div class='col-4 text-end'>
					<a href='extending-autograd'>Extending Autograd &#x25BA;</a>
			</div>
</div>
<div class='content'><p>In this section, we will explore how to create custom layers and modules in PyTorch. This is a crucial skill for developing complex neural network architectures tailored to specific tasks. We will start with the basics and gradually move to more advanced concepts.</p>
</div><h1>Introduction to Custom Layers and Modules</h1>
<div class='content'><p>Creating custom layers and modules allows you to extend PyTorch's functionality and tailor it to your specific needs. This can be particularly useful when the built-in layers do not meet your requirements.</p>
<ul>
<li><strong>Custom Layers</strong>: These are individual building blocks of a neural network.</li>
<li><strong>Custom Modules</strong>: These are more complex structures that can contain multiple layers and other modules.</li>
</ul>
</div><h1>Creating a Custom Layer</h1>
<div class='content'><p>To create a custom layer in PyTorch, you need to subclass <code>torch.nn.Module</code> and define the <code>__init__</code> and <code>forward</code> methods.</p>
</div><h2>Example: Custom Linear Layer</h2>
<div class='content'><p>Let's create a custom linear layer that performs a linear transformation on the input data.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("aW1wb3J0IHRvcmNoCmltcG9ydCB0b3JjaC5ubiBhcyBubgoKY2xhc3MgQ3VzdG9tTGluZWFyKG5uLk1vZHVsZSk6CiAgICBkZWYgX19pbml0X18oc2VsZiwgaW5wdXRfZGltLCBvdXRwdXRfZGltKToKICAgICAgICBzdXBlcihDdXN0b21MaW5lYXIsIHNlbGYpLl9faW5pdF9fKCkKICAgICAgICBzZWxmLndlaWdodCA9IG5uLlBhcmFtZXRlcih0b3JjaC5yYW5kbihpbnB1dF9kaW0sIG91dHB1dF9kaW0pKQogICAgICAgIHNlbGYuYmlhcyA9IG5uLlBhcmFtZXRlcih0b3JjaC5yYW5kbihvdXRwdXRfZGltKSkKCiAgICBkZWYgZm9yd2FyZChzZWxmLCB4KToKICAgICAgICByZXR1cm4gdG9yY2gubWF0bXVsKHgsIHNlbGYud2VpZ2h0KSArIHNlbGYuYmlhcwoKIyBFeGFtcGxlIHVzYWdlCmlucHV0X2RhdGEgPSB0b3JjaC5yYW5kbigxMCwgNSkgICMgQmF0Y2ggb2YgMTAgc2FtcGxlcywgZWFjaCB3aXRoIDUgZmVhdHVyZXMKbGF5ZXIgPSBDdXN0b21MaW5lYXIoNSwgMykKb3V0cHV0X2RhdGEgPSBsYXllcihpbnB1dF9kYXRhKQpwcmludChvdXRwdXRfZGF0YSk="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>import torch
import torch.nn as nn

class CustomLinear(nn.Module):
    def __init__(self, input_dim, output_dim):
        super(CustomLinear, self).__init__()
        self.weight = nn.Parameter(torch.randn(input_dim, output_dim))
        self.bias = nn.Parameter(torch.randn(output_dim))

    def forward(self, x):
        return torch.matmul(x, self.weight) + self.bias

# Example usage
input_data = torch.randn(10, 5)  # Batch of 10 samples, each with 5 features
layer = CustomLinear(5, 3)
output_data = layer(input_data)
print(output_data)</pre></div><div class='content'></div><h2>Explanation</h2>
<div class='content'><ul>
<li><strong><code>__init__</code> Method</strong>: Initializes the layer with weights and biases.</li>
<li><strong><code>forward</code> Method</strong>: Defines the computation performed at every call. In this case, it performs a matrix multiplication followed by an addition.</li>
</ul>
</div><h1>Creating a Custom Module</h1>
<div class='content'><p>Custom modules can encapsulate multiple layers and other modules, allowing for more complex architectures.</p>
</div><h2>Example: Custom Neural Network Module</h2>
<div class='content'><p>Let's create a custom neural network module that consists of two linear layers with a ReLU activation in between.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y2xhc3MgQ3VzdG9tTk4obm4uTW9kdWxlKToKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBpbnB1dF9kaW0sIGhpZGRlbl9kaW0sIG91dHB1dF9kaW0pOgogICAgICAgIHN1cGVyKEN1c3RvbU5OLCBzZWxmKS5fX2luaXRfXygpCiAgICAgICAgc2VsZi5sYXllcjEgPSBDdXN0b21MaW5lYXIoaW5wdXRfZGltLCBoaWRkZW5fZGltKQogICAgICAgIHNlbGYucmVsdSA9IG5uLlJlTFUoKQogICAgICAgIHNlbGYubGF5ZXIyID0gQ3VzdG9tTGluZWFyKGhpZGRlbl9kaW0sIG91dHB1dF9kaW0pCgogICAgZGVmIGZvcndhcmQoc2VsZiwgeCk6CiAgICAgICAgeCA9IHNlbGYubGF5ZXIxKHgpCiAgICAgICAgeCA9IHNlbGYucmVsdSh4KQogICAgICAgIHggPSBzZWxmLmxheWVyMih4KQogICAgICAgIHJldHVybiB4CgojIEV4YW1wbGUgdXNhZ2UKaW5wdXRfZGF0YSA9IHRvcmNoLnJhbmRuKDEwLCA1KSAgIyBCYXRjaCBvZiAxMCBzYW1wbGVzLCBlYWNoIHdpdGggNSBmZWF0dXJlcwptb2RlbCA9IEN1c3RvbU5OKDUsIDQsIDMpCm91dHB1dF9kYXRhID0gbW9kZWwoaW5wdXRfZGF0YSkKcHJpbnQob3V0cHV0X2RhdGEp"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>class CustomNN(nn.Module):
    def __init__(self, input_dim, hidden_dim, output_dim):
        super(CustomNN, self).__init__()
        self.layer1 = CustomLinear(input_dim, hidden_dim)
        self.relu = nn.ReLU()
        self.layer2 = CustomLinear(hidden_dim, output_dim)

    def forward(self, x):
        x = self.layer1(x)
        x = self.relu(x)
        x = self.layer2(x)
        return x

# Example usage
input_data = torch.randn(10, 5)  # Batch of 10 samples, each with 5 features
model = CustomNN(5, 4, 3)
output_data = model(input_data)
print(output_data)</pre></div><div class='content'></div><h2>Explanation</h2>
<div class='content'><ul>
<li><strong><code>__init__</code> Method</strong>: Initializes the layers and activation functions.</li>
<li><strong><code>forward</code> Method</strong>: Defines the forward pass through the network, applying each layer and activation in sequence.</li>
</ul>
</div><h1>Advanced Custom Modules</h1>
<div class='content'><p>For more advanced use cases, you might need to create modules that include custom training loops, loss functions, or other specialized components.</p>
</div><h2>Example: Custom Module with Dropout</h2>
<div class='content'><p>Let's create a custom module that includes a dropout layer to prevent overfitting.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y2xhc3MgQ3VzdG9tTk5XaXRoRHJvcG91dChubi5Nb2R1bGUpOgogICAgZGVmIF9faW5pdF9fKHNlbGYsIGlucHV0X2RpbSwgaGlkZGVuX2RpbSwgb3V0cHV0X2RpbSwgZHJvcG91dF9wcm9iKToKICAgICAgICBzdXBlcihDdXN0b21OTldpdGhEcm9wb3V0LCBzZWxmKS5fX2luaXRfXygpCiAgICAgICAgc2VsZi5sYXllcjEgPSBDdXN0b21MaW5lYXIoaW5wdXRfZGltLCBoaWRkZW5fZGltKQogICAgICAgIHNlbGYucmVsdSA9IG5uLlJlTFUoKQogICAgICAgIHNlbGYuZHJvcG91dCA9IG5uLkRyb3BvdXQoZHJvcG91dF9wcm9iKQogICAgICAgIHNlbGYubGF5ZXIyID0gQ3VzdG9tTGluZWFyKGhpZGRlbl9kaW0sIG91dHB1dF9kaW0pCgogICAgZGVmIGZvcndhcmQoc2VsZiwgeCk6CiAgICAgICAgeCA9IHNlbGYubGF5ZXIxKHgpCiAgICAgICAgeCA9IHNlbGYucmVsdSh4KQogICAgICAgIHggPSBzZWxmLmRyb3BvdXQoeCkKICAgICAgICB4ID0gc2VsZi5sYXllcjIoeCkKICAgICAgICByZXR1cm4geAoKIyBFeGFtcGxlIHVzYWdlCmlucHV0X2RhdGEgPSB0b3JjaC5yYW5kbigxMCwgNSkgICMgQmF0Y2ggb2YgMTAgc2FtcGxlcywgZWFjaCB3aXRoIDUgZmVhdHVyZXMKbW9kZWwgPSBDdXN0b21OTldpdGhEcm9wb3V0KDUsIDQsIDMsIDAuNSkKb3V0cHV0X2RhdGEgPSBtb2RlbChpbnB1dF9kYXRhKQpwcmludChvdXRwdXRfZGF0YSk="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>class CustomNNWithDropout(nn.Module):
    def __init__(self, input_dim, hidden_dim, output_dim, dropout_prob):
        super(CustomNNWithDropout, self).__init__()
        self.layer1 = CustomLinear(input_dim, hidden_dim)
        self.relu = nn.ReLU()
        self.dropout = nn.Dropout(dropout_prob)
        self.layer2 = CustomLinear(hidden_dim, output_dim)

    def forward(self, x):
        x = self.layer1(x)
        x = self.relu(x)
        x = self.dropout(x)
        x = self.layer2(x)
        return x

# Example usage
input_data = torch.randn(10, 5)  # Batch of 10 samples, each with 5 features
model = CustomNNWithDropout(5, 4, 3, 0.5)
output_data = model(input_data)
print(output_data)</pre></div><div class='content'></div><h2>Explanation</h2>
<div class='content'><ul>
<li><strong>Dropout Layer</strong>: Randomly sets a fraction of input units to 0 at each update during training time, which helps prevent overfitting.</li>
</ul>
</div><h1>Summary</h1>
<div class='content'><p>In this section, we covered how to create custom layers and modules in PyTorch. We started with a simple custom linear layer and moved on to more complex custom modules, including those with dropout layers. Custom layers and modules are essential for building sophisticated neural network architectures tailored to specific tasks.</p>
<p>By mastering these concepts, you can extend PyTorch's functionality and create highly customized models for your machine learning projects.</p>
</div><div class='row navigation'>
	<div class='col-4'>
					<a href='custom-loss-functions'>&#x25C4;Custom Loss Functions</a>
			</div>
	<div class='col-4 text-center'>
		<a href="./" class="title">Custom Layers and Modules</a>
	</div>
	<div class='col-4 text-end'>
					<a href='extending-autograd'>Extending Autograd &#x25BA;</a>
			</div>
</div>
</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Advertising</h1>
			<p>This space is reserved for advertising.</p>
			<p>If you want to be a sponsor, contact us to include links in this area: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Thank you for collaborating!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. All rights reserved</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir galetes per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Accept</a>
    <a href="/cookies">More Information</a>
</div>	

	</div>    
</body>
</html>
