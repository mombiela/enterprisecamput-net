<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Serving PyTorch Models</title>

    <link rel="alternate" href="https://campusempresa.com/mod/pytorch/serving-pytorch-models" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/mod/pytorch/serving-pytorch-models" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/mod/pytorch/serving-pytorch-models" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body >
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-8 p-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo-header_enterprise.png"></a>
			</h1>
		</div>
		<div class="col-4 p-0 text-end">
			<h2 id="main_title"><cite>Building today's and tomorrow's society</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-0 m-0 text-end">
													<b id="lit_lang_es" class="px-2">EN</b>
				|
				<a href="https://campusempresa.com/mod/pytorch/serving-pytorch-models" class="px-2">ES</a></b>
				|
				<a href="https://campusempresa.cat/mod/pytorch/serving-pytorch-models" class="px-2">CA</a>
					</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="/objective">The Project</a>
				<a href="/about">About Us</a>
				<a href="/contribute">Contribute</a>
				<a href="/donate">Donations</a>
				<a href="/licence">License</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content">
								<div class='row navigation'>
	<div class='col-4'>
					<a href='exporting-models-with-torchscript'>&#x25C4;Exporting Models with TorchScript</a>
			</div>
	<div class='col-4 text-center'>
		<a href="./" class="title">Serving PyTorch Models</a>
	</div>
	<div class='col-4 text-end'>
					<a href='optimizing-for-inference'>Optimizing for Inference &#x25BA;</a>
			</div>
</div>
<div class='content'><p>In this section, we will cover how to serve PyTorch models so that they can be used in production environments. Serving a model involves making it available for inference through an API or other interface. This is a crucial step in deploying machine learning models to real-world applications.</p>
</div><h1>Key Concepts</h1>
<div class='content'><ul>
<li><strong>Model Serialization</strong>: Saving a trained model to disk.</li>
<li><strong>Model Deserialization</strong>: Loading a saved model from disk.</li>
<li><strong>Inference</strong>: Running the model to make predictions on new data.</li>
<li><strong>REST API</strong>: A common way to serve models over the web.</li>
<li><strong>Deployment Tools</strong>: Tools and frameworks that help in deploying models.</li>
</ul>
</div><h1>Model Serialization and Deserialization</h1>
<div class='content'><p>Before serving a model, you need to save it after training. PyTorch provides simple methods for this.</p>
</div><h2>Saving a Model</h2>
<div class='content'><p>You can save a model using <code>torch.save</code>. This function serializes the model and saves it to disk.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("aW1wb3J0IHRvcmNoCgojIEFzc3VtaW5nIGBtb2RlbGAgaXMgeW91ciB0cmFpbmVkIG1vZGVsCnRvcmNoLnNhdmUobW9kZWwuc3RhdGVfZGljdCgpLCAnbW9kZWwucHRoJyk="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>import torch

# Assuming `model` is your trained model
torch.save(model.state_dict(), 'model.pth')</pre></div><div class='content'></div><h2>Loading a Model</h2>
<div class='content'><p>To load a saved model, you use <code>torch.load</code> and <code>load_state_dict</code>.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("aW1wb3J0IHRvcmNoCmZyb20geW91cl9tb2RlbF9maWxlIGltcG9ydCBZb3VyTW9kZWxDbGFzcwoKbW9kZWwgPSBZb3VyTW9kZWxDbGFzcygpCm1vZGVsLmxvYWRfc3RhdGVfZGljdCh0b3JjaC5sb2FkKCdtb2RlbC5wdGgnKSkKbW9kZWwuZXZhbCgpICAjIFNldCB0aGUgbW9kZWwgdG8gZXZhbHVhdGlvbiBtb2Rl"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>import torch
from your_model_file import YourModelClass

model = YourModelClass()
model.load_state_dict(torch.load('model.pth'))
model.eval()  # Set the model to evaluation mode</pre></div><div class='content'></div><h1>Serving Models with a REST API</h1>
<div class='content'><p>One of the most common ways to serve a model is through a REST API. This allows clients to send HTTP requests to get predictions from the model.</p>
</div><h2>Using Flask</h2>
<div class='content'><p>Flask is a lightweight web framework for Python that is commonly used for serving machine learning models.</p>
<h4>Setting Up Flask</h4>
<p>First, install Flask if you haven't already:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("cGlwIGluc3RhbGwgRmxhc2s="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>pip install Flask</pre></div><div class='content'><h4>Creating a Flask App</h4>
<p>Here is a basic example of a Flask app that serves a PyTorch model:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ZnJvbSBmbGFzayBpbXBvcnQgRmxhc2ssIHJlcXVlc3QsIGpzb25pZnkKaW1wb3J0IHRvcmNoCmZyb20geW91cl9tb2RlbF9maWxlIGltcG9ydCBZb3VyTW9kZWxDbGFzcwoKYXBwID0gRmxhc2soX19uYW1lX18pCgojIExvYWQgdGhlIG1vZGVsCm1vZGVsID0gWW91ck1vZGVsQ2xhc3MoKQptb2RlbC5sb2FkX3N0YXRlX2RpY3QodG9yY2gubG9hZCgnbW9kZWwucHRoJykpCm1vZGVsLmV2YWwoKQoKQGFwcC5yb3V0ZSgnL3ByZWRpY3QnLCBtZXRob2RzPVsnUE9TVCddKQpkZWYgcHJlZGljdCgpOgogICAgZGF0YSA9IHJlcXVlc3QuZ2V0X2pzb24oZm9yY2U9VHJ1ZSkKICAgIGlucHV0cyA9IHRvcmNoLnRlbnNvcihkYXRhWydpbnB1dHMnXSkKICAgIHdpdGggdG9yY2gubm9fZ3JhZCgpOgogICAgICAgIG91dHB1dHMgPSBtb2RlbChpbnB1dHMpCiAgICByZXR1cm4ganNvbmlmeSh7J291dHB1dHMnOiBvdXRwdXRzLnRvbGlzdCgpfSkKCmlmIF9fbmFtZV9fID09ICdfX21haW5fXyc6CiAgICBhcHAucnVuKGRlYnVnPVRydWUp"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>from flask import Flask, request, jsonify
import torch
from your_model_file import YourModelClass

app = Flask(__name__)

# Load the model
model = YourModelClass()
model.load_state_dict(torch.load('model.pth'))
model.eval()

@app.route('/predict', methods=['POST'])
def predict():
    data = request.get_json(force=True)
    inputs = torch.tensor(data['inputs'])
    with torch.no_grad():
        outputs = model(inputs)
    return jsonify({'outputs': outputs.tolist()})

if __name__ == '__main__':
    app.run(debug=True)</pre></div><div class='content'></div><h2>Testing the API</h2>
<div class='content'><p>You can test the API using tools like <code>curl</code> or Postman.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y3VybCAtWCBQT1NUIC1IICJDb250ZW50LVR5cGU6IGFwcGxpY2F0aW9uL2pzb24iIC1kICd7ImlucHV0cyI6IFsxLjAsIDIuMCwgMy4wXX0nIGh0dHA6Ly8xMjcuMC4wLjE6NTAwMC9wcmVkaWN0"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>curl -X POST -H &quot;Content-Type: application/json&quot; -d '{&quot;inputs&quot;: [1.0, 2.0, 3.0]}' http://127.0.0.1:5000/predict</pre></div><div class='content'></div><h1>Deployment Tools</h1>
<div class='content'><p>Several tools can help you deploy your model more efficiently:</p>
<ul>
<li><strong>TorchServe</strong>: A flexible and easy-to-use tool for serving PyTorch models.</li>
<li><strong>Docker</strong>: Containerization tool that can package your application and its dependencies.</li>
<li><strong>Kubernetes</strong>: Orchestration tool for deploying, scaling, and managing containerized applications.</li>
</ul>
</div><h2>Using TorchServe</h2>
<div class='content'><p>TorchServe is a tool specifically designed for serving PyTorch models. It simplifies the process and provides features like logging, metrics, and multi-model serving.</p>
<h4>Installing TorchServe</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("cGlwIGluc3RhbGwgdG9yY2hzZXJ2ZSB0b3JjaC1tb2RlbC1hcmNoaXZlcg=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>pip install torchserve torch-model-archiver</pre></div><div class='content'><h4>Archiving the Model</h4>
<p>You need to create a model archive file (<code>.mar</code>) that TorchServe can use.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("dG9yY2gtbW9kZWwtYXJjaGl2ZXIgLS1tb2RlbC1uYW1lIG15X21vZGVsIC0tdmVyc2lvbiAxLjAgLS1zZXJpYWxpemVkLWZpbGUgbW9kZWwucHRoIC0taGFuZGxlciBoYW5kbGVyLnB5IC0tZXh0cmEtZmlsZXMgInlvdXJfbW9kZWxfZmlsZS5weSI="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>torch-model-archiver --model-name my_model --version 1.0 --serialized-file model.pth --handler handler.py --extra-files &quot;your_model_file.py&quot;</pre></div><div class='content'><h4>Starting TorchServe</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("dG9yY2hzZXJ2ZSAtLXN0YXJ0IC0tbmNzIC0tbW9kZWwtc3RvcmUgbW9kZWxfc3RvcmUgLS1tb2RlbHMgbXlfbW9kZWw9bXlfbW9kZWwubWFy"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>torchserve --start --ncs --model-store model_store --models my_model=my_model.mar</pre></div><div class='content'></div><h1>Conclusion</h1>
<div class='content'><p>Serving PyTorch models is a crucial step in deploying machine learning applications. By understanding how to serialize and deserialize models, create REST APIs with Flask, and use deployment tools like TorchServe, you can make your models available for real-world use. This section has provided you with the foundational knowledge and practical examples to get started with serving your PyTorch models.</p>
</div><div class='row navigation'>
	<div class='col-4'>
					<a href='exporting-models-with-torchscript'>&#x25C4;Exporting Models with TorchScript</a>
			</div>
	<div class='col-4 text-center'>
		<a href="./" class="title">Serving PyTorch Models</a>
	</div>
	<div class='col-4 text-end'>
					<a href='optimizing-for-inference'>Optimizing for Inference &#x25BA;</a>
			</div>
</div>

			</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Advertising</h1>
			<p>This space is reserved for advertising.</p>
			<p>If you want to be a sponsor, contact us to include links in this area: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Thank you for collaborating!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. All rights reserved</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir galetes per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Accept</a>
    <a href="/cookies">More Information</a>
</div>	

	</div>    
</body>
</html>
