<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generative Adversarial Networks (GANs)</title>

    <link rel="alternate" href="https://campusempresa.com/mod/pytorch/06-01-gans" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/mod/pytorch/06-01-gans" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/mod/pytorch/06-01-gans" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="/js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body >
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-12 col-md-6 p-2 p-md-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo-header_enterprise.png"></a>
			</h1>
		</div>
		<div class="col-12 col-md-6 p-2 p-md-0 text-end">
				<b id="lit_lang_es" class="px-2">EN</b>
	|
	<a href="https://campusempresa.com/mod/pytorch/06-01-gans" class="px-2">ES</a></b>
	|
	<a href="https://campusempresa.cat/mod/pytorch/06-01-gans" class="px-2">CA</a>
<br>
			<cite>Building today's and tomorrow's society</cite>
		</div>
	</div>
</div>
<div id="subheader" class="container-xxl">
	<div class="row">
		<div class="col-12 p-2 p-md-0 m-0 text-end">
			<a href="/objective">The Project</a> | 
<a href="/about">About Us</a> | 
<a href="/contribute">Contribute</a> | 
<a href="/donate">Donations</a> | 
<a href="/licence">License</a>
		</div>
	</div>
</div>

<div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
									<a href="./">Course Content</a>
					<span class="sep">|</span>
								<a href="/all/competencias">Technical Skills</a>
				<a href="/all/conocimientos">Knowledge</a>
				<a href="/all/soft_skills">Social Skills</a>
			</div>
		</div>
	</div>
</div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content">
								<div class='row navigation'>
	<div class='col-1 col-md-2'>
					<a href='05-04-gru-networks' title="Gated Recurrent Units (GRUs)">
				<span class="d-none d-md-inline">&#x25C4; Previous</span>
				<span class="d-inline d-md-none"><i class="bi bi-caret-left-square-fill"></i></span>
			</a>
			</div>
	<div class='col-10 col-md-8 text-center'>
					<a href="./"><h2 style="text-decoration:underline">Generative Adversarial Networks (GANs)</h2></a>
			</div>
	<div class='col-1 col-md-2 text-end'>
					<a href='06-02-reinforcement-learning' title="Reinforcement Learning with PyTorch">
				<span class="d-none d-md-inline">Next &#x25BA;</span>
				<span class="d-inline d-md-none"><i class="bi bi-caret-right-square-fill"></i></span>
			</a>
			</div>
</div>
<div class='content'><p>Generative Adversarial Networks (GANs) are a class of machine learning frameworks designed by Ian Goodfellow and his colleagues in 2014. GANs consist of two neural networks, the generator and the discriminator, which compete against each other in a zero-sum game. The generator creates data that mimics real data, while the discriminator evaluates the authenticity of the data. This competition drives both networks to improve over time.</p>
</div><h1><p>Key Concepts</p>
</h1>
<div class='content'></div><h2><ol>
<li>Generator</li>
</ol>
</h2>
<div class='content'><ul>
<li><strong>Purpose</strong>: To generate data that is indistinguishable from real data.</li>
<li><strong>Input</strong>: Random noise (usually from a normal distribution).</li>
<li><strong>Output</strong>: Synthetic data (e.g., images, text).</li>
</ul>
</div><h2><ol start="2">
<li>Discriminator</li>
</ol>
</h2>
<div class='content'><ul>
<li><strong>Purpose</strong>: To distinguish between real data and data generated by the generator.</li>
<li><strong>Input</strong>: Both real data and synthetic data.</li>
<li><strong>Output</strong>: Probability that the input data is real.</li>
</ul>
</div><h2><ol start="3">
<li>Adversarial Training</li>
</ol>
</h2>
<div class='content'><ul>
<li><strong>Objective</strong>: The generator tries to fool the discriminator, while the discriminator tries to correctly identify real vs. fake data.</li>
<li><strong>Loss Functions</strong>:
<ul>
<li><strong>Generator Loss</strong>: Measures how well the generator fools the discriminator.</li>
<li><strong>Discriminator Loss</strong>: Measures how well the discriminator distinguishes real from fake data.</li>
</ul>
</li>
</ul>
</div><h1><p>Practical Example: Building a Simple GAN</p>
</h1>
<div class='content'></div><h2><p>Step 1: Import Libraries</p>
</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("aW1wb3J0IHRvcmNoCmltcG9ydCB0b3JjaC5ubiBhcyBubgppbXBvcnQgdG9yY2gub3B0aW0gYXMgb3B0aW0KaW1wb3J0IHRvcmNodmlzaW9uCmltcG9ydCB0b3JjaHZpc2lvbi50cmFuc2Zvcm1zIGFzIHRyYW5zZm9ybXMKaW1wb3J0IG1hdHBsb3RsaWIucHlwbG90IGFzIHBsdAppbXBvcnQgbnVtcHkgYXMgbnA="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>import torch
import torch.nn as nn
import torch.optim as optim
import torchvision
import torchvision.transforms as transforms
import matplotlib.pyplot as plt
import numpy as np</pre></div><div class='content'></div><h2><p>Step 2: Define the Generator and Discriminator</p>
</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y2xhc3MgR2VuZXJhdG9yKG5uLk1vZHVsZSk6CiAgICBkZWYgX19pbml0X18oc2VsZiwgaW5wdXRfc2l6ZSwgaGlkZGVuX3NpemUsIG91dHB1dF9zaXplKToKICAgICAgICBzdXBlcihHZW5lcmF0b3IsIHNlbGYpLl9faW5pdF9fKCkKICAgICAgICBzZWxmLm1haW4gPSBubi5TZXF1ZW50aWFsKAogICAgICAgICAgICBubi5MaW5lYXIoaW5wdXRfc2l6ZSwgaGlkZGVuX3NpemUpLAogICAgICAgICAgICBubi5SZUxVKFRydWUpLAogICAgICAgICAgICBubi5MaW5lYXIoaGlkZGVuX3NpemUsIGhpZGRlbl9zaXplKSwKICAgICAgICAgICAgbm4uUmVMVShUcnVlKSwKICAgICAgICAgICAgbm4uTGluZWFyKGhpZGRlbl9zaXplLCBvdXRwdXRfc2l6ZSksCiAgICAgICAgICAgIG5uLlRhbmgoKQogICAgICAgICkKCiAgICBkZWYgZm9yd2FyZChzZWxmLCB4KToKICAgICAgICByZXR1cm4gc2VsZi5tYWluKHgpCgpjbGFzcyBEaXNjcmltaW5hdG9yKG5uLk1vZHVsZSk6CiAgICBkZWYgX19pbml0X18oc2VsZiwgaW5wdXRfc2l6ZSwgaGlkZGVuX3NpemUsIG91dHB1dF9zaXplKToKICAgICAgICBzdXBlcihEaXNjcmltaW5hdG9yLCBzZWxmKS5fX2luaXRfXygpCiAgICAgICAgc2VsZi5tYWluID0gbm4uU2VxdWVudGlhbCgKICAgICAgICAgICAgbm4uTGluZWFyKGlucHV0X3NpemUsIGhpZGRlbl9zaXplKSwKICAgICAgICAgICAgbm4uTGVha3lSZUxVKDAuMiwgaW5wbGFjZT1UcnVlKSwKICAgICAgICAgICAgbm4uTGluZWFyKGhpZGRlbl9zaXplLCBoaWRkZW5fc2l6ZSksCiAgICAgICAgICAgIG5uLkxlYWt5UmVMVSgwLjIsIGlucGxhY2U9VHJ1ZSksCiAgICAgICAgICAgIG5uLkxpbmVhcihoaWRkZW5fc2l6ZSwgb3V0cHV0X3NpemUpLAogICAgICAgICAgICBubi5TaWdtb2lkKCkKICAgICAgICApCgogICAgZGVmIGZvcndhcmQoc2VsZiwgeCk6CiAgICAgICAgcmV0dXJuIHNlbGYubWFpbih4KQ=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>class Generator(nn.Module):
    def __init__(self, input_size, hidden_size, output_size):
        super(Generator, self).__init__()
        self.main = nn.Sequential(
            nn.Linear(input_size, hidden_size),
            nn.ReLU(True),
            nn.Linear(hidden_size, hidden_size),
            nn.ReLU(True),
            nn.Linear(hidden_size, output_size),
            nn.Tanh()
        )

    def forward(self, x):
        return self.main(x)

class Discriminator(nn.Module):
    def __init__(self, input_size, hidden_size, output_size):
        super(Discriminator, self).__init__()
        self.main = nn.Sequential(
            nn.Linear(input_size, hidden_size),
            nn.LeakyReLU(0.2, inplace=True),
            nn.Linear(hidden_size, hidden_size),
            nn.LeakyReLU(0.2, inplace=True),
            nn.Linear(hidden_size, output_size),
            nn.Sigmoid()
        )

    def forward(self, x):
        return self.main(x)</pre></div><div class='content'></div><h2><p>Step 3: Initialize the Networks</p>
</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("aW5wdXRfc2l6ZSA9IDEwMApoaWRkZW5fc2l6ZSA9IDI1NgpvdXRwdXRfc2l6ZSA9IDc4NCAgIyBGb3IgTU5JU1QgZGF0YXNldCAoMjh4MjggaW1hZ2VzKQoKRyA9IEdlbmVyYXRvcihpbnB1dF9zaXplLCBoaWRkZW5fc2l6ZSwgb3V0cHV0X3NpemUpCkQgPSBEaXNjcmltaW5hdG9yKG91dHB1dF9zaXplLCBoaWRkZW5fc2l6ZSwgMSk="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>input_size = 100
hidden_size = 256
output_size = 784  # For MNIST dataset (28x28 images)

G = Generator(input_size, hidden_size, output_size)
D = Discriminator(output_size, hidden_size, 1)</pre></div><div class='content'></div><h2><p>Step 4: Define Loss Function and Optimizers</p>
</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y3JpdGVyaW9uID0gbm4uQkNFTG9zcygpCmxyID0gMC4wMDAyCgpvcHRpbWl6ZXJEID0gb3B0aW0uQWRhbShELnBhcmFtZXRlcnMoKSwgbHI9bHIpCm9wdGltaXplckcgPSBvcHRpbS5BZGFtKEcucGFyYW1ldGVycygpLCBscj1scik="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>criterion = nn.BCELoss()
lr = 0.0002

optimizerD = optim.Adam(D.parameters(), lr=lr)
optimizerG = optim.Adam(G.parameters(), lr=lr)</pre></div><div class='content'></div><h2><p>Step 5: Training Loop</p>
</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("bnVtX2Vwb2NocyA9IDEwMApiYXRjaF9zaXplID0gMTAwCnRyYW5zZm9ybSA9IHRyYW5zZm9ybXMuQ29tcG9zZShbCiAgICB0cmFuc2Zvcm1zLlRvVGVuc29yKCksCiAgICB0cmFuc2Zvcm1zLk5vcm1hbGl6ZSgoMC41LCksICgwLjUsKSkKXSkKCnRyYWluc2V0ID0gdG9yY2h2aXNpb24uZGF0YXNldHMuTU5JU1Qocm9vdD0nLi9kYXRhJywgdHJhaW49VHJ1ZSwgZG93bmxvYWQ9VHJ1ZSwgdHJhbnNmb3JtPXRyYW5zZm9ybSkKdHJhaW5sb2FkZXIgPSB0b3JjaC51dGlscy5kYXRhLkRhdGFMb2FkZXIodHJhaW5zZXQsIGJhdGNoX3NpemU9YmF0Y2hfc2l6ZSwgc2h1ZmZsZT1UcnVlKQoKZm9yIGVwb2NoIGluIHJhbmdlKG51bV9lcG9jaHMpOgogICAgZm9yIGksIChkYXRhLCBfKSBpbiBlbnVtZXJhdGUodHJhaW5sb2FkZXIpOgogICAgICAgICMgVHJhaW4gRGlzY3JpbWluYXRvcgogICAgICAgIEQuemVyb19ncmFkKCkKICAgICAgICByZWFsX2RhdGEgPSBkYXRhLnZpZXcoLTEsIDI4KjI4KQogICAgICAgIGJhdGNoX3NpemUgPSByZWFsX2RhdGEuc2l6ZSgwKQogICAgICAgIGxhYmVscyA9IHRvcmNoLm9uZXMoYmF0Y2hfc2l6ZSwgMSkKICAgICAgICBvdXRwdXQgPSBEKHJlYWxfZGF0YSkKICAgICAgICBsb3NzRF9yZWFsID0gY3JpdGVyaW9uKG91dHB1dCwgbGFiZWxzKQogICAgICAgIGxvc3NEX3JlYWwuYmFja3dhcmQoKQoKICAgICAgICBub2lzZSA9IHRvcmNoLnJhbmRuKGJhdGNoX3NpemUsIGlucHV0X3NpemUpCiAgICAgICAgZmFrZV9kYXRhID0gRyhub2lzZSkKICAgICAgICBsYWJlbHMgPSB0b3JjaC56ZXJvcyhiYXRjaF9zaXplLCAxKQogICAgICAgIG91dHB1dCA9IEQoZmFrZV9kYXRhLmRldGFjaCgpKQogICAgICAgIGxvc3NEX2Zha2UgPSBjcml0ZXJpb24ob3V0cHV0LCBsYWJlbHMpCiAgICAgICAgbG9zc0RfZmFrZS5iYWNrd2FyZCgpCiAgICAgICAgb3B0aW1pemVyRC5zdGVwKCkKCiAgICAgICAgIyBUcmFpbiBHZW5lcmF0b3IKICAgICAgICBHLnplcm9fZ3JhZCgpCiAgICAgICAgbGFiZWxzID0gdG9yY2gub25lcyhiYXRjaF9zaXplLCAxKQogICAgICAgIG91dHB1dCA9IEQoZmFrZV9kYXRhKQogICAgICAgIGxvc3NHID0gY3JpdGVyaW9uKG91dHB1dCwgbGFiZWxzKQogICAgICAgIGxvc3NHLmJhY2t3YXJkKCkKICAgICAgICBvcHRpbWl6ZXJHLnN0ZXAoKQoKICAgIHByaW50KGYnRXBvY2ggW3tlcG9jaCsxfS97bnVtX2Vwb2Noc31dLCBMb3NzIEQ6IHtsb3NzRF9yZWFsK2xvc3NEX2Zha2U6LjRmfSwgTG9zcyBHOiB7bG9zc0c6LjRmfScp"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>num_epochs = 100
batch_size = 100
transform = transforms.Compose([
    transforms.ToTensor(),
    transforms.Normalize((0.5,), (0.5,))
])

trainset = torchvision.datasets.MNIST(root='./data', train=True, download=True, transform=transform)
trainloader = torch.utils.data.DataLoader(trainset, batch_size=batch_size, shuffle=True)

for epoch in range(num_epochs):
    for i, (data, _) in enumerate(trainloader):
        # Train Discriminator
        D.zero_grad()
        real_data = data.view(-1, 28*28)
        batch_size = real_data.size(0)
        labels = torch.ones(batch_size, 1)
        output = D(real_data)
        lossD_real = criterion(output, labels)
        lossD_real.backward()

        noise = torch.randn(batch_size, input_size)
        fake_data = G(noise)
        labels = torch.zeros(batch_size, 1)
        output = D(fake_data.detach())
        lossD_fake = criterion(output, labels)
        lossD_fake.backward()
        optimizerD.step()

        # Train Generator
        G.zero_grad()
        labels = torch.ones(batch_size, 1)
        output = D(fake_data)
        lossG = criterion(output, labels)
        lossG.backward()
        optimizerG.step()

    print(f'Epoch [{epoch+1}/{num_epochs}], Loss D: {lossD_real+lossD_fake:.4f}, Loss G: {lossG:.4f}')</pre></div><div class='content'></div><h2><p>Step 6: Visualize Generated Data</p>
</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ZGVmIHNob3dfZ2VuZXJhdGVkX2ltYWdlcyhlcG9jaCk6CiAgICBub2lzZSA9IHRvcmNoLnJhbmRuKDY0LCBpbnB1dF9zaXplKQogICAgZmFrZV9pbWFnZXMgPSBHKG5vaXNlKS52aWV3KC0xLCAxLCAyOCwgMjgpCiAgICBncmlkID0gdG9yY2h2aXNpb24udXRpbHMubWFrZV9ncmlkKGZha2VfaW1hZ2VzLCBucm93PTgsIG5vcm1hbGl6ZT1UcnVlKQogICAgcGx0Lmltc2hvdyhucC50cmFuc3Bvc2UoZ3JpZC5kZXRhY2goKS5udW1weSgpLCAoMSwgMiwgMCkpKQogICAgcGx0LnRpdGxlKGYnRXBvY2gge2Vwb2NofScpCiAgICBwbHQuc2hvdygpCgpzaG93X2dlbmVyYXRlZF9pbWFnZXMobnVtX2Vwb2Nocyk="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>def show_generated_images(epoch):
    noise = torch.randn(64, input_size)
    fake_images = G(noise).view(-1, 1, 28, 28)
    grid = torchvision.utils.make_grid(fake_images, nrow=8, normalize=True)
    plt.imshow(np.transpose(grid.detach().numpy(), (1, 2, 0)))
    plt.title(f'Epoch {epoch}')
    plt.show()

show_generated_images(num_epochs)</pre></div><div class='content'></div><h1><p>Practical Exercises</p>
</h1>
<div class='content'></div><h2><p>Exercise 1: Modify the Generator and Discriminator</p>
</h2>
<div class='content'><ul>
<li><strong>Task</strong>: Add more layers to the generator and discriminator. Observe how the performance changes.</li>
<li><strong>Solution</strong>: Add additional <code>nn.Linear</code> and activation layers in the <code>Generator</code> and <code>Discriminator</code> classes.</li>
</ul>
</div><h2><p>Exercise 2: Experiment with Different Loss Functions</p>
</h2>
<div class='content'><ul>
<li><strong>Task</strong>: Try using different loss functions such as Mean Squared Error (MSE) instead of Binary Cross-Entropy (BCE).</li>
<li><strong>Solution</strong>: Replace <code>nn.BCELoss()</code> with <code>nn.MSELoss()</code> and adjust the labels accordingly.</li>
</ul>
</div><h2><p>Exercise 3: Implement Conditional GANs (cGANs)</p>
</h2>
<div class='content'><ul>
<li><strong>Task</strong>: Implement a conditional GAN where the generator and discriminator are conditioned on class labels.</li>
<li><strong>Solution</strong>: Concatenate the class labels with the input noise for the generator and with the real/fake data for the discriminator.</li>
</ul>
</div><h1><p>Common Mistakes and Tips</p>
</h1>
<div class='content'><ul>
<li><strong>Vanishing Gradients</strong>: Ensure that the learning rates are not too high, which can cause the gradients to vanish.</li>
<li><strong>Mode Collapse</strong>: The generator may produce limited varieties of outputs. Use techniques like mini-batch discrimination to mitigate this.</li>
<li><strong>Training Stability</strong>: GANs can be unstable to train. Regularly monitor the loss values and generated outputs to ensure the training is progressing as expected.</li>
</ul>
</div><h1><p>Conclusion</p>
</h1>
<div class='content'><p>In this section, we introduced GANs, a powerful framework for generating synthetic data. We covered the basic concepts, implemented a simple GAN, and provided exercises to deepen your understanding. In the next module, we will explore reinforcement learning with PyTorch, building on the knowledge gained here.</p>
</div><div class='row navigation'>
	<div class='col-1 col-md-2'>
					<a href='05-04-gru-networks' title="Gated Recurrent Units (GRUs)">
				<span class="d-none d-md-inline">&#x25C4; Previous</span>
				<span class="d-inline d-md-none"><i class="bi bi-caret-left-square-fill"></i></span>
			</a>
			</div>
	<div class='col-10 col-md-8 text-center'>
			</div>
	<div class='col-1 col-md-2 text-end'>
					<a href='06-02-reinforcement-learning' title="Reinforcement Learning with PyTorch">
				<span class="d-none d-md-inline">Next &#x25BA;</span>
				<span class="d-inline d-md-none"><i class="bi bi-caret-right-square-fill"></i></span>
			</a>
			</div>
</div>

			</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Advertising</h1>
			<p>This space is reserved for advertising.</p>
			<p>If you want to be a sponsor, contact us to include links in this area: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Thank you for collaborating!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. All rights reserved</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	We use cookies to improve your user experience and offer content tailored to your interests.
    <a href="#" id="btn_accept_cookies" class="button">Accept</a>
    <a href="/cookies">More Information</a>
</div>	

	</div>    
</body>
</html>
