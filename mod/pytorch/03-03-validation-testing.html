<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Validation and Testing</title>

    <link rel="alternate" href="https://campusempresa.com/mod/pytorch/03-03-validation-testing" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/mod/pytorch/03-03-validation-testing" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/mod/pytorch/03-03-validation-testing" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="/js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body >
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-12 col-md-8 p-2 p-md-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo-header_enterprise.png"></a>
			</h1>
		</div>
		<div class="col-12 col-md-4 p-2 p-md-0 text-end">
			<h2 id="main_title"><cite>Building today's and tomorrow's society</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-2 p-md-0 m-0 text-end">
													<b id="lit_lang_es" class="px-2">EN</b>
				|
				<a href="https://campusempresa.com/mod/pytorch/03-03-validation-testing" class="px-2">ES</a></b>
				|
				<a href="https://campusempresa.cat/mod/pytorch/03-03-validation-testing" class="px-2">CA</a>
					</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="/objective">The Project</a>
				<a href="/about">About Us</a>
				<a href="/contribute">Contribute</a>
				<a href="/donate">Donations</a>
				<a href="/licence">License</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content">
								<div class='row navigation'>
	<div class='col-2'>
					<a href='03-02-training-loop' title="Training Loop">&#x25C4;Previous</a>
			</div>
	<div class='col-8 text-center'>
					<a href="./"><h2 style="text-decoration:underline">Validation and Testing</h2></a>
			</div>
	<div class='col-2 text-end'>
					<a href='03-04-saving-loading-models' title="Saving and Loading Models">Next &#x25BA;</a>
			</div>
</div>
<div class='content'><p>In this section, we will cover the essential concepts and practical steps involved in validating and testing neural networks in PyTorch. Validation and testing are crucial steps in the machine learning pipeline to ensure that your model generalizes well to unseen data and performs as expected.</p>
</div><h1><p>Key Concepts</p>
</h1>
<div class='content'><ol>
<li><strong>Validation Set</strong>: A subset of the dataset used to tune hyperparameters and make decisions about the model architecture. It helps in preventing overfitting.</li>
<li><strong>Test Set</strong>: A separate subset of the dataset used to evaluate the final model's performance. It should not be used during the training or validation process.</li>
<li><strong>Overfitting</strong>: When a model performs well on the training data but poorly on the validation/test data.</li>
<li><strong>Underfitting</strong>: When a model performs poorly on both the training and validation/test data.</li>
</ol>
</div><h1><p>Steps for Validation and Testing</p>
</h1>
<div class='content'><ol>
<li><strong>Split the Dataset</strong>: Divide the dataset into training, validation, and test sets.</li>
<li><strong>Train the Model</strong>: Train the model using the training set.</li>
<li><strong>Validate the Model</strong>: Evaluate the model on the validation set to tune hyperparameters and make adjustments.</li>
<li><strong>Test the Model</strong>: Evaluate the final model on the test set to assess its performance.</li>
</ol>
</div><h1><p>Practical Example</p>
</h1>
<div class='content'><p>Let's walk through a practical example of how to perform validation and testing in PyTorch.</p>
</div><h2><p>Step 1: Import Libraries</p>
</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("aW1wb3J0IHRvcmNoCmltcG9ydCB0b3JjaC5ubiBhcyBubgppbXBvcnQgdG9yY2gub3B0aW0gYXMgb3B0aW0KZnJvbSB0b3JjaC51dGlscy5kYXRhIGltcG9ydCBEYXRhTG9hZGVyLCByYW5kb21fc3BsaXQKZnJvbSB0b3JjaHZpc2lvbiBpbXBvcnQgZGF0YXNldHMsIHRyYW5zZm9ybXM="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>import torch
import torch.nn as nn
import torch.optim as optim
from torch.utils.data import DataLoader, random_split
from torchvision import datasets, transforms</pre></div><div class='content'></div><h2><p>Step 2: Prepare the Dataset</p>
</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("IyBEZWZpbmUgdHJhbnNmb3JtYXRpb25zIGZvciB0aGUgZGF0YXNldAp0cmFuc2Zvcm0gPSB0cmFuc2Zvcm1zLkNvbXBvc2UoWwogICAgdHJhbnNmb3Jtcy5Ub1RlbnNvcigpLAogICAgdHJhbnNmb3Jtcy5Ob3JtYWxpemUoKDAuNSwpLCAoMC41LCkpCl0pCgojIExvYWQgdGhlIGRhdGFzZXQKZGF0YXNldCA9IGRhdGFzZXRzLk1OSVNUKHJvb3Q9Jy4vZGF0YScsIHRyYWluPVRydWUsIGRvd25sb2FkPVRydWUsIHRyYW5zZm9ybT10cmFuc2Zvcm0pCgojIFNwbGl0IHRoZSBkYXRhc2V0IGludG8gdHJhaW5pbmcsIHZhbGlkYXRpb24sIGFuZCB0ZXN0IHNldHMKdHJhaW5fc2l6ZSA9IGludCgwLjggKiBsZW4oZGF0YXNldCkpCnZhbF9zaXplID0gaW50KDAuMSAqIGxlbihkYXRhc2V0KSkKdGVzdF9zaXplID0gbGVuKGRhdGFzZXQpIC0gdHJhaW5fc2l6ZSAtIHZhbF9zaXplCgp0cmFpbl9kYXRhc2V0LCB2YWxfZGF0YXNldCwgdGVzdF9kYXRhc2V0ID0gcmFuZG9tX3NwbGl0KGRhdGFzZXQsIFt0cmFpbl9zaXplLCB2YWxfc2l6ZSwgdGVzdF9zaXplXSkKCiMgQ3JlYXRlIGRhdGEgbG9hZGVycwp0cmFpbl9sb2FkZXIgPSBEYXRhTG9hZGVyKHRyYWluX2RhdGFzZXQsIGJhdGNoX3NpemU9NjQsIHNodWZmbGU9VHJ1ZSkKdmFsX2xvYWRlciA9IERhdGFMb2FkZXIodmFsX2RhdGFzZXQsIGJhdGNoX3NpemU9NjQsIHNodWZmbGU9RmFsc2UpCnRlc3RfbG9hZGVyID0gRGF0YUxvYWRlcih0ZXN0X2RhdGFzZXQsIGJhdGNoX3NpemU9NjQsIHNodWZmbGU9RmFsc2Up"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'># Define transformations for the dataset
transform = transforms.Compose([
    transforms.ToTensor(),
    transforms.Normalize((0.5,), (0.5,))
])

# Load the dataset
dataset = datasets.MNIST(root='./data', train=True, download=True, transform=transform)

# Split the dataset into training, validation, and test sets
train_size = int(0.8 * len(dataset))
val_size = int(0.1 * len(dataset))
test_size = len(dataset) - train_size - val_size

train_dataset, val_dataset, test_dataset = random_split(dataset, [train_size, val_size, test_size])

# Create data loaders
train_loader = DataLoader(train_dataset, batch_size=64, shuffle=True)
val_loader = DataLoader(val_dataset, batch_size=64, shuffle=False)
test_loader = DataLoader(test_dataset, batch_size=64, shuffle=False)</pre></div><div class='content'></div><h2><p>Step 3: Define the Model</p>
</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y2xhc3MgU2ltcGxlTk4obm4uTW9kdWxlKToKICAgIGRlZiBfX2luaXRfXyhzZWxmKToKICAgICAgICBzdXBlcihTaW1wbGVOTiwgc2VsZikuX19pbml0X18oKQogICAgICAgIHNlbGYuZmMxID0gbm4uTGluZWFyKDI4KjI4LCAxMjgpCiAgICAgICAgc2VsZi5mYzIgPSBubi5MaW5lYXIoMTI4LCA2NCkKICAgICAgICBzZWxmLmZjMyA9IG5uLkxpbmVhcig2NCwgMTApCiAgICAKICAgIGRlZiBmb3J3YXJkKHNlbGYsIHgpOgogICAgICAgIHggPSB4LnZpZXcoLTEsIDI4KjI4KQogICAgICAgIHggPSB0b3JjaC5yZWx1KHNlbGYuZmMxKHgpKQogICAgICAgIHggPSB0b3JjaC5yZWx1KHNlbGYuZmMyKHgpKQogICAgICAgIHggPSBzZWxmLmZjMyh4KQogICAgICAgIHJldHVybiB4Cgptb2RlbCA9IFNpbXBsZU5OKCk="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>class SimpleNN(nn.Module):
    def __init__(self):
        super(SimpleNN, self).__init__()
        self.fc1 = nn.Linear(28*28, 128)
        self.fc2 = nn.Linear(128, 64)
        self.fc3 = nn.Linear(64, 10)
    
    def forward(self, x):
        x = x.view(-1, 28*28)
        x = torch.relu(self.fc1(x))
        x = torch.relu(self.fc2(x))
        x = self.fc3(x)
        return x

model = SimpleNN()</pre></div><div class='content'></div><h2><p>Step 4: Define Loss Function and Optimizer</p>
</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y3JpdGVyaW9uID0gbm4uQ3Jvc3NFbnRyb3B5TG9zcygpCm9wdGltaXplciA9IG9wdGltLkFkYW0obW9kZWwucGFyYW1ldGVycygpLCBscj0wLjAwMSk="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>criterion = nn.CrossEntropyLoss()
optimizer = optim.Adam(model.parameters(), lr=0.001)</pre></div><div class='content'></div><h2><p>Step 5: Train the Model</p>
</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("bnVtX2Vwb2NocyA9IDEwCgpmb3IgZXBvY2ggaW4gcmFuZ2UobnVtX2Vwb2Nocyk6CiAgICBtb2RlbC50cmFpbigpCiAgICBydW5uaW5nX2xvc3MgPSAwLjAKICAgIGZvciBpbWFnZXMsIGxhYmVscyBpbiB0cmFpbl9sb2FkZXI6CiAgICAgICAgb3B0aW1pemVyLnplcm9fZ3JhZCgpCiAgICAgICAgb3V0cHV0cyA9IG1vZGVsKGltYWdlcykKICAgICAgICBsb3NzID0gY3JpdGVyaW9uKG91dHB1dHMsIGxhYmVscykKICAgICAgICBsb3NzLmJhY2t3YXJkKCkKICAgICAgICBvcHRpbWl6ZXIuc3RlcCgpCiAgICAgICAgcnVubmluZ19sb3NzICs9IGxvc3MuaXRlbSgpCiAgICAKICAgIHByaW50KGYiRXBvY2ggW3tlcG9jaCsxfS97bnVtX2Vwb2Noc31dLCBMb3NzOiB7cnVubmluZ19sb3NzL2xlbih0cmFpbl9sb2FkZXIpOi40Zn0iKQ=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>num_epochs = 10

for epoch in range(num_epochs):
    model.train()
    running_loss = 0.0
    for images, labels in train_loader:
        optimizer.zero_grad()
        outputs = model(images)
        loss = criterion(outputs, labels)
        loss.backward()
        optimizer.step()
        running_loss += loss.item()
    
    print(f&quot;Epoch [{epoch+1}/{num_epochs}], Loss: {running_loss/len(train_loader):.4f}&quot;)</pre></div><div class='content'></div><h2><p>Step 6: Validate the Model</p>
</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("bW9kZWwuZXZhbCgpCnZhbF9sb3NzID0gMC4wCmNvcnJlY3QgPSAwCnRvdGFsID0gMAoKd2l0aCB0b3JjaC5ub19ncmFkKCk6CiAgICBmb3IgaW1hZ2VzLCBsYWJlbHMgaW4gdmFsX2xvYWRlcjoKICAgICAgICBvdXRwdXRzID0gbW9kZWwoaW1hZ2VzKQogICAgICAgIGxvc3MgPSBjcml0ZXJpb24ob3V0cHV0cywgbGFiZWxzKQogICAgICAgIHZhbF9sb3NzICs9IGxvc3MuaXRlbSgpCiAgICAgICAgXywgcHJlZGljdGVkID0gdG9yY2gubWF4KG91dHB1dHMuZGF0YSwgMSkKICAgICAgICB0b3RhbCArPSBsYWJlbHMuc2l6ZSgwKQogICAgICAgIGNvcnJlY3QgKz0gKHByZWRpY3RlZCA9PSBsYWJlbHMpLnN1bSgpLml0ZW0oKQoKcHJpbnQoZiJWYWxpZGF0aW9uIExvc3M6IHt2YWxfbG9zcy9sZW4odmFsX2xvYWRlcik6LjRmfSwgQWNjdXJhY3k6IHsxMDAgKiBjb3JyZWN0IC8gdG90YWw6LjJmfSUiKQ=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>model.eval()
val_loss = 0.0
correct = 0
total = 0

with torch.no_grad():
    for images, labels in val_loader:
        outputs = model(images)
        loss = criterion(outputs, labels)
        val_loss += loss.item()
        _, predicted = torch.max(outputs.data, 1)
        total += labels.size(0)
        correct += (predicted == labels).sum().item()

print(f&quot;Validation Loss: {val_loss/len(val_loader):.4f}, Accuracy: {100 * correct / total:.2f}%&quot;)</pre></div><div class='content'></div><h2><p>Step 7: Test the Model</p>
</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("bW9kZWwuZXZhbCgpCnRlc3RfbG9zcyA9IDAuMApjb3JyZWN0ID0gMAp0b3RhbCA9IDAKCndpdGggdG9yY2gubm9fZ3JhZCgpOgogICAgZm9yIGltYWdlcywgbGFiZWxzIGluIHRlc3RfbG9hZGVyOgogICAgICAgIG91dHB1dHMgPSBtb2RlbChpbWFnZXMpCiAgICAgICAgbG9zcyA9IGNyaXRlcmlvbihvdXRwdXRzLCBsYWJlbHMpCiAgICAgICAgdGVzdF9sb3NzICs9IGxvc3MuaXRlbSgpCiAgICAgICAgXywgcHJlZGljdGVkID0gdG9yY2gubWF4KG91dHB1dHMuZGF0YSwgMSkKICAgICAgICB0b3RhbCArPSBsYWJlbHMuc2l6ZSgwKQogICAgICAgIGNvcnJlY3QgKz0gKHByZWRpY3RlZCA9PSBsYWJlbHMpLnN1bSgpLml0ZW0oKQoKcHJpbnQoZiJUZXN0IExvc3M6IHt0ZXN0X2xvc3MvbGVuKHRlc3RfbG9hZGVyKTouNGZ9LCBBY2N1cmFjeTogezEwMCAqIGNvcnJlY3QgLyB0b3RhbDouMmZ9JSIp"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>model.eval()
test_loss = 0.0
correct = 0
total = 0

with torch.no_grad():
    for images, labels in test_loader:
        outputs = model(images)
        loss = criterion(outputs, labels)
        test_loss += loss.item()
        _, predicted = torch.max(outputs.data, 1)
        total += labels.size(0)
        correct += (predicted == labels).sum().item()

print(f&quot;Test Loss: {test_loss/len(test_loader):.4f}, Accuracy: {100 * correct / total:.2f}%&quot;)</pre></div><div class='content'></div><h1><p>Practical Exercises</p>
</h1>
<div class='content'></div><h2><p>Exercise 1: Implement Early Stopping</p>
</h2>
<div class='content'><p><strong>Task</strong>: Modify the training loop to include early stopping based on the validation loss.</p>
<p><strong>Solution</strong>:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ZWFybHlfc3RvcHBpbmdfcGF0aWVuY2UgPSAzCmJlc3RfdmFsX2xvc3MgPSBmbG9hdCgnaW5mJykKcGF0aWVuY2VfY291bnRlciA9IDAKCmZvciBlcG9jaCBpbiByYW5nZShudW1fZXBvY2hzKToKICAgIG1vZGVsLnRyYWluKCkKICAgIHJ1bm5pbmdfbG9zcyA9IDAuMAogICAgZm9yIGltYWdlcywgbGFiZWxzIGluIHRyYWluX2xvYWRlcjoKICAgICAgICBvcHRpbWl6ZXIuemVyb19ncmFkKCkKICAgICAgICBvdXRwdXRzID0gbW9kZWwoaW1hZ2VzKQogICAgICAgIGxvc3MgPSBjcml0ZXJpb24ob3V0cHV0cywgbGFiZWxzKQogICAgICAgIGxvc3MuYmFja3dhcmQoKQogICAgICAgIG9wdGltaXplci5zdGVwKCkKICAgICAgICBydW5uaW5nX2xvc3MgKz0gbG9zcy5pdGVtKCkKICAgIAogICAgbW9kZWwuZXZhbCgpCiAgICB2YWxfbG9zcyA9IDAuMAogICAgd2l0aCB0b3JjaC5ub19ncmFkKCk6CiAgICAgICAgZm9yIGltYWdlcywgbGFiZWxzIGluIHZhbF9sb2FkZXI6CiAgICAgICAgICAgIG91dHB1dHMgPSBtb2RlbChpbWFnZXMpCiAgICAgICAgICAgIGxvc3MgPSBjcml0ZXJpb24ob3V0cHV0cywgbGFiZWxzKQogICAgICAgICAgICB2YWxfbG9zcyArPSBsb3NzLml0ZW0oKQogICAgCiAgICB2YWxfbG9zcyAvPSBsZW4odmFsX2xvYWRlcikKICAgIHByaW50KGYiRXBvY2ggW3tlcG9jaCsxfS97bnVtX2Vwb2Noc31dLCBMb3NzOiB7cnVubmluZ19sb3NzL2xlbih0cmFpbl9sb2FkZXIpOi40Zn0sIFZhbGlkYXRpb24gTG9zczoge3ZhbF9sb3NzOi40Zn0iKQogICAgCiAgICBpZiB2YWxfbG9zcyA8IGJlc3RfdmFsX2xvc3M6CiAgICAgICAgYmVzdF92YWxfbG9zcyA9IHZhbF9sb3NzCiAgICAgICAgcGF0aWVuY2VfY291bnRlciA9IDAKICAgIGVsc2U6CiAgICAgICAgcGF0aWVuY2VfY291bnRlciArPSAxCiAgICAKICAgIGlmIHBhdGllbmNlX2NvdW50ZXIgPj0gZWFybHlfc3RvcHBpbmdfcGF0aWVuY2U6CiAgICAgICAgcHJpbnQoIkVhcmx5IHN0b3BwaW5nIHRyaWdnZXJlZCIpCiAgICAgICAgYnJlYWs="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>early_stopping_patience = 3
best_val_loss = float('inf')
patience_counter = 0

for epoch in range(num_epochs):
    model.train()
    running_loss = 0.0
    for images, labels in train_loader:
        optimizer.zero_grad()
        outputs = model(images)
        loss = criterion(outputs, labels)
        loss.backward()
        optimizer.step()
        running_loss += loss.item()
    
    model.eval()
    val_loss = 0.0
    with torch.no_grad():
        for images, labels in val_loader:
            outputs = model(images)
            loss = criterion(outputs, labels)
            val_loss += loss.item()
    
    val_loss /= len(val_loader)
    print(f&quot;Epoch [{epoch+1}/{num_epochs}], Loss: {running_loss/len(train_loader):.4f}, Validation Loss: {val_loss:.4f}&quot;)
    
    if val_loss &lt; best_val_loss:
        best_val_loss = val_loss
        patience_counter = 0
    else:
        patience_counter += 1
    
    if patience_counter &gt;= early_stopping_patience:
        print(&quot;Early stopping triggered&quot;)
        break</pre></div><div class='content'></div><h2><p>Exercise 2: Implement K-Fold Cross-Validation</p>
</h2>
<div class='content'><p><strong>Task</strong>: Implement K-Fold Cross-Validation to evaluate the model's performance.</p>
<p><strong>Solution</strong>:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ZnJvbSBza2xlYXJuLm1vZGVsX3NlbGVjdGlvbiBpbXBvcnQgS0ZvbGQKCmtfZm9sZHMgPSA1CnJlc3VsdHMgPSB7fQoKa2ZvbGQgPSBLRm9sZChuX3NwbGl0cz1rX2ZvbGRzLCBzaHVmZmxlPVRydWUpCgpmb3IgZm9sZCwgKHRyYWluX2lkcywgdmFsX2lkcykgaW4gZW51bWVyYXRlKGtmb2xkLnNwbGl0KGRhdGFzZXQpKToKICAgIHByaW50KGYnRk9MRCB7Zm9sZH0nKQogICAgcHJpbnQoJy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tJykKICAgIAogICAgdHJhaW5fc3Vic2FtcGxlciA9IHRvcmNoLnV0aWxzLmRhdGEuU3Vic2V0UmFuZG9tU2FtcGxlcih0cmFpbl9pZHMpCiAgICB2YWxfc3Vic2FtcGxlciA9IHRvcmNoLnV0aWxzLmRhdGEuU3Vic2V0UmFuZG9tU2FtcGxlcih2YWxfaWRzKQogICAgCiAgICB0cmFpbl9sb2FkZXIgPSBEYXRhTG9hZGVyKGRhdGFzZXQsIGJhdGNoX3NpemU9NjQsIHNhbXBsZXI9dHJhaW5fc3Vic2FtcGxlcikKICAgIHZhbF9sb2FkZXIgPSBEYXRhTG9hZGVyKGRhdGFzZXQsIGJhdGNoX3NpemU9NjQsIHNhbXBsZXI9dmFsX3N1YnNhbXBsZXIpCiAgICAKICAgIG1vZGVsID0gU2ltcGxlTk4oKQogICAgb3B0aW1pemVyID0gb3B0aW0uQWRhbShtb2RlbC5wYXJhbWV0ZXJzKCksIGxyPTAuMDAxKQogICAgCiAgICBmb3IgZXBvY2ggaW4gcmFuZ2UobnVtX2Vwb2Nocyk6CiAgICAgICAgbW9kZWwudHJhaW4oKQogICAgICAgIHJ1bm5pbmdfbG9zcyA9IDAuMAogICAgICAgIGZvciBpbWFnZXMsIGxhYmVscyBpbiB0cmFpbl9sb2FkZXI6CiAgICAgICAgICAgIG9wdGltaXplci56ZXJvX2dyYWQoKQogICAgICAgICAgICBvdXRwdXRzID0gbW9kZWwoaW1hZ2VzKQogICAgICAgICAgICBsb3NzID0gY3JpdGVyaW9uKG91dHB1dHMsIGxhYmVscykKICAgICAgICAgICAgbG9zcy5iYWNrd2FyZCgpCiAgICAgICAgICAgIG9wdGltaXplci5zdGVwKCkKICAgICAgICAgICAgcnVubmluZ19sb3NzICs9IGxvc3MuaXRlbSgpCiAgICAgICAgCiAgICAgICAgbW9kZWwuZXZhbCgpCiAgICAgICAgdmFsX2xvc3MgPSAwLjAKICAgICAgICBjb3JyZWN0ID0gMAogICAgICAgIHRvdGFsID0gMAogICAgICAgIHdpdGggdG9yY2gubm9fZ3JhZCgpOgogICAgICAgICAgICBmb3IgaW1hZ2VzLCBsYWJlbHMgaW4gdmFsX2xvYWRlcjoKICAgICAgICAgICAgICAgIG91dHB1dHMgPSBtb2RlbChpbWFnZXMpCiAgICAgICAgICAgICAgICBsb3NzID0gY3JpdGVyaW9uKG91dHB1dHMsIGxhYmVscykKICAgICAgICAgICAgICAgIHZhbF9sb3NzICs9IGxvc3MuaXRlbSgpCiAgICAgICAgICAgICAgICBfLCBwcmVkaWN0ZWQgPSB0b3JjaC5tYXgob3V0cHV0cy5kYXRhLCAxKQogICAgICAgICAgICAgICAgdG90YWwgKz0gbGFiZWxzLnNpemUoMCkKICAgICAgICAgICAgICAgIGNvcnJlY3QgKz0gKHByZWRpY3RlZCA9PSBsYWJlbHMpLnN1bSgpLml0ZW0oKQogICAgICAgIAogICAgICAgIHZhbF9sb3NzIC89IGxlbih2YWxfbG9hZGVyKQogICAgICAgIGFjY3VyYWN5ID0gMTAwICogY29ycmVjdCAvIHRvdGFsCiAgICAgICAgcHJpbnQoZiJFcG9jaCBbe2Vwb2NoKzF9L3tudW1fZXBvY2hzfV0sIExvc3M6IHtydW5uaW5nX2xvc3MvbGVuKHRyYWluX2xvYWRlcik6LjRmfSwgVmFsaWRhdGlvbiBMb3NzOiB7dmFsX2xvc3M6LjRmfSwgQWNjdXJhY3k6IHthY2N1cmFjeTouMmZ9JSIpCiAgICAKICAgIHJlc3VsdHNbZm9sZF0gPSBhY2N1cmFjeQoKcHJpbnQoZidLLUZvbGQgQ3Jvc3MtVmFsaWRhdGlvbiByZXN1bHRzOiB7cmVzdWx0c30nKQpwcmludChmJ0F2ZXJhZ2UgQWNjdXJhY3k6IHtzdW0ocmVzdWx0cy52YWx1ZXMoKSkvbGVuKHJlc3VsdHMudmFsdWVzKCkpOi4yZn0lJyk="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>from sklearn.model_selection import KFold

k_folds = 5
results = {}

kfold = KFold(n_splits=k_folds, shuffle=True)

for fold, (train_ids, val_ids) in enumerate(kfold.split(dataset)):
    print(f'FOLD {fold}')
    print('--------------------------------')
    
    train_subsampler = torch.utils.data.SubsetRandomSampler(train_ids)
    val_subsampler = torch.utils.data.SubsetRandomSampler(val_ids)
    
    train_loader = DataLoader(dataset, batch_size=64, sampler=train_subsampler)
    val_loader = DataLoader(dataset, batch_size=64, sampler=val_subsampler)
    
    model = SimpleNN()
    optimizer = optim.Adam(model.parameters(), lr=0.001)
    
    for epoch in range(num_epochs):
        model.train()
        running_loss = 0.0
        for images, labels in train_loader:
            optimizer.zero_grad()
            outputs = model(images)
            loss = criterion(outputs, labels)
            loss.backward()
            optimizer.step()
            running_loss += loss.item()
        
        model.eval()
        val_loss = 0.0
        correct = 0
        total = 0
        with torch.no_grad():
            for images, labels in val_loader:
                outputs = model(images)
                loss = criterion(outputs, labels)
                val_loss += loss.item()
                _, predicted = torch.max(outputs.data, 1)
                total += labels.size(0)
                correct += (predicted == labels).sum().item()
        
        val_loss /= len(val_loader)
        accuracy = 100 * correct / total
        print(f&quot;Epoch [{epoch+1}/{num_epochs}], Loss: {running_loss/len(train_loader):.4f}, Validation Loss: {val_loss:.4f}, Accuracy: {accuracy:.2f}%&quot;)
    
    results[fold] = accuracy

print(f'K-Fold Cross-Validation results: {results}')
print(f'Average Accuracy: {sum(results.values())/len(results.values()):.2f}%')</pre></div><div class='content'></div><h1><p>Summary</p>
</h1>
<div class='content'><p>In this section, we covered the importance of validation and testing in the machine learning pipeline. We walked through a practical example of how to split the dataset, train the model, validate it, and finally test it. We also provided exercises to implement early stopping and K-Fold Cross-Validation to further solidify your understanding.</p>
<p>In the next section, we will delve into saving and loading models, which is crucial for deploying your trained models in real-world applications.</p>
</div><div class='row navigation'>
	<div class='col-2'>
					<a href='03-02-training-loop' title="Training Loop">&#x25C4;Previous</a>
			</div>
	<div class='col-8 text-center'>
			</div>
	<div class='col-2 text-end'>
					<a href='03-04-saving-loading-models' title="Saving and Loading Models">Next &#x25BA;</a>
			</div>
</div>

			</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Advertising</h1>
			<p>This space is reserved for advertising.</p>
			<p>If you want to be a sponsor, contact us to include links in this area: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Thank you for collaborating!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. All rights reserved</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir galetes per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Accept</a>
    <a href="/cookies">More Information</a>
</div>	

	</div>    
</body>
</html>
