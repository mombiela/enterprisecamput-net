<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Environment Mapping</title>

    <link rel="alternate" href="https://campusempresa.com/mod/open_gl/06-04-environment-mapping" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/mod/open_gl/06-04-environment-mapping" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/mod/open_gl/06-04-environment-mapping" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="/js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body >
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-12 col-md-8 p-2 p-md-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo-header_enterprise.png"></a>
			</h1>
		</div>
		<div class="col-12 col-md-4 p-2 p-md-0 text-end">
			<h2 id="main_title"><cite>Building today's and tomorrow's society</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-2 p-md-0 m-0 text-end">
													<b id="lit_lang_es" class="px-2">EN</b>
				|
				<a href="https://campusempresa.com/mod/open_gl/06-04-environment-mapping" class="px-2">ES</a></b>
				|
				<a href="https://campusempresa.cat/mod/open_gl/06-04-environment-mapping" class="px-2">CA</a>
					</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="/objective">The Project</a>
				<a href="/about">About Us</a>
				<a href="/contribute">Contribute</a>
				<a href="/donate">Donations</a>
				<a href="/licence">License</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content">
								<div class='row navigation'>
	<div class='col-2'>
					<a href='06-03-shadow-mapping' title="Shadow Mapping">&#x25C4;Previous</a>
			</div>
	<div class='col-8 text-center'>
					<a href="./"><h2 style="text-decoration:underline">Environment Mapping</h2></a>
			</div>
	<div class='col-2 text-end'>
					<a href='07-01-compute-shaders' title="Compute Shaders">Next &#x25BA;</a>
			</div>
</div>
<div class='content'><p>Environment mapping is a technique used in computer graphics to simulate the appearance of reflective surfaces. It creates the illusion that an object is reflecting its surroundings, which can significantly enhance the realism of a scene. This technique is commonly used for rendering shiny objects like metals, water surfaces, and glass.</p>
</div><h1><p>Key Concepts</p>
</h1>
<div class='content'><ol>
<li><strong>Reflection Vectors</strong>: Calculate the reflection vector based on the view direction and the surface normal.</li>
<li><strong>Environment Maps</strong>: Use textures that represent the surrounding environment. These can be in the form of:
<ul>
<li><strong>Cube Maps</strong>: Six textures representing the faces of a cube.</li>
<li><strong>Spherical Maps</strong>: A single texture representing the environment in a spherical projection.</li>
</ul>
</li>
<li><strong>Texture Sampling</strong>: Sample the environment map using the reflection vector to determine the color of the reflective surface.</li>
</ol>
</div><h1><p>Steps to Implement Environment Mapping</p>
</h1>
<div class='content'></div><h2><ol>
<li>Create and Load Environment Maps</li>
</ol>
</h2>
<div class='content'><p>First, you need to create or load an environment map. For simplicity, we'll use a cube map in this example.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("R0x1aW50IGxvYWRDdWJlTWFwKHN0ZDo6dmVjdG9yPHN0ZDo6c3RyaW5nPiBmYWNlcykgewogICAgR0x1aW50IHRleHR1cmVJRDsKICAgIGdsR2VuVGV4dHVyZXMoMSwgJnRleHR1cmVJRCk7CiAgICBnbEJpbmRUZXh0dXJlKEdMX1RFWFRVUkVfQ1VCRV9NQVAsIHRleHR1cmVJRCk7CgogICAgaW50IHdpZHRoLCBoZWlnaHQsIG5yQ2hhbm5lbHM7CiAgICBmb3IgKHVuc2lnbmVkIGludCBpID0gMDsgaSA8IGZhY2VzLnNpemUoKTsgaSsrKSB7CiAgICAgICAgdW5zaWduZWQgY2hhciAqZGF0YSA9IHN0YmlfbG9hZChmYWNlc1tpXS5jX3N0cigpLCAmd2lkdGgsICZoZWlnaHQsICZuckNoYW5uZWxzLCAwKTsKICAgICAgICBpZiAoZGF0YSkgewogICAgICAgICAgICBnbFRleEltYWdlMkQoR0xfVEVYVFVSRV9DVUJFX01BUF9QT1NJVElWRV9YICsgaSwgCiAgICAgICAgICAgICAgICAgICAgICAgICAwLCBHTF9SR0IsIHdpZHRoLCBoZWlnaHQsIDAsIEdMX1JHQiwgR0xfVU5TSUdORURfQllURSwgZGF0YSk7CiAgICAgICAgICAgIHN0YmlfaW1hZ2VfZnJlZShkYXRhKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBzdGQ6OmNvdXQgPDwgIkN1YmVtYXAgdGV4dHVyZSBmYWlsZWQgdG8gbG9hZCBhdCBwYXRoOiAiIDw8IGZhY2VzW2ldIDw8IHN0ZDo6ZW5kbDsKICAgICAgICAgICAgc3RiaV9pbWFnZV9mcmVlKGRhdGEpOwogICAgICAgIH0KICAgIH0KICAgIGdsVGV4UGFyYW1ldGVyaShHTF9URVhUVVJFX0NVQkVfTUFQLCBHTF9URVhUVVJFX01JTl9GSUxURVIsIEdMX0xJTkVBUik7CiAgICBnbFRleFBhcmFtZXRlcmkoR0xfVEVYVFVSRV9DVUJFX01BUCwgR0xfVEVYVFVSRV9NQUdfRklMVEVSLCBHTF9MSU5FQVIpOwogICAgZ2xUZXhQYXJhbWV0ZXJpKEdMX1RFWFRVUkVfQ1VCRV9NQVAsIEdMX1RFWFRVUkVfV1JBUF9TLCBHTF9DTEFNUF9UT19FREdFKTsKICAgIGdsVGV4UGFyYW1ldGVyaShHTF9URVhUVVJFX0NVQkVfTUFQLCBHTF9URVhUVVJFX1dSQVBfVCwgR0xfQ0xBTVBfVE9fRURHRSk7CiAgICBnbFRleFBhcmFtZXRlcmkoR0xfVEVYVFVSRV9DVUJFX01BUCwgR0xfVEVYVFVSRV9XUkFQX1IsIEdMX0NMQU1QX1RPX0VER0UpOwoKICAgIHJldHVybiB0ZXh0dXJlSUQ7Cn0="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>GLuint loadCubeMap(std::vector&lt;std::string&gt; faces) {
    GLuint textureID;
    glGenTextures(1, &amp;textureID);
    glBindTexture(GL_TEXTURE_CUBE_MAP, textureID);

    int width, height, nrChannels;
    for (unsigned int i = 0; i &lt; faces.size(); i++) {
        unsigned char *data = stbi_load(faces[i].c_str(), &amp;width, &amp;height, &amp;nrChannels, 0);
        if (data) {
            glTexImage2D(GL_TEXTURE_CUBE_MAP_POSITIVE_X + i, 
                         0, GL_RGB, width, height, 0, GL_RGB, GL_UNSIGNED_BYTE, data);
            stbi_image_free(data);
        } else {
            std::cout &lt;&lt; &quot;Cubemap texture failed to load at path: &quot; &lt;&lt; faces[i] &lt;&lt; std::endl;
            stbi_image_free(data);
        }
    }
    glTexParameteri(GL_TEXTURE_CUBE_MAP, GL_TEXTURE_MIN_FILTER, GL_LINEAR);
    glTexParameteri(GL_TEXTURE_CUBE_MAP, GL_TEXTURE_MAG_FILTER, GL_LINEAR);
    glTexParameteri(GL_TEXTURE_CUBE_MAP, GL_TEXTURE_WRAP_S, GL_CLAMP_TO_EDGE);
    glTexParameteri(GL_TEXTURE_CUBE_MAP, GL_TEXTURE_WRAP_T, GL_CLAMP_TO_EDGE);
    glTexParameteri(GL_TEXTURE_CUBE_MAP, GL_TEXTURE_WRAP_R, GL_CLAMP_TO_EDGE);

    return textureID;
}</pre></div><div class='content'></div><h2><ol start="2">
<li>Set Up Shaders</li>
</ol>
</h2>
<div class='content'><p>You need shaders to handle the reflection calculations and texture sampling.</p>
<p><strong>Vertex Shader:</strong></p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("I3ZlcnNpb24gMzMwIGNvcmUKbGF5b3V0KGxvY2F0aW9uID0gMCkgaW4gdmVjMyBhUG9zOwpsYXlvdXQobG9jYXRpb24gPSAxKSBpbiB2ZWMzIGFOb3JtYWw7CgpvdXQgdmVjMyBGcmFnUG9zOwpvdXQgdmVjMyBOb3JtYWw7Cgp1bmlmb3JtIG1hdDQgbW9kZWw7CnVuaWZvcm0gbWF0NCB2aWV3Owp1bmlmb3JtIG1hdDQgcHJvamVjdGlvbjsKCnZvaWQgbWFpbigpIHsKICAgIEZyYWdQb3MgPSB2ZWMzKG1vZGVsICogdmVjNChhUG9zLCAxLjApKTsKICAgIE5vcm1hbCA9IG1hdDModHJhbnNwb3NlKGludmVyc2UobW9kZWwpKSkgKiBhTm9ybWFsOyAgCiAgICBnbF9Qb3NpdGlvbiA9IHByb2plY3Rpb24gKiB2aWV3ICogdmVjNChGcmFnUG9zLCAxLjApOwp9"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>#version 330 core
layout(location = 0) in vec3 aPos;
layout(location = 1) in vec3 aNormal;

out vec3 FragPos;
out vec3 Normal;

uniform mat4 model;
uniform mat4 view;
uniform mat4 projection;

void main() {
    FragPos = vec3(model * vec4(aPos, 1.0));
    Normal = mat3(transpose(inverse(model))) * aNormal;  
    gl_Position = projection * view * vec4(FragPos, 1.0);
}</pre></div><div class='content'><p><strong>Fragment Shader:</strong></p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("I3ZlcnNpb24gMzMwIGNvcmUKb3V0IHZlYzQgRnJhZ0NvbG9yOwoKaW4gdmVjMyBGcmFnUG9zOwppbiB2ZWMzIE5vcm1hbDsKCnVuaWZvcm0gc2FtcGxlckN1YmUgc2t5Ym94Owp1bmlmb3JtIHZlYzMgY2FtZXJhUG9zOwoKdm9pZCBtYWluKCkgewogICAgdmVjMyBJID0gbm9ybWFsaXplKEZyYWdQb3MgLSBjYW1lcmFQb3MpOwogICAgdmVjMyBSID0gcmVmbGVjdChJLCBub3JtYWxpemUoTm9ybWFsKSk7CiAgICBGcmFnQ29sb3IgPSB0ZXh0dXJlKHNreWJveCwgUik7Cn0="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>#version 330 core
out vec4 FragColor;

in vec3 FragPos;
in vec3 Normal;

uniform samplerCube skybox;
uniform vec3 cameraPos;

void main() {
    vec3 I = normalize(FragPos - cameraPos);
    vec3 R = reflect(I, normalize(Normal));
    FragColor = texture(skybox, R);
}</pre></div><div class='content'></div><h2><ol start="3">
<li>Render the Scene</li>
</ol>
</h2>
<div class='content'><p>In your rendering loop, bind the cube map texture and set the necessary uniforms.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Ly8gTG9hZCB0aGUgY3ViZSBtYXAKc3RkOjp2ZWN0b3I8c3RkOjpzdHJpbmc+IGZhY2VzID0gewogICAgInJpZ2h0LmpwZyIsICJsZWZ0LmpwZyIsICJ0b3AuanBnIiwgImJvdHRvbS5qcGciLCAiZnJvbnQuanBnIiwgImJhY2suanBnIgp9OwpHTHVpbnQgY3ViZW1hcFRleHR1cmUgPSBsb2FkQ3ViZU1hcChmYWNlcyk7CgovLyBJbiB0aGUgcmVuZGVyIGxvb3AKZ2xVc2VQcm9ncmFtKHNoYWRlclByb2dyYW0pOwpnbFVuaWZvcm0zZnYoZ2xHZXRVbmlmb3JtTG9jYXRpb24oc2hhZGVyUHJvZ3JhbSwgImNhbWVyYVBvcyIpLCAxLCAmY2FtZXJhUG9zWzBdKTsKZ2xBY3RpdmVUZXh0dXJlKEdMX1RFWFRVUkUwKTsKZ2xCaW5kVGV4dHVyZShHTF9URVhUVVJFX0NVQkVfTUFQLCBjdWJlbWFwVGV4dHVyZSk7CmdsVW5pZm9ybTFpKGdsR2V0VW5pZm9ybUxvY2F0aW9uKHNoYWRlclByb2dyYW0sICJza3lib3giKSwgMCk7CgovLyBSZW5kZXIgeW91ciByZWZsZWN0aXZlIG9iamVjdA=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>// Load the cube map
std::vector&lt;std::string&gt; faces = {
    &quot;right.jpg&quot;, &quot;left.jpg&quot;, &quot;top.jpg&quot;, &quot;bottom.jpg&quot;, &quot;front.jpg&quot;, &quot;back.jpg&quot;
};
GLuint cubemapTexture = loadCubeMap(faces);

// In the render loop
glUseProgram(shaderProgram);
glUniform3fv(glGetUniformLocation(shaderProgram, &quot;cameraPos&quot;), 1, &amp;cameraPos[0]);
glActiveTexture(GL_TEXTURE0);
glBindTexture(GL_TEXTURE_CUBE_MAP, cubemapTexture);
glUniform1i(glGetUniformLocation(shaderProgram, &quot;skybox&quot;), 0);

// Render your reflective object</pre></div><div class='content'></div><h1><p>Practical Exercise</p>
</h1>
<div class='content'></div><h2><p>Task</p>
</h2>
<div class='content'><ol>
<li>Create a cube map texture using six images representing the environment.</li>
<li>Implement the vertex and fragment shaders provided above.</li>
<li>Render a reflective sphere in the scene using the environment map.</li>
</ol>
</div><h2><p>Solution</p>
</h2>
<div class='content'><ol>
<li><strong>Load the Cube Map:</strong></li>
</ol>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("c3RkOjp2ZWN0b3I8c3RkOjpzdHJpbmc+IGZhY2VzID0gewogICAgInJpZ2h0LmpwZyIsICJsZWZ0LmpwZyIsICJ0b3AuanBnIiwgImJvdHRvbS5qcGciLCAiZnJvbnQuanBnIiwgImJhY2suanBnIgp9OwpHTHVpbnQgY3ViZW1hcFRleHR1cmUgPSBsb2FkQ3ViZU1hcChmYWNlcyk7"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>std::vector&lt;std::string&gt; faces = {
    &quot;right.jpg&quot;, &quot;left.jpg&quot;, &quot;top.jpg&quot;, &quot;bottom.jpg&quot;, &quot;front.jpg&quot;, &quot;back.jpg&quot;
};
GLuint cubemapTexture = loadCubeMap(faces);</pre></div><div class='content'><ol start="2">
<li><strong>Set Up Shaders:</strong></li>
</ol>
<p>Ensure your shaders are compiled and linked correctly.</p>
<ol start="3">
<li><strong>Render the Reflective Sphere:</strong></li>
</ol>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Z2xVc2VQcm9ncmFtKHNoYWRlclByb2dyYW0pOwpnbFVuaWZvcm0zZnYoZ2xHZXRVbmlmb3JtTG9jYXRpb24oc2hhZGVyUHJvZ3JhbSwgImNhbWVyYVBvcyIpLCAxLCAmY2FtZXJhUG9zWzBdKTsKZ2xBY3RpdmVUZXh0dXJlKEdMX1RFWFRVUkUwKTsKZ2xCaW5kVGV4dHVyZShHTF9URVhUVVJFX0NVQkVfTUFQLCBjdWJlbWFwVGV4dHVyZSk7CmdsVW5pZm9ybTFpKGdsR2V0VW5pZm9ybUxvY2F0aW9uKHNoYWRlclByb2dyYW0sICJza3lib3giKSwgMCk7CgovLyBSZW5kZXIgeW91ciByZWZsZWN0aXZlIHNwaGVyZQ=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>glUseProgram(shaderProgram);
glUniform3fv(glGetUniformLocation(shaderProgram, &quot;cameraPos&quot;), 1, &amp;cameraPos[0]);
glActiveTexture(GL_TEXTURE0);
glBindTexture(GL_TEXTURE_CUBE_MAP, cubemapTexture);
glUniform1i(glGetUniformLocation(shaderProgram, &quot;skybox&quot;), 0);

// Render your reflective sphere</pre></div><div class='content'></div><h1><p>Common Mistakes and Tips</p>
</h1>
<div class='content'><ul>
<li><strong>Incorrect Reflection Vector Calculation</strong>: Ensure the reflection vector is calculated correctly in the fragment shader.</li>
<li><strong>Texture Coordinates</strong>: Make sure the cube map texture coordinates are correctly mapped.</li>
<li><strong>Shader Compilation</strong>: Check for shader compilation errors and ensure all uniforms are set correctly.</li>
</ul>
</div><h1><p>Conclusion</p>
</h1>
<div class='content'><p>Environment mapping is a powerful technique to simulate reflective surfaces in OpenGL. By understanding the key concepts and following the steps to implement it, you can create visually stunning effects in your graphics applications. Practice with different environment maps and objects to master this technique.</p>
</div><div class='row navigation'>
	<div class='col-2'>
					<a href='06-03-shadow-mapping' title="Shadow Mapping">&#x25C4;Previous</a>
			</div>
	<div class='col-8 text-center'>
			</div>
	<div class='col-2 text-end'>
					<a href='07-01-compute-shaders' title="Compute Shaders">Next &#x25BA;</a>
			</div>
</div>

			</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Advertising</h1>
			<p>This space is reserved for advertising.</p>
			<p>If you want to be a sponsor, contact us to include links in this area: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Thank you for collaborating!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. All rights reserved</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	We use cookies to improve your user experience and offer content tailored to your interests.
    <a href="#" id="btn_accept_cookies" class="button">Accept</a>
    <a href="/cookies">More Information</a>
</div>	

	</div>    
</body>
</html>
