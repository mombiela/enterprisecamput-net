<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Securing Elasticsearch</title>

    <link rel="alternate" href="https://campusempresa.com/mod/elasticsearch/06-01-securing-elasticsearch" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/mod/elasticsearch/06-01-securing-elasticsearch" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/mod/elasticsearch/06-01-securing-elasticsearch" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="/js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body >
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-12 col-md-8 p-2 p-md-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo-header_enterprise.png"></a>
			</h1>
		</div>
		<div class="col-12 col-md-4 p-2 p-md-0 text-end">
			<h2 id="main_title"><cite>Building today's and tomorrow's society</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-2 p-md-0 m-0 text-end">
													<b id="lit_lang_es" class="px-2">EN</b>
				|
				<a href="https://campusempresa.com/mod/elasticsearch/06-01-securing-elasticsearch" class="px-2">ES</a></b>
				|
				<a href="https://campusempresa.cat/mod/elasticsearch/06-01-securing-elasticsearch" class="px-2">CA</a>
					</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="/objective">The Project</a>
				<a href="/about">About Us</a>
				<a href="/contribute">Contribute</a>
				<a href="/donate">Donations</a>
				<a href="/licence">License</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content">
								<div class='row navigation'>
	<div class='col-2'>
					<a href='05-04-backup-restore' title="Backup and Restore">&#x25C4;Previous</a>
			</div>
	<div class='col-8 text-center'>
					<a href="./"><h2 style="text-decoration:underline">Securing Elasticsearch</h2></a>
			</div>
	<div class='col-2 text-end'>
					<a href='06-02-user-authentication-authorization' title="User Authentication and Authorization">Next &#x25BA;</a>
			</div>
</div>
<div class='content'><p>Securing Elasticsearch is crucial to protect your data and ensure that only authorized users can access and manipulate it. This section will cover the essential aspects of securing your Elasticsearch cluster, including setting up basic security features, configuring SSL/TLS, and managing user access.</p>
</div><h1><p>Key Concepts</p>
</h1>
<div class='content'><ol>
<li>
<p><strong>Security Features in Elasticsearch</strong>:</p>
<ul>
<li><strong>Authentication</strong>: Verifying the identity of users.</li>
<li><strong>Authorization</strong>: Granting permissions to users based on their roles.</li>
<li><strong>Encryption</strong>: Protecting data in transit and at rest.</li>
<li><strong>Auditing</strong>: Tracking access and changes to the data.</li>
</ul>
</li>
<li>
<p><strong>Security Plugins</strong>:</p>
<ul>
<li><strong>X-Pack Security</strong>: A commercial plugin by Elastic that provides comprehensive security features.</li>
</ul>
</li>
</ol>
</div><h1><p>Setting Up Basic Security</p>
</h1>
<div class='content'></div><h2><p>Step 1: Enable Security Features</p>
</h2>
<div class='content'><p>To enable security features in Elasticsearch, you need to configure the <code>elasticsearch.yml</code> file. Add the following lines to enable security:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("eHBhY2suc2VjdXJpdHkuZW5hYmxlZDogdHJ1ZQp4cGFjay5zZWN1cml0eS50cmFuc3BvcnQuc3NsLmVuYWJsZWQ6IHRydWUKeHBhY2suc2VjdXJpdHkuaHR0cC5zc2wuZW5hYmxlZDogdHJ1ZQ=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>xpack.security.enabled: true
xpack.security.transport.ssl.enabled: true
xpack.security.http.ssl.enabled: true</pre></div><div class='content'></div><h2><p>Step 2: Generate SSL/TLS Certificates</p>
</h2>
<div class='content'><p>Elasticsearch requires SSL/TLS certificates to encrypt communication between nodes and clients. You can use the <code>elasticsearch-certutil</code> tool to generate these certificates.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("IyBHZW5lcmF0ZSBhIGNlcnRpZmljYXRlIGF1dGhvcml0eSAoQ0EpCmJpbi9lbGFzdGljc2VhcmNoLWNlcnR1dGlsIGNhCgojIEdlbmVyYXRlIGNlcnRpZmljYXRlcyBmb3IgdGhlIG5vZGVzCmJpbi9lbGFzdGljc2VhcmNoLWNlcnR1dGlsIGNlcnQgLS1jYSBlbGFzdGljLXN0YWNrLWNhLnAxMg=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'># Generate a certificate authority (CA)
bin/elasticsearch-certutil ca

# Generate certificates for the nodes
bin/elasticsearch-certutil cert --ca elastic-stack-ca.p12</pre></div><div class='content'></div><h2><p>Step 3: Configure SSL/TLS</p>
</h2>
<div class='content'><p>Once you have the certificates, configure Elasticsearch to use them by adding the following lines to the <code>elasticsearch.yml</code> file:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("eHBhY2suc2VjdXJpdHkudHJhbnNwb3J0LnNzbC52ZXJpZmljYXRpb25fbW9kZTogY2VydGlmaWNhdGUKeHBhY2suc2VjdXJpdHkudHJhbnNwb3J0LnNzbC5rZXlzdG9yZS5wYXRoOiAvcGF0aC90by95b3VyL2tleXN0b3JlLnAxMgp4cGFjay5zZWN1cml0eS50cmFuc3BvcnQuc3NsLnRydXN0c3RvcmUucGF0aDogL3BhdGgvdG8veW91ci90cnVzdHN0b3JlLnAxMgoKeHBhY2suc2VjdXJpdHkuaHR0cC5zc2wua2V5c3RvcmUucGF0aDogL3BhdGgvdG8veW91ci9rZXlzdG9yZS5wMTIKeHBhY2suc2VjdXJpdHkuaHR0cC5zc2wudHJ1c3RzdG9yZS5wYXRoOiAvcGF0aC90by95b3VyL3RydXN0c3RvcmUucDEy"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>xpack.security.transport.ssl.verification_mode: certificate
xpack.security.transport.ssl.keystore.path: /path/to/your/keystore.p12
xpack.security.transport.ssl.truststore.path: /path/to/your/truststore.p12

xpack.security.http.ssl.keystore.path: /path/to/your/keystore.p12
xpack.security.http.ssl.truststore.path: /path/to/your/truststore.p12</pre></div><div class='content'></div><h2><p>Step 4: Set Up User Authentication</p>
</h2>
<div class='content'><p>Elasticsearch comes with a built-in user database. You can use the <code>elasticsearch-users</code> tool to manage users.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("IyBBZGQgYSBuZXcgdXNlcgpiaW4vZWxhc3RpY3NlYXJjaC11c2VycyB1c2VyYWRkIDx1c2VybmFtZT4gLXAgPHBhc3N3b3JkPiAtciA8cm9sZT4KCiMgRXhhbXBsZTogQWRkIGFuIGFkbWluIHVzZXIKYmluL2VsYXN0aWNzZWFyY2gtdXNlcnMgdXNlcmFkZCBhZG1pbiAtcCBhZG1pbnBhc3N3b3JkIC1yIHN1cGVydXNlcg=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'># Add a new user
bin/elasticsearch-users useradd &lt;username&gt; -p &lt;password&gt; -r &lt;role&gt;

# Example: Add an admin user
bin/elasticsearch-users useradd admin -p adminpassword -r superuser</pre></div><div class='content'></div><h2><p>Step 5: Configure Role-Based Access Control (RBAC)</p>
</h2>
<div class='content'><p>Define roles and assign them to users to control access to different parts of the cluster. Roles are defined in the <code>roles.yml</code> file.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("IyBEZWZpbmUgYSBjdXN0b20gcm9sZQpteV9jdXN0b21fcm9sZToKICBjbHVzdGVyOiBbICJhbGwiIF0KICBpbmRpY2VzOgogICAgLSBuYW1lczogWyAibXlfaW5kZXgiIF0KICAgICAgcHJpdmlsZWdlczogWyAicmVhZCIsICJ3cml0ZSIgXQ=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'># Define a custom role
my_custom_role:
  cluster: [ &quot;all&quot; ]
  indices:
    - names: [ &quot;my_index&quot; ]
      privileges: [ &quot;read&quot;, &quot;write&quot; ]</pre></div><div class='content'><p>Assign the role to a user:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("YmluL2VsYXN0aWNzZWFyY2gtdXNlcnMgdXNlcmFkZCA8dXNlcm5hbWU+IC1wIDxwYXNzd29yZD4gLXIgbXlfY3VzdG9tX3JvbGU="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>bin/elasticsearch-users useradd &lt;username&gt; -p &lt;password&gt; -r my_custom_role</pre></div><div class='content'></div><h1><p>Practical Example</p>
</h1>
<div class='content'><p>Let's walk through a practical example of securing an Elasticsearch cluster.</p>
</div><h2><p>Example: Securing a Single-Node Cluster</p>
</h2>
<div class='content'><ol>
<li>
<p><strong>Enable Security Features</strong>:</p>
<pre><code class="language-yaml"># elasticsearch.yml
xpack.security.enabled: true
xpack.security.transport.ssl.enabled: true
xpack.security.http.ssl.enabled: true
</code></pre>
</li>
<li>
<p><strong>Generate SSL/TLS Certificates</strong>:</p>
<pre><code class="language-bash">bin/elasticsearch-certutil ca
bin/elasticsearch-certutil cert --ca elastic-stack-ca.p12
</code></pre>
</li>
<li>
<p><strong>Configure SSL/TLS</strong>:</p>
<pre><code class="language-yaml"># elasticsearch.yml
xpack.security.transport.ssl.verification_mode: certificate
xpack.security.transport.ssl.keystore.path: /path/to/your/keystore.p12
xpack.security.transport.ssl.truststore.path: /path/to/your/truststore.p12

xpack.security.http.ssl.keystore.path: /path/to/your/keystore.p12
xpack.security.http.ssl.truststore.path: /path/to/your/truststore.p12
</code></pre>
</li>
<li>
<p><strong>Set Up User Authentication</strong>:</p>
<pre><code class="language-bash">bin/elasticsearch-users useradd admin -p adminpassword -r superuser
</code></pre>
</li>
<li>
<p><strong>Configure RBAC</strong>:</p>
<pre><code class="language-yaml"># roles.yml
my_custom_role:
  cluster: [ &quot;all&quot; ]
  indices:
    - names: [ &quot;my_index&quot; ]
      privileges: [ &quot;read&quot;, &quot;write&quot; ]
</code></pre>
<p>Assign the role to a user:</p>
<pre><code class="language-bash">bin/elasticsearch-users useradd user1 -p userpassword -r my_custom_role
</code></pre>
</li>
</ol>
</div><h1><p>Common Mistakes and Tips</p>
</h1>
<div class='content'><ul>
<li><strong>Certificate Issues</strong>: Ensure that the paths to the keystore and truststore files are correct and that the files have the appropriate permissions.</li>
<li><strong>Role Misconfiguration</strong>: Double-check the roles and privileges assigned to users to avoid unauthorized access.</li>
<li><strong>Password Management</strong>: Use strong, unique passwords for all users and change them regularly.</li>
</ul>
</div><h1><p>Conclusion</p>
</h1>
<div class='content'><p>Securing Elasticsearch is a multi-step process that involves enabling security features, configuring SSL/TLS, setting up user authentication, and defining roles and permissions. By following these steps, you can ensure that your Elasticsearch cluster is secure and that your data is protected from unauthorized access. In the next section, we will delve into user authentication and authorization in more detail.</p>
</div><div class='row navigation'>
	<div class='col-2'>
					<a href='05-04-backup-restore' title="Backup and Restore">&#x25C4;Previous</a>
			</div>
	<div class='col-8 text-center'>
			</div>
	<div class='col-2 text-end'>
					<a href='06-02-user-authentication-authorization' title="User Authentication and Authorization">Next &#x25BA;</a>
			</div>
</div>

			</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Advertising</h1>
			<p>This space is reserved for advertising.</p>
			<p>If you want to be a sponsor, contact us to include links in this area: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Thank you for collaborating!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. All rights reserved</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	We use cookies to improve your user experience and offer content tailored to your interests.
    <a href="#" id="btn_accept_cookies" class="button">Accept</a>
    <a href="/cookies">More Information</a>
</div>	

	</div>    
</body>
</html>
