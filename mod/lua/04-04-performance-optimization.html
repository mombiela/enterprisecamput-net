<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Performance Optimization</title>

    <link rel="alternate" href="https://campusempresa.com/mod/lua/04-04-performance-optimization" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/mod/lua/04-04-performance-optimization" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/mod/lua/04-04-performance-optimization" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body >
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-8 p-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo-header_enterprise.png"></a>
			</h1>
		</div>
		<div class="col-4 p-0 text-end">
			<h2 id="main_title"><cite>Building today's and tomorrow's society</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-0 m-0 text-end">
													<b id="lit_lang_es" class="px-2">EN</b>
				|
				<a href="https://campusempresa.com/mod/lua/04-04-performance-optimization" class="px-2">ES</a></b>
				|
				<a href="https://campusempresa.cat/mod/lua/04-04-performance-optimization" class="px-2">CA</a>
					</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="/objective">The Project</a>
				<a href="/about">About Us</a>
				<a href="/contribute">Contribute</a>
				<a href="/donate">Donations</a>
				<a href="/licence">License</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content">
								<div class='row navigation'>
	<div class='col-2'>
					<a href='04-03-debugging-techniques' title="Debugging Techniques">&#x25C4;Previous</a>
			</div>
	<div class='col-8 text-center'>
					<a href="./"><h2 style="text-decoration:underline">Performance Optimization</h2></a>
			</div>
	<div class='col-2 text-end'>
					<a href='04-05-lua-c-api' title="Using the Lua C API">Next &#x25BA;</a>
			</div>
</div>
<div class='content'><p>In this section, we will explore various techniques and best practices to optimize the performance of your Lua code. Performance optimization is crucial for ensuring that your Lua applications run efficiently, especially in resource-constrained environments or performance-critical applications such as games.</p>
</div><h1>Key Concepts</h1>
<div class='content'><ol>
<li><strong>Profiling and Benchmarking</strong></li>
<li><strong>Memory Management</strong></li>
<li><strong>Optimizing Loops and Iterations</strong></li>
<li><strong>Efficient Table Usage</strong></li>
<li><strong>Avoiding Global Variables</strong></li>
<li><strong>Using Local Variables</strong></li>
<li><strong>Optimizing Function Calls</strong></li>
<li><strong>String Manipulation</strong></li>
</ol>
</div><h1>1. Profiling and Benchmarking</h1>
<div class='content'><p>Before optimizing your code, it's essential to identify the bottlenecks. Profiling and benchmarking help you understand where your code spends the most time.</p>
</div><h2>Example: Simple Profiling</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("bG9jYWwgc3RhcnRUaW1lID0gb3MuY2xvY2soKQoKLS0gQ29kZSB0byBiZSBwcm9maWxlZApmb3IgaSA9IDEsIDEwMDAwMDAgZG8KICAgIGxvY2FsIHggPSBpICogaQplbmQKCmxvY2FsIGVuZFRpbWUgPSBvcy5jbG9jaygpCnByaW50KCJUaW1lIHRha2VuOiAiIC4uIChlbmRUaW1lIC0gc3RhcnRUaW1lKSAuLiAiIHNlY29uZHMiKQ=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>local startTime = os.clock()

-- Code to be profiled
for i = 1, 1000000 do
    local x = i * i
end

local endTime = os.clock()
print(&quot;Time taken: &quot; .. (endTime - startTime) .. &quot; seconds&quot;)</pre></div><div class='content'></div><h2>Explanation</h2>
<div class='content'><ul>
<li><code>os.clock()</code> is used to measure the CPU time taken by the code block.</li>
<li>The difference between <code>endTime</code> and <code>startTime</code> gives the time taken to execute the code.</li>
</ul>
</div><h1>2. Memory Management</h1>
<div class='content'><p>Efficient memory management can significantly impact performance. Lua has automatic garbage collection, but you can still optimize memory usage.</p>
</div><h2>Tips</h2>
<div class='content'><ul>
<li><strong>Reuse tables</strong>: Instead of creating new tables frequently, reuse existing ones.</li>
<li><strong>Avoid unnecessary allocations</strong>: Minimize the creation of temporary objects.</li>
</ul>
</div><h1>3. Optimizing Loops and Iterations</h1>
<div class='content'><p>Loops are often a significant source of performance issues. Optimizing them can lead to substantial performance gains.</p>
</div><h2>Example: Loop Optimization</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("LS0gSW5lZmZpY2llbnQgbG9vcApmb3IgaSA9IDEsICNsYXJnZVRhYmxlIGRvCiAgICBwcm9jZXNzKGxhcmdlVGFibGVbaV0pCmVuZAoKLS0gT3B0aW1pemVkIGxvb3AKbG9jYWwgbiA9ICNsYXJnZVRhYmxlCmZvciBpID0gMSwgbiBkbwogICAgcHJvY2VzcyhsYXJnZVRhYmxlW2ldKQplbmQ="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>-- Inefficient loop
for i = 1, #largeTable do
    process(largeTable[i])
end

-- Optimized loop
local n = #largeTable
for i = 1, n do
    process(largeTable[i])
end</pre></div><div class='content'></div><h2>Explanation</h2>
<div class='content'><ul>
<li>Storing the length of the table in a local variable (<code>n</code>) avoids recalculating the length in each iteration.</li>
</ul>
</div><h1>4. Efficient Table Usage</h1>
<div class='content'><p>Tables are a fundamental data structure in Lua. Using them efficiently can improve performance.</p>
</div><h2>Tips</h2>
<div class='content'><ul>
<li><strong>Preallocate table size</strong>: If you know the size of the table in advance, preallocate it to avoid resizing.</li>
<li><strong>Use numeric indices</strong>: Accessing elements with numeric indices is faster than with string keys.</li>
</ul>
</div><h2>Example: Preallocating Table Size</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("bG9jYWwgdCA9IHt9CmZvciBpID0gMSwgMTAwMCBkbwogICAgdFtpXSA9IDAKZW5k"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>local t = {}
for i = 1, 1000 do
    t[i] = 0
end</pre></div><div class='content'></div><h1>5. Avoiding Global Variables</h1>
<div class='content'><p>Global variables are slower to access than local variables. Minimize their use to improve performance.</p>
</div><h2>Example: Using Local Variables</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("LS0gVXNpbmcgZ2xvYmFsIHZhcmlhYmxlCmZvciBpID0gMSwgMTAwMDAwMCBkbwogICAgZ2xvYmFsVmFyID0gZ2xvYmFsVmFyICsgMQplbmQKCi0tIFVzaW5nIGxvY2FsIHZhcmlhYmxlCmxvY2FsIGxvY2FsVmFyID0gMApmb3IgaSA9IDEsIDEwMDAwMDAgZG8KICAgIGxvY2FsVmFyID0gbG9jYWxWYXIgKyAxCmVuZA=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>-- Using global variable
for i = 1, 1000000 do
    globalVar = globalVar + 1
end

-- Using local variable
local localVar = 0
for i = 1, 1000000 do
    localVar = localVar + 1
end</pre></div><div class='content'></div><h1>6. Using Local Variables</h1>
<div class='content'><p>Local variables are faster to access than global variables. Use local variables whenever possible.</p>
</div><h2>Example: Local Variable Usage</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("bG9jYWwgZnVuY3Rpb24gY29tcHV0ZSgpCiAgICBsb2NhbCBhID0gMTAKICAgIGxvY2FsIGIgPSAyMAogICAgcmV0dXJuIGEgKyBiCmVuZA=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>local function compute()
    local a = 10
    local b = 20
    return a + b
end</pre></div><div class='content'></div><h1>7. Optimizing Function Calls</h1>
<div class='content'><p>Function calls can be expensive. Minimize the number of function calls in performance-critical sections.</p>
</div><h2>Example: Inlining Functions</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("LS0gRnVuY3Rpb24gY2FsbApsb2NhbCBmdW5jdGlvbiBhZGQoYSwgYikKICAgIHJldHVybiBhICsgYgplbmQKCmxvY2FsIHJlc3VsdCA9IGFkZCg1LCAxMCkKCi0tIElubGluZWQgZnVuY3Rpb24KbG9jYWwgcmVzdWx0ID0gNSArIDEw"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>-- Function call
local function add(a, b)
    return a + b
end

local result = add(5, 10)

-- Inlined function
local result = 5 + 10</pre></div><div class='content'></div><h1>8. String Manipulation</h1>
<div class='content'><p>String operations can be costly. Use efficient methods for string manipulation.</p>
</div><h2>Example: String Concatenation</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("LS0gSW5lZmZpY2llbnQgc3RyaW5nIGNvbmNhdGVuYXRpb24KbG9jYWwgc3RyID0gIiIKZm9yIGkgPSAxLCAxMDAwIGRvCiAgICBzdHIgPSBzdHIgLi4gImEiCmVuZAoKLS0gRWZmaWNpZW50IHN0cmluZyBjb25jYXRlbmF0aW9uCmxvY2FsIHQgPSB7fQpmb3IgaSA9IDEsIDEwMDAgZG8KICAgIHRbaV0gPSAiYSIKZW5kCmxvY2FsIHN0ciA9IHRhYmxlLmNvbmNhdCh0KQ=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>-- Inefficient string concatenation
local str = &quot;&quot;
for i = 1, 1000 do
    str = str .. &quot;a&quot;
end

-- Efficient string concatenation
local t = {}
for i = 1, 1000 do
    t[i] = &quot;a&quot;
end
local str = table.concat(t)</pre></div><div class='content'></div><h2>Explanation</h2>
<div class='content'><ul>
<li>Using <code>table.concat</code> is more efficient than concatenating strings in a loop.</li>
</ul>
</div><h1>Practical Exercise</h1>
<div class='content'></div><h2>Exercise: Optimize the Following Code</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("bG9jYWwgZnVuY3Rpb24gc2xvd0Z1bmN0aW9uKCkKICAgIGxvY2FsIHJlc3VsdCA9ICIiCiAgICBmb3IgaSA9IDEsIDEwMDAwIGRvCiAgICAgICAgcmVzdWx0ID0gcmVzdWx0IC4uICJhIgogICAgZW5kCiAgICByZXR1cm4gcmVzdWx0CmVuZAoKcHJpbnQoc2xvd0Z1bmN0aW9uKCkp"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>local function slowFunction()
    local result = &quot;&quot;
    for i = 1, 10000 do
        result = result .. &quot;a&quot;
    end
    return result
end

print(slowFunction())</pre></div><div class='content'></div><h2>Solution</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("bG9jYWwgZnVuY3Rpb24gZmFzdEZ1bmN0aW9uKCkKICAgIGxvY2FsIHQgPSB7fQogICAgZm9yIGkgPSAxLCAxMDAwMCBkbwogICAgICAgIHRbaV0gPSAiYSIKICAgIGVuZAogICAgcmV0dXJuIHRhYmxlLmNvbmNhdCh0KQplbmQKCnByaW50KGZhc3RGdW5jdGlvbigpKQ=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>local function fastFunction()
    local t = {}
    for i = 1, 10000 do
        t[i] = &quot;a&quot;
    end
    return table.concat(t)
end

print(fastFunction())</pre></div><div class='content'></div><h2>Explanation</h2>
<div class='content'><ul>
<li>The optimized version uses a table to collect strings and <code>table.concat</code> to concatenate them, which is more efficient.</li>
</ul>
</div><h1>Conclusion</h1>
<div class='content'><p>In this section, we covered various techniques to optimize the performance of your Lua code. By profiling and benchmarking your code, managing memory efficiently, optimizing loops and iterations, using tables effectively, avoiding global variables, using local variables, optimizing function calls, and handling strings efficiently, you can significantly improve the performance of your Lua applications.</p>
<p>Next, we will delve into the Lua C API, which allows you to extend Lua with C functions and libraries, providing even more opportunities for optimization and functionality enhancement.</p>
</div><div class='row navigation'>
	<div class='col-2'>
					<a href='04-03-debugging-techniques' title="Debugging Techniques">&#x25C4;Previous</a>
			</div>
	<div class='col-8 text-center'>
			</div>
	<div class='col-2 text-end'>
					<a href='04-05-lua-c-api' title="Using the Lua C API">Next &#x25BA;</a>
			</div>
</div>

			</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Advertising</h1>
			<p>This space is reserved for advertising.</p>
			<p>If you want to be a sponsor, contact us to include links in this area: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Thank you for collaborating!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. All rights reserved</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir galetes per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Accept</a>
    <a href="/cookies">More Information</a>
</div>	

	</div>    
</body>
</html>
