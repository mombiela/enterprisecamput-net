<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Querying the Database</title>

    <link rel="alternate" href="https://campusempresa.com/mod/django/querying-the-database" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/mod/django/querying-the-database" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/mod/django/querying-the-database" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body>
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-8 p-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo-header_enterprise.png"></a>
			</h1>
		</div>
		<div class="col-4 p-0 text-end">
			<h2 id="main_title"><cite>Building today's and tomorrow's society</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-0 m-0 text-end">
													<b id="lit_lang_es" class="px-2">EN</b>
				|
				<a href="https://campusempresa.com/mod/django/querying-the-database" class="px-2">ES</a></b>
				|
				<a href="https://campusempresa.cat/mod/django/querying-the-database" class="px-2">CA</a>
					</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="/objective">The Project</a>
				<a href="/about">About Us</a>
				<a href="/contribute">Contribute</a>
				<a href="/donate">Donations</a>
				<a href="/licence">License</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content"><div class='row navigation'>
	<div class='col-4'>
					<a href='model-migrations'>&#x25C4;Model Migrations</a>
			</div>
	<div class='col-4 text-center'>
		<a href="./" class="title">Querying the Database</a>
	</div>
	<div class='col-4 text-end'>
					<a href='model-relationships'>Model Relationships &#x25BA;</a>
			</div>
</div>
<div class='content'></div><h1>Introduction</h1>
<div class='content'><p>In this section, we will explore how to query the database using Django's ORM (Object-Relational Mapping). Django ORM provides a high-level abstraction upon SQL, allowing developers to interact with the database using Python code. This makes it easier to perform CRUD (Create, Read, Update, Delete) operations without writing raw SQL queries.</p>
</div><h1>Basic Queries</h1>
<h2>Retrieving All Objects</h2>
<div class='content'><p>To retrieve all objects from a model, you can use the <code>all()</code> method.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ZnJvbSBteWFwcC5tb2RlbHMgaW1wb3J0IEJvb2sKCiMgUmV0cmlldmUgYWxsIGJvb2tzCmJvb2tzID0gQm9vay5vYmplY3RzLmFsbCgp"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>from myapp.models import Book

# Retrieve all books
books = Book.objects.all()</pre></div><div class='content'></div><h2>Filtering Objects</h2>
<div class='content'><p>To filter objects based on certain criteria, you can use the <code>filter()</code> method.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ZnJvbSBteWFwcC5tb2RlbHMgaW1wb3J0IEJvb2sKCiMgUmV0cmlldmUgYm9va3MgcHVibGlzaGVkIGluIDIwMjEKYm9va3NfMjAyMSA9IEJvb2sub2JqZWN0cy5maWx0ZXIocHVibGljYXRpb25feWVhcj0yMDIxKQ=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>from myapp.models import Book

# Retrieve books published in 2021
books_2021 = Book.objects.filter(publication_year=2021)</pre></div><div class='content'></div><h2>Retrieving a Single Object</h2>
<div class='content'><p>To retrieve a single object, you can use the <code>get()</code> method. Note that <code>get()</code> will raise a <code>DoesNotExist</code> exception if no object is found and a <code>MultipleObjectsReturned</code> exception if more than one object is found.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ZnJvbSBteWFwcC5tb2RlbHMgaW1wb3J0IEJvb2sKCiMgUmV0cmlldmUgYSBib29rIHdpdGggYSBzcGVjaWZpYyB0aXRsZQp0cnk6CiAgICBib29rID0gQm9vay5vYmplY3RzLmdldCh0aXRsZT0iRGphbmdvIGZvciBCZWdpbm5lcnMiKQpleGNlcHQgQm9vay5Eb2VzTm90RXhpc3Q6CiAgICBwcmludCgiQm9vayBub3QgZm91bmQiKQpleGNlcHQgQm9vay5NdWx0aXBsZU9iamVjdHNSZXR1cm5lZDoKICAgIHByaW50KCJNdWx0aXBsZSBib29rcyBmb3VuZCIp"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>from myapp.models import Book

# Retrieve a book with a specific title
try:
    book = Book.objects.get(title=&quot;Django for Beginners&quot;)
except Book.DoesNotExist:
    print(&quot;Book not found&quot;)
except Book.MultipleObjectsReturned:
    print(&quot;Multiple books found&quot;)</pre></div><div class='content'></div><h2>Field Lookups</h2>
<div class='content'><p>Django provides various field lookups to filter data. Some common lookups include:</p>
<ul>
<li><code>exact</code>: Exact match</li>
<li><code>iexact</code>: Case-insensitive exact match</li>
<li><code>contains</code>: Case-sensitive containment test</li>
<li><code>icontains</code>: Case-insensitive containment test</li>
<li><code>gt</code>: Greater than</li>
<li><code>gte</code>: Greater than or equal to</li>
<li><code>lt</code>: Less than</li>
<li><code>lte</code>: Less than or equal to</li>
</ul>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ZnJvbSBteWFwcC5tb2RlbHMgaW1wb3J0IEJvb2sKCiMgUmV0cmlldmUgYm9va3Mgd2l0aCB0aXRsZXMgY29udGFpbmluZyAnRGphbmdvJwpib29rcyA9IEJvb2sub2JqZWN0cy5maWx0ZXIodGl0bGVfX2ljb250YWlucz0nRGphbmdvJykKCiMgUmV0cmlldmUgYm9va3MgcHVibGlzaGVkIGFmdGVyIDIwMjAKYm9va3MgPSBCb29rLm9iamVjdHMuZmlsdGVyKHB1YmxpY2F0aW9uX3llYXJfX2d0PTIwMjAp"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>from myapp.models import Book

# Retrieve books with titles containing 'Django'
books = Book.objects.filter(title__icontains='Django')

# Retrieve books published after 2020
books = Book.objects.filter(publication_year__gt=2020)</pre></div><div class='content'></div><h1>Advanced Queries</h1>
<h2>Complex Lookups with Q Objects</h2>
<div class='content'><p>To perform complex queries involving OR conditions or combining multiple conditions, you can use <code>Q</code> objects.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ZnJvbSBkamFuZ28uZGIubW9kZWxzIGltcG9ydCBRCmZyb20gbXlhcHAubW9kZWxzIGltcG9ydCBCb29rCgojIFJldHJpZXZlIGJvb2tzIHB1Ymxpc2hlZCBpbiAyMDIwIG9yIHdpdGggdGl0bGVzIGNvbnRhaW5pbmcgJ1B5dGhvbicKYm9va3MgPSBCb29rLm9iamVjdHMuZmlsdGVyKFEocHVibGljYXRpb25feWVhcj0yMDIwKSB8IFEodGl0bGVfX2ljb250YWlucz0nUHl0aG9uJykp"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>from django.db.models import Q
from myapp.models import Book

# Retrieve books published in 2020 or with titles containing 'Python'
books = Book.objects.filter(Q(publication_year=2020) | Q(title__icontains='Python'))</pre></div><div class='content'></div><h2>Aggregations</h2>
<div class='content'><p>Django provides aggregation functions like <code>Count</code>, <code>Sum</code>, <code>Avg</code>, <code>Min</code>, and <code>Max</code> to perform calculations on querysets.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ZnJvbSBkamFuZ28uZGIubW9kZWxzIGltcG9ydCBDb3VudCwgQXZnCmZyb20gbXlhcHAubW9kZWxzIGltcG9ydCBCb29rCgojIENvdW50IHRoZSBudW1iZXIgb2YgYm9va3MKYm9va19jb3VudCA9IEJvb2sub2JqZWN0cy5jb3VudCgpCgojIENhbGN1bGF0ZSB0aGUgYXZlcmFnZSBwdWJsaWNhdGlvbiB5ZWFyCmF2ZXJhZ2VfeWVhciA9IEJvb2sub2JqZWN0cy5hZ2dyZWdhdGUoQXZnKCdwdWJsaWNhdGlvbl95ZWFyJykp"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>from django.db.models import Count, Avg
from myapp.models import Book

# Count the number of books
book_count = Book.objects.count()

# Calculate the average publication year
average_year = Book.objects.aggregate(Avg('publication_year'))</pre></div><div class='content'></div><h2>Annotating Querysets</h2>
<div class='content'><p>The <code>annotate()</code> method allows you to add calculated fields to each object in a queryset.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ZnJvbSBkamFuZ28uZGIubW9kZWxzIGltcG9ydCBDb3VudApmcm9tIG15YXBwLm1vZGVscyBpbXBvcnQgQXV0aG9yCgojIEFubm90YXRlIGF1dGhvcnMgd2l0aCB0aGUgbnVtYmVyIG9mIGJvb2tzIHRoZXkgaGF2ZSB3cml0dGVuCmF1dGhvcnMgPSBBdXRob3Iub2JqZWN0cy5hbm5vdGF0ZShib29rX2NvdW50PUNvdW50KCdib29rJykpCmZvciBhdXRob3IgaW4gYXV0aG9yczoKICAgIHByaW50KGYie2F1dGhvci5uYW1lfSBoYXMgd3JpdHRlbiB7YXV0aG9yLmJvb2tfY291bnR9IGJvb2tzIik="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>from django.db.models import Count
from myapp.models import Author

# Annotate authors with the number of books they have written
authors = Author.objects.annotate(book_count=Count('book'))
for author in authors:
    print(f&quot;{author.name} has written {author.book_count} books&quot;)</pre></div><div class='content'></div><h1>Query Optimization</h1>
<h2>Select Related</h2>
<div class='content'><p>To reduce the number of database queries, you can use <code>select_related()</code> for single-valued relationships (foreign keys).</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ZnJvbSBteWFwcC5tb2RlbHMgaW1wb3J0IEJvb2sKCiMgUmV0cmlldmUgYm9va3MgYWxvbmcgd2l0aCB0aGVpciBhdXRob3JzIGluIGEgc2luZ2xlIHF1ZXJ5CmJvb2tzID0gQm9vay5vYmplY3RzLnNlbGVjdF9yZWxhdGVkKCdhdXRob3InKS5hbGwoKQ=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>from myapp.models import Book

# Retrieve books along with their authors in a single query
books = Book.objects.select_related('author').all()</pre></div><div class='content'></div><h2>Prefetch Related</h2>
<div class='content'><p>For multi-valued relationships (many-to-many and reverse foreign key), use <code>prefetch_related()</code>.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ZnJvbSBteWFwcC5tb2RlbHMgaW1wb3J0IEF1dGhvcgoKIyBSZXRyaWV2ZSBhdXRob3JzIGFsb25nIHdpdGggdGhlaXIgYm9va3MgaW4gYSBzaW5nbGUgcXVlcnkKYXV0aG9ycyA9IEF1dGhvci5vYmplY3RzLnByZWZldGNoX3JlbGF0ZWQoJ2Jvb2tfc2V0JykuYWxsKCk="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>from myapp.models import Author

# Retrieve authors along with their books in a single query
authors = Author.objects.prefetch_related('book_set').all()</pre></div><div class='content'></div><h1>Conclusion</h1>
<div class='content'><p>Querying the database in Django is made simple and efficient through the use of Django ORM. By understanding basic and advanced querying techniques, you can perform complex data retrieval operations with ease. Remember to use query optimization techniques like <code>select_related()</code> and <code>prefetch_related()</code> to improve the performance of your database queries.</p>
</div><div class='row navigation'>
	<div class='col-4'>
					<a href='model-migrations'>&#x25C4;Model Migrations</a>
			</div>
	<div class='col-4 text-center'>
		<a href="./" class="title">Querying the Database</a>
	</div>
	<div class='col-4 text-end'>
					<a href='model-relationships'>Model Relationships &#x25BA;</a>
			</div>
</div>
</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Advertising</h1>
			<p>This space is reserved for advertising.</p>
			<p>If you want to be a sponsor, contact us to include links in this area: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Thank you for collaborating!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. All rights reserved</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir galetes per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Accept</a>
    <a href="/cookies">More Information</a>
</div>	

	</div>    
</body>
</html>
