<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Querying Techniques</title>

    <link rel="alternate" href="https://campusempresa.com/mod/django/advanced-querying-techniques" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/mod/django/advanced-querying-techniques" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/mod/django/advanced-querying-techniques" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body>
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-8 p-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo-header_enterprise.png"></a>
			</h1>
		</div>
		<div class="col-4 p-0 text-end">
			<h2 id="main_title"><cite>Building today's and tomorrow's society</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-0 m-0 text-end">
													<b id="lit_lang_es" class="px-2">EN</b>
				|
				<a href="https://campusempresa.com/mod/django/advanced-querying-techniques" class="px-2">ES</a></b>
				|
				<a href="https://campusempresa.cat/mod/django/advanced-querying-techniques" class="px-2">CA</a>
					</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="/objective">The Project</a>
				<a href="/about">About Us</a>
				<a href="/contribute">Contribute</a>
				<a href="/donate">Donations</a>
				<a href="/licence">License</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content"><div class='row navigation'>
	<div class='col-4'>
					<a href='security-best-practices'>&#x25C4;Security Best Practices</a>
			</div>
	<div class='col-4 text-center'>
		<a href="./" class="title">Advanced Querying Techniques</a>
	</div>
	<div class='col-4 text-end'>
					<a href='custom-management-commands'>Custom Management Commands &#x25BA;</a>
			</div>
</div>
<div class='content'><p>In this section, we will delve into advanced querying techniques in Django. This will help you write more efficient and powerful queries, allowing you to retrieve exactly the data you need from your database.</p>
</div><h1>Key Concepts</h1>
<div class='content'><ul>
<li><strong>QuerySet API</strong>: Understanding the full power of Django's QuerySet API.</li>
<li><strong>Aggregation</strong>: Performing complex calculations on your data.</li>
<li><strong>Annotations</strong>: Adding calculated fields to your QuerySets.</li>
<li><strong>Subqueries</strong>: Using subqueries to perform more complex lookups.</li>
<li><strong>Raw SQL</strong>: When and how to use raw SQL in Django.</li>
</ul>
</div><h1>QuerySet API</h1>
<div class='content'><p>Django's QuerySet API is incredibly powerful and allows you to filter, order, and manipulate your data in various ways.</p>
</div><h2>Filtering Data</h2>
<div class='content'><p>You can filter data using the <code>filter()</code> method. This method allows you to specify conditions that the returned objects must meet.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("IyBFeGFtcGxlOiBGaWx0ZXJpbmcgYm9va3MgcHVibGlzaGVkIGFmdGVyIDIwMjAKcmVjZW50X2Jvb2tzID0gQm9vay5vYmplY3RzLmZpbHRlcihwdWJsaWNhdGlvbl9kYXRlX195ZWFyX19ndD0yMDIwKQ=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'># Example: Filtering books published after 2020
recent_books = Book.objects.filter(publication_date__year__gt=2020)</pre></div><div class='content'></div><h2>Chaining Filters</h2>
<div class='content'><p>Filters can be chained together to refine the results further.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("IyBFeGFtcGxlOiBGaWx0ZXJpbmcgYm9va3MgcHVibGlzaGVkIGFmdGVyIDIwMjAgYW5kIGF1dGhvcmVkIGJ5ICdKb2huIERvZScKcmVjZW50X2Jvb2tzX2J5X2pvaG4gPSBCb29rLm9iamVjdHMuZmlsdGVyKHB1YmxpY2F0aW9uX2RhdGVfX3llYXJfX2d0PTIwMjApLmZpbHRlcihhdXRob3JfX25hbWU9J0pvaG4gRG9lJyk="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'># Example: Filtering books published after 2020 and authored by 'John Doe'
recent_books_by_john = Book.objects.filter(publication_date__year__gt=2020).filter(author__name='John Doe')</pre></div><div class='content'></div><h2>Excluding Data</h2>
<div class='content'><p>The <code>exclude()</code> method allows you to exclude objects that match certain conditions.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("IyBFeGFtcGxlOiBFeGNsdWRpbmcgYm9va3MgcHVibGlzaGVkIGJlZm9yZSAyMDAwCm1vZGVybl9ib29rcyA9IEJvb2sub2JqZWN0cy5leGNsdWRlKHB1YmxpY2F0aW9uX2RhdGVfX3llYXJfX2x0PTIwMDAp"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'># Example: Excluding books published before 2000
modern_books = Book.objects.exclude(publication_date__year__lt=2000)</pre></div><div class='content'></div><h1>Aggregation</h1>
<div class='content'><p>Aggregation allows you to perform calculations on a QuerySet, such as counting, summing, or averaging values.</p>
</div><h2>Using Aggregation Functions</h2>
<div class='content'><p>Django provides several aggregation functions like <code>Count</code>, <code>Sum</code>, <code>Avg</code>, <code>Min</code>, and <code>Max</code>.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ZnJvbSBkamFuZ28uZGIubW9kZWxzIGltcG9ydCBDb3VudCwgQXZnCgojIEV4YW1wbGU6IENvdW50aW5nIHRoZSBudW1iZXIgb2YgYm9va3MgYnkgZWFjaCBhdXRob3IKYXV0aG9yX2Jvb2tfY291bnRzID0gQXV0aG9yLm9iamVjdHMuYW5ub3RhdGUobnVtX2Jvb2tzPUNvdW50KCdib29rJykpCgojIEV4YW1wbGU6IENhbGN1bGF0aW5nIHRoZSBhdmVyYWdlIHJhdGluZyBvZiBhbGwgYm9va3MKYXZlcmFnZV9yYXRpbmcgPSBCb29rLm9iamVjdHMuYWdncmVnYXRlKEF2ZygncmF0aW5nJykp"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>from django.db.models import Count, Avg

# Example: Counting the number of books by each author
author_book_counts = Author.objects.annotate(num_books=Count('book'))

# Example: Calculating the average rating of all books
average_rating = Book.objects.aggregate(Avg('rating'))</pre></div><div class='content'></div><h1>Annotations</h1>
<div class='content'><p>Annotations are similar to aggregations but add the calculated values to each object in the QuerySet.</p>
</div><h2>Adding Annotations</h2>
<div class='content'><p>You can add annotations using the <code>annotate()</code> method.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ZnJvbSBkamFuZ28uZGIubW9kZWxzIGltcG9ydCBDb3VudAoKIyBFeGFtcGxlOiBBZGRpbmcgdGhlIG51bWJlciBvZiBib29rcyBlYWNoIGF1dGhvciBoYXMgd3JpdHRlbgphdXRob3JzX3dpdGhfYm9va19jb3VudHMgPSBBdXRob3Iub2JqZWN0cy5hbm5vdGF0ZShudW1fYm9va3M9Q291bnQoJ2Jvb2snKSk="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>from django.db.models import Count

# Example: Adding the number of books each author has written
authors_with_book_counts = Author.objects.annotate(num_books=Count('book'))</pre></div><div class='content'></div><h1>Subqueries</h1>
<div class='content'><p>Subqueries allow you to perform more complex lookups by embedding one query inside another.</p>
</div><h2>Using Subqueries</h2>
<div class='content'><p>Subqueries can be used with the <code>Subquery</code> and <code>OuterRef</code> classes.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ZnJvbSBkamFuZ28uZGIubW9kZWxzIGltcG9ydCBTdWJxdWVyeSwgT3V0ZXJSZWYKCiMgRXhhbXBsZTogR2V0dGluZyB0aGUgbGF0ZXN0IGJvb2sgZm9yIGVhY2ggYXV0aG9yCmxhdGVzdF9ib29rcyA9IEJvb2sub2JqZWN0cy5maWx0ZXIoYXV0aG9yPU91dGVyUmVmKCdwaycpKS5vcmRlcl9ieSgnLXB1YmxpY2F0aW9uX2RhdGUnKQphdXRob3JzX3dpdGhfbGF0ZXN0X2Jvb2tzID0gQXV0aG9yLm9iamVjdHMuYW5ub3RhdGUobGF0ZXN0X2Jvb2s9U3VicXVlcnkobGF0ZXN0X2Jvb2tzLnZhbHVlcygndGl0bGUnKVs6MV0pKQ=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>from django.db.models import Subquery, OuterRef

# Example: Getting the latest book for each author
latest_books = Book.objects.filter(author=OuterRef('pk')).order_by('-publication_date')
authors_with_latest_books = Author.objects.annotate(latest_book=Subquery(latest_books.values('title')[:1]))</pre></div><div class='content'></div><h1>Raw SQL</h1>
<div class='content'><p>While Django's ORM is powerful, there are times when you might need to write raw SQL queries.</p>
</div><h2>Executing Raw SQL</h2>
<div class='content'><p>You can execute raw SQL queries using the <code>raw()</code> method.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("IyBFeGFtcGxlOiBFeGVjdXRpbmcgYSByYXcgU1FMIHF1ZXJ5CmJvb2tzID0gQm9vay5vYmplY3RzLnJhdygnU0VMRUNUICogRlJPTSBteWFwcF9ib29rIFdIRVJFIHB1YmxpY2F0aW9uX2RhdGUgPiAlcycsIFsyMDIwXSk="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'># Example: Executing a raw SQL query
books = Book.objects.raw('SELECT * FROM myapp_book WHERE publication_date &gt; %s', [2020])</pre></div><div class='content'></div><h2>Using Raw SQL for Complex Queries</h2>
<div class='content'><p>Raw SQL can be useful for complex queries that are difficult to express using the ORM.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("IyBFeGFtcGxlOiBVc2luZyByYXcgU1FMIGZvciBhIGNvbXBsZXggcXVlcnkKY29tcGxleF9xdWVyeSA9ICcnJwpTRUxFQ1QgYXV0aG9yLm5hbWUsIENPVU5UKGJvb2suaWQpIGFzIGJvb2tfY291bnQKRlJPTSBteWFwcF9hdXRob3IgYXMgYXV0aG9yCkpPSU4gbXlhcHBfYm9vayBhcyBib29rIE9OIGF1dGhvci5pZCA9IGJvb2suYXV0aG9yX2lkCkdST1VQIEJZIGF1dGhvci5uYW1lCkhBVklORyBDT1VOVChib29rLmlkKSA+IDUKJycnCmF1dGhvcnNfd2l0aF9tYW55X2Jvb2tzID0gQXV0aG9yLm9iamVjdHMucmF3KGNvbXBsZXhfcXVlcnkp"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'># Example: Using raw SQL for a complex query
complex_query = '''
SELECT author.name, COUNT(book.id) as book_count
FROM myapp_author as author
JOIN myapp_book as book ON author.id = book.author_id
GROUP BY author.name
HAVING COUNT(book.id) &gt; 5
'''
authors_with_many_books = Author.objects.raw(complex_query)</pre></div><div class='content'></div><h1>Conclusion</h1>
<div class='content'><p>Advanced querying techniques in Django allow you to perform complex data retrieval and manipulation tasks efficiently. By mastering the QuerySet API, aggregation, annotations, subqueries, and raw SQL, you can handle a wide range of data-related challenges in your Django applications. Practice these techniques with real-world examples to deepen your understanding and improve your skills.</p>
</div><div class='row navigation'>
	<div class='col-4'>
					<a href='security-best-practices'>&#x25C4;Security Best Practices</a>
			</div>
	<div class='col-4 text-center'>
		<a href="./" class="title">Advanced Querying Techniques</a>
	</div>
	<div class='col-4 text-end'>
					<a href='custom-management-commands'>Custom Management Commands &#x25BA;</a>
			</div>
</div>
</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Advertising</h1>
			<p>This space is reserved for advertising.</p>
			<p>If you want to be a sponsor, contact us to include links in this area: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Thank you for collaborating!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. All rights reserved</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir galetes per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Accept</a>
    <a href="/cookies">More Information</a>
</div>	

	</div>    
</body>
</html>
