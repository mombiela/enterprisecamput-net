<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Handling Cursors</title>

    <link rel="alternate" href="https://campusempresa.com/mod/cobol/08-04-handling-cursors" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/mod/cobol/08-04-handling-cursors" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/mod/cobol/08-04-handling-cursors" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="/js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body >
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-12 col-md-6 p-2 p-md-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo-header_enterprise.png"></a>
			</h1>
		</div>
		<div class="col-12 col-md-6 p-2 p-md-0 text-end">
				<b id="lit_lang_es" class="px-2">EN</b>
	|
	<a href="https://campusempresa.com/mod/cobol/08-04-handling-cursors" class="px-2">ES</a></b>
	|
	<a href="https://campusempresa.cat/mod/cobol/08-04-handling-cursors" class="px-2">CA</a>
<br>
			<cite>Building today's and tomorrow's society</cite>
		</div>
	</div>
</div>
<div id="subheader" class="container-xxl">
	<div class="row">
		<div class="col-12 p-2 p-md-0 m-0 text-end">
			<a href="/objective">The Project</a> | 
<a href="/about">About Us</a> | 
<a href="/contribute">Contribute</a> | 
<a href="/donate">Donations</a> | 
<a href="/licence">License</a>
		</div>
	</div>
</div>

<div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
									<a href="./">Course Content</a>
					<span class="sep">|</span>
								<a href="/all/competencias">Technical Skills</a>
				<a href="/all/conocimientos">Knowledge</a>
				<a href="/all/soft_skills">Social Skills</a>
			</div>
		</div>
	</div>
</div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content">
								<div class='row navigation'>
	<div class='col-1 col-md-2'>
					<a href='08-03-database-operations' title="Database Operations">
				<span class="d-none d-md-inline">&#x25C4; Previous</span>
				<span class="d-inline d-md-none"><i class="bi bi-caret-left-square-fill"></i></span>
			</a>
			</div>
	<div class='col-10 col-md-8 text-center'>
					<a href="./"><h2 style="text-decoration:underline">Handling Cursors</h2></a>
			</div>
	<div class='col-1 col-md-2 text-end'>
					<a href='09-01-object-oriented-cobol' title="Object-Oriented COBOL">
				<span class="d-none d-md-inline">Next &#x25BA;</span>
				<span class="d-inline d-md-none"><i class="bi bi-caret-right-square-fill"></i></span>
			</a>
			</div>
</div>
<div class='content'><p>In this section, we will delve into the concept of cursors in COBOL, particularly when working with databases like DB2. Cursors are essential for handling multiple rows of data retrieved from a database. They allow you to process each row individually, which is crucial for applications that need to handle large datasets.</p>
</div><h1><p>What is a Cursor?</p>
</h1>
<div class='content'><p>A cursor is a database object used to retrieve, manipulate, and navigate through a result set row by row. It acts as a pointer to the rows in a result set, enabling you to fetch and process each row sequentially.</p>
</div><h2><p>Key Concepts of Cursors</p>
</h2>
<div class='content'><ol>
<li><strong>Declaration</strong>: Define the cursor and the SQL query it will execute.</li>
<li><strong>Opening</strong>: Execute the SQL query and establish the result set.</li>
<li><strong>Fetching</strong>: Retrieve rows from the result set one at a time.</li>
<li><strong>Closing</strong>: Release the cursor and its resources.</li>
</ol>
</div><h1><p>Declaring a Cursor</p>
</h1>
<div class='content'><p>To declare a cursor in COBOL, you use the <code>EXEC SQL DECLARE CURSOR</code> statement. This statement specifies the SQL query that the cursor will execute.</p>
</div><h2><p>Example</p>
</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("RVhFQyBTUUwKICAgIERFQ0xBUkUgRU1QX0NVUlNPUiBDVVJTT1IgRk9SCiAgICBTRUxFQ1QgRU1QX0lELCBFTVBfTkFNRSwgRU1QX1NBTEFSWQogICAgRlJPTSBFTVBMT1lFRQogICAgV0hFUkUgREVQQVJUTUVOVCA9ICdTQUxFUycKRU5ELUVYRUMu"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>EXEC SQL
    DECLARE EMP_CURSOR CURSOR FOR
    SELECT EMP_ID, EMP_NAME, EMP_SALARY
    FROM EMPLOYEE
    WHERE DEPARTMENT = 'SALES'
END-EXEC.</pre></div><div class='content'><p>In this example, <code>EMP_CURSOR</code> is declared to select employee details from the <code>EMPLOYEE</code> table where the department is 'SALES'.</p>
</div><h1><p>Opening a Cursor</p>
</h1>
<div class='content'><p>After declaring the cursor, you need to open it to execute the SQL query and establish the result set.</p>
</div><h2><p>Example</p>
</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("RVhFQyBTUUwKICAgIE9QRU4gRU1QX0NVUlNPUgpFTkQtRVhFQy4="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>EXEC SQL
    OPEN EMP_CURSOR
END-EXEC.</pre></div><div class='content'></div><h1><p>Fetching Data</p>
</h1>
<div class='content'><p>Once the cursor is open, you can fetch rows from the result set. The <code>FETCH</code> statement retrieves the next row and moves the cursor to the subsequent row.</p>
</div><h2><p>Example</p>
</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("RVhFQyBTUUwKICAgIEZFVENIIEVNUF9DVVJTT1IgSU5UTyA6RU1QLUlELCA6RU1QLU5BTUUsIDpFTVAtU0FMQVJZCkVORC1FWEVDLg=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>EXEC SQL
    FETCH EMP_CURSOR INTO :EMP-ID, :EMP-NAME, :EMP-SALARY
END-EXEC.</pre></div><div class='content'><p>In this example, the <code>FETCH</code> statement retrieves the next row from <code>EMP_CURSOR</code> and stores the values into COBOL variables <code>EMP-ID</code>, <code>EMP-NAME</code>, and <code>EMP-SALARY</code>.</p>
</div><h2><p>Looping Through Rows</p>
</h2>
<div class='content'><p>Typically, you will use a loop to fetch all rows from the cursor until no more rows are available.</p>
</div><h2><p>Example</p>
</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("UEVSRk9STSBVTlRJTCBTUUxDT0RFIE5PVCA9IDAKICAgIEVYRUMgU1FMCiAgICAgICAgRkVUQ0ggRU1QX0NVUlNPUiBJTlRPIDpFTVAtSUQsIDpFTVAtTkFNRSwgOkVNUC1TQUxBUlkKICAgIEVORC1FWEVDCgogICAgSUYgU1FMQ09ERSA9IDAKICAgICAgICBESVNQTEFZICdFbXBsb3llZSBJRDogJyBFTVAtSUQKICAgICAgICBESVNQTEFZICdFbXBsb3llZSBOYW1lOiAnIEVNUC1OQU1FCiAgICAgICAgRElTUExBWSAnRW1wbG95ZWUgU2FsYXJ5OiAnIEVNUC1TQUxBUlkKICAgIEVORC1JRgpFTkQtUEVSRk9STS4="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>PERFORM UNTIL SQLCODE NOT = 0
    EXEC SQL
        FETCH EMP_CURSOR INTO :EMP-ID, :EMP-NAME, :EMP-SALARY
    END-EXEC

    IF SQLCODE = 0
        DISPLAY 'Employee ID: ' EMP-ID
        DISPLAY 'Employee Name: ' EMP-NAME
        DISPLAY 'Employee Salary: ' EMP-SALARY
    END-IF
END-PERFORM.</pre></div><div class='content'><p>In this example, the loop continues fetching rows until <code>SQLCODE</code> is not equal to 0, indicating no more rows are available.</p>
</div><h1><p>Closing a Cursor</p>
</h1>
<div class='content'><p>After processing all rows, you should close the cursor to release its resources.</p>
</div><h2><p>Example</p>
</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("RVhFQyBTUUwKICAgIENMT1NFIEVNUF9DVVJTT1IKRU5ELUVYRUMu"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>EXEC SQL
    CLOSE EMP_CURSOR
END-EXEC.</pre></div><div class='content'></div><h1><p>Practical Exercise</p>
</h1>
<div class='content'></div><h2><p>Task</p>
</h2>
<div class='content'><p>Write a COBOL program that uses a cursor to fetch and display all employees' details from the <code>EMPLOYEE</code> table where the department is 'HR'.</p>
</div><h2><p>Solution</p>
</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("SURFTlRJRklDQVRJT04gRElWSVNJT04uClBST0dSQU0tSUQuIEZldGNoRW1wbG95ZWVzLgoKREFUQSBESVZJU0lPTi4KV09SS0lORy1TVE9SQUdFIFNFQ1RJT04uCjAxIEVNUC1JRCAgICAgIFBJQyA5KDUpLgowMSBFTVAtTkFNRSAgICBQSUMgWCgyMCkuCjAxIEVNUC1TQUxBUlkgIFBJQyA5KDcpVjk5LgoKRVhFQyBTUUwKICAgIElOQ0xVREUgU1FMQ0EKRU5ELUVYRUMuCgpQUk9DRURVUkUgRElWSVNJT04uCk1BSU4tTE9HSUMuCiAgICBFWEVDIFNRTAogICAgICAgIERFQ0xBUkUgSFJfQ1VSU09SIENVUlNPUiBGT1IKICAgICAgICBTRUxFQ1QgRU1QX0lELCBFTVBfTkFNRSwgRU1QX1NBTEFSWQogICAgICAgIEZST00gRU1QTE9ZRUUKICAgICAgICBXSEVSRSBERVBBUlRNRU5UID0gJ0hSJwogICAgRU5ELUVYRUMuCgogICAgRVhFQyBTUUwKICAgICAgICBPUEVOIEhSX0NVUlNPUgogICAgRU5ELUVYRUMuCgogICAgUEVSRk9STSBVTlRJTCBTUUxDT0RFIE5PVCA9IDAKICAgICAgICBFWEVDIFNRTAogICAgICAgICAgICBGRVRDSCBIUl9DVVJTT1IgSU5UTyA6RU1QLUlELCA6RU1QLU5BTUUsIDpFTVAtU0FMQVJZCiAgICAgICAgRU5ELUVYRUMKCiAgICAgICAgSUYgU1FMQ09ERSA9IDAKICAgICAgICAgICAgRElTUExBWSAnRW1wbG95ZWUgSUQ6ICcgRU1QLUlECiAgICAgICAgICAgIERJU1BMQVkgJ0VtcGxveWVlIE5hbWU6ICcgRU1QLU5BTUUKICAgICAgICAgICAgRElTUExBWSAnRW1wbG95ZWUgU2FsYXJ5OiAnIEVNUC1TQUxBUlkKICAgICAgICBFTkQtSUYKICAgIEVORC1QRVJGT1JNLgoKICAgIEVYRUMgU1FMCiAgICAgICAgQ0xPU0UgSFJfQ1VSU09SCiAgICBFTkQtRVhFQy4KCiAgICBTVE9QIFJVTi4="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>IDENTIFICATION DIVISION.
PROGRAM-ID. FetchEmployees.

DATA DIVISION.
WORKING-STORAGE SECTION.
01 EMP-ID      PIC 9(5).
01 EMP-NAME    PIC X(20).
01 EMP-SALARY  PIC 9(7)V99.

EXEC SQL
    INCLUDE SQLCA
END-EXEC.

PROCEDURE DIVISION.
MAIN-LOGIC.
    EXEC SQL
        DECLARE HR_CURSOR CURSOR FOR
        SELECT EMP_ID, EMP_NAME, EMP_SALARY
        FROM EMPLOYEE
        WHERE DEPARTMENT = 'HR'
    END-EXEC.

    EXEC SQL
        OPEN HR_CURSOR
    END-EXEC.

    PERFORM UNTIL SQLCODE NOT = 0
        EXEC SQL
            FETCH HR_CURSOR INTO :EMP-ID, :EMP-NAME, :EMP-SALARY
        END-EXEC

        IF SQLCODE = 0
            DISPLAY 'Employee ID: ' EMP-ID
            DISPLAY 'Employee Name: ' EMP-NAME
            DISPLAY 'Employee Salary: ' EMP-SALARY
        END-IF
    END-PERFORM.

    EXEC SQL
        CLOSE HR_CURSOR
    END-EXEC.

    STOP RUN.</pre></div><div class='content'></div><h2><p>Explanation</p>
</h2>
<div class='content'><ol>
<li><strong>Declare Cursor</strong>: The cursor <code>HR_CURSOR</code> is declared to select employee details from the <code>EMPLOYEE</code> table where the department is 'HR'.</li>
<li><strong>Open Cursor</strong>: The cursor is opened to execute the SQL query.</li>
<li><strong>Fetch Rows</strong>: A loop fetches each row from the cursor and displays the employee details.</li>
<li><strong>Close Cursor</strong>: The cursor is closed after all rows are processed.</li>
</ol>
</div><h1><p>Common Mistakes and Tips</p>
</h1>
<div class='content'><ul>
<li><strong>Forgetting to Close the Cursor</strong>: Always close the cursor to free up resources.</li>
<li><strong>Handling SQLCODE</strong>: Check <code>SQLCODE</code> after each <code>FETCH</code> to handle any errors or end-of-data conditions.</li>
<li><strong>Variable Mismatch</strong>: Ensure that the COBOL variables match the data types and lengths of the database columns.</li>
</ul>
</div><h1><p>Conclusion</p>
</h1>
<div class='content'><p>In this section, you learned how to handle cursors in COBOL for database operations. Cursors are powerful tools for processing multiple rows of data efficiently. By mastering cursor operations, you can build robust COBOL applications that interact seamlessly with databases. In the next module, we will explore advanced topics in COBOL, including object-oriented programming and web services.</p>
</div><div class='row navigation'>
	<div class='col-1 col-md-2'>
					<a href='08-03-database-operations' title="Database Operations">
				<span class="d-none d-md-inline">&#x25C4; Previous</span>
				<span class="d-inline d-md-none"><i class="bi bi-caret-left-square-fill"></i></span>
			</a>
			</div>
	<div class='col-10 col-md-8 text-center'>
			</div>
	<div class='col-1 col-md-2 text-end'>
					<a href='09-01-object-oriented-cobol' title="Object-Oriented COBOL">
				<span class="d-none d-md-inline">Next &#x25BA;</span>
				<span class="d-inline d-md-none"><i class="bi bi-caret-right-square-fill"></i></span>
			</a>
			</div>
</div>

			</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Advertising</h1>
			<p>This space is reserved for advertising.</p>
			<p>If you want to be a sponsor, contact us to include links in this area: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Thank you for collaborating!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. All rights reserved</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	We use cookies to improve your user experience and offer content tailored to your interests.
    <a href="#" id="btn_accept_cookies" class="button">Accept</a>
    <a href="/cookies">More Information</a>
</div>	

	</div>    
</body>
</html>
