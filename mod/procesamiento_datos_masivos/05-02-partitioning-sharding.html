<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Partitioning and Sharding</title>

    <link rel="alternate" href="https://campusempresa.com/mod/procesamiento_datos_masivos/05-02-particionamiento-sharding" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/mod/procesamiento_datos_masivos/05-02-particionament-sharding" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/mod/procesamiento_datos_masivos/05-02-partitioning-sharding" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body >
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-8 p-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo-header_enterprise.png"></a>
			</h1>
		</div>
		<div class="col-4 p-0 text-end">
			<h2 id="main_title"><cite>Building today's and tomorrow's society</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-0 m-0 text-end">
													<b id="lit_lang_es" class="px-2">EN</b>
				|
				<a href="https://campusempresa.com/mod/procesamiento_datos_masivos/05-02-partitioning-sharding" class="px-2">ES</a></b>
				|
				<a href="https://campusempresa.cat/mod/procesamiento_datos_masivos/05-02-partitioning-sharding" class="px-2">CA</a>
					</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="/objective">The Project</a>
				<a href="/about">About Us</a>
				<a href="/contribute">Contribute</a>
				<a href="/donate">Donations</a>
				<a href="/licence">License</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content">
								<div class='row navigation'>
	<div class='col-2'>
					<a href='05-01-data-compression' title="Data Compression">&#x25C4;Previous</a>
			</div>
	<div class='col-8 text-center'>
					<a href="./"><h2 style="text-decoration:underline">Partitioning and Sharding</h2></a>
			</div>
	<div class='col-2 text-end'>
					<a href='05-03-query-optimization' title="Query Optimization">Next &#x25BA;</a>
			</div>
</div>
<div class='content'></div><h1>Introduction</h1>
<div class='content'><p>Partitioning and sharding are essential techniques in massive data processing that help manage and optimize the storage and retrieval of large datasets. These techniques distribute data across multiple storage units, improving performance, scalability, and availability.</p>
</div><h1>Key Concepts</h1>
<div class='content'></div><h2>Partitioning</h2>
<div class='content'><p>Partitioning involves dividing a large dataset into smaller, more manageable pieces called partitions. Each partition can be processed independently, which enhances performance and scalability.</p>
<h4>Types of Partitioning</h4>
<ol>
<li>
<p><strong>Horizontal Partitioning</strong>:</p>
<ul>
<li>Divides data by rows.</li>
<li>Each partition contains a subset of rows from the original table.</li>
<li>Example: Splitting customer data by geographic region.</li>
</ul>
</li>
<li>
<p><strong>Vertical Partitioning</strong>:</p>
<ul>
<li>Divides data by columns.</li>
<li>Each partition contains a subset of columns from the original table.</li>
<li>Example: Separating frequently accessed columns from rarely accessed ones.</li>
</ul>
</li>
<li>
<p><strong>Range Partitioning</strong>:</p>
<ul>
<li>Divides data based on a range of values.</li>
<li>Example: Partitioning sales data by year.</li>
</ul>
</li>
<li>
<p><strong>Hash Partitioning</strong>:</p>
<ul>
<li>Uses a hash function to determine the partition for each data item.</li>
<li>Example: Distributing user data based on the hash of user IDs.</li>
</ul>
</li>
</ol>
</div><h2>Sharding</h2>
<div class='content'><p>Sharding is a specific type of partitioning used primarily in distributed databases. It involves splitting a dataset into smaller, distinct pieces called shards, each stored on a different server or node.</p>
<h4>Sharding Strategies</h4>
<ol>
<li>
<p><strong>Key-Based Sharding</strong>:</p>
<ul>
<li>Uses a key (e.g., user ID) to determine the shard.</li>
<li>Ensures even distribution of data across shards.</li>
</ul>
</li>
<li>
<p><strong>Range-Based Sharding</strong>:</p>
<ul>
<li>Divides data based on a range of values.</li>
<li>Similar to range partitioning but applied across multiple servers.</li>
</ul>
</li>
<li>
<p><strong>Directory-Based Sharding</strong>:</p>
<ul>
<li>Uses a lookup table to map data items to shards.</li>
<li>Provides flexibility but adds complexity.</li>
</ul>
</li>
</ol>
</div><h1>Practical Examples</h1>
<div class='content'></div><h2>Example 1: Horizontal Partitioning</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("LS0gQ3JlYXRlIGEgdGFibGUgZm9yIGN1c3RvbWVyIGRhdGEKQ1JFQVRFIFRBQkxFIGN1c3RvbWVycyAoCiAgICBjdXN0b21lcl9pZCBJTlQsCiAgICBuYW1lIFZBUkNIQVIoMTAwKSwKICAgIHJlZ2lvbiBWQVJDSEFSKDUwKSwKICAgIFBSSU1BUlkgS0VZIChjdXN0b21lcl9pZCkKKTsKCi0tIFBhcnRpdGlvbiB0aGUgdGFibGUgYnkgcmVnaW9uCkNSRUFURSBUQUJMRSBjdXN0b21lcnNfbm9ydGggQVMKU0VMRUNUICogRlJPTSBjdXN0b21lcnMgV0hFUkUgcmVnaW9uID0gJ05vcnRoJzsKCkNSRUFURSBUQUJMRSBjdXN0b21lcnNfc291dGggQVMKU0VMRUNUICogRlJPTSBjdXN0b21lcnMgV0hFUkUgcmVnaW9uID0gJ1NvdXRoJzs="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>-- Create a table for customer data
CREATE TABLE customers (
    customer_id INT,
    name VARCHAR(100),
    region VARCHAR(50),
    PRIMARY KEY (customer_id)
);

-- Partition the table by region
CREATE TABLE customers_north AS
SELECT * FROM customers WHERE region = 'North';

CREATE TABLE customers_south AS
SELECT * FROM customers WHERE region = 'South';</pre></div><div class='content'><p><em>Explanation</em>: This example demonstrates horizontal partitioning by creating separate tables for customers in the North and South regions.</p>
</div><h2>Example 2: Hash Sharding</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("aW1wb3J0IGhhc2hsaWIKCmRlZiBnZXRfc2hhcmQodXNlcl9pZCk6CiAgICAjIFVzZSBhIGhhc2ggZnVuY3Rpb24gdG8gZGV0ZXJtaW5lIHRoZSBzaGFyZAogICAgaGFzaF92YWx1ZSA9IGludChoYXNobGliLm1kNSh1c2VyX2lkLmVuY29kZSgpKS5oZXhkaWdlc3QoKSwgMTYpCiAgICByZXR1cm4gaGFzaF92YWx1ZSAlIDQgICMgQXNzdW1pbmcgNCBzaGFyZHMKCiMgRXhhbXBsZSB1c2FnZQp1c2VyX2lkID0gInVzZXIxMjMiCnNoYXJkID0gZ2V0X3NoYXJkKHVzZXJfaWQpCnByaW50KGYiVXNlciB7dXNlcl9pZH0gc2hvdWxkIGJlIHN0b3JlZCBpbiBzaGFyZCB7c2hhcmR9Iik="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>import hashlib

def get_shard(user_id):
    # Use a hash function to determine the shard
    hash_value = int(hashlib.md5(user_id.encode()).hexdigest(), 16)
    return hash_value % 4  # Assuming 4 shards

# Example usage
user_id = &quot;user123&quot;
shard = get_shard(user_id)
print(f&quot;User {user_id} should be stored in shard {shard}&quot;)</pre></div><div class='content'><p><em>Explanation</em>: This Python code uses a hash function to determine the shard for a given user ID, ensuring an even distribution of users across 4 shards.</p>
</div><h1>Exercises</h1>
<div class='content'></div><h2>Exercise 1: Implement Range Partitioning</h2>
<div class='content'><p><strong>Task</strong>: Create SQL statements to partition a sales table by year.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("LS0gQ3JlYXRlIGEgdGFibGUgZm9yIHNhbGVzIGRhdGEKQ1JFQVRFIFRBQkxFIHNhbGVzICgKICAgIHNhbGVfaWQgSU5ULAogICAgc2FsZV9kYXRlIERBVEUsCiAgICBhbW91bnQgREVDSU1BTCgxMCwgMiksCiAgICBQUklNQVJZIEtFWSAoc2FsZV9pZCkKKTsKCi0tIFBhcnRpdGlvbiB0aGUgdGFibGUgYnkgeWVhcgpDUkVBVEUgVEFCTEUgc2FsZXNfMjAyMSBBUwpTRUxFQ1QgKiBGUk9NIHNhbGVzIFdIRVJFIFlFQVIoc2FsZV9kYXRlKSA9IDIwMjE7CgpDUkVBVEUgVEFCTEUgc2FsZXNfMjAyMiBBUwpTRUxFQ1QgKiBGUk9NIHNhbGVzIFdIRVJFIFlFQVIoc2FsZV9kYXRlKSA9IDIwMjI7"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>-- Create a table for sales data
CREATE TABLE sales (
    sale_id INT,
    sale_date DATE,
    amount DECIMAL(10, 2),
    PRIMARY KEY (sale_id)
);

-- Partition the table by year
CREATE TABLE sales_2021 AS
SELECT * FROM sales WHERE YEAR(sale_date) = 2021;

CREATE TABLE sales_2022 AS
SELECT * FROM sales WHERE YEAR(sale_date) = 2022;</pre></div><div class='content'></div><h2>Exercise 2: Implement Key-Based Sharding</h2>
<div class='content'><p><strong>Task</strong>: Write a Python function to determine the shard for a given order ID using key-based sharding.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ZGVmIGdldF9vcmRlcl9zaGFyZChvcmRlcl9pZCk6CiAgICAjIFVzZSBhIHNpbXBsZSBtb2R1bHVzIG9wZXJhdGlvbiB0byBkZXRlcm1pbmUgdGhlIHNoYXJkCiAgICByZXR1cm4gaW50KG9yZGVyX2lkKSAlIDMgICMgQXNzdW1pbmcgMyBzaGFyZHMKCiMgRXhhbXBsZSB1c2FnZQpvcmRlcl9pZCA9ICI0NTYiCnNoYXJkID0gZ2V0X29yZGVyX3NoYXJkKG9yZGVyX2lkKQpwcmludChmIk9yZGVyIHtvcmRlcl9pZH0gc2hvdWxkIGJlIHN0b3JlZCBpbiBzaGFyZCB7c2hhcmR9Iik="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>def get_order_shard(order_id):
    # Use a simple modulus operation to determine the shard
    return int(order_id) % 3  # Assuming 3 shards

# Example usage
order_id = &quot;456&quot;
shard = get_order_shard(order_id)
print(f&quot;Order {order_id} should be stored in shard {shard}&quot;)</pre></div><div class='content'></div><h1>Solutions</h1>
<div class='content'></div><h2>Solution 1: Implement Range Partitioning</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("LS0gQ3JlYXRlIGEgdGFibGUgZm9yIHNhbGVzIGRhdGEKQ1JFQVRFIFRBQkxFIHNhbGVzICgKICAgIHNhbGVfaWQgSU5ULAogICAgc2FsZV9kYXRlIERBVEUsCiAgICBhbW91bnQgREVDSU1BTCgxMCwgMiksCiAgICBQUklNQVJZIEtFWSAoc2FsZV9pZCkKKTsKCi0tIFBhcnRpdGlvbiB0aGUgdGFibGUgYnkgeWVhcgpDUkVBVEUgVEFCTEUgc2FsZXNfMjAyMSBBUwpTRUxFQ1QgKiBGUk9NIHNhbGVzIFdIRVJFIFlFQVIoc2FsZV9kYXRlKSA9IDIwMjE7CgpDUkVBVEUgVEFCTEUgc2FsZXNfMjAyMiBBUwpTRUxFQ1QgKiBGUk9NIHNhbGVzIFdIRVJFIFlFQVIoc2FsZV9kYXRlKSA9IDIwMjI7"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>-- Create a table for sales data
CREATE TABLE sales (
    sale_id INT,
    sale_date DATE,
    amount DECIMAL(10, 2),
    PRIMARY KEY (sale_id)
);

-- Partition the table by year
CREATE TABLE sales_2021 AS
SELECT * FROM sales WHERE YEAR(sale_date) = 2021;

CREATE TABLE sales_2022 AS
SELECT * FROM sales WHERE YEAR(sale_date) = 2022;</pre></div><div class='content'></div><h2>Solution 2: Implement Key-Based Sharding</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ZGVmIGdldF9vcmRlcl9zaGFyZChvcmRlcl9pZCk6CiAgICAjIFVzZSBhIHNpbXBsZSBtb2R1bHVzIG9wZXJhdGlvbiB0byBkZXRlcm1pbmUgdGhlIHNoYXJkCiAgICByZXR1cm4gaW50KG9yZGVyX2lkKSAlIDMgICMgQXNzdW1pbmcgMyBzaGFyZHMKCiMgRXhhbXBsZSB1c2FnZQpvcmRlcl9pZCA9ICI0NTYiCnNoYXJkID0gZ2V0X29yZGVyX3NoYXJkKG9yZGVyX2lkKQpwcmludChmIk9yZGVyIHtvcmRlcl9pZH0gc2hvdWxkIGJlIHN0b3JlZCBpbiBzaGFyZCB7c2hhcmR9Iik="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>def get_order_shard(order_id):
    # Use a simple modulus operation to determine the shard
    return int(order_id) % 3  # Assuming 3 shards

# Example usage
order_id = &quot;456&quot;
shard = get_order_shard(order_id)
print(f&quot;Order {order_id} should be stored in shard {shard}&quot;)</pre></div><div class='content'></div><h1>Common Mistakes and Tips</h1>
<div class='content'><ul>
<li><strong>Mistake</strong>: Not considering the distribution of data when choosing a partitioning or sharding strategy.
<ul>
<li><strong>Tip</strong>: Analyze your data access patterns and distribution to choose the most appropriate strategy.</li>
</ul>
</li>
<li><strong>Mistake</strong>: Overcomplicating the sharding logic.
<ul>
<li><strong>Tip</strong>: Start with simple strategies and only add complexity if necessary.</li>
</ul>
</li>
</ul>
</div><h1>Conclusion</h1>
<div class='content'><p>Partitioning and sharding are powerful techniques for managing large datasets. By understanding and applying these methods, you can significantly improve the performance, scalability, and availability of your data systems. In the next module, we will explore query optimization techniques to further enhance data processing efficiency.</p>
</div><div class='row navigation'>
	<div class='col-2'>
					<a href='05-01-data-compression' title="Data Compression">&#x25C4;Previous</a>
			</div>
	<div class='col-8 text-center'>
			</div>
	<div class='col-2 text-end'>
					<a href='05-03-query-optimization' title="Query Optimization">Next &#x25BA;</a>
			</div>
</div>

			</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Advertising</h1>
			<p>This space is reserved for advertising.</p>
			<p>If you want to be a sponsor, contact us to include links in this area: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Thank you for collaborating!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. All rights reserved</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir galetes per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Accept</a>
    <a href="/cookies">More Information</a>
</div>	

	</div>    
</body>
</html>
