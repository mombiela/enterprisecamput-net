<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GraphQL Subscriptions</title>

    <link rel="alternate" href="https://campusempresa.com/mod/graphql/graphql-subscriptions" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/mod/graphql/graphql-subscriptions" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/mod/graphql/graphql-subscriptions" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body >
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-8 p-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo-header_enterprise.png"></a>
			</h1>
		</div>
		<div class="col-4 p-0 text-end">
			<h2 id="main_title"><cite>Building today's and tomorrow's society</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-0 m-0 text-end">
													<b id="lit_lang_es" class="px-2">EN</b>
				|
				<a href="https://campusempresa.com/mod/graphql/graphql-subscriptions" class="px-2">ES</a></b>
				|
				<a href="https://campusempresa.cat/mod/graphql/graphql-subscriptions" class="px-2">CA</a>
					</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="/objective">The Project</a>
				<a href="/about">About Us</a>
				<a href="/contribute">Contribute</a>
				<a href="/donate">Donations</a>
				<a href="/licence">License</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content">
								<div class='row navigation'>
	<div class='col-4'>
					<a href='relay'>&#x25C4;Relay</a>
			</div>
	<div class='col-4 text-center'>
		<a href="./" class="title">GraphQL Subscriptions</a>
	</div>
	<div class='col-4 text-end'>
					<a href='testing-graphql-apis'>Testing GraphQL APIs &#x25BA;</a>
			</div>
</div>
<div class='content'></div><h1>Introduction to GraphQL Subscriptions</h1>
<div class='content'><p>GraphQL Subscriptions are a powerful feature that allows clients to receive real-time updates from the server. Unlike queries and mutations, which are one-time operations, subscriptions maintain an active connection and push updates to the client whenever specific events occur on the server.</p>
</div><h2>Key Concepts</h2>
<div class='content'><ul>
<li><strong>Real-time Communication</strong>: Subscriptions enable real-time communication between the client and server.</li>
<li><strong>WebSockets</strong>: Subscriptions typically use WebSockets to maintain a persistent connection.</li>
<li><strong>Pub/Sub Mechanism</strong>: Subscriptions often rely on a publish/subscribe mechanism to broadcast updates to subscribed clients.</li>
</ul>
</div><h1>Setting Up GraphQL Subscriptions</h1>
<div class='content'><p>To use GraphQL Subscriptions, you need to set up a WebSocket server and configure your GraphQL server to handle subscription operations.</p>
</div><h2>Server-Side Setup</h2>
<div class='content'><ol>
<li>
<p><strong>Install Dependencies</strong>:</p>
<ul>
<li><code>graphql-subscriptions</code>: Provides a simple pub/sub implementation.</li>
<li><code>subscriptions-transport-ws</code>: WebSocket transport for GraphQL subscriptions.</li>
</ul>
<pre><code class="language-bash">npm install graphql-subscriptions subscriptions-transport-ws
</code></pre>
</li>
<li>
<p><strong>Configure WebSocket Server</strong>:</p>
<ul>
<li>Set up a WebSocket server to handle subscription requests.</li>
</ul>
<pre><code class="language-javascript">const { createServer } = require('http');
const { execute, subscribe } = require('graphql');
const { SubscriptionServer } = require('subscriptions-transport-ws');
const { makeExecutableSchema } = require('@graphql-tools/schema');

const typeDefs = `
  type Query {
    _: Boolean
  }
  type Subscription {
    messageSent: String
  }
`;

const resolvers = {
  Subscription: {
    messageSent: {
      subscribe: (_, __, { pubsub }) =&gt; pubsub.asyncIterator('MESSAGE_SENT')
    }
  }
};

const schema = makeExecutableSchema({ typeDefs, resolvers });

const server = createServer((req, res) =&gt; {
  res.writeHead(404);
  res.end();
});

server.listen(4000, () =&gt; {
  new SubscriptionServer({
    execute,
    subscribe,
    schema
  }, {
    server,
    path: '/subscriptions',
  });
  console.log('WebSocket Server is running on ws://localhost:4000/subscriptions');
});
</code></pre>
</li>
<li>
<p><strong>Publish Events</strong>:</p>
<ul>
<li>Use a pub/sub mechanism to publish events that clients can subscribe to.</li>
</ul>
<pre><code class="language-javascript">const { PubSub } = require('graphql-subscriptions');
const pubsub = new PubSub();

// Example of publishing an event
setInterval(() =&gt; {
  pubsub.publish('MESSAGE_SENT', { messageSent: 'Hello World!' });
}, 1000);
</code></pre>
</li>
</ol>
</div><h2>Client-Side Setup</h2>
<div class='content'><ol>
<li>
<p><strong>Install Dependencies</strong>:</p>
<ul>
<li><code>subscriptions-transport-ws</code>: WebSocket transport for GraphQL subscriptions.</li>
<li><code>apollo-client</code> and <code>apollo-link-ws</code>: Apollo Client and WebSocket link for handling subscriptions.</li>
</ul>
<pre><code class="language-bash">npm install subscriptions-transport-ws @apollo/client
</code></pre>
</li>
<li>
<p><strong>Configure Apollo Client</strong>:</p>
<ul>
<li>Set up Apollo Client to use WebSocket link for subscriptions.</li>
</ul>
<pre><code class="language-javascript">import { ApolloClient, InMemoryCache, split } from '@apollo/client';
import { WebSocketLink } from '@apollo/client/link/ws';
import { getMainDefinition } from '@apollo/client/utilities';

const wsLink = new WebSocketLink({
  uri: 'ws://localhost:4000/subscriptions',
  options: {
    reconnect: true
  }
});

const client = new ApolloClient({
  link: wsLink,
  cache: new InMemoryCache()
});
</code></pre>
</li>
<li>
<p><strong>Subscribe to Events</strong>:</p>
<ul>
<li>Use Apollo Client to subscribe to events.</li>
</ul>
<pre><code class="language-javascript">import { gql, useSubscription } from '@apollo/client';

const MESSAGE_SENT_SUBSCRIPTION = gql`
  subscription OnMessageSent {
    messageSent
  }
`;

function Messages() {
  const { data, loading } = useSubscription(MESSAGE_SENT_SUBSCRIPTION);

  if (loading) return &lt;p&gt;Loading...&lt;/p&gt;;
  return &lt;p&gt;New message: {data.messageSent}&lt;/p&gt;;
}
</code></pre>
</li>
</ol>
</div><h1>Conclusion</h1>
<div class='content'><p>GraphQL Subscriptions provide a robust way to implement real-time features in your applications. By leveraging WebSockets and a pub/sub mechanism, you can push updates to clients as soon as they happen. Setting up subscriptions involves configuring both the server and client to handle WebSocket connections and manage subscription events. With this knowledge, you can now implement real-time functionality in your GraphQL applications, enhancing the user experience with live updates.</p>
</div><div class='row navigation'>
	<div class='col-4'>
					<a href='relay'>&#x25C4;Relay</a>
			</div>
	<div class='col-4 text-center'>
		<a href="./" class="title">GraphQL Subscriptions</a>
	</div>
	<div class='col-4 text-end'>
					<a href='testing-graphql-apis'>Testing GraphQL APIs &#x25BA;</a>
			</div>
</div>

			</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Advertising</h1>
			<p>This space is reserved for advertising.</p>
			<p>If you want to be a sponsor, contact us to include links in this area: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Thank you for collaborating!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. All rights reserved</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir galetes per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Accept</a>
    <a href="/cookies">More Information</a>
</div>	

	</div>    
</body>
</html>
