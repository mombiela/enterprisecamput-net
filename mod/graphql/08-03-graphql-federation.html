<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GraphQL Federation</title>

    <link rel="alternate" href="https://campusempresa.com/mod/graphql/08-03-graphql-federation" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/mod/graphql/08-03-graphql-federation" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/mod/graphql/08-03-graphql-federation" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="/js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body >
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-12 col-md-8 p-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo-header_enterprise.png"></a>
			</h1>
		</div>
		<div class="col-12 col-md-4 px-0 py-2 py-md-0 text-end">
			<h2 id="main_title"><cite>Building today's and tomorrow's society</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 px-0 py-2 py-md-0 m-0 text-end">
													<b id="lit_lang_es" class="px-2">EN</b>
				|
				<a href="https://campusempresa.com/mod/graphql/08-03-graphql-federation" class="px-2">ES</a></b>
				|
				<a href="https://campusempresa.cat/mod/graphql/08-03-graphql-federation" class="px-2">CA</a>
					</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="/objective">The Project</a>
				<a href="/about">About Us</a>
				<a href="/contribute">Contribute</a>
				<a href="/donate">Donations</a>
				<a href="/licence">License</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content">
								<div class='row navigation'>
	<div class='col-2'>
					<a href='08-02-graphql-in-microservices' title="GraphQL in Microservices">&#x25C4;Previous</a>
			</div>
	<div class='col-8 text-center'>
					<a href="./"><h2 style="text-decoration:underline">GraphQL Federation</h2></a>
			</div>
	<div class='col-2 text-end'>
					<a href='08-04-case-studies' title="Case Studies">Next &#x25BA;</a>
			</div>
</div>
<div class='content'><p>GraphQL Federation is a powerful technique that allows you to compose multiple GraphQL services into a single, unified API. This approach is particularly useful in microservices architectures, where different teams or services manage different parts of the schema. Federation helps in scaling GraphQL across large organizations by enabling a modular and maintainable schema design.</p>
</div><h1>Key Concepts</h1>
<div class='content'></div><h2>1. Federated Services</h2>
<div class='content'><p>Federated services are individual GraphQL services that expose part of the overall schema. Each service is responsible for a specific domain or functionality.</p>
</div><h2>2. Gateway</h2>
<div class='content'><p>The gateway is a central service that aggregates the schemas from all federated services and provides a unified API to the clients. It handles query planning and execution across the federated services.</p>
</div><h2>3. Schema Composition</h2>
<div class='content'><p>Schema composition is the process of merging schemas from multiple federated services into a single schema. This involves resolving conflicts and ensuring that the combined schema is valid.</p>
</div><h2>4. Type Extensions</h2>
<div class='content'><p>Type extensions allow federated services to extend types defined in other services. This is useful for adding fields or relationships that span multiple services.</p>
</div><h2>5. Entities and Keys</h2>
<div class='content'><p>Entities are types that can be referenced across services. Keys are fields that uniquely identify an entity, enabling services to resolve references to entities managed by other services.</p>
</div><h1>Setting Up GraphQL Federation</h1>
<div class='content'></div><h2>Step 1: Define Federated Services</h2>
<div class='content'><p>Each federated service should define its own schema and expose it using a GraphQL server. Here's an example of a simple federated service:</p>
<p><strong>User Service Schema (user-service/schema.graphql)</strong></p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("dHlwZSBVc2VyIEBrZXkoZmllbGRzOiAiaWQiKSB7CiAgaWQ6IElEIQogIG5hbWU6IFN0cmluZyEKICBlbWFpbDogU3RyaW5nIQp9Cgp0eXBlIFF1ZXJ5IHsKICB1c2VyKGlkOiBJRCEpOiBVc2VyCn0="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>type User @key(fields: &quot;id&quot;) {
  id: ID!
  name: String!
  email: String!
}

type Query {
  user(id: ID!): User
}</pre></div><div class='content'><p><strong>User Service Resolver (user-service/resolvers.js)</strong></p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y29uc3QgeyBBcG9sbG9TZXJ2ZXIsIGdxbCB9ID0gcmVxdWlyZSgnYXBvbGxvLXNlcnZlcicpOwpjb25zdCB7IGJ1aWxkRmVkZXJhdGVkU2NoZW1hIH0gPSByZXF1aXJlKCdAYXBvbGxvL2ZlZGVyYXRpb24nKTsKCmNvbnN0IHR5cGVEZWZzID0gZ3FsYAogIHR5cGUgVXNlciBAa2V5KGZpZWxkczogImlkIikgewogICAgaWQ6IElEIQogICAgbmFtZTogU3RyaW5nIQogICAgZW1haWw6IFN0cmluZyEKICB9CgogIHR5cGUgUXVlcnkgewogICAgdXNlcihpZDogSUQhKTogVXNlcgogIH0KYDsKCmNvbnN0IHJlc29sdmVycyA9IHsKICBRdWVyeTogewogICAgdXNlcjogKF8sIHsgaWQgfSkgPT4gewogICAgICAvLyBGZXRjaCB1c2VyIGJ5IElEIGZyb20gdGhlIGRhdGFiYXNlCiAgICAgIHJldHVybiB7IGlkLCBuYW1lOiAiSm9obiBEb2UiLCBlbWFpbDogImpvaG4uZG9lQGV4YW1wbGUuY29tIiB9OwogICAgfSwKICB9LAogIFVzZXI6IHsKICAgIF9fcmVzb2x2ZVJlZmVyZW5jZSh1c2VyKSB7CiAgICAgIC8vIFJlc29sdmUgdXNlciByZWZlcmVuY2UKICAgICAgcmV0dXJuIHsgaWQ6IHVzZXIuaWQsIG5hbWU6ICJKb2huIERvZSIsIGVtYWlsOiAiam9obi5kb2VAZXhhbXBsZS5jb20iIH07CiAgICB9LAogIH0sCn07Cgpjb25zdCBzZXJ2ZXIgPSBuZXcgQXBvbGxvU2VydmVyKHsKICBzY2hlbWE6IGJ1aWxkRmVkZXJhdGVkU2NoZW1hKFt7IHR5cGVEZWZzLCByZXNvbHZlcnMgfV0pLAp9KTsKCnNlcnZlci5saXN0ZW4oeyBwb3J0OiA0MDAxIH0pLnRoZW4oKHsgdXJsIH0pID0+IHsKICBjb25zb2xlLmxvZyhgVXNlciBzZXJ2aWNlIHJlYWR5IGF0ICR7dXJsfWApOwp9KTs="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>const { ApolloServer, gql } = require('apollo-server');
const { buildFederatedSchema } = require('@apollo/federation');

const typeDefs = gql`
  type User @key(fields: &quot;id&quot;) {
    id: ID!
    name: String!
    email: String!
  }

  type Query {
    user(id: ID!): User
  }
`;

const resolvers = {
  Query: {
    user: (_, { id }) =&gt; {
      // Fetch user by ID from the database
      return { id, name: &quot;John Doe&quot;, email: &quot;john.doe@example.com&quot; };
    },
  },
  User: {
    __resolveReference(user) {
      // Resolve user reference
      return { id: user.id, name: &quot;John Doe&quot;, email: &quot;john.doe@example.com&quot; };
    },
  },
};

const server = new ApolloServer({
  schema: buildFederatedSchema([{ typeDefs, resolvers }]),
});

server.listen({ port: 4001 }).then(({ url }) =&gt; {
  console.log(`User service ready at ${url}`);
});</pre></div><div class='content'></div><h2>Step 2: Set Up the Gateway</h2>
<div class='content'><p>The gateway aggregates the schemas from all federated services and provides a unified API.</p>
<p><strong>Gateway Setup (gateway/index.js)</strong></p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y29uc3QgeyBBcG9sbG9TZXJ2ZXIgfSA9IHJlcXVpcmUoJ2Fwb2xsby1zZXJ2ZXInKTsKY29uc3QgeyBBcG9sbG9HYXRld2F5IH0gPSByZXF1aXJlKCdAYXBvbGxvL2dhdGV3YXknKTsKCmNvbnN0IGdhdGV3YXkgPSBuZXcgQXBvbGxvR2F0ZXdheSh7CiAgc2VydmljZUxpc3Q6IFsKICAgIHsgbmFtZTogJ3VzZXInLCB1cmw6ICdodHRwOi8vbG9jYWxob3N0OjQwMDEnIH0sCiAgICAvLyBBZGQgb3RoZXIgZmVkZXJhdGVkIHNlcnZpY2VzIGhlcmUKICBdLAp9KTsKCmNvbnN0IHNlcnZlciA9IG5ldyBBcG9sbG9TZXJ2ZXIoewogIGdhdGV3YXksCiAgc3Vic2NyaXB0aW9uczogZmFsc2UsCn0pOwoKc2VydmVyLmxpc3Rlbih7IHBvcnQ6IDQwMDAgfSkudGhlbigoeyB1cmwgfSkgPT4gewogIGNvbnNvbGUubG9nKGBHYXRld2F5IHJlYWR5IGF0ICR7dXJsfWApOwp9KTs="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>const { ApolloServer } = require('apollo-server');
const { ApolloGateway } = require('@apollo/gateway');

const gateway = new ApolloGateway({
  serviceList: [
    { name: 'user', url: 'http://localhost:4001' },
    // Add other federated services here
  ],
});

const server = new ApolloServer({
  gateway,
  subscriptions: false,
});

server.listen({ port: 4000 }).then(({ url }) =&gt; {
  console.log(`Gateway ready at ${url}`);
});</pre></div><div class='content'></div><h2>Step 3: Extend Types Across Services</h2>
<div class='content'><p>Federated services can extend types defined in other services. For example, a <code>Post</code> service can extend the <code>User</code> type to include posts authored by the user.</p>
<p><strong>Post Service Schema (post-service/schema.graphql)</strong></p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ZXh0ZW5kIHR5cGUgVXNlciBAa2V5KGZpZWxkczogImlkIikgewogIGlkOiBJRCEgQGV4dGVybmFsCiAgcG9zdHM6IFtQb3N0XQp9Cgp0eXBlIFBvc3QgewogIGlkOiBJRCEKICB0aXRsZTogU3RyaW5nIQogIGNvbnRlbnQ6IFN0cmluZyEKICBhdXRob3JJZDogSUQhCn0KCnR5cGUgUXVlcnkgewogIHBvc3RzQnlVc2VyKHVzZXJJZDogSUQhKTogW1Bvc3RdCn0="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>extend type User @key(fields: &quot;id&quot;) {
  id: ID! @external
  posts: [Post]
}

type Post {
  id: ID!
  title: String!
  content: String!
  authorId: ID!
}

type Query {
  postsByUser(userId: ID!): [Post]
}</pre></div><div class='content'><p><strong>Post Service Resolver (post-service/resolvers.js)</strong></p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y29uc3QgeyBBcG9sbG9TZXJ2ZXIsIGdxbCB9ID0gcmVxdWlyZSgnYXBvbGxvLXNlcnZlcicpOwpjb25zdCB7IGJ1aWxkRmVkZXJhdGVkU2NoZW1hIH0gPSByZXF1aXJlKCdAYXBvbGxvL2ZlZGVyYXRpb24nKTsKCmNvbnN0IHR5cGVEZWZzID0gZ3FsYAogIGV4dGVuZCB0eXBlIFVzZXIgQGtleShmaWVsZHM6ICJpZCIpIHsKICAgIGlkOiBJRCEgQGV4dGVybmFsCiAgICBwb3N0czogW1Bvc3RdCiAgfQoKICB0eXBlIFBvc3QgewogICAgaWQ6IElEIQogICAgdGl0bGU6IFN0cmluZyEKICAgIGNvbnRlbnQ6IFN0cmluZyEKICAgIGF1dGhvcklkOiBJRCEKICB9CgogIHR5cGUgUXVlcnkgewogICAgcG9zdHNCeVVzZXIodXNlcklkOiBJRCEpOiBbUG9zdF0KICB9CmA7Cgpjb25zdCByZXNvbHZlcnMgPSB7CiAgVXNlcjogewogICAgcG9zdHModXNlcikgewogICAgICAvLyBGZXRjaCBwb3N0cyBieSB1c2VyIElEIGZyb20gdGhlIGRhdGFiYXNlCiAgICAgIHJldHVybiBbCiAgICAgICAgeyBpZDogIjEiLCB0aXRsZTogIlBvc3QgMSIsIGNvbnRlbnQ6ICJDb250ZW50IDEiLCBhdXRob3JJZDogdXNlci5pZCB9LAogICAgICAgIHsgaWQ6ICIyIiwgdGl0bGU6ICJQb3N0IDIiLCBjb250ZW50OiAiQ29udGVudCAyIiwgYXV0aG9ySWQ6IHVzZXIuaWQgfSwKICAgICAgXTsKICAgIH0sCiAgfSwKICBRdWVyeTogewogICAgcG9zdHNCeVVzZXI6IChfLCB7IHVzZXJJZCB9KSA9PiB7CiAgICAgIC8vIEZldGNoIHBvc3RzIGJ5IHVzZXIgSUQgZnJvbSB0aGUgZGF0YWJhc2UKICAgICAgcmV0dXJuIFsKICAgICAgICB7IGlkOiAiMSIsIHRpdGxlOiAiUG9zdCAxIiwgY29udGVudDogIkNvbnRlbnQgMSIsIGF1dGhvcklkOiB1c2VySWQgfSwKICAgICAgICB7IGlkOiAiMiIsIHRpdGxlOiAiUG9zdCAyIiwgY29udGVudDogIkNvbnRlbnQgMiIsIGF1dGhvcklkOiB1c2VySWQgfSwKICAgICAgXTsKICAgIH0sCiAgfSwKfTsKCmNvbnN0IHNlcnZlciA9IG5ldyBBcG9sbG9TZXJ2ZXIoewogIHNjaGVtYTogYnVpbGRGZWRlcmF0ZWRTY2hlbWEoW3sgdHlwZURlZnMsIHJlc29sdmVycyB9XSksCn0pOwoKc2VydmVyLmxpc3Rlbih7IHBvcnQ6IDQwMDIgfSkudGhlbigoeyB1cmwgfSkgPT4gewogIGNvbnNvbGUubG9nKGBQb3N0IHNlcnZpY2UgcmVhZHkgYXQgJHt1cmx9YCk7Cn0pOw=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>const { ApolloServer, gql } = require('apollo-server');
const { buildFederatedSchema } = require('@apollo/federation');

const typeDefs = gql`
  extend type User @key(fields: &quot;id&quot;) {
    id: ID! @external
    posts: [Post]
  }

  type Post {
    id: ID!
    title: String!
    content: String!
    authorId: ID!
  }

  type Query {
    postsByUser(userId: ID!): [Post]
  }
`;

const resolvers = {
  User: {
    posts(user) {
      // Fetch posts by user ID from the database
      return [
        { id: &quot;1&quot;, title: &quot;Post 1&quot;, content: &quot;Content 1&quot;, authorId: user.id },
        { id: &quot;2&quot;, title: &quot;Post 2&quot;, content: &quot;Content 2&quot;, authorId: user.id },
      ];
    },
  },
  Query: {
    postsByUser: (_, { userId }) =&gt; {
      // Fetch posts by user ID from the database
      return [
        { id: &quot;1&quot;, title: &quot;Post 1&quot;, content: &quot;Content 1&quot;, authorId: userId },
        { id: &quot;2&quot;, title: &quot;Post 2&quot;, content: &quot;Content 2&quot;, authorId: userId },
      ];
    },
  },
};

const server = new ApolloServer({
  schema: buildFederatedSchema([{ typeDefs, resolvers }]),
});

server.listen({ port: 4002 }).then(({ url }) =&gt; {
  console.log(`Post service ready at ${url}`);
});</pre></div><div class='content'></div><h2>Step 4: Query the Unified API</h2>
<div class='content'><p>Clients can now query the unified API provided by the gateway, which will delegate the queries to the appropriate federated services.</p>
<p><strong>Example Query</strong></p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("cXVlcnkgewogIHVzZXIoaWQ6ICIxIikgewogICAgaWQKICAgIG5hbWUKICAgIGVtYWlsCiAgICBwb3N0cyB7CiAgICAgIGlkCiAgICAgIHRpdGxlCiAgICAgIGNvbnRlbnQKICAgIH0KICB9Cn0="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>query {
  user(id: &quot;1&quot;) {
    id
    name
    email
    posts {
      id
      title
      content
    }
  }
}</pre></div><div class='content'></div><h1>Practical Exercise</h1>
<div class='content'></div><h2>Exercise: Implement a Federated Service</h2>
<div class='content'><ol>
<li>
<p><strong>Create a Product Service</strong></p>
<ul>
<li>Define a <code>Product</code> type with fields <code>id</code>, <code>name</code>, and <code>price</code>.</li>
<li>Implement a query to fetch a product by ID.</li>
</ul>
</li>
<li>
<p><strong>Extend the User Type</strong></p>
<ul>
<li>Extend the <code>User</code> type in the Product service to include a list of products purchased by the user.</li>
</ul>
</li>
<li>
<p><strong>Set Up the Gateway</strong></p>
<ul>
<li>Add the Product service to the gateway's service list.</li>
</ul>
</li>
<li>
<p><strong>Query the Unified API</strong></p>
<ul>
<li>Write a query to fetch a user along with the products they have purchased.</li>
</ul>
</li>
</ol>
</div><h2>Solution</h2>
<div class='content'><p><strong>Product Service Schema (product-service/schema.graphql)</strong></p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ZXh0ZW5kIHR5cGUgVXNlciBAa2V5KGZpZWxkczogImlkIikgewogIGlkOiBJRCEgQGV4dGVybmFsCiAgcHVyY2hhc2VkUHJvZHVjdHM6IFtQcm9kdWN0XQp9Cgp0eXBlIFByb2R1Y3QgewogIGlkOiBJRCEKICBuYW1lOiBTdHJpbmchCiAgcHJpY2U6IEZsb2F0IQp9Cgp0eXBlIFF1ZXJ5IHsKICBwcm9kdWN0KGlkOiBJRCEpOiBQcm9kdWN0Cn0="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>extend type User @key(fields: &quot;id&quot;) {
  id: ID! @external
  purchasedProducts: [Product]
}

type Product {
  id: ID!
  name: String!
  price: Float!
}

type Query {
  product(id: ID!): Product
}</pre></div><div class='content'><p><strong>Product Service Resolver (product-service/resolvers.js)</strong></p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y29uc3QgeyBBcG9sbG9TZXJ2ZXIsIGdxbCB9ID0gcmVxdWlyZSgnYXBvbGxvLXNlcnZlcicpOwpjb25zdCB7IGJ1aWxkRmVkZXJhdGVkU2NoZW1hIH0gPSByZXF1aXJlKCdAYXBvbGxvL2ZlZGVyYXRpb24nKTsKCmNvbnN0IHR5cGVEZWZzID0gZ3FsYAogIGV4dGVuZCB0eXBlIFVzZXIgQGtleShmaWVsZHM6ICJpZCIpIHsKICAgIGlkOiBJRCEgQGV4dGVybmFsCiAgICBwdXJjaGFzZWRQcm9kdWN0czogW1Byb2R1Y3RdCiAgfQoKICB0eXBlIFByb2R1Y3QgewogICAgaWQ6IElEIQogICAgbmFtZTogU3RyaW5nIQogICAgcHJpY2U6IEZsb2F0IQogIH0KCiAgdHlwZSBRdWVyeSB7CiAgICBwcm9kdWN0KGlkOiBJRCEpOiBQcm9kdWN0CiAgfQpgOwoKY29uc3QgcmVzb2x2ZXJzID0gewogIFVzZXI6IHsKICAgIHB1cmNoYXNlZFByb2R1Y3RzKHVzZXIpIHsKICAgICAgLy8gRmV0Y2ggcHJvZHVjdHMgcHVyY2hhc2VkIGJ5IHVzZXIgSUQgZnJvbSB0aGUgZGF0YWJhc2UKICAgICAgcmV0dXJuIFsKICAgICAgICB7IGlkOiAiMSIsIG5hbWU6ICJQcm9kdWN0IDEiLCBwcmljZTogMTAwLjAgfSwKICAgICAgICB7IGlkOiAiMiIsIG5hbWU6ICJQcm9kdWN0IDIiLCBwcmljZTogMjAwLjAgfSwKICAgICAgXTsKICAgIH0sCiAgfSwKICBRdWVyeTogewogICAgcHJvZHVjdDogKF8sIHsgaWQgfSkgPT4gewogICAgICAvLyBGZXRjaCBwcm9kdWN0IGJ5IElEIGZyb20gdGhlIGRhdGFiYXNlCiAgICAgIHJldHVybiB7IGlkLCBuYW1lOiAiUHJvZHVjdCAxIiwgcHJpY2U6IDEwMC4wIH07CiAgICB9LAogIH0sCn07Cgpjb25zdCBzZXJ2ZXIgPSBuZXcgQXBvbGxvU2VydmVyKHsKICBzY2hlbWE6IGJ1aWxkRmVkZXJhdGVkU2NoZW1hKFt7IHR5cGVEZWZzLCByZXNvbHZlcnMgfV0pLAp9KTsKCnNlcnZlci5saXN0ZW4oeyBwb3J0OiA0MDAzIH0pLnRoZW4oKHsgdXJsIH0pID0+IHsKICBjb25zb2xlLmxvZyhgUHJvZHVjdCBzZXJ2aWNlIHJlYWR5IGF0ICR7dXJsfWApOwp9KTs="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>const { ApolloServer, gql } = require('apollo-server');
const { buildFederatedSchema } = require('@apollo/federation');

const typeDefs = gql`
  extend type User @key(fields: &quot;id&quot;) {
    id: ID! @external
    purchasedProducts: [Product]
  }

  type Product {
    id: ID!
    name: String!
    price: Float!
  }

  type Query {
    product(id: ID!): Product
  }
`;

const resolvers = {
  User: {
    purchasedProducts(user) {
      // Fetch products purchased by user ID from the database
      return [
        { id: &quot;1&quot;, name: &quot;Product 1&quot;, price: 100.0 },
        { id: &quot;2&quot;, name: &quot;Product 2&quot;, price: 200.0 },
      ];
    },
  },
  Query: {
    product: (_, { id }) =&gt; {
      // Fetch product by ID from the database
      return { id, name: &quot;Product 1&quot;, price: 100.0 };
    },
  },
};

const server = new ApolloServer({
  schema: buildFederatedSchema([{ typeDefs, resolvers }]),
});

server.listen({ port: 4003 }).then(({ url }) =&gt; {
  console.log(`Product service ready at ${url}`);
});</pre></div><div class='content'><p><strong>Gateway Setup (gateway/index.js)</strong></p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y29uc3QgeyBBcG9sbG9TZXJ2ZXIgfSA9IHJlcXVpcmUoJ2Fwb2xsby1zZXJ2ZXInKTsKY29uc3QgeyBBcG9sbG9HYXRld2F5IH0gPSByZXF1aXJlKCdAYXBvbGxvL2dhdGV3YXknKTsKCmNvbnN0IGdhdGV3YXkgPSBuZXcgQXBvbGxvR2F0ZXdheSh7CiAgc2VydmljZUxpc3Q6IFsKICAgIHsgbmFtZTogJ3VzZXInLCB1cmw6ICdodHRwOi8vbG9jYWxob3N0OjQwMDEnIH0sCiAgICB7IG5hbWU6ICdwb3N0JywgdXJsOiAnaHR0cDovL2xvY2FsaG9zdDo0MDAyJyB9LAogICAgeyBuYW1lOiAncHJvZHVjdCcsIHVybDogJ2h0dHA6Ly9sb2NhbGhvc3Q6NDAwMycgfSwKICBdLAp9KTsKCmNvbnN0IHNlcnZlciA9IG5ldyBBcG9sbG9TZXJ2ZXIoewogIGdhdGV3YXksCiAgc3Vic2NyaXB0aW9uczogZmFsc2UsCn0pOwoKc2VydmVyLmxpc3Rlbih7IHBvcnQ6IDQwMDAgfSkudGhlbigoeyB1cmwgfSkgPT4gewogIGNvbnNvbGUubG9nKGBHYXRld2F5IHJlYWR5IGF0ICR7dXJsfWApOwp9KTs="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>const { ApolloServer } = require('apollo-server');
const { ApolloGateway } = require('@apollo/gateway');

const gateway = new ApolloGateway({
  serviceList: [
    { name: 'user', url: 'http://localhost:4001' },
    { name: 'post', url: 'http://localhost:4002' },
    { name: 'product', url: 'http://localhost:4003' },
  ],
});

const server = new ApolloServer({
  gateway,
  subscriptions: false,
});

server.listen({ port: 4000 }).then(({ url }) =&gt; {
  console.log(`Gateway ready at ${url}`);
});</pre></div><div class='content'><p><strong>Example Query</strong></p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("cXVlcnkgewogIHVzZXIoaWQ6ICIxIikgewogICAgaWQKICAgIG5hbWUKICAgIGVtYWlsCiAgICBwdXJjaGFzZWRQcm9kdWN0cyB7CiAgICAgIGlkCiAgICAgIG5hbWUKICAgICAgcHJpY2UKICAgIH0KICB9Cn0="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>query {
  user(id: &quot;1&quot;) {
    id
    name
    email
    purchasedProducts {
      id
      name
      price
    }
  }
}</pre></div><div class='content'></div><h1>Conclusion</h1>
<div class='content'><p>GraphQL Federation is a robust solution for scaling GraphQL across large organizations and microservices architectures. By composing multiple GraphQL services into a single, unified API, you can achieve a modular and maintainable schema design. This module covered the key concepts of federation, setting up federated services, extending types across services, and querying the unified API. With practical examples and exercises, you should now be equipped to implement GraphQL Federation in your own projects.</p>
</div><div class='row navigation'>
	<div class='col-2'>
					<a href='08-02-graphql-in-microservices' title="GraphQL in Microservices">&#x25C4;Previous</a>
			</div>
	<div class='col-8 text-center'>
			</div>
	<div class='col-2 text-end'>
					<a href='08-04-case-studies' title="Case Studies">Next &#x25BA;</a>
			</div>
</div>

			</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Advertising</h1>
			<p>This space is reserved for advertising.</p>
			<p>If you want to be a sponsor, contact us to include links in this area: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Thank you for collaborating!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. All rights reserved</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir galetes per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Accept</a>
    <a href="/cookies">More Information</a>
</div>	

	</div>    
</body>
</html>
