<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Directives in GraphQL</title>

    <link rel="alternate" href="https://campusempresa.com/mod/graphql/directives" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/mod/graphql/directives" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/mod/graphql/directives" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body >
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-8 p-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo-header_enterprise.png"></a>
			</h1>
		</div>
		<div class="col-4 p-0 text-end">
			<h2 id="main_title"><cite>Building today's and tomorrow's society</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-0 m-0 text-end">
													<b id="lit_lang_es" class="px-2">EN</b>
				|
				<a href="https://campusempresa.com/mod/graphql/directives" class="px-2">ES</a></b>
				|
				<a href="https://campusempresa.cat/mod/graphql/directives" class="px-2">CA</a>
					</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="/objective">The Project</a>
				<a href="/about">About Us</a>
				<a href="/contribute">Contribute</a>
				<a href="/donate">Donations</a>
				<a href="/licence">License</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content">
								<div class='row navigation'>
	<div class='col-4'>
					<a href='interfaces'>&#x25C4;Interfaces</a>
			</div>
	<div class='col-4 text-center'>
		<a href="./" class="title">Directives in GraphQL</a>
	</div>
	<div class='col-4 text-end'>
					<a href='schema-stitching'>Schema Stitching &#x25BA;</a>
			</div>
</div>
<div class='content'><p>Directives are a powerful feature in GraphQL that allow you to dynamically alter the execution of your queries and schemas. They provide a way to customize the behavior of your GraphQL server and client interactions. In this section, we will explore what directives are, how to use them, and some common use cases.</p>
</div><h1>What are Directives?</h1>
<div class='content'><p>Directives are special annotations in GraphQL that can be attached to fields, fragments, or operations to modify their behavior. They are prefixed with an <code>@</code> symbol and can be used to conditionally include or exclude parts of a query, among other things.</p>
</div><h2>Key Concepts</h2>
<div class='content'><ul>
<li><strong>Annotation</strong>: Directives are annotations that can be added to GraphQL queries and schemas.</li>
<li><strong>Conditional Execution</strong>: They allow for conditional inclusion or exclusion of fields and fragments.</li>
<li><strong>Custom Directives</strong>: You can define your own directives to extend the functionality of your GraphQL server.</li>
</ul>
</div><h1>Built-in Directives</h1>
<div class='content'><p>GraphQL comes with two built-in directives: <code>@include</code> and <code>@skip</code>.</p>
</div><h2>@include Directive</h2>
<div class='content'><p>The <code>@include</code> directive conditionally includes a field or fragment only if the specified argument is true.</p>
<h4>Syntax</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ZGlyZWN0aXZlIEBpbmNsdWRlKGlmOiBCb29sZWFuISkgb24gRklFTEQgfCBGUkFHTUVOVF9TUFJFQUQgfCBJTkxJTkVfRlJBR01FTlQ="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>directive @include(if: Boolean!) on FIELD | FRAGMENT_SPREAD | INLINE_FRAGMENT</pre></div><div class='content'><h4>Example</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("cXVlcnkgR2V0VXNlcigkaW5jbHVkZUFkZHJlc3M6IEJvb2xlYW4hKSB7CiAgdXNlcihpZDogIjEiKSB7CiAgICBuYW1lCiAgICBlbWFpbAogICAgYWRkcmVzcyBAaW5jbHVkZShpZjogJGluY2x1ZGVBZGRyZXNzKSB7CiAgICAgIHN0cmVldAogICAgICBjaXR5CiAgICAgIGNvdW50cnkKICAgIH0KICB9Cn0="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>query GetUser($includeAddress: Boolean!) {
  user(id: &quot;1&quot;) {
    name
    email
    address @include(if: $includeAddress) {
      street
      city
      country
    }
  }
}</pre></div><div class='content'><p>In this example, the <code>address</code> field will only be included in the response if the variable <code>$includeAddress</code> is true.</p>
</div><h2>@skip Directive</h2>
<div class='content'><p>The <code>@skip</code> directive conditionally excludes a field or fragment if the specified argument is true.</p>
<h4>Syntax</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ZGlyZWN0aXZlIEBza2lwKGlmOiBCb29sZWFuISkgb24gRklFTEQgfCBGUkFHTUVOVF9TUFJFQUQgfCBJTkxJTkVfRlJBR01FTlQ="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>directive @skip(if: Boolean!) on FIELD | FRAGMENT_SPREAD | INLINE_FRAGMENT</pre></div><div class='content'><h4>Example</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("cXVlcnkgR2V0VXNlcigkc2tpcEFkZHJlc3M6IEJvb2xlYW4hKSB7CiAgdXNlcihpZDogIjEiKSB7CiAgICBuYW1lCiAgICBlbWFpbAogICAgYWRkcmVzcyBAc2tpcChpZjogJHNraXBBZGRyZXNzKSB7CiAgICAgIHN0cmVldAogICAgICBjaXR5CiAgICAgIGNvdW50cnkKICAgIH0KICB9Cn0="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>query GetUser($skipAddress: Boolean!) {
  user(id: &quot;1&quot;) {
    name
    email
    address @skip(if: $skipAddress) {
      street
      city
      country
    }
  }
}</pre></div><div class='content'><p>In this example, the <code>address</code> field will be excluded from the response if the variable <code>$skipAddress</code> is true.</p>
</div><h1>Custom Directives</h1>
<div class='content'><p>You can define your own directives to add custom behavior to your GraphQL server. Custom directives are defined in the schema and can be used to implement features like authentication, logging, or data transformation.</p>
</div><h2>Defining a Custom Directive</h2>
<div class='content'><p>To define a custom directive, you need to add it to your schema using the <code>directive</code> keyword.</p>
<h4>Example</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ZGlyZWN0aXZlIEBhdXRoKHJlcXVpcmVzOiBSb2xlID0gQURNSU4pIG9uIEZJRUxEX0RFRklOSVRJT04KCmVudW0gUm9sZSB7CiAgQURNSU4KICBVU0VSCn0="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>directive @auth(requires: Role = ADMIN) on FIELD_DEFINITION

enum Role {
  ADMIN
  USER
}</pre></div><div class='content'><p>In this example, we define an <code>@auth</code> directive that takes a <code>requires</code> argument of type <code>Role</code>.</p>
</div><h2>Using a Custom Directive</h2>
<div class='content'><p>Once defined, you can use the custom directive in your schema.</p>
<h4>Example</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("dHlwZSBRdWVyeSB7CiAgc2VjcmV0RGF0YTogU3RyaW5nIEBhdXRoKHJlcXVpcmVzOiBBRE1JTikKfQ=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>type Query {
  secretData: String @auth(requires: ADMIN)
}</pre></div><div class='content'><p>In this example, the <code>secretData</code> field is protected by the <code>@auth</code> directive, which requires the user to have an <code>ADMIN</code> role.</p>
</div><h2>Implementing Custom Directive Logic</h2>
<div class='content'><p>To implement the logic for a custom directive, you need to write a directive resolver in your server code.</p>
<h4>Example (JavaScript with Apollo Server)</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y29uc3QgeyBTY2hlbWFEaXJlY3RpdmVWaXNpdG9yIH0gPSByZXF1aXJlKCdhcG9sbG8tc2VydmVyJyk7CmNvbnN0IHsgZGVmYXVsdEZpZWxkUmVzb2x2ZXIgfSA9IHJlcXVpcmUoJ2dyYXBocWwnKTsKCmNsYXNzIEF1dGhEaXJlY3RpdmUgZXh0ZW5kcyBTY2hlbWFEaXJlY3RpdmVWaXNpdG9yIHsKICB2aXNpdEZpZWxkRGVmaW5pdGlvbihmaWVsZCkgewogICAgY29uc3QgeyByZXNvbHZlID0gZGVmYXVsdEZpZWxkUmVzb2x2ZXIgfSA9IGZpZWxkOwogICAgY29uc3QgeyByZXF1aXJlcyB9ID0gdGhpcy5hcmdzOwoKICAgIGZpZWxkLnJlc29sdmUgPSBhc3luYyBmdW5jdGlvbiAoLi4uYXJncykgewogICAgICBjb25zdCBjb250ZXh0ID0gYXJnc1syXTsKICAgICAgaWYgKCFjb250ZXh0LnVzZXIgfHwgIWNvbnRleHQudXNlci5yb2xlcy5pbmNsdWRlcyhyZXF1aXJlcykpIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIk5vdCBhdXRob3JpemVkIik7CiAgICAgIH0KICAgICAgcmV0dXJuIHJlc29sdmUuYXBwbHkodGhpcywgYXJncyk7CiAgICB9OwogIH0KfQoKY29uc3QgdHlwZURlZnMgPSBgCiAgZGlyZWN0aXZlIEBhdXRoKHJlcXVpcmVzOiBSb2xlID0gQURNSU4pIG9uIEZJRUxEX0RFRklOSVRJT04KCiAgZW51bSBSb2xlIHsKICAgIEFETUlOCiAgICBVU0VSCiAgfQoKICB0eXBlIFF1ZXJ5IHsKICAgIHNlY3JldERhdGE6IFN0cmluZyBAYXV0aChyZXF1aXJlczogQURNSU4pCiAgfQpgOwoKY29uc3QgcmVzb2x2ZXJzID0gewogIFF1ZXJ5OiB7CiAgICBzZWNyZXREYXRhOiAoKSA9PiAiVGhpcyBpcyBzZWNyZXQgZGF0YSIsCiAgfSwKfTsKCmNvbnN0IHNlcnZlciA9IG5ldyBBcG9sbG9TZXJ2ZXIoewogIHR5cGVEZWZzLAogIHJlc29sdmVycywKICBzY2hlbWFEaXJlY3RpdmVzOiB7CiAgICBhdXRoOiBBdXRoRGlyZWN0aXZlLAogIH0sCiAgY29udGV4dDogKHsgcmVxIH0pID0+IHsKICAgIC8vIE1vY2sgdXNlciBjb250ZXh0CiAgICByZXR1cm4gewogICAgICB1c2VyOiB7CiAgICAgICAgcm9sZXM6IFsnVVNFUiddLAogICAgICB9LAogICAgfTsKICB9LAp9KTsKCnNlcnZlci5saXN0ZW4oKS50aGVuKCh7IHVybCB9KSA9PiB7CiAgY29uc29sZS5sb2coYPCfmoAgU2VydmVyIHJlYWR5IGF0ICR7dXJsfWApOwp9KTs="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>const { SchemaDirectiveVisitor } = require('apollo-server');
const { defaultFieldResolver } = require('graphql');

class AuthDirective extends SchemaDirectiveVisitor {
  visitFieldDefinition(field) {
    const { resolve = defaultFieldResolver } = field;
    const { requires } = this.args;

    field.resolve = async function (...args) {
      const context = args[2];
      if (!context.user || !context.user.roles.includes(requires)) {
        throw new Error(&quot;Not authorized&quot;);
      }
      return resolve.apply(this, args);
    };
  }
}

const typeDefs = `
  directive @auth(requires: Role = ADMIN) on FIELD_DEFINITION

  enum Role {
    ADMIN
    USER
  }

  type Query {
    secretData: String @auth(requires: ADMIN)
  }
`;

const resolvers = {
  Query: {
    secretData: () =&gt; &quot;This is secret data&quot;,
  },
};

const server = new ApolloServer({
  typeDefs,
  resolvers,
  schemaDirectives: {
    auth: AuthDirective,
  },
  context: ({ req }) =&gt; {
    // Mock user context
    return {
      user: {
        roles: ['USER'],
      },
    };
  },
});

server.listen().then(({ url }) =&gt; {
  console.log(`ðŸš€ Server ready at ${url}`);
});</pre></div><div class='content'><p>In this example, the <code>AuthDirective</code> class extends <code>SchemaDirectiveVisitor</code> and overrides the <code>visitFieldDefinition</code> method to implement the authorization logic.</p>
</div><h1>Conclusion</h1>
<div class='content'><p>Directives in GraphQL are a versatile tool that can help you control the execution of your queries and extend the functionality of your GraphQL server. By understanding and utilizing both built-in and custom directives, you can create more dynamic and powerful GraphQL applications. Whether you need to conditionally include fields, enforce authorization, or implement custom behaviors, directives provide a flexible solution to meet your needs.</p>
</div><div class='row navigation'>
	<div class='col-4'>
					<a href='interfaces'>&#x25C4;Interfaces</a>
			</div>
	<div class='col-4 text-center'>
		<a href="./" class="title">Directives in GraphQL</a>
	</div>
	<div class='col-4 text-end'>
					<a href='schema-stitching'>Schema Stitching &#x25BA;</a>
			</div>
</div>

			</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Advertising</h1>
			<p>This space is reserved for advertising.</p>
			<p>If you want to be a sponsor, contact us to include links in this area: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Thank you for collaborating!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. All rights reserved</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir galetes per millorar la teva experiÃ¨ncia d'Ãºs i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Accept</a>
    <a href="/cookies">More Information</a>
</div>	

	</div>    
</body>
</html>
