<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Query Optimization</title>

    <link rel="alternate" href="https://campusempresa.com/mod/graphql/05-01-query-optimization" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/mod/graphql/05-01-query-optimization" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/mod/graphql/05-01-query-optimization" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body >
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-12 col-md-8 p-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo-header_enterprise.png"></a>
			</h1>
		</div>
		<div class="col-12 col-md-4 p-0 text-end">
			<h2 id="main_title"><cite>Building today's and tomorrow's society</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-0 m-0 text-end">
													<b id="lit_lang_es" class="px-2">EN</b>
				|
				<a href="https://campusempresa.com/mod/graphql/05-01-query-optimization" class="px-2">ES</a></b>
				|
				<a href="https://campusempresa.cat/mod/graphql/05-01-query-optimization" class="px-2">CA</a>
					</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="/objective">The Project</a>
				<a href="/about">About Us</a>
				<a href="/contribute">Contribute</a>
				<a href="/donate">Donations</a>
				<a href="/licence">License</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content">
								<div class='row navigation'>
	<div class='col-2'>
					<a href='04-04-error-handling' title="Error Handling">&#x25C4;Previous</a>
			</div>
	<div class='col-8 text-center'>
					<a href="./"><h2 style="text-decoration:underline">Query Optimization</h2></a>
			</div>
	<div class='col-2 text-end'>
					<a href='05-02-rate-limiting' title="Rate Limiting">Next &#x25BA;</a>
			</div>
</div>
<div class='content'><p>In this section, we will explore various techniques and strategies to optimize GraphQL queries for better performance. Optimizing queries is crucial for ensuring that your GraphQL server can handle large volumes of requests efficiently and provide quick responses to clients.</p>
</div><h1>Key Concepts</h1>
<div class='content'><ol>
<li>
<p><strong>Understanding Query Complexity</strong>:</p>
<ul>
<li>GraphQL queries can be complex and nested, leading to performance bottlenecks.</li>
<li>It's essential to analyze and understand the complexity of your queries to optimize them effectively.</li>
</ul>
</li>
<li>
<p><strong>Efficient Data Fetching</strong>:</p>
<ul>
<li>Use data loaders to batch and cache database requests.</li>
<li>Avoid N+1 query problems by fetching related data in a single query.</li>
</ul>
</li>
<li>
<p><strong>Pagination and Filtering</strong>:</p>
<ul>
<li>Implement pagination to limit the amount of data returned in a single query.</li>
<li>Use filtering to allow clients to request only the data they need.</li>
</ul>
</li>
<li>
<p><strong>Query Caching</strong>:</p>
<ul>
<li>Cache query results to reduce the load on your server and database.</li>
<li>Use tools like Redis or in-memory caching to store frequently requested data.</li>
</ul>
</li>
<li>
<p><strong>Optimizing Resolvers</strong>:</p>
<ul>
<li>Write efficient resolver functions to minimize processing time.</li>
<li>Use asynchronous resolvers to handle I/O-bound operations without blocking the event loop.</li>
</ul>
</li>
</ol>
</div><h1>Practical Examples</h1>
<div class='content'></div><h2>Example 1: Using Data Loaders</h2>
<div class='content'><p>Data loaders help batch and cache database requests, reducing the number of queries sent to the database.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y29uc3QgRGF0YUxvYWRlciA9IHJlcXVpcmUoJ2RhdGFsb2FkZXInKTsKY29uc3QgeyBnZXRVc2VyQnlJZCB9ID0gcmVxdWlyZSgnLi9kYXRhYmFzZScpOwoKLy8gQ3JlYXRlIGEgZGF0YSBsb2FkZXIgZm9yIHVzZXJzCmNvbnN0IHVzZXJMb2FkZXIgPSBuZXcgRGF0YUxvYWRlcihhc3luYyAodXNlcklkcykgPT4gewogIGNvbnN0IHVzZXJzID0gYXdhaXQgZ2V0VXNlckJ5SWQodXNlcklkcyk7CiAgcmV0dXJuIHVzZXJJZHMubWFwKChpZCkgPT4gdXNlcnMuZmluZCgodXNlcikgPT4gdXNlci5pZCA9PT0gaWQpKTsKfSk7CgovLyBSZXNvbHZlciB1c2luZyBkYXRhIGxvYWRlcgpjb25zdCByZXNvbHZlcnMgPSB7CiAgUXVlcnk6IHsKICAgIHVzZXI6IChwYXJlbnQsIGFyZ3MpID0+IHVzZXJMb2FkZXIubG9hZChhcmdzLmlkKSwKICB9LAp9Ow=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>const DataLoader = require('dataloader');
const { getUserById } = require('./database');

// Create a data loader for users
const userLoader = new DataLoader(async (userIds) =&gt; {
  const users = await getUserById(userIds);
  return userIds.map((id) =&gt; users.find((user) =&gt; user.id === id));
});

// Resolver using data loader
const resolvers = {
  Query: {
    user: (parent, args) =&gt; userLoader.load(args.id),
  },
};</pre></div><div class='content'></div><h2>Example 2: Implementing Pagination</h2>
<div class='content'><p>Pagination helps limit the amount of data returned in a single query, improving performance.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("dHlwZSBRdWVyeSB7CiAgdXNlcnMobGltaXQ6IEludCwgb2Zmc2V0OiBJbnQpOiBbVXNlcl0KfQoKdHlwZSBVc2VyIHsKICBpZDogSUQhCiAgbmFtZTogU3RyaW5nIQogIGVtYWlsOiBTdHJpbmchCn0="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>type Query {
  users(limit: Int, offset: Int): [User]
}

type User {
  id: ID!
  name: String!
  email: String!
}</pre></div><div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y29uc3QgcmVzb2x2ZXJzID0gewogIFF1ZXJ5OiB7CiAgICB1c2VyczogYXN5bmMgKHBhcmVudCwgeyBsaW1pdCwgb2Zmc2V0IH0sIHsgZGIgfSkgPT4gewogICAgICByZXR1cm4gZGIudXNlcnMuZmluZEFsbCh7CiAgICAgICAgbGltaXQsCiAgICAgICAgb2Zmc2V0LAogICAgICB9KTsKICAgIH0sCiAgfSwKfTs="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>const resolvers = {
  Query: {
    users: async (parent, { limit, offset }, { db }) =&gt; {
      return db.users.findAll({
        limit,
        offset,
      });
    },
  },
};</pre></div><div class='content'></div><h2>Example 3: Caching Query Results</h2>
<div class='content'><p>Caching query results can significantly reduce the load on your server and database.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y29uc3QgcmVkaXMgPSByZXF1aXJlKCdyZWRpcycpOwpjb25zdCBjbGllbnQgPSByZWRpcy5jcmVhdGVDbGllbnQoKTsKCmNvbnN0IHJlc29sdmVycyA9IHsKICBRdWVyeTogewogICAgdXNlcjogYXN5bmMgKHBhcmVudCwgeyBpZCB9LCB7IGRiIH0pID0+IHsKICAgICAgY29uc3QgY2FjaGVLZXkgPSBgdXNlcjoke2lkfWA7CiAgICAgIGNvbnN0IGNhY2hlZFVzZXIgPSBhd2FpdCBjbGllbnQuZ2V0QXN5bmMoY2FjaGVLZXkpOwoKICAgICAgaWYgKGNhY2hlZFVzZXIpIHsKICAgICAgICByZXR1cm4gSlNPTi5wYXJzZShjYWNoZWRVc2VyKTsKICAgICAgfQoKICAgICAgY29uc3QgdXNlciA9IGF3YWl0IGRiLnVzZXJzLmZpbmRCeVBrKGlkKTsKICAgICAgYXdhaXQgY2xpZW50LnNldEFzeW5jKGNhY2hlS2V5LCBKU09OLnN0cmluZ2lmeSh1c2VyKSwgJ0VYJywgMzYwMCk7IC8vIENhY2hlIGZvciAxIGhvdXIKCiAgICAgIHJldHVybiB1c2VyOwogICAgfSwKICB9LAp9Ow=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>const redis = require('redis');
const client = redis.createClient();

const resolvers = {
  Query: {
    user: async (parent, { id }, { db }) =&gt; {
      const cacheKey = `user:${id}`;
      const cachedUser = await client.getAsync(cacheKey);

      if (cachedUser) {
        return JSON.parse(cachedUser);
      }

      const user = await db.users.findByPk(id);
      await client.setAsync(cacheKey, JSON.stringify(user), 'EX', 3600); // Cache for 1 hour

      return user;
    },
  },
};</pre></div><div class='content'></div><h1>Practical Exercises</h1>
<div class='content'></div><h2>Exercise 1: Optimize a Query with Data Loaders</h2>
<div class='content'><p><strong>Task</strong>: Refactor the following resolver to use a data loader for fetching users.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y29uc3QgcmVzb2x2ZXJzID0gewogIFF1ZXJ5OiB7CiAgICBwb3N0czogYXN5bmMgKHBhcmVudCwgYXJncywgeyBkYiB9KSA9PiB7CiAgICAgIGNvbnN0IHBvc3RzID0gYXdhaXQgZGIucG9zdHMuZmluZEFsbCgpOwogICAgICByZXR1cm4gcG9zdHMubWFwKGFzeW5jIChwb3N0KSA9PiB7CiAgICAgICAgY29uc3QgdXNlciA9IGF3YWl0IGRiLnVzZXJzLmZpbmRCeVBrKHBvc3QudXNlcklkKTsKICAgICAgICByZXR1cm4gewogICAgICAgICAgLi4ucG9zdCwKICAgICAgICAgIHVzZXIsCiAgICAgICAgfTsKICAgICAgfSk7CiAgICB9LAogIH0sCn07"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>const resolvers = {
  Query: {
    posts: async (parent, args, { db }) =&gt; {
      const posts = await db.posts.findAll();
      return posts.map(async (post) =&gt; {
        const user = await db.users.findByPk(post.userId);
        return {
          ...post,
          user,
        };
      });
    },
  },
};</pre></div><div class='content'><p><strong>Solution</strong>:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y29uc3QgRGF0YUxvYWRlciA9IHJlcXVpcmUoJ2RhdGFsb2FkZXInKTsKCmNvbnN0IHVzZXJMb2FkZXIgPSBuZXcgRGF0YUxvYWRlcihhc3luYyAodXNlcklkcykgPT4gewogIGNvbnN0IHVzZXJzID0gYXdhaXQgZGIudXNlcnMuZmluZEFsbCh7CiAgICB3aGVyZTogeyBpZDogdXNlcklkcyB9LAogIH0pOwogIHJldHVybiB1c2VySWRzLm1hcCgoaWQpID0+IHVzZXJzLmZpbmQoKHVzZXIpID0+IHVzZXIuaWQgPT09IGlkKSk7Cn0pOwoKY29uc3QgcmVzb2x2ZXJzID0gewogIFF1ZXJ5OiB7CiAgICBwb3N0czogYXN5bmMgKHBhcmVudCwgYXJncywgeyBkYiB9KSA9PiB7CiAgICAgIGNvbnN0IHBvc3RzID0gYXdhaXQgZGIucG9zdHMuZmluZEFsbCgpOwogICAgICByZXR1cm4gcG9zdHMubWFwKChwb3N0KSA9PiAoewogICAgICAgIC4uLnBvc3QsCiAgICAgICAgdXNlcjogdXNlckxvYWRlci5sb2FkKHBvc3QudXNlcklkKSwKICAgICAgfSkpOwogICAgfSwKICB9LAp9Ow=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>const DataLoader = require('dataloader');

const userLoader = new DataLoader(async (userIds) =&gt; {
  const users = await db.users.findAll({
    where: { id: userIds },
  });
  return userIds.map((id) =&gt; users.find((user) =&gt; user.id === id));
});

const resolvers = {
  Query: {
    posts: async (parent, args, { db }) =&gt; {
      const posts = await db.posts.findAll();
      return posts.map((post) =&gt; ({
        ...post,
        user: userLoader.load(post.userId),
      }));
    },
  },
};</pre></div><div class='content'></div><h2>Exercise 2: Implement Pagination in a Query</h2>
<div class='content'><p><strong>Task</strong>: Add pagination to the following resolver.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y29uc3QgcmVzb2x2ZXJzID0gewogIFF1ZXJ5OiB7CiAgICB1c2VyczogYXN5bmMgKHBhcmVudCwgYXJncywgeyBkYiB9KSA9PiB7CiAgICAgIHJldHVybiBkYi51c2Vycy5maW5kQWxsKCk7CiAgICB9LAogIH0sCn07"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>const resolvers = {
  Query: {
    users: async (parent, args, { db }) =&gt; {
      return db.users.findAll();
    },
  },
};</pre></div><div class='content'><p><strong>Solution</strong>:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y29uc3QgcmVzb2x2ZXJzID0gewogIFF1ZXJ5OiB7CiAgICB1c2VyczogYXN5bmMgKHBhcmVudCwgeyBsaW1pdCwgb2Zmc2V0IH0sIHsgZGIgfSkgPT4gewogICAgICByZXR1cm4gZGIudXNlcnMuZmluZEFsbCh7CiAgICAgICAgbGltaXQsCiAgICAgICAgb2Zmc2V0LAogICAgICB9KTsKICAgIH0sCiAgfSwKfTs="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>const resolvers = {
  Query: {
    users: async (parent, { limit, offset }, { db }) =&gt; {
      return db.users.findAll({
        limit,
        offset,
      });
    },
  },
};</pre></div><div class='content'></div><h1>Common Mistakes and Tips</h1>
<div class='content'><ul>
<li><strong>Over-fetching Data</strong>: Avoid fetching more data than necessary. Use pagination and filtering to limit the data returned.</li>
<li><strong>Ignoring Query Complexity</strong>: Analyze the complexity of your queries and optimize them to reduce processing time.</li>
<li><strong>Not Using Caching</strong>: Implement caching to reduce the load on your server and database.</li>
<li><strong>Blocking the Event Loop</strong>: Use asynchronous resolvers to handle I/O-bound operations without blocking the event loop.</li>
</ul>
</div><h1>Conclusion</h1>
<div class='content'><p>In this section, we covered various techniques and strategies to optimize GraphQL queries for better performance. By understanding query complexity, using data loaders, implementing pagination, caching query results, and writing efficient resolvers, you can significantly improve the performance of your GraphQL server. In the next section, we will explore rate limiting to further enhance the performance and security of your GraphQL server.</p>
</div><div class='row navigation'>
	<div class='col-2'>
					<a href='04-04-error-handling' title="Error Handling">&#x25C4;Previous</a>
			</div>
	<div class='col-8 text-center'>
			</div>
	<div class='col-2 text-end'>
					<a href='05-02-rate-limiting' title="Rate Limiting">Next &#x25BA;</a>
			</div>
</div>

			</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Advertising</h1>
			<p>This space is reserved for advertising.</p>
			<p>If you want to be a sponsor, contact us to include links in this area: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Thank you for collaborating!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. All rights reserved</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir galetes per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Accept</a>
    <a href="/cookies">More Information</a>
</div>	

	</div>    
</body>
</html>
