<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Memory Management</title>

    <link rel="alternate" href="https://campusempresa.com/mod/swift/05-03-memory-management" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/mod/swift/05-03-memory-management" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/mod/swift/05-03-memory-management" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body >
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-8 p-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo-header_enterprise.png"></a>
			</h1>
		</div>
		<div class="col-4 p-0 text-end">
			<h2 id="main_title"><cite>Building today's and tomorrow's society</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-0 m-0 text-end">
													<b id="lit_lang_es" class="px-2">EN</b>
				|
				<a href="https://campusempresa.com/mod/swift/05-03-memory-management" class="px-2">ES</a></b>
				|
				<a href="https://campusempresa.cat/mod/swift/05-03-memory-management" class="px-2">CA</a>
					</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="/objective">The Project</a>
				<a href="/about">About Us</a>
				<a href="/contribute">Contribute</a>
				<a href="/donate">Donations</a>
				<a href="/licence">License</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content">
								<div class='row navigation'>
	<div class='col-2'>
					<a href='05-02-advanced-error-handling' title="Advanced Error Handling">&#x25C4;Previous</a>
			</div>
	<div class='col-8 text-center'>
					<a href="./"><h2 style="text-decoration:underline">Memory Management</h2></a>
			</div>
	<div class='col-2 text-end'>
					<a href='05-04-concurrency' title="Concurrency">Next &#x25BA;</a>
			</div>
</div>
<div class='content'><p>Memory management is a crucial aspect of programming, especially in languages like Swift that provide both high-level abstractions and low-level control. In this section, we will explore how Swift handles memory management, focusing on Automatic Reference Counting (ARC), strong and weak references, and common pitfalls.</p>
</div><h1>Key Concepts</h1>
<div class='content'><ol>
<li><strong>Automatic Reference Counting (ARC)</strong></li>
<li><strong>Strong, Weak, and Unowned References</strong></li>
<li><strong>Retain Cycles</strong></li>
<li><strong>Memory Leaks</strong></li>
<li><strong>Best Practices</strong></li>
</ol>
</div><h1>Automatic Reference Counting (ARC)</h1>
<div class='content'><p>Swift uses Automatic Reference Counting (ARC) to manage memory usage. ARC automatically keeps track of the number of references to each instance of a class. When the reference count of an instance drops to zero, ARC deallocates the instance to free up memory.</p>
</div><h2>Example</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y2xhc3MgUGVyc29uIHsKICAgIHZhciBuYW1lOiBTdHJpbmcKICAgIAogICAgaW5pdChuYW1lOiBTdHJpbmcpIHsKICAgICAgICBzZWxmLm5hbWUgPSBuYW1lCiAgICAgICAgcHJpbnQoIlwobmFtZSkgaXMgYmVpbmcgaW5pdGlhbGl6ZWQiKQogICAgfQogICAgCiAgICBkZWluaXQgewogICAgICAgIHByaW50KCJcKG5hbWUpIGlzIGJlaW5nIGRlaW5pdGlhbGl6ZWQiKQogICAgfQp9Cgp2YXIgcGVyc29uMTogUGVyc29uPyA9IFBlcnNvbihuYW1lOiAiSm9obiIpCnBlcnNvbjEgPSBuaWwgLy8gIkpvaG4gaXMgYmVpbmcgZGVpbml0aWFsaXplZCIgd2lsbCBiZSBwcmludGVk"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>class Person {
    var name: String
    
    init(name: String) {
        self.name = name
        print(&quot;\(name) is being initialized&quot;)
    }
    
    deinit {
        print(&quot;\(name) is being deinitialized&quot;)
    }
}

var person1: Person? = Person(name: &quot;John&quot;)
person1 = nil // &quot;John is being deinitialized&quot; will be printed</pre></div><div class='content'><p>In this example, the <code>Person</code> instance is deallocated when <code>person1</code> is set to <code>nil</code>.</p>
</div><h1>Strong, Weak, and Unowned References</h1>
<div class='content'></div><h2>Strong References</h2>
<div class='content'><p>By default, all references in Swift are strong references. A strong reference increases the reference count of an instance by one.</p>
</div><h2>Weak References</h2>
<div class='content'><p>A weak reference does not increase the reference count of an instance. Weak references are declared using the <code>weak</code> keyword and are always optional.</p>
</div><h2>Example</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y2xhc3MgUGVyc29uIHsKICAgIHZhciBuYW1lOiBTdHJpbmcKICAgIHdlYWsgdmFyIGZyaWVuZDogUGVyc29uPwogICAgCiAgICBpbml0KG5hbWU6IFN0cmluZykgewogICAgICAgIHNlbGYubmFtZSA9IG5hbWUKICAgIH0KfQoKdmFyIHBlcnNvbjE6IFBlcnNvbj8gPSBQZXJzb24obmFtZTogIkpvaG4iKQp2YXIgcGVyc29uMjogUGVyc29uPyA9IFBlcnNvbihuYW1lOiAiSmFuZSIpCgpwZXJzb24xPy5mcmllbmQgPSBwZXJzb24yCnBlcnNvbjI/LmZyaWVuZCA9IHBlcnNvbjEKCnBlcnNvbjEgPSBuaWwKcGVyc29uMiA9IG5pbA=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>class Person {
    var name: String
    weak var friend: Person?
    
    init(name: String) {
        self.name = name
    }
}

var person1: Person? = Person(name: &quot;John&quot;)
var person2: Person? = Person(name: &quot;Jane&quot;)

person1?.friend = person2
person2?.friend = person1

person1 = nil
person2 = nil</pre></div><div class='content'><p>In this example, <code>friend</code> is a weak reference, preventing a retain cycle.</p>
</div><h2>Unowned References</h2>
<div class='content'><p>An unowned reference does not increase the reference count and is not optional. Use <code>unowned</code> when you are sure the reference will never be <code>nil</code> during its lifetime.</p>
</div><h2>Example</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y2xhc3MgUGVyc29uIHsKICAgIHZhciBuYW1lOiBTdHJpbmcKICAgIHVub3duZWQgdmFyIHNwb3VzZTogUGVyc29uCiAgICAKICAgIGluaXQobmFtZTogU3RyaW5nLCBzcG91c2U6IFBlcnNvbikgewogICAgICAgIHNlbGYubmFtZSA9IG5hbWUKICAgICAgICBzZWxmLnNwb3VzZSA9IHNwb3VzZQogICAgfQp9Cgp2YXIgcGVyc29uMTogUGVyc29uPyA9IFBlcnNvbihuYW1lOiAiSm9obiIsIHNwb3VzZTogcGVyc29uMiEpCnZhciBwZXJzb24yOiBQZXJzb24/ID0gUGVyc29uKG5hbWU6ICJKYW5lIiwgc3BvdXNlOiBwZXJzb24xISk="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>class Person {
    var name: String
    unowned var spouse: Person
    
    init(name: String, spouse: Person) {
        self.name = name
        self.spouse = spouse
    }
}

var person1: Person? = Person(name: &quot;John&quot;, spouse: person2!)
var person2: Person? = Person(name: &quot;Jane&quot;, spouse: person1!)</pre></div><div class='content'><p>In this example, <code>spouse</code> is an unowned reference, ensuring no retain cycle.</p>
</div><h1>Retain Cycles</h1>
<div class='content'><p>A retain cycle occurs when two or more instances hold strong references to each other, preventing ARC from deallocating them.</p>
</div><h2>Example</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y2xhc3MgUGVyc29uIHsKICAgIHZhciBuYW1lOiBTdHJpbmcKICAgIHZhciBmcmllbmQ6IFBlcnNvbj8KICAgIAogICAgaW5pdChuYW1lOiBTdHJpbmcpIHsKICAgICAgICBzZWxmLm5hbWUgPSBuYW1lCiAgICB9Cn0KCnZhciBwZXJzb24xOiBQZXJzb24/ID0gUGVyc29uKG5hbWU6ICJKb2huIikKdmFyIHBlcnNvbjI6IFBlcnNvbj8gPSBQZXJzb24obmFtZTogIkphbmUiKQoKcGVyc29uMT8uZnJpZW5kID0gcGVyc29uMgpwZXJzb24yPy5mcmllbmQgPSBwZXJzb24xCgpwZXJzb24xID0gbmlsCnBlcnNvbjIgPSBuaWw="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>class Person {
    var name: String
    var friend: Person?
    
    init(name: String) {
        self.name = name
    }
}

var person1: Person? = Person(name: &quot;John&quot;)
var person2: Person? = Person(name: &quot;Jane&quot;)

person1?.friend = person2
person2?.friend = person1

person1 = nil
person2 = nil</pre></div><div class='content'><p>In this example, <code>person1</code> and <code>person2</code> will never be deallocated due to the retain cycle.</p>
</div><h1>Memory Leaks</h1>
<div class='content'><p>Memory leaks occur when memory that is no longer needed is not released. Retain cycles are a common cause of memory leaks in Swift.</p>
</div><h2>Detecting Memory Leaks</h2>
<div class='content'><p>Use Xcode's Instruments tool to detect memory leaks in your application.</p>
</div><h1>Best Practices</h1>
<div class='content'><ol>
<li><strong>Use weak and unowned references appropriately</strong>: Use <code>weak</code> for optional references and <code>unowned</code> for non-optional references.</li>
<li><strong>Avoid retain cycles</strong>: Be mindful of retain cycles, especially in closures and delegate patterns.</li>
<li><strong>Use Instruments</strong>: Regularly use Instruments to detect and fix memory leaks.</li>
</ol>
</div><h1>Practical Exercise</h1>
<div class='content'></div><h2>Exercise</h2>
<div class='content'><p>Create a class <code>Car</code> with a property <code>owner</code> of type <code>Person</code>. Ensure that there are no retain cycles between <code>Car</code> and <code>Person</code>.</p>
</div><h2>Solution</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y2xhc3MgUGVyc29uIHsKICAgIHZhciBuYW1lOiBTdHJpbmcKICAgIHZhciBjYXI6IENhcj8KICAgIAogICAgaW5pdChuYW1lOiBTdHJpbmcpIHsKICAgICAgICBzZWxmLm5hbWUgPSBuYW1lCiAgICB9Cn0KCmNsYXNzIENhciB7CiAgICB2YXIgbW9kZWw6IFN0cmluZwogICAgd2VhayB2YXIgb3duZXI6IFBlcnNvbj8KICAgIAogICAgaW5pdChtb2RlbDogU3RyaW5nKSB7CiAgICAgICAgc2VsZi5tb2RlbCA9IG1vZGVsCiAgICB9Cn0KCnZhciBwZXJzb246IFBlcnNvbj8gPSBQZXJzb24obmFtZTogIkpvaG4iKQp2YXIgY2FyOiBDYXI/ID0gQ2FyKG1vZGVsOiAiVGVzbGEiKQoKcGVyc29uPy5jYXIgPSBjYXIKY2FyPy5vd25lciA9IHBlcnNvbgoKcGVyc29uID0gbmlsCmNhciA9IG5pbA=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>class Person {
    var name: String
    var car: Car?
    
    init(name: String) {
        self.name = name
    }
}

class Car {
    var model: String
    weak var owner: Person?
    
    init(model: String) {
        self.model = model
    }
}

var person: Person? = Person(name: &quot;John&quot;)
var car: Car? = Car(model: &quot;Tesla&quot;)

person?.car = car
car?.owner = person

person = nil
car = nil</pre></div><div class='content'><p>In this solution, <code>owner</code> is a weak reference, preventing a retain cycle.</p>
</div><h1>Conclusion</h1>
<div class='content'><p>In this section, we covered the basics of memory management in Swift, focusing on ARC, strong and weak references, retain cycles, and best practices. Understanding these concepts is crucial for writing efficient and memory-safe Swift code. In the next section, we will delve into concurrency in Swift, exploring how to write concurrent code safely and efficiently.</p>
</div><div class='row navigation'>
	<div class='col-2'>
					<a href='05-02-advanced-error-handling' title="Advanced Error Handling">&#x25C4;Previous</a>
			</div>
	<div class='col-8 text-center'>
			</div>
	<div class='col-2 text-end'>
					<a href='05-04-concurrency' title="Concurrency">Next &#x25BA;</a>
			</div>
</div>

			</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Advertising</h1>
			<p>This space is reserved for advertising.</p>
			<p>If you want to be a sponsor, contact us to include links in this area: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Thank you for collaborating!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. All rights reserved</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir galetes per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Accept</a>
    <a href="/cookies">More Information</a>
</div>	

	</div>    
</body>
</html>
