<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Using Core Data</title>

    <link rel="alternate" href="https://campusempresa.com/mod/swift/using-core-data" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/mod/swift/using-core-data" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/mod/swift/using-core-data" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body>
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-8 p-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo-header_enterprise.png"></a>
			</h1>
		</div>
		<div class="col-4 p-0 text-end">
			<h2 id="main_title"><cite>Building today's and tomorrow's society</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-0 m-0 text-end">
													<b id="lit_lang_es" class="px-2">EN</b>
				|
				<a href="https://campusempresa.com/mod/swift/using-core-data" class="px-2">ES</a></b>
				|
				<a href="https://campusempresa.cat/mod/swift/using-core-data" class="px-2">CA</a>
					</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="/objective">The Project</a>
				<a href="/about">About Us</a>
				<a href="/contribute">Contribute</a>
				<a href="/donate">Donations</a>
				<a href="/licence">License</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content"><div class='row navigation'>
	<div class='col-4'>
					<a href='concurrency-and-multithreading'>&#x25C4;Concurrency and Multithreading</a>
			</div>
	<div class='col-4 text-center'>
		<a href="./" class="title">Using Core Data</a>
	</div>
	<div class='col-4 text-end'>
					<a href='testing-and-debugging'>Testing and Debugging &#x25BA;</a>
			</div>
</div>
<div class='content'><p>Core Data is a powerful framework provided by Apple for managing the model layer of your application. It allows you to work with object graphs and persist data efficiently. This topic will guide you from the basics to advanced usage of Core Data in Swift.</p>
</div><h1>Introduction to Core Data</h1>
<div class='content'><p>Core Data is an object graph and persistence framework provided by Apple. It allows developers to manage the model layer objects in their applications. Core Data can be used to store data in a SQLite database, binary files, or in-memory.</p>
</div><h2>Key Concepts</h2>
<div class='content'><ul>
<li><strong>Managed Object Model</strong>: Defines the structure of your data.</li>
<li><strong>Managed Object Context</strong>: Acts as a scratchpad for managed objects.</li>
<li><strong>Persistent Store Coordinator</strong>: Coordinates between the managed object context and the persistent store.</li>
<li><strong>Managed Object</strong>: Instances of your data model entities.</li>
</ul>
</div><h1>Setting Up Core Data in a Swift Project</h1>
<div class='content'><p>To use Core Data in your project, you need to set it up properly. This involves creating a data model and configuring the Core Data stack.</p>
</div><h2>Creating a Data Model</h2>
<div class='content'><ol>
<li>
<p><strong>Add a Data Model File</strong>:</p>
<ul>
<li>Go to File &gt; New &gt; File.</li>
<li>Choose Data Model and name it (e.g., <code>Model.xcdatamodeld</code>).</li>
</ul>
</li>
<li>
<p><strong>Define Entities and Attributes</strong>:</p>
<ul>
<li>Open the <code>.xcdatamodeld</code> file.</li>
<li>Add entities (e.g., <code>Person</code>) and attributes (e.g., <code>name</code>, <code>age</code>).</li>
</ul>
</li>
</ol>
</div><h2>Configuring the Core Data Stack</h2>
<div class='content'><p>The Core Data stack is the heart of Core Data. It consists of the managed object model, persistent store coordinator, and managed object context.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("aW1wb3J0IENvcmVEYXRhCgpjbGFzcyBDb3JlRGF0YVN0YWNrIHsKICAgIHN0YXRpYyBsZXQgc2hhcmVkID0gQ29yZURhdGFTdGFjaygpCgogICAgcHJpdmF0ZSBpbml0KCkge30KCiAgICBsYXp5IHZhciBwZXJzaXN0ZW50Q29udGFpbmVyOiBOU1BlcnNpc3RlbnRDb250YWluZXIgPSB7CiAgICAgICAgbGV0IGNvbnRhaW5lciA9IE5TUGVyc2lzdGVudENvbnRhaW5lcihuYW1lOiAiTW9kZWwiKQogICAgICAgIGNvbnRhaW5lci5sb2FkUGVyc2lzdGVudFN0b3JlcyB7IHN0b3JlRGVzY3JpcHRpb24sIGVycm9yIGluCiAgICAgICAgICAgIGlmIGxldCBlcnJvciA9IGVycm9yIGFzIE5TRXJyb3I/IHsKICAgICAgICAgICAgICAgIGZhdGFsRXJyb3IoIlVucmVzb2x2ZWQgZXJyb3IgXChlcnJvciksIFwoZXJyb3IudXNlckluZm8pIikKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gY29udGFpbmVyCiAgICB9KCkKCiAgICB2YXIgY29udGV4dDogTlNNYW5hZ2VkT2JqZWN0Q29udGV4dCB7CiAgICAgICAgcmV0dXJuIHBlcnNpc3RlbnRDb250YWluZXIudmlld0NvbnRleHQKICAgIH0KfQ=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>import CoreData

class CoreDataStack {
    static let shared = CoreDataStack()

    private init() {}

    lazy var persistentContainer: NSPersistentContainer = {
        let container = NSPersistentContainer(name: &quot;Model&quot;)
        container.loadPersistentStores { storeDescription, error in
            if let error = error as NSError? {
                fatalError(&quot;Unresolved error \(error), \(error.userInfo)&quot;)
            }
        }
        return container
    }()

    var context: NSManagedObjectContext {
        return persistentContainer.viewContext
    }
}</pre></div><div class='content'></div><h1>Basic Operations with Core Data</h1>
<div class='content'><p>Once the Core Data stack is set up, you can perform basic operations like creating, reading, updating, and deleting (CRUD) data.</p>
</div><h2>Creating Data</h2>
<div class='content'><p>To create a new managed object, you need to insert it into the managed object context.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ZnVuYyBjcmVhdGVQZXJzb24obmFtZTogU3RyaW5nLCBhZ2U6IEludDE2KSB7CiAgICBsZXQgY29udGV4dCA9IENvcmVEYXRhU3RhY2suc2hhcmVkLmNvbnRleHQKICAgIGxldCBwZXJzb24gPSBQZXJzb24oY29udGV4dDogY29udGV4dCkKICAgIHBlcnNvbi5uYW1lID0gbmFtZQogICAgcGVyc29uLmFnZSA9IGFnZQoKICAgIGRvIHsKICAgICAgICB0cnkgY29udGV4dC5zYXZlKCkKICAgIH0gY2F0Y2ggewogICAgICAgIHByaW50KCJGYWlsZWQgdG8gc2F2ZSBwZXJzb246IFwoZXJyb3IpIikKICAgIH0KfQ=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>func createPerson(name: String, age: Int16) {
    let context = CoreDataStack.shared.context
    let person = Person(context: context)
    person.name = name
    person.age = age

    do {
        try context.save()
    } catch {
        print(&quot;Failed to save person: \(error)&quot;)
    }
}</pre></div><div class='content'></div><h2>Reading Data</h2>
<div class='content'><p>To fetch data, you use <code>NSFetchRequest</code>.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ZnVuYyBmZXRjaFBlb3BsZSgpIC0+IFtQZXJzb25dPyB7CiAgICBsZXQgY29udGV4dCA9IENvcmVEYXRhU3RhY2suc2hhcmVkLmNvbnRleHQKICAgIGxldCBmZXRjaFJlcXVlc3Q6IE5TRmV0Y2hSZXF1ZXN0PFBlcnNvbj4gPSBQZXJzb24uZmV0Y2hSZXF1ZXN0KCkKCiAgICBkbyB7CiAgICAgICAgbGV0IHBlb3BsZSA9IHRyeSBjb250ZXh0LmZldGNoKGZldGNoUmVxdWVzdCkKICAgICAgICByZXR1cm4gcGVvcGxlCiAgICB9IGNhdGNoIHsKICAgICAgICBwcmludCgiRmFpbGVkIHRvIGZldGNoIHBlb3BsZTogXChlcnJvcikiKQogICAgICAgIHJldHVybiBuaWwKICAgIH0KfQ=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>func fetchPeople() -&gt; [Person]? {
    let context = CoreDataStack.shared.context
    let fetchRequest: NSFetchRequest&lt;Person&gt; = Person.fetchRequest()

    do {
        let people = try context.fetch(fetchRequest)
        return people
    } catch {
        print(&quot;Failed to fetch people: \(error)&quot;)
        return nil
    }
}</pre></div><div class='content'></div><h2>Updating Data</h2>
<div class='content'><p>To update a managed object, fetch it first, then modify its properties and save the context.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ZnVuYyB1cGRhdGVQZXJzb24ocGVyc29uOiBQZXJzb24sIG5ld05hbWU6IFN0cmluZykgewogICAgbGV0IGNvbnRleHQgPSBDb3JlRGF0YVN0YWNrLnNoYXJlZC5jb250ZXh0CiAgICBwZXJzb24ubmFtZSA9IG5ld05hbWUKCiAgICBkbyB7CiAgICAgICAgdHJ5IGNvbnRleHQuc2F2ZSgpCiAgICB9IGNhdGNoIHsKICAgICAgICBwcmludCgiRmFpbGVkIHRvIHVwZGF0ZSBwZXJzb246IFwoZXJyb3IpIikKICAgIH0KfQ=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>func updatePerson(person: Person, newName: String) {
    let context = CoreDataStack.shared.context
    person.name = newName

    do {
        try context.save()
    } catch {
        print(&quot;Failed to update person: \(error)&quot;)
    }
}</pre></div><div class='content'></div><h2>Deleting Data</h2>
<div class='content'><p>To delete a managed object, fetch it first, then delete it from the context and save.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ZnVuYyBkZWxldGVQZXJzb24ocGVyc29uOiBQZXJzb24pIHsKICAgIGxldCBjb250ZXh0ID0gQ29yZURhdGFTdGFjay5zaGFyZWQuY29udGV4dAogICAgY29udGV4dC5kZWxldGUocGVyc29uKQoKICAgIGRvIHsKICAgICAgICB0cnkgY29udGV4dC5zYXZlKCkKICAgIH0gY2F0Y2ggewogICAgICAgIHByaW50KCJGYWlsZWQgdG8gZGVsZXRlIHBlcnNvbjogXChlcnJvcikiKQogICAgfQp9"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>func deletePerson(person: Person) {
    let context = CoreDataStack.shared.context
    context.delete(person)

    do {
        try context.save()
    } catch {
        print(&quot;Failed to delete person: \(error)&quot;)
    }
}</pre></div><div class='content'></div><h1>Advanced Core Data Features</h1>
<div class='content'><p>Core Data offers advanced features such as relationships, batch operations, and versioning.</p>
</div><h2>Relationships</h2>
<div class='content'><p>Entities can have relationships with other entities. For example, a <code>Person</code> entity might have a relationship with a <code>Car</code> entity.</p>
<ul>
<li><strong>One-to-One</strong>: A person has one car.</li>
<li><strong>One-to-Many</strong>: A person has many cars.</li>
<li><strong>Many-to-Many</strong>: Many people can own many cars.</li>
</ul>
</div><h2>Batch Operations</h2>
<div class='content'><p>Batch operations allow you to perform actions on multiple records efficiently.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ZnVuYyBiYXRjaFVwZGF0ZVBlcnNvbkFnZSgpIHsKICAgIGxldCBjb250ZXh0ID0gQ29yZURhdGFTdGFjay5zaGFyZWQuY29udGV4dAogICAgbGV0IGJhdGNoVXBkYXRlUmVxdWVzdCA9IE5TQmF0Y2hVcGRhdGVSZXF1ZXN0KGVudGl0eU5hbWU6ICJQZXJzb24iKQogICAgYmF0Y2hVcGRhdGVSZXF1ZXN0LnByb3BlcnRpZXNUb1VwZGF0ZSA9IFsiYWdlIjogMzBdCiAgICBiYXRjaFVwZGF0ZVJlcXVlc3QucmVzdWx0VHlwZSA9IC51cGRhdGVkT2JqZWN0SURzUmVzdWx0VHlwZQoKICAgIGRvIHsKICAgICAgICBsZXQgcmVzdWx0ID0gdHJ5IGNvbnRleHQuZXhlY3V0ZShiYXRjaFVwZGF0ZVJlcXVlc3QpIGFzPyBOU0JhdGNoVXBkYXRlUmVzdWx0CiAgICAgICAgaWYgbGV0IG9iamVjdElEcyA9IHJlc3VsdD8ucmVzdWx0IGFzPyBbTlNNYW5hZ2VkT2JqZWN0SURdIHsKICAgICAgICAgICAgZm9yIG9iamVjdElEIGluIG9iamVjdElEcyB7CiAgICAgICAgICAgICAgICBsZXQgbWFuYWdlZE9iamVjdCA9IGNvbnRleHQub2JqZWN0KHdpdGg6IG9iamVjdElEKQogICAgICAgICAgICAgICAgY29udGV4dC5yZWZyZXNoKG1hbmFnZWRPYmplY3QsIG1lcmdlQ2hhbmdlczogZmFsc2UpCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IGNhdGNoIHsKICAgICAgICBwcmludCgiRmFpbGVkIHRvIHBlcmZvcm0gYmF0Y2ggdXBkYXRlOiBcKGVycm9yKSIpCiAgICB9Cn0="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>func batchUpdatePersonAge() {
    let context = CoreDataStack.shared.context
    let batchUpdateRequest = NSBatchUpdateRequest(entityName: &quot;Person&quot;)
    batchUpdateRequest.propertiesToUpdate = [&quot;age&quot;: 30]
    batchUpdateRequest.resultType = .updatedObjectIDsResultType

    do {
        let result = try context.execute(batchUpdateRequest) as? NSBatchUpdateResult
        if let objectIDs = result?.result as? [NSManagedObjectID] {
            for objectID in objectIDs {
                let managedObject = context.object(with: objectID)
                context.refresh(managedObject, mergeChanges: false)
            }
        }
    } catch {
        print(&quot;Failed to perform batch update: \(error)&quot;)
    }
}</pre></div><div class='content'></div><h2>Versioning and Migration</h2>
<div class='content'><p>When you change your data model, you need to migrate existing data to the new model. Core Data provides lightweight migration to handle simple changes.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("bGV0IGNvbnRhaW5lciA9IE5TUGVyc2lzdGVudENvbnRhaW5lcihuYW1lOiAiTW9kZWwiKQpsZXQgZGVzY3JpcHRpb24gPSBjb250YWluZXIucGVyc2lzdGVudFN0b3JlRGVzY3JpcHRpb25zLmZpcnN0CmRlc2NyaXB0aW9uPy5zaG91bGRNaWdyYXRlU3RvcmVBdXRvbWF0aWNhbGx5ID0gdHJ1ZQpkZXNjcmlwdGlvbj8uc2hvdWxkSW5mZXJNYXBwaW5nTW9kZWxBdXRvbWF0aWNhbGx5ID0gdHJ1ZQpjb250YWluZXIubG9hZFBlcnNpc3RlbnRTdG9yZXMgeyBzdG9yZURlc2NyaXB0aW9uLCBlcnJvciBpbgogICAgaWYgbGV0IGVycm9yID0gZXJyb3IgYXMgTlNFcnJvcj8gewogICAgICAgIGZhdGFsRXJyb3IoIlVucmVzb2x2ZWQgZXJyb3IgXChlcnJvciksIFwoZXJyb3IudXNlckluZm8pIikKICAgIH0KfQ=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>let container = NSPersistentContainer(name: &quot;Model&quot;)
let description = container.persistentStoreDescriptions.first
description?.shouldMigrateStoreAutomatically = true
description?.shouldInferMappingModelAutomatically = true
container.loadPersistentStores { storeDescription, error in
    if let error = error as NSError? {
        fatalError(&quot;Unresolved error \(error), \(error.userInfo)&quot;)
    }
}</pre></div><div class='content'></div><h1>Conclusion</h1>
<div class='content'><p>Core Data is a robust framework for managing and persisting data in iOS applications. By understanding its core concepts and learning how to perform basic and advanced operations, you can efficiently manage your app's data layer. Remember to always handle errors gracefully and consider the performance implications of your data operations. With practice, you'll be able to leverage Core Data to build powerful and efficient applications.</p>
</div><div class='row navigation'>
	<div class='col-4'>
					<a href='concurrency-and-multithreading'>&#x25C4;Concurrency and Multithreading</a>
			</div>
	<div class='col-4 text-center'>
		<a href="./" class="title">Using Core Data</a>
	</div>
	<div class='col-4 text-end'>
					<a href='testing-and-debugging'>Testing and Debugging &#x25BA;</a>
			</div>
</div>
</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Advertising</h1>
			<p>This space is reserved for advertising.</p>
			<p>If you want to be a sponsor, contact us to include links in this area: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Thank you for collaborating!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. All rights reserved</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir galetes per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Accept</a>
    <a href="/cookies">More Information</a>
</div>	

	</div>    
</body>
</html>
