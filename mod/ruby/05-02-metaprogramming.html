<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Metaprogramming</title>

    <link rel="alternate" href="https://campusempresa.com/mod/ruby/05-02-metaprogramming" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/mod/ruby/05-02-metaprogramming" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/mod/ruby/05-02-metaprogramming" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="/js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body >
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-12 col-md-8 p-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo-header_enterprise.png"></a>
			</h1>
		</div>
		<div class="col-12 col-md-4 px-0 py-2 py-md-0 text-end">
			<h2 id="main_title"><cite>Building today's and tomorrow's society</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 px-0 py-2 py-md-0 m-0 text-end">
													<b id="lit_lang_es" class="px-2">EN</b>
				|
				<a href="https://campusempresa.com/mod/ruby/05-02-metaprogramming" class="px-2">ES</a></b>
				|
				<a href="https://campusempresa.cat/mod/ruby/05-02-metaprogramming" class="px-2">CA</a>
					</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="/objective">The Project</a>
				<a href="/about">About Us</a>
				<a href="/contribute">Contribute</a>
				<a href="/donate">Donations</a>
				<a href="/licence">License</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content">
								<div class='row navigation'>
	<div class='col-2'>
					<a href='05-01-blocks-procs-lambdas' title="Blocks, Procs, and Lambdas">&#x25C4;Previous</a>
			</div>
	<div class='col-8 text-center'>
					<a href="./"><h2 style="text-decoration:underline">Metaprogramming</h2></a>
			</div>
	<div class='col-2 text-end'>
					<a href='05-03-exception-handling' title="Exception Handling">Next &#x25BA;</a>
			</div>
</div>
<div class='content'><p>Metaprogramming in Ruby is a powerful feature that allows you to write code that writes code. This can make your programs more flexible and reduce redundancy. In this section, we will explore the key concepts of metaprogramming, provide practical examples, and offer exercises to help you master this advanced topic.</p>
</div><h1>Key Concepts</h1>
<div class='content'><ol>
<li><strong>Dynamic Methods</strong>: Creating methods at runtime.</li>
<li><strong>Method Missing</strong>: Handling calls to undefined methods.</li>
<li><strong>Class Macros</strong>: Using methods to define other methods.</li>
<li><strong>Eval</strong>: Executing Ruby code stored in strings.</li>
<li><strong>Open Classes</strong>: Modifying existing classes.</li>
</ol>
</div><h1>Dynamic Methods</h1>
<div class='content'><p>Dynamic methods allow you to define methods at runtime. This can be useful for creating methods based on user input or other runtime data.</p>
</div><h2>Example</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y2xhc3MgRHluYW1pY01ldGhvZEV4YW1wbGUKICBkZWYgc2VsZi5jcmVhdGVfbWV0aG9kKG5hbWUpCiAgICBkZWZpbmVfbWV0aG9kKG5hbWUpIGRvCiAgICAgIHB1dHMgIk1ldGhvZCAje25hbWV9IGNhbGxlZCIKICAgIGVuZAogIGVuZAplbmQKCkR5bmFtaWNNZXRob2RFeGFtcGxlLmNyZWF0ZV9tZXRob2QoOmhlbGxvKQpleGFtcGxlID0gRHluYW1pY01ldGhvZEV4YW1wbGUubmV3CmV4YW1wbGUuaGVsbG8gICMgT3V0cHV0OiBNZXRob2QgaGVsbG8gY2FsbGVk"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>class DynamicMethodExample
  def self.create_method(name)
    define_method(name) do
      puts &quot;Method #{name} called&quot;
    end
  end
end

DynamicMethodExample.create_method(:hello)
example = DynamicMethodExample.new
example.hello  # Output: Method hello called</pre></div><div class='content'></div><h2>Explanation</h2>
<div class='content'><ul>
<li><code>define_method</code> is used to create a method with the given name.</li>
<li>The method is defined within the class <code>DynamicMethodExample</code>.</li>
<li>When <code>example.hello</code> is called, it outputs &quot;Method hello called&quot;.</li>
</ul>
</div><h1>Method Missing</h1>
<div class='content'><p><code>method_missing</code> is a powerful way to handle calls to methods that do not exist.</p>
</div><h2>Example</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y2xhc3MgTWV0aG9kTWlzc2luZ0V4YW1wbGUKICBkZWYgbWV0aG9kX21pc3NpbmcobmFtZSwgKmFyZ3MpCiAgICBwdXRzICJZb3UgdHJpZWQgdG8gY2FsbCAje25hbWV9IHdpdGggYXJndW1lbnRzICN7YXJncy5qb2luKCcsICcpfSIKICBlbmQKZW5kCgpleGFtcGxlID0gTWV0aG9kTWlzc2luZ0V4YW1wbGUubmV3CmV4YW1wbGUuc29tZV9tZXRob2QoMSwgMiwgMykgICMgT3V0cHV0OiBZb3UgdHJpZWQgdG8gY2FsbCBzb21lX21ldGhvZCB3aXRoIGFyZ3VtZW50cyAxLCAyLCAz"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>class MethodMissingExample
  def method_missing(name, *args)
    puts &quot;You tried to call #{name} with arguments #{args.join(', ')}&quot;
  end
end

example = MethodMissingExample.new
example.some_method(1, 2, 3)  # Output: You tried to call some_method with arguments 1, 2, 3</pre></div><div class='content'></div><h2>Explanation</h2>
<div class='content'><ul>
<li><code>method_missing</code> is overridden to handle calls to undefined methods.</li>
<li>It takes the method name and any arguments passed to it.</li>
<li>In this example, it simply prints out the method name and arguments.</li>
</ul>
</div><h1>Class Macros</h1>
<div class='content'><p>Class macros are methods that define other methods. They are often used in libraries to provide a DSL (Domain-Specific Language).</p>
</div><h2>Example</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y2xhc3MgTWFjcm9FeGFtcGxlCiAgZGVmIHNlbGYuYXR0cl9hY2Nlc3Nvcl93aXRoX2hpc3RvcnkoYXR0cl9uYW1lKQogICAgYXR0cl9uYW1lID0gYXR0cl9uYW1lLnRvX3MKICAgIGF0dHJfcmVhZGVyIGF0dHJfbmFtZQogICAgYXR0cl9yZWFkZXIgIiN7YXR0cl9uYW1lfV9oaXN0b3J5IgoKICAgIGRlZmluZV9tZXRob2QoIiN7YXR0cl9uYW1lfT0iKSBkbyB8dmFsdWV8CiAgICAgIGluc3RhbmNlX3ZhcmlhYmxlX3NldCgiQCN7YXR0cl9uYW1lfSIsIHZhbHVlKQogICAgICBAaGlzdG9yeSB8fD0gW10KICAgICAgQGhpc3RvcnkgPDwgdmFsdWUKICAgICAgaW5zdGFuY2VfdmFyaWFibGVfc2V0KCJAI3thdHRyX25hbWV9X2hpc3RvcnkiLCBAaGlzdG9yeSkKICAgIGVuZAogIGVuZAplbmQKCmNsYXNzIFBlcnNvbiA8IE1hY3JvRXhhbXBsZQogIGF0dHJfYWNjZXNzb3Jfd2l0aF9oaXN0b3J5IDpuYW1lCmVuZAoKcGVyc29uID0gUGVyc29uLm5ldwpwZXJzb24ubmFtZSA9ICJBbGljZSIKcGVyc29uLm5hbWUgPSAiQm9iIgpwdXRzIHBlcnNvbi5uYW1lX2hpc3RvcnkuaW5zcGVjdCAgIyBPdXRwdXQ6IFsiQWxpY2UiLCAiQm9iIl0="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>class MacroExample
  def self.attr_accessor_with_history(attr_name)
    attr_name = attr_name.to_s
    attr_reader attr_name
    attr_reader &quot;#{attr_name}_history&quot;

    define_method(&quot;#{attr_name}=&quot;) do |value|
      instance_variable_set(&quot;@#{attr_name}&quot;, value)
      @history ||= []
      @history &lt;&lt; value
      instance_variable_set(&quot;@#{attr_name}_history&quot;, @history)
    end
  end
end

class Person &lt; MacroExample
  attr_accessor_with_history :name
end

person = Person.new
person.name = &quot;Alice&quot;
person.name = &quot;Bob&quot;
puts person.name_history.inspect  # Output: [&quot;Alice&quot;, &quot;Bob&quot;]</pre></div><div class='content'></div><h2>Explanation</h2>
<div class='content'><ul>
<li><code>attr_accessor_with_history</code> is a class macro that creates an accessor with history tracking.</li>
<li>It defines a getter for the attribute and its history.</li>
<li>It also defines a setter that updates the history each time the attribute is set.</li>
</ul>
</div><h1>Eval</h1>
<div class='content'><p><code>eval</code> allows you to execute Ruby code stored in strings. Use it with caution as it can introduce security risks.</p>
</div><h2>Example</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y29kZSA9ICJwdXRzICdIZWxsbyBmcm9tIGV2YWwnIgpldmFsKGNvZGUpICAjIE91dHB1dDogSGVsbG8gZnJvbSBldmFs"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>code = &quot;puts 'Hello from eval'&quot;
eval(code)  # Output: Hello from eval</pre></div><div class='content'></div><h2>Explanation</h2>
<div class='content'><ul>
<li><code>eval</code> takes a string containing Ruby code and executes it.</li>
<li>In this example, it prints &quot;Hello from eval&quot;.</li>
</ul>
</div><h1>Open Classes</h1>
<div class='content'><p>Ruby allows you to reopen and modify existing classes. This can be useful for adding methods to built-in classes.</p>
</div><h2>Example</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y2xhc3MgU3RyaW5nCiAgZGVmIHNob3V0CiAgICBzZWxmLnVwY2FzZSArICIhISEiCiAgZW5kCmVuZAoKcHV0cyAiaGVsbG8iLnNob3V0ICAjIE91dHB1dDogSEVMTE8hISE="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>class String
  def shout
    self.upcase + &quot;!!!&quot;
  end
end

puts &quot;hello&quot;.shout  # Output: HELLO!!!</pre></div><div class='content'></div><h2>Explanation</h2>
<div class='content'><ul>
<li>The <code>String</code> class is reopened, and a new method <code>shout</code> is added.</li>
<li>This method converts the string to uppercase and adds exclamation marks.</li>
</ul>
</div><h1>Practical Exercises</h1>
<div class='content'></div><h2>Exercise 1: Dynamic Methods</h2>
<div class='content'><p>Create a class <code>DynamicGreeter</code> that dynamically defines a method <code>greet_&lt;name&gt;</code> for each name in an array.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y2xhc3MgRHluYW1pY0dyZWV0ZXIKICBkZWYgc2VsZi5jcmVhdGVfZ3JlZXRfbWV0aG9kcyhuYW1lcykKICAgIG5hbWVzLmVhY2ggZG8gfG5hbWV8CiAgICAgIGRlZmluZV9tZXRob2QoImdyZWV0XyN7bmFtZX0iKSBkbwogICAgICAgIHB1dHMgIkhlbGxvLCAje25hbWV9ISIKICAgICAgZW5kCiAgICBlbmQKICBlbmQKZW5kCgpEeW5hbWljR3JlZXRlci5jcmVhdGVfZ3JlZXRfbWV0aG9kcyhbIkFsaWNlIiwgIkJvYiIsICJDaGFybGllIl0pCmdyZWV0ZXIgPSBEeW5hbWljR3JlZXRlci5uZXcKZ3JlZXRlci5ncmVldF9BbGljZSAgIyBPdXRwdXQ6IEhlbGxvLCBBbGljZSEKZ3JlZXRlci5ncmVldF9Cb2IgICAgIyBPdXRwdXQ6IEhlbGxvLCBCb2IhCmdyZWV0ZXIuZ3JlZXRfQ2hhcmxpZSAgIyBPdXRwdXQ6IEhlbGxvLCBDaGFybGllIQ=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>class DynamicGreeter
  def self.create_greet_methods(names)
    names.each do |name|
      define_method(&quot;greet_#{name}&quot;) do
        puts &quot;Hello, #{name}!&quot;
      end
    end
  end
end

DynamicGreeter.create_greet_methods([&quot;Alice&quot;, &quot;Bob&quot;, &quot;Charlie&quot;])
greeter = DynamicGreeter.new
greeter.greet_Alice  # Output: Hello, Alice!
greeter.greet_Bob    # Output: Hello, Bob!
greeter.greet_Charlie  # Output: Hello, Charlie!</pre></div><div class='content'></div><h2>Solution</h2>
<div class='content'><ul>
<li>Use <code>define_method</code> within a loop to create methods for each name.</li>
<li>Call the dynamically created methods to verify they work.</li>
</ul>
</div><h2>Exercise 2: Method Missing</h2>
<div class='content'><p>Create a class <code>FlexibleCalculator</code> that can handle basic arithmetic operations (<code>add</code>, <code>subtract</code>, <code>multiply</code>, <code>divide</code>) using <code>method_missing</code>.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Y2xhc3MgRmxleGlibGVDYWxjdWxhdG9yCiAgZGVmIG1ldGhvZF9taXNzaW5nKG5hbWUsICphcmdzKQogICAgaWYgbmFtZS50b19zID1+IC9eKGFkZHxzdWJ0cmFjdHxtdWx0aXBseXxkaXZpZGUpXyhcZCspX2FuZF8oXGQrKSQvCiAgICAgIG9wZXJhdGlvbiwgbnVtMSwgbnVtMiA9ICQxLCAkMi50b19pLCAkMy50b19pCiAgICAgIGNhc2Ugb3BlcmF0aW9uCiAgICAgIHdoZW4gImFkZCIKICAgICAgICBudW0xICsgbnVtMgogICAgICB3aGVuICJzdWJ0cmFjdCIKICAgICAgICBudW0xIC0gbnVtMgogICAgICB3aGVuICJtdWx0aXBseSIKICAgICAgICBudW0xICogbnVtMgogICAgICB3aGVuICJkaXZpZGUiCiAgICAgICAgbnVtMSAvIG51bTIKICAgICAgZWxzZQogICAgICAgIHN1cGVyCiAgICAgIGVuZAogICAgZWxzZQogICAgICBzdXBlcgogICAgZW5kCiAgZW5kCmVuZAoKY2FsY3VsYXRvciA9IEZsZXhpYmxlQ2FsY3VsYXRvci5uZXcKcHV0cyBjYWxjdWxhdG9yLmFkZF8yX2FuZF8zICAgICAgIyBPdXRwdXQ6IDUKcHV0cyBjYWxjdWxhdG9yLnN1YnRyYWN0XzVfYW5kXzIgIyBPdXRwdXQ6IDMKcHV0cyBjYWxjdWxhdG9yLm11bHRpcGx5XzNfYW5kXzQgIyBPdXRwdXQ6IDEyCnB1dHMgY2FsY3VsYXRvci5kaXZpZGVfMTBfYW5kXzIgICMgT3V0cHV0OiA1"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>class FlexibleCalculator
  def method_missing(name, *args)
    if name.to_s =~ /^(add|subtract|multiply|divide)_(\d+)_and_(\d+)$/
      operation, num1, num2 = $1, $2.to_i, $3.to_i
      case operation
      when &quot;add&quot;
        num1 + num2
      when &quot;subtract&quot;
        num1 - num2
      when &quot;multiply&quot;
        num1 * num2
      when &quot;divide&quot;
        num1 / num2
      else
        super
      end
    else
      super
    end
  end
end

calculator = FlexibleCalculator.new
puts calculator.add_2_and_3      # Output: 5
puts calculator.subtract_5_and_2 # Output: 3
puts calculator.multiply_3_and_4 # Output: 12
puts calculator.divide_10_and_2  # Output: 5</pre></div><div class='content'></div><h2>Solution</h2>
<div class='content'><ul>
<li>Use a regular expression to match method names and extract numbers.</li>
<li>Perform the corresponding arithmetic operation based on the method name.</li>
</ul>
</div><h1>Conclusion</h1>
<div class='content'><p>Metaprogramming in Ruby allows you to write more flexible and dynamic code. By understanding and utilizing dynamic methods, <code>method_missing</code>, class macros, <code>eval</code>, and open classes, you can create powerful and concise programs. Practice these concepts with the provided exercises to reinforce your understanding and prepare for more advanced Ruby programming.</p>
</div><div class='row navigation'>
	<div class='col-2'>
					<a href='05-01-blocks-procs-lambdas' title="Blocks, Procs, and Lambdas">&#x25C4;Previous</a>
			</div>
	<div class='col-8 text-center'>
			</div>
	<div class='col-2 text-end'>
					<a href='05-03-exception-handling' title="Exception Handling">Next &#x25BA;</a>
			</div>
</div>

			</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Advertising</h1>
			<p>This space is reserved for advertising.</p>
			<p>If you want to be a sponsor, contact us to include links in this area: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Thank you for collaborating!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. All rights reserved</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir galetes per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Accept</a>
    <a href="/cookies">More Information</a>
</div>	

	</div>    
</body>
</html>
