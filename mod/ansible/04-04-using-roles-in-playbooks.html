<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Using Roles in Playbooks</title>

    <link rel="alternate" href="https://campusempresa.com/mod/ansible/04-04-using-roles-in-playbooks" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/mod/ansible/04-04-using-roles-in-playbooks" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/mod/ansible/04-04-using-roles-in-playbooks" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="/js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body >
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-12 col-md-8 p-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo-header_enterprise.png"></a>
			</h1>
		</div>
		<div class="col-12 col-md-4 px-0 py-2 py-md-0 text-end">
			<h2 id="main_title"><cite>Building today's and tomorrow's society</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 px-0 py-2 py-md-0 m-0 text-end">
													<b id="lit_lang_es" class="px-2">EN</b>
				|
				<a href="https://campusempresa.com/mod/ansible/04-04-using-roles-in-playbooks" class="px-2">ES</a></b>
				|
				<a href="https://campusempresa.cat/mod/ansible/04-04-using-roles-in-playbooks" class="px-2">CA</a>
					</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="/objective">The Project</a>
				<a href="/about">About Us</a>
				<a href="/contribute">Contribute</a>
				<a href="/donate">Donations</a>
				<a href="/licence">License</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content">
								<div class='row navigation'>
	<div class='col-2'>
					<a href='04-03-role-directory-structure' title="Role Directory Structure">&#x25C4;Previous</a>
			</div>
	<div class='col-8 text-center'>
					<a href="./"><h2 style="text-decoration:underline">Using Roles in Playbooks</h2></a>
			</div>
	<div class='col-2 text-end'>
					<a href='05-01-handlers' title="Handlers">Next &#x25BA;</a>
			</div>
</div>
<div class='content'><p>In this section, we will explore how to use roles in Ansible playbooks. Roles are a powerful feature in Ansible that allow you to organize your playbooks and reusable components in a structured manner. By the end of this section, you will understand how to integrate roles into your playbooks effectively.</p>
</div><h1>What are Roles?</h1>
<div class='content'><p>Roles are a way to group related tasks, variables, files, templates, and handlers into a single unit. This makes your playbooks more modular, reusable, and easier to manage.</p>
</div><h2>Key Components of a Role</h2>
<div class='content'><ul>
<li><strong>Tasks</strong>: The main list of tasks to be executed by the role.</li>
<li><strong>Handlers</strong>: Handlers that can be used within the role or notified by tasks.</li>
<li><strong>Templates</strong>: Jinja2 templates that can be used to generate configuration files.</li>
<li><strong>Files</strong>: Static files that can be deployed by the role.</li>
<li><strong>Vars</strong>: Variables specific to the role.</li>
<li><strong>Defaults</strong>: Default variables for the role.</li>
<li><strong>Meta</strong>: Metadata about the role, including dependencies.</li>
<li><strong>Tests</strong>: Test cases for the role.</li>
</ul>
</div><h1>Using Roles in Playbooks</h1>
<div class='content'><p>To use a role in a playbook, you simply need to include the role in the <code>roles</code> section of your playbook. Below is a step-by-step guide on how to do this.</p>
</div><h2>Step 1: Create a Role</h2>
<div class='content'><p>First, create a role using the <code>ansible-galaxy</code> command:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("YW5zaWJsZS1nYWxheHkgaW5pdCBteV9yb2xl"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>ansible-galaxy init my_role</pre></div><div class='content'><p>This command will create a directory structure for the role <code>my_role</code>.</p>
</div><h2>Step 2: Define the Role's Tasks</h2>
<div class='content'><p>Navigate to the <code>tasks</code> directory of your role and create a <code>main.yml</code> file:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("IyByb2xlcy9teV9yb2xlL3Rhc2tzL21haW4ueW1sCi0tLQotIG5hbWU6IEVuc3VyZSBBcGFjaGUgaXMgaW5zdGFsbGVkCiAgYXB0OgogICAgbmFtZTogYXBhY2hlMgogICAgc3RhdGU6IHByZXNlbnQKCi0gbmFtZTogU3RhcnQgQXBhY2hlIHNlcnZpY2UKICBzZXJ2aWNlOgogICAgbmFtZTogYXBhY2hlMgogICAgc3RhdGU6IHN0YXJ0ZWQKICAgIGVuYWJsZWQ6IHRydWU="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'># roles/my_role/tasks/main.yml
---
- name: Ensure Apache is installed
  apt:
    name: apache2
    state: present

- name: Start Apache service
  service:
    name: apache2
    state: started
    enabled: true</pre></div><div class='content'></div><h2>Step 3: Include the Role in a Playbook</h2>
<div class='content'><p>Create a playbook that includes the role:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("IyBwbGF5Ym9vay55bWwKLS0tCi0gaG9zdHM6IHdlYnNlcnZlcnMKICByb2xlczoKICAgIC0gbXlfcm9sZQ=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'># playbook.yml
---
- hosts: webservers
  roles:
    - my_role</pre></div><div class='content'></div><h2>Step 4: Run the Playbook</h2>
<div class='content'><p>Execute the playbook using the <code>ansible-playbook</code> command:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("YW5zaWJsZS1wbGF5Ym9vayAtaSBpbnZlbnRvcnkgcGxheWJvb2sueW1s"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>ansible-playbook -i inventory playbook.yml</pre></div><div class='content'></div><h2>Example Playbook with Multiple Roles</h2>
<div class='content'><p>You can include multiple roles in a single playbook. Here is an example:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("IyBwbGF5Ym9vay55bWwKLS0tCi0gaG9zdHM6IHdlYnNlcnZlcnMKICByb2xlczoKICAgIC0gcm9sZTogbXlfcm9sZQogICAgLSByb2xlOiBhbm90aGVyX3JvbGU="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'># playbook.yml
---
- hosts: webservers
  roles:
    - role: my_role
    - role: another_role</pre></div><div class='content'></div><h2>Using Role Variables</h2>
<div class='content'><p>Roles can have their own variables, which can be defined in the <code>vars</code> or <code>defaults</code> directory of the role. You can also pass variables to roles directly in the playbook:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("IyBwbGF5Ym9vay55bWwKLS0tCi0gaG9zdHM6IHdlYnNlcnZlcnMKICByb2xlczoKICAgIC0gcm9sZTogbXlfcm9sZQogICAgICB2YXJzOgogICAgICAgIGFwYWNoZV9wb3J0OiA4MDgw"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'># playbook.yml
---
- hosts: webservers
  roles:
    - role: my_role
      vars:
        apache_port: 8080</pre></div><div class='content'></div><h2>Practical Exercise</h2>
<div class='content'><p><strong>Exercise:</strong> Create a role named <code>nginx_role</code> that installs and configures Nginx, and then use this role in a playbook.</p>
<p><strong>Steps:</strong></p>
<ol>
<li>Create the role:
<pre><code class="language-bash">ansible-galaxy init nginx_role
</code></pre>
</li>
<li>Define the tasks in <code>nginx_role/tasks/main.yml</code>:
<pre><code class="language-yaml"># roles/nginx_role/tasks/main.yml
---
- name: Ensure Nginx is installed
  apt:
    name: nginx
    state: present

- name: Start Nginx service
  service:
    name: nginx
    state: started
    enabled: true
</code></pre>
</li>
<li>Create a playbook that uses the <code>nginx_role</code>:
<pre><code class="language-yaml"># playbook.yml
---
- hosts: webservers
  roles:
    - nginx_role
</code></pre>
</li>
<li>Run the playbook:
<pre><code class="language-bash">ansible-playbook -i inventory playbook.yml
</code></pre>
</li>
</ol>
<p><strong>Solution:</strong></p>
<p>The solution involves following the steps outlined above. Ensure that the <code>nginx_role</code> is correctly defined and included in the playbook.</p>
</div><h2>Common Mistakes and Tips</h2>
<div class='content'><ul>
<li><strong>Incorrect Directory Structure</strong>: Ensure that the role's directory structure follows the standard layout.</li>
<li><strong>Variable Scope</strong>: Be mindful of variable precedence and scope when using role variables.</li>
<li><strong>Role Dependencies</strong>: Use the <code>meta/main.yml</code> file to define role dependencies if your role relies on other roles.</li>
</ul>
</div><h1>Conclusion</h1>
<div class='content'><p>In this section, we learned how to use roles in Ansible playbooks. Roles help in organizing and reusing code, making your playbooks more maintainable. We covered the creation of roles, defining tasks, and including roles in playbooks. Additionally, we provided a practical exercise to reinforce the concepts learned. In the next module, we will delve into advanced playbook techniques, including handlers, templates, and error handling.</p>
</div><div class='row navigation'>
	<div class='col-2'>
					<a href='04-03-role-directory-structure' title="Role Directory Structure">&#x25C4;Previous</a>
			</div>
	<div class='col-8 text-center'>
			</div>
	<div class='col-2 text-end'>
					<a href='05-01-handlers' title="Handlers">Next &#x25BA;</a>
			</div>
</div>

			</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Advertising</h1>
			<p>This space is reserved for advertising.</p>
			<p>If you want to be a sponsor, contact us to include links in this area: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Thank you for collaborating!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. All rights reserved</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir galetes per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Accept</a>
    <a href="/cookies">More Information</a>
</div>	

	</div>    
</body>
</html>
