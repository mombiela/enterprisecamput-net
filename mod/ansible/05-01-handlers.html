<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Handlers</title>

    <link rel="alternate" href="https://campusempresa.com/mod/ansible/05-01-handlers" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/mod/ansible/05-01-handlers" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/mod/ansible/05-01-handlers" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="/js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body >
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-12 col-md-6 p-2 p-md-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo-header_enterprise.png"></a>
			</h1>
		</div>
		<div class="col-12 col-md-6 p-2 p-md-0 text-end">
				<b id="lit_lang_es" class="px-2">EN</b>
	|
	<a href="https://campusempresa.com/mod/ansible/05-01-handlers" class="px-2">ES</a></b>
	|
	<a href="https://campusempresa.cat/mod/ansible/05-01-handlers" class="px-2">CA</a>
<br>
			<cite>Building today's and tomorrow's society</cite>
		</div>
	</div>
</div>
<div id="subheader" class="container-xxl">
	<div class="row">
		<div class="col-12 p-2 p-md-0 m-0 text-end">
			<a href="/objective">The Project</a> | 
<a href="/about">About Us</a> | 
<a href="/contribute">Contribute</a> | 
<a href="/donate">Donations</a> | 
<a href="/licence">License</a>
		</div>
	</div>
</div>

<div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				 					<a href="/categ/languages">Programming Languages</a>
				 					<a href="/categ/frameworks">Frameworks and Libraries</a>
				 					<a href="/categ/tech-tools">Technical Tools</a>
				 					<a href="/categ/foundations">Theoretical Foundations</a>
				 					<a href="/categ/soft-skills">Social Skills</a>
							</div>
		</div>
	</div>
</div>
		
<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content">
				<div class='row navigation'>
	<div class='col-1 col-md-2'>
					<a href='04-04-using-roles-in-playbooks' title="Using Roles in Playbooks">
				<span class="d-none d-md-inline">&#x25C4; Previous</span>
				<span class="d-inline d-md-none"><i class="bi bi-caret-left-square-fill"></i></span>
			</a>
			</div>
	<div class='col-10 col-md-8 text-center'>
					<a href="./"><h2 style="text-decoration:underline">Handlers</h2></a>
			</div>
	<div class='col-1 col-md-2 text-end'>
					<a href='05-02-templates' title="Templates">
				<span class="d-none d-md-inline">Next &#x25BA;</span>
				<span class="d-inline d-md-none"><i class="bi bi-caret-right-square-fill"></i></span>
			</a>
			</div>
</div>
<div class='content'></div><h1><p>Introduction to Handlers</p>
</h1>
<div class='content'><p>Handlers in Ansible are special tasks that are triggered by other tasks. They are typically used to perform actions that need to happen only once after a series of tasks have been executed, such as restarting a service after a configuration file has been changed.</p>
</div><h2><p>Key Concepts</p>
</h2>
<div class='content'><ul>
<li><strong>Handlers</strong>: Special tasks that are triggered by the <code>notify</code> directive.</li>
<li><strong>Notify</strong>: A directive used in a task to trigger a handler.</li>
<li><strong>Listen</strong>: A directive used in a handler to allow multiple tasks to notify the same handler.</li>
</ul>
</div><h1><p>Creating Handlers</p>
</h1>
<div class='content'><p>Handlers are defined similarly to regular tasks but are placed under a <code>handlers</code> section in a playbook or role. Here is a basic example:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("LS0tCi0gbmFtZTogRXhhbXBsZSBwbGF5Ym9vayB3aXRoIGhhbmRsZXJzCiAgaG9zdHM6IHdlYnNlcnZlcnMKICB0YXNrczoKICAgIC0gbmFtZTogSW5zdGFsbCBBcGFjaGUKICAgICAgYXB0OgogICAgICAgIG5hbWU6IGFwYWNoZTIKICAgICAgICBzdGF0ZTogcHJlc2VudAogICAgICBub3RpZnk6IFJlc3RhcnQgQXBhY2hlCgogIGhhbmRsZXJzOgogICAgLSBuYW1lOiBSZXN0YXJ0IEFwYWNoZQogICAgICBzZXJ2aWNlOgogICAgICAgIG5hbWU6IGFwYWNoZTIKICAgICAgICBzdGF0ZTogcmVzdGFydGVk"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>---
- name: Example playbook with handlers
  hosts: webservers
  tasks:
    - name: Install Apache
      apt:
        name: apache2
        state: present
      notify: Restart Apache

  handlers:
    - name: Restart Apache
      service:
        name: apache2
        state: restarted</pre></div><div class='content'></div><h2><p>Explanation</p>
</h2>
<div class='content'><ul>
<li><strong>Tasks Section</strong>: Contains the tasks to be executed. In this example, it installs the Apache web server.</li>
<li><strong>Notify Directive</strong>: The <code>notify</code> directive in the task triggers the <code>Restart Apache</code> handler.</li>
<li><strong>Handlers Section</strong>: Contains the handler definition. The handler will restart the Apache service when notified.</li>
</ul>
</div><h1><p>Practical Example</p>
</h1>
<div class='content'><p>Let's create a more detailed example where we update a configuration file and then restart the service.</p>
</div><h2><p>Playbook Example</p>
</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("LS0tCi0gbmFtZTogVXBkYXRlIE5naW54IGNvbmZpZ3VyYXRpb24gYW5kIHJlc3RhcnQgc2VydmljZQogIGhvc3RzOiB3ZWJzZXJ2ZXJzCiAgdGFza3M6CiAgICAtIG5hbWU6IEluc3RhbGwgTmdpbngKICAgICAgYXB0OgogICAgICAgIG5hbWU6IG5naW54CiAgICAgICAgc3RhdGU6IHByZXNlbnQKICAgICAgbm90aWZ5OiBSZXN0YXJ0IE5naW54CgogICAgLSBuYW1lOiBVcGRhdGUgTmdpbnggY29uZmlndXJhdGlvbgogICAgICB0ZW1wbGF0ZToKICAgICAgICBzcmM6IG5naW54LmNvbmYuajIKICAgICAgICBkZXN0OiAvZXRjL25naW54L25naW54LmNvbmYKICAgICAgbm90aWZ5OiBSZXN0YXJ0IE5naW54CgogIGhhbmRsZXJzOgogICAgLSBuYW1lOiBSZXN0YXJ0IE5naW54CiAgICAgIHNlcnZpY2U6CiAgICAgICAgbmFtZTogbmdpbngKICAgICAgICBzdGF0ZTogcmVzdGFydGVk"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>---
- name: Update Nginx configuration and restart service
  hosts: webservers
  tasks:
    - name: Install Nginx
      apt:
        name: nginx
        state: present
      notify: Restart Nginx

    - name: Update Nginx configuration
      template:
        src: nginx.conf.j2
        dest: /etc/nginx/nginx.conf
      notify: Restart Nginx

  handlers:
    - name: Restart Nginx
      service:
        name: nginx
        state: restarted</pre></div><div class='content'></div><h2><p>Explanation</p>
</h2>
<div class='content'><ul>
<li><strong>Install Nginx Task</strong>: Installs the Nginx web server and notifies the <code>Restart Nginx</code> handler.</li>
<li><strong>Update Nginx Configuration Task</strong>: Updates the Nginx configuration file using a template and notifies the <code>Restart Nginx</code> handler.</li>
<li><strong>Restart Nginx Handler</strong>: Restarts the Nginx service when notified.</li>
</ul>
</div><h1><p>Practical Exercise</p>
</h1>
<div class='content'></div><h2><p>Exercise</p>
</h2>
<div class='content'><ol>
<li>Create a playbook that installs MySQL, updates its configuration file, and restarts the MySQL service.</li>
<li>Use handlers to ensure the MySQL service is restarted only if the configuration file is changed.</li>
</ol>
</div><h2><p>Solution</p>
</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("LS0tCi0gbmFtZTogSW5zdGFsbCBhbmQgY29uZmlndXJlIE15U1FMCiAgaG9zdHM6IGRhdGFiYXNlcwogIHRhc2tzOgogICAgLSBuYW1lOiBJbnN0YWxsIE15U1FMCiAgICAgIGFwdDoKICAgICAgICBuYW1lOiBteXNxbC1zZXJ2ZXIKICAgICAgICBzdGF0ZTogcHJlc2VudAogICAgICBub3RpZnk6IFJlc3RhcnQgTXlTUUwKCiAgICAtIG5hbWU6IFVwZGF0ZSBNeVNRTCBjb25maWd1cmF0aW9uCiAgICAgIHRlbXBsYXRlOgogICAgICAgIHNyYzogbXkuY25mLmoyCiAgICAgICAgZGVzdDogL2V0Yy9teXNxbC9teS5jbmYKICAgICAgbm90aWZ5OiBSZXN0YXJ0IE15U1FMCgogIGhhbmRsZXJzOgogICAgLSBuYW1lOiBSZXN0YXJ0IE15U1FMCiAgICAgIHNlcnZpY2U6CiAgICAgICAgbmFtZTogbXlzcWwKICAgICAgICBzdGF0ZTogcmVzdGFydGVk"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>---
- name: Install and configure MySQL
  hosts: databases
  tasks:
    - name: Install MySQL
      apt:
        name: mysql-server
        state: present
      notify: Restart MySQL

    - name: Update MySQL configuration
      template:
        src: my.cnf.j2
        dest: /etc/mysql/my.cnf
      notify: Restart MySQL

  handlers:
    - name: Restart MySQL
      service:
        name: mysql
        state: restarted</pre></div><div class='content'></div><h2><p>Explanation</p>
</h2>
<div class='content'><ul>
<li><strong>Install MySQL Task</strong>: Installs the MySQL server and notifies the <code>Restart MySQL</code> handler.</li>
<li><strong>Update MySQL Configuration Task</strong>: Updates the MySQL configuration file using a template and notifies the <code>Restart MySQL</code> handler.</li>
<li><strong>Restart MySQL Handler</strong>: Restarts the MySQL service when notified.</li>
</ul>
</div><h1><p>Common Mistakes and Tips</p>
</h1>
<div class='content'><ul>
<li><strong>Multiple Notifications</strong>: If multiple tasks notify the same handler, the handler will only run once at the end of the playbook execution.</li>
<li><strong>Handler Names</strong>: Ensure handler names are unique within the playbook to avoid conflicts.</li>
<li><strong>Idempotency</strong>: Handlers should be idempotent, meaning running them multiple times should not change the system state after the first run.</li>
</ul>
</div><h1><p>Conclusion</p>
</h1>
<div class='content'><p>Handlers are a powerful feature in Ansible that allow you to perform actions conditionally based on the state of other tasks. By using handlers, you can ensure that services are restarted or other actions are taken only when necessary, making your playbooks more efficient and reliable.</p>
<p>In the next section, we will explore how to use templates in Ansible to manage configuration files dynamically.</p>
</div><div class='row navigation'>
	<div class='col-1 col-md-2'>
					<a href='04-04-using-roles-in-playbooks' title="Using Roles in Playbooks">
				<span class="d-none d-md-inline">&#x25C4; Previous</span>
				<span class="d-inline d-md-none"><i class="bi bi-caret-left-square-fill"></i></span>
			</a>
			</div>
	<div class='col-10 col-md-8 text-center'>
			</div>
	<div class='col-1 col-md-2 text-end'>
					<a href='05-02-templates' title="Templates">
				<span class="d-none d-md-inline">Next &#x25BA;</span>
				<span class="d-inline d-md-none"><i class="bi bi-caret-right-square-fill"></i></span>
			</a>
			</div>
</div>

			</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Advertising</h1>
			<p>This space is reserved for advertising.</p>
			<p>If you want to be a sponsor, contact us to include links in this area: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Thank you for collaborating!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. All rights reserved</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	We use cookies to improve your user experience and offer content tailored to your interests.
    <a href="#" id="btn_accept_cookies" class="button">Accept</a>
    <a href="/cookies">More Information</a>
</div>	

	</div>    
</body>
</html>
