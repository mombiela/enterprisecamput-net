<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Optimizing Playbooks</title>

    <link rel="alternate" href="https://campusempresa.com/mod/ansible/05-05-optimizing-playbooks" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/mod/ansible/05-05-optimizing-playbooks" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/mod/ansible/05-05-optimizing-playbooks" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body >
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-8 p-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo-header_enterprise.png"></a>
			</h1>
		</div>
		<div class="col-4 p-0 text-end">
			<h2 id="main_title"><cite>Building today's and tomorrow's society</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-0 m-0 text-end">
													<b id="lit_lang_es" class="px-2">EN</b>
				|
				<a href="https://campusempresa.com/mod/ansible/05-05-optimizing-playbooks" class="px-2">ES</a></b>
				|
				<a href="https://campusempresa.cat/mod/ansible/05-05-optimizing-playbooks" class="px-2">CA</a>
					</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="/objective">The Project</a>
				<a href="/about">About Us</a>
				<a href="/contribute">Contribute</a>
				<a href="/donate">Donations</a>
				<a href="/licence">License</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content">
								<div class='row navigation'>
	<div class='col-2'>
					<a href='05-04-error-handling' title="Error Handling">&#x25C4;Previous</a>
			</div>
	<div class='col-8 text-center'>
					<a href="./"><h2 style="text-decoration:underline">Optimizing Playbooks</h2></a>
			</div>
	<div class='col-2 text-end'>
					<a href='06-01-what-is-ansible-galaxy' title="What is Ansible Galaxy?">Next &#x25BA;</a>
			</div>
</div>
<div class='content'><p>Optimizing Ansible playbooks is crucial for improving performance, reducing execution time, and ensuring efficient resource usage. This section will cover various techniques and best practices to optimize your playbooks.</p>
</div><h1>Key Concepts</h1>
<div class='content'><ol>
<li><strong>Minimize Task Execution Time</strong>: Reduce the time each task takes to execute.</li>
<li><strong>Reduce Playbook Size</strong>: Keep playbooks concise and modular.</li>
<li><strong>Efficient Use of Variables</strong>: Use variables wisely to avoid redundancy.</li>
<li><strong>Parallel Execution</strong>: Execute tasks in parallel where possible.</li>
<li><strong>Idempotency</strong>: Ensure tasks are idempotent to avoid unnecessary changes.</li>
<li><strong>Caching</strong>: Use caching to avoid redundant operations.</li>
<li><strong>Handlers and Notifications</strong>: Use handlers to manage state changes efficiently.</li>
</ol>
</div><h1>Techniques for Optimization</h1>
<div class='content'></div><h2>1. Minimize Task Execution Time</h2>
<div class='content'><ul>
<li><strong>Use Specific Modules</strong>: Use the most appropriate module for the task. For example, use <code>copy</code> instead of <code>command: cp</code> for copying files.</li>
<li><strong>Limit Scope</strong>: Use <code>when</code> conditions to limit task execution to necessary hosts or conditions.</li>
</ul>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("LSBuYW1lOiBJbnN0YWxsIEFwYWNoZSBvbiBVYnVudHUKICBhcHQ6CiAgICBuYW1lOiBhcGFjaGUyCiAgICBzdGF0ZTogcHJlc2VudAogIHdoZW46IGFuc2libGVfb3NfZmFtaWx5ID09ICJEZWJpYW4i"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>- name: Install Apache on Ubuntu
  apt:
    name: apache2
    state: present
  when: ansible_os_family == &quot;Debian&quot;</pre></div><div class='content'></div><h2>2. Reduce Playbook Size</h2>
<div class='content'><ul>
<li><strong>Modular Playbooks</strong>: Break down large playbooks into smaller, reusable roles.</li>
<li><strong>Include Statements</strong>: Use <code>include</code> or <code>import</code> statements to include other playbooks or tasks.</li>
</ul>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("LSBpbXBvcnRfcGxheWJvb2s6IGNvbW1vbi55bWwKLSBpbXBvcnRfcGxheWJvb2s6IHdlYnNlcnZlcnMueW1s"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>- import_playbook: common.yml
- import_playbook: webservers.yml</pre></div><div class='content'></div><h2>3. Efficient Use of Variables</h2>
<div class='content'><ul>
<li><strong>Group Variables</strong>: Define variables at the group level in inventory files to avoid repetition.</li>
<li><strong>Default Variables</strong>: Use default variables in roles to provide fallback values.</li>
</ul>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("IyBncm91cF92YXJzL3dlYnNlcnZlcnMueW1sCmFwYWNoZV9wb3J0OiA4MA=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'># group_vars/webservers.yml
apache_port: 80</pre></div><div class='content'></div><h2>4. Parallel Execution</h2>
<div class='content'><ul>
<li><strong>Forks</strong>: Increase the number of parallel processes using the <code>forks</code> parameter in the configuration file.</li>
</ul>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("IyBhbnNpYmxlLmNmZwpbZGVmYXVsdHNdCmZvcmtzID0gMTA="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'># ansible.cfg
[defaults]
forks = 10</pre></div><div class='content'><ul>
<li><strong>Async and Poll</strong>: Use <code>async</code> and <code>poll</code> to run long-running tasks asynchronously.</li>
</ul>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("LSBuYW1lOiBSdW4gYSBsb25nIHRhc2sgYXN5bmNocm9ub3VzbHkKICBjb21tYW5kOiAvcGF0aC90by9sb25nL3Rhc2sKICBhc3luYzogMzYwMAogIHBvbGw6IDAKICByZWdpc3RlcjogbG9uZ190YXNrCgotIG5hbWU6IENoZWNrIG9uIHRoZSBsb25nIHRhc2sKICBhc3luY19zdGF0dXM6CiAgICBqaWQ6ICJ7eyBsb25nX3Rhc2suYW5zaWJsZV9qb2JfaWQgfX0iCiAgcmVnaXN0ZXI6IGpvYl9yZXN1bHQKICB1bnRpbDogam9iX3Jlc3VsdC5maW5pc2hlZAogIHJldHJpZXM6IDMwCiAgZGVsYXk6IDEw"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>- name: Run a long task asynchronously
  command: /path/to/long/task
  async: 3600
  poll: 0
  register: long_task

- name: Check on the long task
  async_status:
    jid: &quot;{{ long_task.ansible_job_id }}&quot;
  register: job_result
  until: job_result.finished
  retries: 30
  delay: 10</pre></div><div class='content'></div><h2>5. Idempotency</h2>
<div class='content'><ul>
<li><strong>Check Mode</strong>: Use <code>check_mode</code> to ensure tasks are idempotent and do not make unnecessary changes.</li>
</ul>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("LSBuYW1lOiBFbnN1cmUgQXBhY2hlIGlzIGluc3RhbGxlZAogIGFwdDoKICAgIG5hbWU6IGFwYWNoZTIKICAgIHN0YXRlOiBwcmVzZW50CiAgY2hlY2tfbW9kZTogeWVz"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>- name: Ensure Apache is installed
  apt:
    name: apache2
    state: present
  check_mode: yes</pre></div><div class='content'></div><h2>6. Caching</h2>
<div class='content'><ul>
<li><strong>Fact Caching</strong>: Enable fact caching to avoid gathering facts multiple times.</li>
</ul>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("IyBhbnNpYmxlLmNmZwpbZGVmYXVsdHNdCmdhdGhlcmluZyA9IHNtYXJ0CmZhY3RfY2FjaGluZyA9IGpzb25maWxlCmZhY3RfY2FjaGluZ19jb25uZWN0aW9uID0gL3BhdGgvdG8vZmFjdF9jYWNoZQ=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'># ansible.cfg
[defaults]
gathering = smart
fact_caching = jsonfile
fact_caching_connection = /path/to/fact_cache</pre></div><div class='content'></div><h2>7. Handlers and Notifications</h2>
<div class='content'><ul>
<li><strong>Efficient Handlers</strong>: Use handlers to perform actions only when necessary, such as restarting a service only if a configuration file changes.</li>
</ul>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("LSBuYW1lOiBDb3B5IEFwYWNoZSBjb25maWcgZmlsZQogIGNvcHk6CiAgICBzcmM6IGFwYWNoZS5jb25mCiAgICBkZXN0OiAvZXRjL2FwYWNoZTIvYXBhY2hlMi5jb25mCiAgbm90aWZ5OiBSZXN0YXJ0IEFwYWNoZQoKaGFuZGxlcnM6CiAgLSBuYW1lOiBSZXN0YXJ0IEFwYWNoZQogICAgc2VydmljZToKICAgICAgbmFtZTogYXBhY2hlMgogICAgICBzdGF0ZTogcmVzdGFydGVk"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>- name: Copy Apache config file
  copy:
    src: apache.conf
    dest: /etc/apache2/apache2.conf
  notify: Restart Apache

handlers:
  - name: Restart Apache
    service:
      name: apache2
      state: restarted</pre></div><div class='content'></div><h1>Practical Exercise</h1>
<div class='content'></div><h2>Exercise: Optimize a Playbook</h2>
<div class='content'><p>Given the following playbook, apply the optimization techniques discussed above:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("LS0tCi0gaG9zdHM6IGFsbAogIHRhc2tzOgogICAgLSBuYW1lOiBJbnN0YWxsIEFwYWNoZQogICAgICBjb21tYW5kOiBhcHQtZ2V0IGluc3RhbGwgLXkgYXBhY2hlMgoKICAgIC0gbmFtZTogQ29weSBBcGFjaGUgY29uZmlnCiAgICAgIGNvbW1hbmQ6IGNwIC90bXAvYXBhY2hlLmNvbmYgL2V0Yy9hcGFjaGUyL2FwYWNoZTIuY29uZgoKICAgIC0gbmFtZTogUmVzdGFydCBBcGFjaGUKICAgICAgY29tbWFuZDogc3lzdGVtY3RsIHJlc3RhcnQgYXBhY2hlMg=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>---
- hosts: all
  tasks:
    - name: Install Apache
      command: apt-get install -y apache2

    - name: Copy Apache config
      command: cp /tmp/apache.conf /etc/apache2/apache2.conf

    - name: Restart Apache
      command: systemctl restart apache2</pre></div><div class='content'></div><h2>Solution</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("LS0tCi0gaG9zdHM6IGFsbAogIHRhc2tzOgogICAgLSBuYW1lOiBJbnN0YWxsIEFwYWNoZQogICAgICBhcHQ6CiAgICAgICAgbmFtZTogYXBhY2hlMgogICAgICAgIHN0YXRlOiBwcmVzZW50CgogICAgLSBuYW1lOiBDb3B5IEFwYWNoZSBjb25maWcKICAgICAgY29weToKICAgICAgICBzcmM6IC90bXAvYXBhY2hlLmNvbmYKICAgICAgICBkZXN0OiAvZXRjL2FwYWNoZTIvYXBhY2hlMi5jb25mCiAgICAgIG5vdGlmeTogUmVzdGFydCBBcGFjaGUKCmhhbmRsZXJzOgogIC0gbmFtZTogUmVzdGFydCBBcGFjaGUKICAgIHNlcnZpY2U6CiAgICAgIG5hbWU6IGFwYWNoZTIKICAgICAgc3RhdGU6IHJlc3RhcnRlZA=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>---
- hosts: all
  tasks:
    - name: Install Apache
      apt:
        name: apache2
        state: present

    - name: Copy Apache config
      copy:
        src: /tmp/apache.conf
        dest: /etc/apache2/apache2.conf
      notify: Restart Apache

handlers:
  - name: Restart Apache
    service:
      name: apache2
      state: restarted</pre></div><div class='content'></div><h1>Common Mistakes and Tips</h1>
<div class='content'><ul>
<li><strong>Avoid Using Shell/Command Modules</strong>: Prefer specific modules like <code>apt</code>, <code>copy</code>, and <code>service</code> over <code>shell</code> or <code>command</code> for better idempotency and performance.</li>
<li><strong>Limit Fact Gathering</strong>: Use <code>gather_facts: no</code> if facts are not needed for a playbook.</li>
<li><strong>Use Tags</strong>: Apply tags to tasks and roles to run specific parts of a playbook.</li>
</ul>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("LSBuYW1lOiBJbnN0YWxsIEFwYWNoZQogIGFwdDoKICAgIG5hbWU6IGFwYWNoZTIKICAgIHN0YXRlOiBwcmVzZW50CiAgdGFnczogYXBhY2hl"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>- name: Install Apache
  apt:
    name: apache2
    state: present
  tags: apache</pre></div><div class='content'></div><h1>Conclusion</h1>
<div class='content'><p>Optimizing Ansible playbooks involves a combination of best practices and specific techniques to ensure efficient and effective automation. By minimizing task execution time, reducing playbook size, using variables efficiently, enabling parallel execution, ensuring idempotency, leveraging caching, and using handlers wisely, you can significantly improve the performance and maintainability of your Ansible playbooks.</p>
</div><div class='row navigation'>
	<div class='col-2'>
					<a href='05-04-error-handling' title="Error Handling">&#x25C4;Previous</a>
			</div>
	<div class='col-8 text-center'>
			</div>
	<div class='col-2 text-end'>
					<a href='06-01-what-is-ansible-galaxy' title="What is Ansible Galaxy?">Next &#x25BA;</a>
			</div>
</div>

			</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Advertising</h1>
			<p>This space is reserved for advertising.</p>
			<p>If you want to be a sponsor, contact us to include links in this area: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Thank you for collaborating!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. All rights reserved</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir galetes per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Accept</a>
    <a href="/cookies">More Information</a>
</div>	

	</div>    
</body>
</html>
