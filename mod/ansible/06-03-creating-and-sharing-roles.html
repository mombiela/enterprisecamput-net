<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Creating and Sharing Roles</title>

    <link rel="alternate" href="https://campusempresa.com/mod/ansible/06-03-creating-and-sharing-roles" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/mod/ansible/06-03-creating-and-sharing-roles" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/mod/ansible/06-03-creating-and-sharing-roles" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="/js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body >
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-12 col-md-8 p-2 p-md-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo-header_enterprise.png"></a>
			</h1>
		</div>
		<div class="col-12 col-md-4 p-2 p-md-0 text-end">
			<h2 id="main_title"><cite>Building today's and tomorrow's society</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-2 p-md-0 m-0 text-end">
													<b id="lit_lang_es" class="px-2">EN</b>
				|
				<a href="https://campusempresa.com/mod/ansible/06-03-creating-and-sharing-roles" class="px-2">ES</a></b>
				|
				<a href="https://campusempresa.cat/mod/ansible/06-03-creating-and-sharing-roles" class="px-2">CA</a>
					</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="/objective">The Project</a>
				<a href="/about">About Us</a>
				<a href="/contribute">Contribute</a>
				<a href="/donate">Donations</a>
				<a href="/licence">License</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content">
								<div class='row navigation'>
	<div class='col-2'>
					<a href='06-02-using-ansible-galaxy' title="Using Ansible Galaxy">&#x25C4;Previous</a>
			</div>
	<div class='col-8 text-center'>
					<a href="./"><h2 style="text-decoration:underline">Creating and Sharing Roles</h2></a>
			</div>
	<div class='col-2 text-end'>
					<a href='07-01-introduction-to-ansible-tower' title="Introduction to Ansible Tower">Next &#x25BA;</a>
			</div>
</div>
<div class='content'><p>In this section, we will delve into the process of creating and sharing roles in Ansible. Roles are a powerful way to organize and reuse Ansible code, making your playbooks more modular and maintainable. By the end of this section, you will understand how to create roles, structure them properly, and share them using Ansible Galaxy.</p>
</div><h1><p>What is a Role?</p>
</h1>
<div class='content'><p>A role in Ansible is a way to group related tasks, variables, files, templates, and handlers into a single unit. Roles help in organizing playbooks and make them reusable and easier to manage.</p>
</div><h1><p>Creating a Role</p>
</h1>
<div class='content'></div><h2><p>Step-by-Step Guide</p>
</h2>
<div class='content'><ol>
<li>
<p><strong>Create a Role Directory Structure:</strong>
Use the <code>ansible-galaxy</code> command to create a new role. This command will generate the necessary directory structure for you.</p>
<pre><code class="language-bash">ansible-galaxy init my_role
</code></pre>
<p>This will create a directory named <code>my_role</code> with the following structure:</p>
<pre><code>my_role/
├── defaults
│   └── main.yml
├── files
├── handlers
│   └── main.yml
├── meta
│   └── main.yml
├── tasks
│   └── main.yml
├── templates
├── tests
│   ├── inventory
│   └── test.yml
└── vars
    └── main.yml
</code></pre>
</li>
<li>
<p><strong>Define Tasks:</strong>
Add tasks to the <code>tasks/main.yml</code> file. Tasks are the core of a role and define the actions to be performed.</p>
<pre><code class="language-yaml"># my_role/tasks/main.yml
- name: Install Nginx
  apt:
    name: nginx
    state: present
</code></pre>
</li>
<li>
<p><strong>Set Default Variables:</strong>
Define default variables in the <code>defaults/main.yml</code> file. These variables can be overridden by the user.</p>
<pre><code class="language-yaml"># my_role/defaults/main.yml
nginx_port: 80
</code></pre>
</li>
<li>
<p><strong>Add Handlers:</strong>
Handlers are tasks that are triggered by other tasks. Define them in the <code>handlers/main.yml</code> file.</p>
<pre><code class="language-yaml"># my_role/handlers/main.yml
- name: restart nginx
  service:
    name: nginx
    state: restarted
</code></pre>
</li>
<li>
<p><strong>Include Files and Templates:</strong>
Place any files or templates your role needs in the <code>files</code> and <code>templates</code> directories, respectively.</p>
<pre><code class="language-yaml"># my_role/templates/nginx.conf.j2
server {
    listen {{ nginx_port }};
    server_name localhost;
}
</code></pre>
</li>
<li>
<p><strong>Meta Information:</strong>
Provide metadata about your role in the <code>meta/main.yml</code> file. This includes information like the author, license, and dependencies.</p>
<pre><code class="language-yaml"># my_role/meta/main.yml
galaxy_info:
  author: Your Name
  description: Install and configure Nginx
  license: MIT
  min_ansible_version: 2.9
</code></pre>
</li>
</ol>
</div><h1><p>Sharing Roles</p>
</h1>
<div class='content'></div><h2><p>Using Ansible Galaxy</p>
</h2>
<div class='content'><p>Ansible Galaxy is a hub for finding, reusing, and sharing Ansible roles. To share your role on Ansible Galaxy, follow these steps:</p>
<ol>
<li>
<p><strong>Create a Galaxy Account:</strong>
Sign up for an account on <a href="https://galaxy.ansible.com/">Ansible Galaxy</a>.</p>
</li>
<li>
<p><strong>Prepare Your Role:</strong>
Ensure your role follows the best practices and includes all necessary metadata in the <code>meta/main.yml</code> file.</p>
</li>
<li>
<p><strong>Publish Your Role:</strong>
Use the <code>ansible-galaxy</code> command to publish your role.</p>
<pre><code class="language-bash">ansible-galaxy import username my_role
</code></pre>
<p>Replace <code>username</code> with your Galaxy username and <code>my_role</code> with the name of your role.</p>
</li>
<li>
<p><strong>Versioning:</strong>
Tag your role with a version number using Git. This helps users to track changes and use specific versions of your role.</p>
<pre><code class="language-bash">git tag 1.0.0
git push origin 1.0.0
</code></pre>
</li>
</ol>
</div><h2><p>Using GitHub</p>
</h2>
<div class='content'><p>You can also share your roles via GitHub. Simply push your role to a GitHub repository and provide the URL to users.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Z2l0IGluaXQKZ2l0IGFkZCAuCmdpdCBjb21taXQgLW0gIkluaXRpYWwgY29tbWl0IgpnaXQgcmVtb3RlIGFkZCBvcmlnaW4gaHR0cHM6Ly9naXRodWIuY29tL3VzZXJuYW1lL215X3JvbGUuZ2l0CmdpdCBwdXNoIC11IG9yaWdpbiBtYXN0ZXI="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>git init
git add .
git commit -m &quot;Initial commit&quot;
git remote add origin https://github.com/username/my_role.git
git push -u origin master</pre></div><div class='content'></div><h1><p>Practical Exercise</p>
</h1>
<div class='content'></div><h2><p>Exercise: Create and Share a Role</p>
</h2>
<div class='content'><ol>
<li>
<p><strong>Create a Role:</strong>
Create a role named <code>webserver</code> that installs and configures Apache.</p>
</li>
<li>
<p><strong>Define Tasks:</strong>
Add tasks to install Apache and start the service.</p>
</li>
<li>
<p><strong>Set Default Variables:</strong>
Define a default variable for the Apache port.</p>
</li>
<li>
<p><strong>Add Handlers:</strong>
Add a handler to restart Apache.</p>
</li>
<li>
<p><strong>Share the Role:</strong>
Publish the role on Ansible Galaxy or share it via GitHub.</p>
</li>
</ol>
</div><h2><p>Solution</p>
</h2>
<div class='content'><ol>
<li>
<p><strong>Create a Role:</strong></p>
<pre><code class="language-bash">ansible-galaxy init webserver
</code></pre>
</li>
<li>
<p><strong>Define Tasks:</strong></p>
<pre><code class="language-yaml"># webserver/tasks/main.yml
- name: Install Apache
  apt:
    name: apache2
    state: present

- name: Start Apache
  service:
    name: apache2
    state: started
    enabled: true
</code></pre>
</li>
<li>
<p><strong>Set Default Variables:</strong></p>
<pre><code class="language-yaml"># webserver/defaults/main.yml
apache_port: 80
</code></pre>
</li>
<li>
<p><strong>Add Handlers:</strong></p>
<pre><code class="language-yaml"># webserver/handlers/main.yml
- name: restart apache
  service:
    name: apache2
    state: restarted
</code></pre>
</li>
<li>
<p><strong>Share the Role:</strong>
Follow the steps mentioned above to publish the role on Ansible Galaxy or share it via GitHub.</p>
</li>
</ol>
</div><h1><p>Conclusion</p>
</h1>
<div class='content'><p>In this section, we covered the creation and sharing of Ansible roles. Roles help in organizing and reusing Ansible code, making your playbooks more modular and maintainable. We also explored how to share roles using Ansible Galaxy and GitHub. In the next module, we will dive into Ansible Tower and learn how to manage projects and inventories.</p>
</div><div class='row navigation'>
	<div class='col-2'>
					<a href='06-02-using-ansible-galaxy' title="Using Ansible Galaxy">&#x25C4;Previous</a>
			</div>
	<div class='col-8 text-center'>
			</div>
	<div class='col-2 text-end'>
					<a href='07-01-introduction-to-ansible-tower' title="Introduction to Ansible Tower">Next &#x25BA;</a>
			</div>
</div>

			</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Advertising</h1>
			<p>This space is reserved for advertising.</p>
			<p>If you want to be a sponsor, contact us to include links in this area: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Thank you for collaborating!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. All rights reserved</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	We use cookies to improve your user experience and offer content tailored to your interests.
    <a href="#" id="btn_accept_cookies" class="button">Accept</a>
    <a href="/cookies">More Information</a>
</div>	

	</div>    
</body>
</html>
