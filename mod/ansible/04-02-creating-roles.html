<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Creating Roles</title>

    <link rel="alternate" href="https://campusempresa.com/mod/ansible/04-02-creating-roles" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/mod/ansible/04-02-creating-roles" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/mod/ansible/04-02-creating-roles" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="/js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body >
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-12 col-md-6 p-2 p-md-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo-header_enterprise.png"></a>
			</h1>
		</div>
		<div class="col-12 col-md-6 p-2 p-md-0 text-end">
				<b id="lit_lang_es" class="px-2">EN</b>
	|
	<a href="https://campusempresa.com/mod/ansible/04-02-creating-roles" class="px-2">ES</a></b>
	|
	<a href="https://campusempresa.cat/mod/ansible/04-02-creating-roles" class="px-2">CA</a>
<br>
			<cite>Building today's and tomorrow's society</cite>
		</div>
	</div>
</div>
<div id="subheader" class="container-xxl">
	<div class="row">
		<div class="col-12 p-2 p-md-0 m-0 text-end">
			<a href="/objective">The Project</a> | 
<a href="/about">About Us</a> | 
<a href="/contribute">Contribute</a> | 
<a href="/donate">Donations</a> | 
<a href="/licence">License</a>
		</div>
	</div>
</div>

<div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
									<a href="./">Course Content</a>
					<span class="sep">|</span>
								<a href="/all/competencias">Technical Skills</a>
				<a href="/all/conocimientos">Knowledge</a>
				<a href="/all/soft_skills">Social Skills</a>
			</div>
		</div>
	</div>
</div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content">
								<div class='row navigation'>
	<div class='col-1 col-md-2'>
					<a href='04-01-introduction-to-roles' title="Introduction to Roles">
				<span class="d-none d-md-inline">&#x25C4; Previous</span>
				<span class="d-inline d-md-none"><i class="bi bi-caret-left-square-fill"></i></span>
			</a>
			</div>
	<div class='col-10 col-md-8 text-center'>
					<a href="./"><h2 style="text-decoration:underline">Creating Roles</h2></a>
			</div>
	<div class='col-1 col-md-2 text-end'>
					<a href='04-03-role-directory-structure' title="Role Directory Structure">
				<span class="d-none d-md-inline">Next &#x25BA;</span>
				<span class="d-inline d-md-none"><i class="bi bi-caret-right-square-fill"></i></span>
			</a>
			</div>
</div>
<div class='content'><p>In this section, we will delve into the process of creating roles in Ansible. Roles are a powerful way to organize and reuse Ansible code, making your playbooks more modular and maintainable. By the end of this section, you will understand how to create roles and use them effectively in your Ansible projects.</p>
</div><h1><p>What is a Role?</p>
</h1>
<div class='content'><p>A role in Ansible is a way to group related tasks, variables, files, templates, and handlers into a single unit. This modular approach helps in organizing your playbooks and makes them easier to manage and reuse.</p>
</div><h1><p>Steps to Create a Role</p>
</h1>
<div class='content'></div><h2><ol>
<li>Role Directory Structure</li>
</ol>
</h2>
<div class='content'><p>Ansible expects a specific directory structure for roles. Here is the standard structure:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("cm9sZXMvCiAg4pSU4pSA4pSAIDxyb2xlX25hbWU+LwogICAgICDilJzilIDilIAgdGFza3MvCiAgICAgIOKUgiAgIOKUlOKUgOKUgCBtYWluLnltbAogICAgICDilJzilIDilIAgaGFuZGxlcnMvCiAgICAgIOKUgiAgIOKUlOKUgOKUgCBtYWluLnltbAogICAgICDilJzilIDilIAgdGVtcGxhdGVzLwogICAgICDilJzilIDilIAgZmlsZXMvCiAgICAgIOKUnOKUgOKUgCB2YXJzLwogICAgICDilIIgICDilJTilIDilIAgbWFpbi55bWwKICAgICAg4pSc4pSA4pSAIGRlZmF1bHRzLwogICAgICDilIIgICDilJTilIDilIAgbWFpbi55bWwKICAgICAg4pSc4pSA4pSAIG1ldGEvCiAgICAgIOKUgiAgIOKUlOKUgOKUgCBtYWluLnltbAogICAgICDilJTilIDilIAgUkVBRE1FLm1k"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>roles/
  └── &lt;role_name&gt;/
      ├── tasks/
      │   └── main.yml
      ├── handlers/
      │   └── main.yml
      ├── templates/
      ├── files/
      ├── vars/
      │   └── main.yml
      ├── defaults/
      │   └── main.yml
      ├── meta/
      │   └── main.yml
      └── README.md</pre></div><div class='content'></div><h2><ol start="2">
<li>Creating the Role Directory</li>
</ol>
</h2>
<div class='content'><p>Let's create a role named <code>webserver</code>. You can create the directory structure manually or use the <code>ansible-galaxy</code> command to generate it for you.</p>
<h4>Using <code>ansible-galaxy</code> Command</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("YW5zaWJsZS1nYWxheHkgaW5pdCB3ZWJzZXJ2ZXI="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>ansible-galaxy init webserver</pre></div><div class='content'><p>This command will create the necessary directory structure for the <code>webserver</code> role.</p>
</div><h2><ol start="3">
<li>Adding Tasks</li>
</ol>
</h2>
<div class='content'><p>Tasks are the core of any role. They define the actions that Ansible will perform. Create a <code>main.yml</code> file inside the <code>tasks</code> directory and add your tasks.</p>
<h4>Example: <code>tasks/main.yml</code></h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("LS0tCiMgdGFza3MgZmlsZSBmb3Igd2Vic2VydmVyCi0gbmFtZTogSW5zdGFsbCBBcGFjaGUKICBhcHQ6CiAgICBuYW1lOiBhcGFjaGUyCiAgICBzdGF0ZTogcHJlc2VudAogIGJlY29tZTogeWVzCgotIG5hbWU6IFN0YXJ0IEFwYWNoZSBzZXJ2aWNlCiAgc2VydmljZToKICAgIG5hbWU6IGFwYWNoZTIKICAgIHN0YXRlOiBzdGFydGVkCiAgICBlbmFibGVkOiB5ZXM="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>---
# tasks file for webserver
- name: Install Apache
  apt:
    name: apache2
    state: present
  become: yes

- name: Start Apache service
  service:
    name: apache2
    state: started
    enabled: yes</pre></div><div class='content'></div><h2><ol start="4">
<li>Adding Handlers</li>
</ol>
</h2>
<div class='content'><p>Handlers are used to perform actions when notified by tasks. Create a <code>main.yml</code> file inside the <code>handlers</code> directory.</p>
<h4>Example: <code>handlers/main.yml</code></h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("LS0tCiMgaGFuZGxlcnMgZmlsZSBmb3Igd2Vic2VydmVyCi0gbmFtZTogcmVzdGFydCBhcGFjaGUKICBzZXJ2aWNlOgogICAgbmFtZTogYXBhY2hlMgogICAgc3RhdGU6IHJlc3RhcnRlZA=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>---
# handlers file for webserver
- name: restart apache
  service:
    name: apache2
    state: restarted</pre></div><div class='content'></div><h2><ol start="5">
<li>Adding Templates and Files</li>
</ol>
</h2>
<div class='content'><p>Templates and files are used to manage configuration files. Place your Jinja2 templates in the <code>templates</code> directory and static files in the <code>files</code> directory.</p>
<h4>Example: <code>templates/index.html.j2</code></h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("PCFET0NUWVBFIGh0bWw+CjxodG1sPgo8aGVhZD4KICAgIDx0aXRsZT5XZWxjb21lIHRvIHt7IGFuc2libGVfaG9zdG5hbWUgfX08L3RpdGxlPgo8L2hlYWQ+Cjxib2R5PgogICAgPGgxPkhlbGxvIGZyb20ge3sgYW5zaWJsZV9ob3N0bmFtZSB9fTwvaDE+CjwvYm9keT4KPC9odG1sPg=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;Welcome to {{ ansible_hostname }}&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;h1&gt;Hello from {{ ansible_hostname }}&lt;/h1&gt;
&lt;/body&gt;
&lt;/html&gt;</pre></div><div class='content'></div><h2><ol start="6">
<li>Adding Variables</li>
</ol>
</h2>
<div class='content'><p>Variables can be defined in the <code>vars</code> and <code>defaults</code> directories. Variables in <code>defaults</code> have the lowest precedence, while those in <code>vars</code> have a higher precedence.</p>
<h4>Example: <code>defaults/main.yml</code></h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("LS0tCiMgZGVmYXVsdHMgZmlsZSBmb3Igd2Vic2VydmVyCmFwYWNoZV9wb3J0OiA4MA=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>---
# defaults file for webserver
apache_port: 80</pre></div><div class='content'></div><h2><ol start="7">
<li>Adding Metadata</li>
</ol>
</h2>
<div class='content'><p>Metadata provides information about the role, such as its dependencies. Create a <code>main.yml</code> file inside the <code>meta</code> directory.</p>
<h4>Example: <code>meta/main.yml</code></h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("LS0tCiMgbWV0YSBmaWxlIGZvciB3ZWJzZXJ2ZXIKZGVwZW5kZW5jaWVzOiBbXQ=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>---
# meta file for webserver
dependencies: []</pre></div><div class='content'></div><h2><ol start="8">
<li>Using the Role in a Playbook</li>
</ol>
</h2>
<div class='content'><p>Once the role is created, you can use it in your playbooks. Here's an example of how to use the <code>webserver</code> role in a playbook.</p>
<h4>Example: <code>site.yml</code></h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("LS0tCi0gaG9zdHM6IHdlYnNlcnZlcnMKICByb2xlczoKICAgIC0gd2Vic2VydmVy"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>---
- hosts: webservers
  roles:
    - webserver</pre></div><div class='content'></div><h1><p>Practical Exercise</p>
</h1>
<div class='content'></div><h2><p>Exercise: Create a Role to Install and Configure Nginx</p>
</h2>
<div class='content'><ol>
<li>Create a role named <code>nginx</code>.</li>
<li>Add tasks to install and start the Nginx service.</li>
<li>Add a handler to restart Nginx when notified.</li>
<li>Create a template for the Nginx default page.</li>
<li>Define a variable for the Nginx port in the <code>defaults</code> directory.</li>
<li>Use the role in a playbook.</li>
</ol>
<h4>Solution</h4>
<ol>
<li>Create the role:</li>
</ol>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("YW5zaWJsZS1nYWxheHkgaW5pdCBuZ2lueA=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>ansible-galaxy init nginx</pre></div><div class='content'><ol start="2">
<li>Add tasks to <code>tasks/main.yml</code>:</li>
</ol>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("LS0tCiMgdGFza3MgZmlsZSBmb3IgbmdpbngKLSBuYW1lOiBJbnN0YWxsIE5naW54CiAgYXB0OgogICAgbmFtZTogbmdpbngKICAgIHN0YXRlOiBwcmVzZW50CiAgYmVjb21lOiB5ZXMKCi0gbmFtZTogU3RhcnQgTmdpbnggc2VydmljZQogIHNlcnZpY2U6CiAgICBuYW1lOiBuZ2lueAogICAgc3RhdGU6IHN0YXJ0ZWQKICAgIGVuYWJsZWQ6IHllcw=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>---
# tasks file for nginx
- name: Install Nginx
  apt:
    name: nginx
    state: present
  become: yes

- name: Start Nginx service
  service:
    name: nginx
    state: started
    enabled: yes</pre></div><div class='content'><ol start="3">
<li>Add a handler to <code>handlers/main.yml</code>:</li>
</ol>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("LS0tCiMgaGFuZGxlcnMgZmlsZSBmb3IgbmdpbngKLSBuYW1lOiByZXN0YXJ0IG5naW54CiAgc2VydmljZToKICAgIG5hbWU6IG5naW54CiAgICBzdGF0ZTogcmVzdGFydGVk"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>---
# handlers file for nginx
- name: restart nginx
  service:
    name: nginx
    state: restarted</pre></div><div class='content'><ol start="4">
<li>Create a template <code>templates/index.html.j2</code>:</li>
</ol>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("PCFET0NUWVBFIGh0bWw+CjxodG1sPgo8aGVhZD4KICAgIDx0aXRsZT5XZWxjb21lIHRvIHt7IGFuc2libGVfaG9zdG5hbWUgfX08L3RpdGxlPgo8L2hlYWQ+Cjxib2R5PgogICAgPGgxPkhlbGxvIGZyb20ge3sgYW5zaWJsZV9ob3N0bmFtZSB9fTwvaDE+CjwvYm9keT4KPC9odG1sPg=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;Welcome to {{ ansible_hostname }}&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;h1&gt;Hello from {{ ansible_hostname }}&lt;/h1&gt;
&lt;/body&gt;
&lt;/html&gt;</pre></div><div class='content'><ol start="5">
<li>Define a variable in <code>defaults/main.yml</code>:</li>
</ol>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("LS0tCiMgZGVmYXVsdHMgZmlsZSBmb3IgbmdpbngKbmdpbnhfcG9ydDogODA="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>---
# defaults file for nginx
nginx_port: 80</pre></div><div class='content'><ol start="6">
<li>Use the role in a playbook <code>site.yml</code>:</li>
</ol>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("LS0tCi0gaG9zdHM6IHdlYnNlcnZlcnMKICByb2xlczoKICAgIC0gbmdpbng="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>---
- hosts: webservers
  roles:
    - nginx</pre></div><div class='content'></div><h1><p>Conclusion</p>
</h1>
<div class='content'><p>In this section, we covered the process of creating roles in Ansible. We discussed the role directory structure, how to add tasks, handlers, templates, files, variables, and metadata. We also provided a practical exercise to reinforce the concepts learned. Roles are a powerful feature in Ansible that help in organizing and reusing your code, making your playbooks more modular and maintainable. In the next section, we will explore how to use roles in playbooks.</p>
</div><div class='row navigation'>
	<div class='col-1 col-md-2'>
					<a href='04-01-introduction-to-roles' title="Introduction to Roles">
				<span class="d-none d-md-inline">&#x25C4; Previous</span>
				<span class="d-inline d-md-none"><i class="bi bi-caret-left-square-fill"></i></span>
			</a>
			</div>
	<div class='col-10 col-md-8 text-center'>
			</div>
	<div class='col-1 col-md-2 text-end'>
					<a href='04-03-role-directory-structure' title="Role Directory Structure">
				<span class="d-none d-md-inline">Next &#x25BA;</span>
				<span class="d-inline d-md-none"><i class="bi bi-caret-right-square-fill"></i></span>
			</a>
			</div>
</div>

			</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Advertising</h1>
			<p>This space is reserved for advertising.</p>
			<p>If you want to be a sponsor, contact us to include links in this area: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Thank you for collaborating!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. All rights reserved</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	We use cookies to improve your user experience and offer content tailored to your interests.
    <a href="#" id="btn_accept_cookies" class="button">Accept</a>
    <a href="/cookies">More Information</a>
</div>	

	</div>    
</body>
</html>
