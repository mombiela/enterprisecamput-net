<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Playbook Structure</title>

    <link rel="alternate" href="https://campusempresa.com/mod/ansible/03-03-playbook-structure" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/mod/ansible/03-03-playbook-structure" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/mod/ansible/03-03-playbook-structure" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="/js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body >
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-12 col-md-8 p-2 p-md-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo-header_enterprise.png"></a>
			</h1>
		</div>
		<div class="col-12 col-md-4 p-2 p-md-0 text-end">
			<h2 id="main_title"><cite>Building today's and tomorrow's society</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-2 p-md-0 m-0 text-end">
													<b id="lit_lang_es" class="px-2">EN</b>
				|
				<a href="https://campusempresa.com/mod/ansible/03-03-playbook-structure" class="px-2">ES</a></b>
				|
				<a href="https://campusempresa.cat/mod/ansible/03-03-playbook-structure" class="px-2">CA</a>
					</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="/objective">The Project</a>
				<a href="/about">About Us</a>
				<a href="/contribute">Contribute</a>
				<a href="/donate">Donations</a>
				<a href="/licence">License</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content">
								<div class='row navigation'>
	<div class='col-2'>
					<a href='03-02-writing-your-first-playbook' title="Writing Your First Playbook">&#x25C4;Previous</a>
			</div>
	<div class='col-8 text-center'>
					<a href="./"><h2 style="text-decoration:underline">Playbook Structure</h2></a>
			</div>
	<div class='col-2 text-end'>
					<a href='03-04-variables-and-facts' title="Variables and Facts">Next &#x25BA;</a>
			</div>
</div>
<div class='content'><p>In this section, we will delve into the structure of an Ansible playbook. Understanding the structure is crucial for writing effective and maintainable playbooks. We will cover the following key components:</p>
<ol>
<li><strong>YAML Basics</strong></li>
<li><strong>Playbook Anatomy</strong></li>
<li><strong>Tasks</strong></li>
<li><strong>Handlers</strong></li>
<li><strong>Variables</strong></li>
<li><strong>Includes and Imports</strong></li>
</ol>
</div><h1><ol>
<li>YAML Basics</li>
</ol>
</h1>
<div class='content'><p>Ansible playbooks are written in YAML (YAML Ain't Markup Language). Here are some basic rules of YAML:</p>
<ul>
<li>YAML files use indentation to indicate structure. Indentation is done using spaces, not tabs.</li>
<li>Lists are indicated by a dash (<code>-</code>).</li>
<li>Key-value pairs are separated by a colon (<code>:</code>).</li>
</ul>
</div><h2><p>Example:</p>
</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("IyBBIHNpbXBsZSBZQU1MIGV4YW1wbGUKLSBuYW1lOiBJbnN0YWxsIEFwYWNoZQogIGhvc3RzOiB3ZWJzZXJ2ZXJzCiAgdGFza3M6CiAgICAtIG5hbWU6IEVuc3VyZSBBcGFjaGUgaXMgaW5zdGFsbGVkCiAgICAgIHl1bToKICAgICAgICBuYW1lOiBodHRwZAogICAgICAgIHN0YXRlOiBwcmVzZW50"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'># A simple YAML example
- name: Install Apache
  hosts: webservers
  tasks:
    - name: Ensure Apache is installed
      yum:
        name: httpd
        state: present</pre></div><div class='content'></div><h1><ol start="2">
<li>Playbook Anatomy</li>
</ol>
</h1>
<div class='content'><p>A playbook is a collection of plays. Each play targets a group of hosts and defines tasks to be executed on those hosts.</p>
</div><h2><p>Basic Structure:</p>
</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("LSBuYW1lOiBQbGF5Ym9vayBOYW1lCiAgaG9zdHM6IHRhcmdldF9ob3N0cwogIGJlY29tZTogeWVzL25vCiAgdmFyczoKICAgIHZhcmlhYmxlX25hbWU6IHZhbHVlCiAgdGFza3M6CiAgICAtIG5hbWU6IFRhc2sgTmFtZQogICAgICBtb2R1bGVfbmFtZToKICAgICAgICBwYXJhbWV0ZXIxOiB2YWx1ZTEKICAgICAgICBwYXJhbWV0ZXIyOiB2YWx1ZTIKICBoYW5kbGVyczoKICAgIC0gbmFtZTogSGFuZGxlciBOYW1lCiAgICAgIG1vZHVsZV9uYW1lOgogICAgICAgIHBhcmFtZXRlcjE6IHZhbHVlMQ=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>- name: Playbook Name
  hosts: target_hosts
  become: yes/no
  vars:
    variable_name: value
  tasks:
    - name: Task Name
      module_name:
        parameter1: value1
        parameter2: value2
  handlers:
    - name: Handler Name
      module_name:
        parameter1: value1</pre></div><div class='content'></div><h2><p>Explanation:</p>
</h2>
<div class='content'><ul>
<li><strong>name</strong>: A description of the playbook or play.</li>
<li><strong>hosts</strong>: The target hosts on which the playbook will run.</li>
<li><strong>become</strong>: Whether to escalate privileges (e.g., using <code>sudo</code>).</li>
<li><strong>vars</strong>: Variables used within the playbook.</li>
<li><strong>tasks</strong>: A list of tasks to be executed.</li>
<li><strong>handlers</strong>: Special tasks that are triggered by other tasks.</li>
</ul>
</div><h1><ol start="3">
<li>Tasks</li>
</ol>
</h1>
<div class='content'><p>Tasks are the core of a playbook. Each task uses an Ansible module to perform an action.</p>
</div><h2><p>Example:</p>
</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("LSBuYW1lOiBFbnN1cmUgQXBhY2hlIGlzIGluc3RhbGxlZAogIHl1bToKICAgIG5hbWU6IGh0dHBkCiAgICBzdGF0ZTogcHJlc2VudA=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>- name: Ensure Apache is installed
  yum:
    name: httpd
    state: present</pre></div><div class='content'></div><h2><p>Explanation:</p>
</h2>
<div class='content'><ul>
<li><strong>name</strong>: A description of the task.</li>
<li><strong>yum</strong>: The module used (in this case, the <code>yum</code> module for package management).</li>
<li><strong>name</strong>: The package to be managed.</li>
<li><strong>state</strong>: The desired state of the package (<code>present</code> or <code>absent</code>).</li>
</ul>
</div><h1><ol start="4">
<li>Handlers</li>
</ol>
</h1>
<div class='content'><p>Handlers are tasks that are triggered by other tasks using the <code>notify</code> directive. They are typically used for actions like restarting services.</p>
</div><h2><p>Example:</p>
</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("dGFza3M6CiAgLSBuYW1lOiBFbnN1cmUgQXBhY2hlIGlzIGluc3RhbGxlZAogICAgeXVtOgogICAgICBuYW1lOiBodHRwZAogICAgICBzdGF0ZTogcHJlc2VudAogICAgbm90aWZ5OiBSZXN0YXJ0IEFwYWNoZQoKaGFuZGxlcnM6CiAgLSBuYW1lOiBSZXN0YXJ0IEFwYWNoZQogICAgc2VydmljZToKICAgICAgbmFtZTogaHR0cGQKICAgICAgc3RhdGU6IHJlc3RhcnRlZA=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>tasks:
  - name: Ensure Apache is installed
    yum:
      name: httpd
      state: present
    notify: Restart Apache

handlers:
  - name: Restart Apache
    service:
      name: httpd
      state: restarted</pre></div><div class='content'></div><h2><p>Explanation:</p>
</h2>
<div class='content'><ul>
<li><strong>notify</strong>: Specifies the handler to be triggered.</li>
<li><strong>handlers</strong>: Defines the handler tasks.</li>
</ul>
</div><h1><ol start="5">
<li>Variables</li>
</ol>
</h1>
<div class='content'><p>Variables allow you to store values that can be reused throughout the playbook.</p>
</div><h2><p>Example:</p>
</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("dmFyczoKICBodHRwX3BvcnQ6IDgwCgp0YXNrczoKICAtIG5hbWU6IEVuc3VyZSBBcGFjaGUgaXMgbGlzdGVuaW5nIG9uIHBvcnQgODAKICAgIGxpbmVpbmZpbGU6CiAgICAgIHBhdGg6IC9ldGMvaHR0cGQvY29uZi9odHRwZC5jb25mCiAgICAgIHJlZ2V4cDogJ15MaXN0ZW4nCiAgICAgIGxpbmU6ICJMaXN0ZW4ge3sgaHR0cF9wb3J0IH19Ig=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>vars:
  http_port: 80

tasks:
  - name: Ensure Apache is listening on port 80
    lineinfile:
      path: /etc/httpd/conf/httpd.conf
      regexp: '^Listen'
      line: &quot;Listen {{ http_port }}&quot;</pre></div><div class='content'></div><h2><p>Explanation:</p>
</h2>
<div class='content'><ul>
<li><strong>vars</strong>: Defines variables.</li>
<li><strong>{{ variable_name }}</strong>: Syntax to use the variable.</li>
</ul>
</div><h1><ol start="6">
<li>Includes and Imports</li>
</ol>
</h1>
<div class='content'><p>Includes and imports allow you to break down your playbook into smaller, reusable files.</p>
</div><h2><p>Example:</p>
</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("LSBuYW1lOiBJbmNsdWRlIHRhc2tzIGZyb20gYW5vdGhlciBmaWxlCiAgaW1wb3J0X3Rhc2tzOiB0YXNrcy55bWw="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>- name: Include tasks from another file
  import_tasks: tasks.yml</pre></div><div class='content'></div><h2><p>Explanation:</p>
</h2>
<div class='content'><ul>
<li><strong>import_tasks</strong>: Imports tasks from another file.</li>
</ul>
</div><h1><p>Practical Exercise</p>
</h1>
<div class='content'></div><h2><p>Task:</p>
</h2>
<div class='content'><p>Create a playbook that installs Nginx on a group of web servers, ensures the service is running, and sets up a basic HTML file.</p>
</div><h2><p>Solution:</p>
</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("LSBuYW1lOiBJbnN0YWxsIGFuZCBjb25maWd1cmUgTmdpbngKICBob3N0czogd2Vic2VydmVycwogIGJlY29tZTogeWVzCiAgdmFyczoKICAgIG5naW54X3BhY2thZ2U6IG5naW54CiAgICBuZ2lueF9zZXJ2aWNlOiBuZ2lueAogICAgaW5kZXhfZmlsZTogL3Vzci9zaGFyZS9uZ2lueC9odG1sL2luZGV4Lmh0bWwKICAgIGluZGV4X2NvbnRlbnQ6ICI8aHRtbD48Ym9keT48aDE+V2VsY29tZSB0byBOZ2lueCE8L2gxPjwvYm9keT48L2h0bWw+IgoKICB0YXNrczoKICAgIC0gbmFtZTogSW5zdGFsbCBOZ2lueAogICAgICB5dW06CiAgICAgICAgbmFtZTogInt7IG5naW54X3BhY2thZ2UgfX0iCiAgICAgICAgc3RhdGU6IHByZXNlbnQKCiAgICAtIG5hbWU6IEVuc3VyZSBOZ2lueCBpcyBydW5uaW5nCiAgICAgIHNlcnZpY2U6CiAgICAgICAgbmFtZTogInt7IG5naW54X3NlcnZpY2UgfX0iCiAgICAgICAgc3RhdGU6IHN0YXJ0ZWQKICAgICAgICBlbmFibGVkOiB5ZXMKCiAgICAtIG5hbWU6IENyZWF0ZSBpbmRleC5odG1sCiAgICAgIGNvcHk6CiAgICAgICAgY29udGVudDogInt7IGluZGV4X2NvbnRlbnQgfX0iCiAgICAgICAgZGVzdDogInt7IGluZGV4X2ZpbGUgfX0iCgogIGhhbmRsZXJzOgogICAgLSBuYW1lOiBSZXN0YXJ0IE5naW54CiAgICAgIHNlcnZpY2U6CiAgICAgICAgbmFtZTogInt7IG5naW54X3NlcnZpY2UgfX0iCiAgICAgICAgc3RhdGU6IHJlc3RhcnRlZA=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>- name: Install and configure Nginx
  hosts: webservers
  become: yes
  vars:
    nginx_package: nginx
    nginx_service: nginx
    index_file: /usr/share/nginx/html/index.html
    index_content: &quot;&lt;html&gt;&lt;body&gt;&lt;h1&gt;Welcome to Nginx!&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;&quot;

  tasks:
    - name: Install Nginx
      yum:
        name: &quot;{{ nginx_package }}&quot;
        state: present

    - name: Ensure Nginx is running
      service:
        name: &quot;{{ nginx_service }}&quot;
        state: started
        enabled: yes

    - name: Create index.html
      copy:
        content: &quot;{{ index_content }}&quot;
        dest: &quot;{{ index_file }}&quot;

  handlers:
    - name: Restart Nginx
      service:
        name: &quot;{{ nginx_service }}&quot;
        state: restarted</pre></div><div class='content'></div><h2><p>Explanation:</p>
</h2>
<div class='content'><ul>
<li><strong>vars</strong>: Defines variables for package name, service name, file path, and content.</li>
<li><strong>tasks</strong>: Installs Nginx, ensures it is running, and creates an index.html file.</li>
<li><strong>handlers</strong>: Defines a handler to restart Nginx if needed.</li>
</ul>
</div><h1><p>Conclusion</p>
</h1>
<div class='content'><p>Understanding the structure of an Ansible playbook is fundamental to writing effective automation scripts. By mastering the components such as tasks, handlers, variables, and includes, you can create modular, reusable, and maintainable playbooks. In the next section, we will explore variables and facts in more detail, which will further enhance your playbook writing skills.</p>
</div><div class='row navigation'>
	<div class='col-2'>
					<a href='03-02-writing-your-first-playbook' title="Writing Your First Playbook">&#x25C4;Previous</a>
			</div>
	<div class='col-8 text-center'>
			</div>
	<div class='col-2 text-end'>
					<a href='03-04-variables-and-facts' title="Variables and Facts">Next &#x25BA;</a>
			</div>
</div>

			</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Advertising</h1>
			<p>This space is reserved for advertising.</p>
			<p>If you want to be a sponsor, contact us to include links in this area: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Thank you for collaborating!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. All rights reserved</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	We use cookies to improve your user experience and offer content tailored to your interests.
    <a href="#" id="btn_accept_cookies" class="button">Accept</a>
    <a href="/cookies">More Information</a>
</div>	

	</div>    
</body>
</html>
