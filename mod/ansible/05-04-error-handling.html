<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Error Handling</title>

    <link rel="alternate" href="https://campusempresa.com/mod/ansible/05-04-error-handling" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/mod/ansible/05-04-error-handling" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/mod/ansible/05-04-error-handling" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="/js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body >
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-12 col-md-8 p-2 p-md-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo-header_enterprise.png"></a>
			</h1>
		</div>
		<div class="col-12 col-md-4 p-2 p-md-0 text-end">
			<h2 id="main_title"><cite>Building today's and tomorrow's society</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-2 p-md-0 m-0 text-end">
													<b id="lit_lang_es" class="px-2">EN</b>
				|
				<a href="https://campusempresa.com/mod/ansible/05-04-error-handling" class="px-2">ES</a></b>
				|
				<a href="https://campusempresa.cat/mod/ansible/05-04-error-handling" class="px-2">CA</a>
					</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="/objective">The Project</a>
				<a href="/about">About Us</a>
				<a href="/contribute">Contribute</a>
				<a href="/donate">Donations</a>
				<a href="/licence">License</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content">
								<div class='row navigation'>
	<div class='col-2'>
					<a href='05-03-ansible-vault' title="Ansible Vault">&#x25C4;Previous</a>
			</div>
	<div class='col-8 text-center'>
					<a href="./"><h2 style="text-decoration:underline">Error Handling</h2></a>
			</div>
	<div class='col-2 text-end'>
					<a href='05-05-optimizing-playbooks' title="Optimizing Playbooks">Next &#x25BA;</a>
			</div>
</div>
<div class='content'><p>Error handling is a crucial aspect of writing robust and reliable Ansible playbooks. In this section, we will cover various techniques and best practices for managing errors in Ansible. By the end of this module, you will be able to handle errors gracefully and ensure your playbooks can recover from unexpected issues.</p>
</div><h1><p>Key Concepts</p>
</h1>
<div class='content'><ol>
<li>
<p><strong>Error Handling Strategies</strong>:</p>
<ul>
<li><strong>Fail Fast</strong>: Stop execution immediately when an error occurs.</li>
<li><strong>Ignore Errors</strong>: Continue execution even if an error occurs.</li>
<li><strong>Retry Mechanism</strong>: Retry a task if it fails.</li>
<li><strong>Rescue and Always Blocks</strong>: Execute specific tasks when an error occurs or always execute certain tasks regardless of success or failure.</li>
</ul>
</li>
<li>
<p><strong>Common Error Handling Techniques</strong>:</p>
<ul>
<li><strong><code>ignore_errors</code></strong>: Ignore errors for specific tasks.</li>
<li><strong><code>failed_when</code></strong>: Define custom failure conditions.</li>
<li><strong><code>rescue</code> and <code>always</code></strong>: Handle errors and ensure cleanup tasks are executed.</li>
</ul>
</li>
</ol>
</div><h1><p>Practical Examples</p>
</h1>
<div class='content'></div><h2><ol>
<li>Fail Fast</li>
</ol>
</h2>
<div class='content'><p>By default, Ansible stops executing the playbook when a task fails. This is known as the &quot;fail fast&quot; strategy.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("LS0tCi0gbmFtZTogRmFpbCBGYXN0IEV4YW1wbGUKICBob3N0czogbG9jYWxob3N0CiAgdGFza3M6CiAgICAtIG5hbWU6IFRoaXMgdGFzayB3aWxsIGZhaWwKICAgICAgY29tbWFuZDogL2Jpbi9mYWxzZQ=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>---
- name: Fail Fast Example
  hosts: localhost
  tasks:
    - name: This task will fail
      command: /bin/false</pre></div><div class='content'></div><h2><ol start="2">
<li>Ignore Errors</li>
</ol>
</h2>
<div class='content'><p>You can use the <code>ignore_errors</code> directive to continue execution even if a task fails.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("LS0tCi0gbmFtZTogSWdub3JlIEVycm9ycyBFeGFtcGxlCiAgaG9zdHM6IGxvY2FsaG9zdAogIHRhc2tzOgogICAgLSBuYW1lOiBUaGlzIHRhc2sgd2lsbCBmYWlsIGJ1dCBiZSBpZ25vcmVkCiAgICAgIGNvbW1hbmQ6IC9iaW4vZmFsc2UKICAgICAgaWdub3JlX2Vycm9yczogeWVzCgogICAgLSBuYW1lOiBUaGlzIHRhc2sgd2lsbCBydW4gZXZlbiBpZiB0aGUgcHJldmlvdXMgdGFzayBmYWlscwogICAgICBjb21tYW5kOiAvYmluL3RydWU="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>---
- name: Ignore Errors Example
  hosts: localhost
  tasks:
    - name: This task will fail but be ignored
      command: /bin/false
      ignore_errors: yes

    - name: This task will run even if the previous task fails
      command: /bin/true</pre></div><div class='content'></div><h2><ol start="3">
<li>Retry Mechanism</li>
</ol>
</h2>
<div class='content'><p>Use the <code>retries</code> and <code>delay</code> directives to retry a task if it fails.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("LS0tCi0gbmFtZTogUmV0cnkgTWVjaGFuaXNtIEV4YW1wbGUKICBob3N0czogbG9jYWxob3N0CiAgdGFza3M6CiAgICAtIG5hbWU6IFRoaXMgdGFzayB3aWxsIGJlIHJldHJpZWQgdXAgdG8gMyB0aW1lcwogICAgICBjb21tYW5kOiAvYmluL2ZhbHNlCiAgICAgIHJlZ2lzdGVyOiByZXN1bHQKICAgICAgdW50aWw6IHJlc3VsdC5yYyA9PSAwCiAgICAgIHJldHJpZXM6IDMKICAgICAgZGVsYXk6IDU="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>---
- name: Retry Mechanism Example
  hosts: localhost
  tasks:
    - name: This task will be retried up to 3 times
      command: /bin/false
      register: result
      until: result.rc == 0
      retries: 3
      delay: 5</pre></div><div class='content'></div><h2><ol start="4">
<li>Custom Failure Conditions</li>
</ol>
</h2>
<div class='content'><p>Use the <code>failed_when</code> directive to define custom conditions for task failure.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("LS0tCi0gbmFtZTogQ3VzdG9tIEZhaWx1cmUgQ29uZGl0aW9ucyBFeGFtcGxlCiAgaG9zdHM6IGxvY2FsaG9zdAogIHRhc2tzOgogICAgLSBuYW1lOiBUaGlzIHRhc2sgd2lsbCBmYWlsIGlmIHRoZSBvdXRwdXQgZG9lcyBub3QgY29udGFpbiAnc3VjY2VzcycKICAgICAgY29tbWFuZDogL2Jpbi9lY2hvICJmYWlsdXJlIgogICAgICByZWdpc3RlcjogcmVzdWx0CiAgICAgIGZhaWxlZF93aGVuOiAiJ3N1Y2Nlc3MnIG5vdCBpbiByZXN1bHQuc3Rkb3V0Ig=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>---
- name: Custom Failure Conditions Example
  hosts: localhost
  tasks:
    - name: This task will fail if the output does not contain 'success'
      command: /bin/echo &quot;failure&quot;
      register: result
      failed_when: &quot;'success' not in result.stdout&quot;</pre></div><div class='content'></div><h2><ol start="5">
<li>Rescue and Always Blocks</li>
</ol>
</h2>
<div class='content'><p>Use <code>rescue</code> to handle errors and <code>always</code> to ensure certain tasks are always executed.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("LS0tCi0gbmFtZTogUmVzY3VlIGFuZCBBbHdheXMgQmxvY2tzIEV4YW1wbGUKICBob3N0czogbG9jYWxob3N0CiAgdGFza3M6CiAgICAtIG5hbWU6IFRoaXMgdGFzayB3aWxsIGZhaWwKICAgICAgY29tbWFuZDogL2Jpbi9mYWxzZQogICAgICByZWdpc3RlcjogcmVzdWx0CiAgICAgIGlnbm9yZV9lcnJvcnM6IHllcwoKICAgIC0gbmFtZTogVGhpcyB0YXNrIHdpbGwgcnVuIGlmIHRoZSBwcmV2aW91cyB0YXNrIGZhaWxzCiAgICAgIGRlYnVnOgogICAgICAgIG1zZzogIlRhc2sgZmFpbGVkLCBydW5uaW5nIHJlc2N1ZSBibG9jayIKICAgICAgd2hlbjogcmVzdWx0IGlzIGZhaWxlZAoKICAgIC0gbmFtZTogVGhpcyB0YXNrIHdpbGwgYWx3YXlzIHJ1bgogICAgICBkZWJ1ZzoKICAgICAgICBtc2c6ICJUaGlzIHRhc2sgYWx3YXlzIHJ1bnMiCiAgICAgIGFsd2F5czogeWVz"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>---
- name: Rescue and Always Blocks Example
  hosts: localhost
  tasks:
    - name: This task will fail
      command: /bin/false
      register: result
      ignore_errors: yes

    - name: This task will run if the previous task fails
      debug:
        msg: &quot;Task failed, running rescue block&quot;
      when: result is failed

    - name: This task will always run
      debug:
        msg: &quot;This task always runs&quot;
      always: yes</pre></div><div class='content'></div><h1><p>Practical Exercises</p>
</h1>
<div class='content'></div><h2><p>Exercise 1: Ignore Errors</p>
</h2>
<div class='content'><p><strong>Task</strong>: Write a playbook that attempts to create a directory that already exists and ignores the error.</p>
<p><strong>Solution</strong>:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("LS0tCi0gbmFtZTogSWdub3JlIEVycm9ycyBFeGVyY2lzZQogIGhvc3RzOiBsb2NhbGhvc3QKICB0YXNrczoKICAgIC0gbmFtZTogQXR0ZW1wdCB0byBjcmVhdGUgYW4gZXhpc3RpbmcgZGlyZWN0b3J5CiAgICAgIGZpbGU6CiAgICAgICAgcGF0aDogL3RtcAogICAgICAgIHN0YXRlOiBkaXJlY3RvcnkKICAgICAgaWdub3JlX2Vycm9yczogeWVzCgogICAgLSBuYW1lOiBUaGlzIHRhc2sgc2hvdWxkIHJ1biBldmVuIGlmIHRoZSBwcmV2aW91cyB0YXNrIGZhaWxzCiAgICAgIGRlYnVnOgogICAgICAgIG1zZzogIlByZXZpb3VzIHRhc2sgd2FzIGlnbm9yZWQi"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>---
- name: Ignore Errors Exercise
  hosts: localhost
  tasks:
    - name: Attempt to create an existing directory
      file:
        path: /tmp
        state: directory
      ignore_errors: yes

    - name: This task should run even if the previous task fails
      debug:
        msg: &quot;Previous task was ignored&quot;</pre></div><div class='content'></div><h2><p>Exercise 2: Custom Failure Conditions</p>
</h2>
<div class='content'><p><strong>Task</strong>: Write a playbook that runs a command and fails if the output does not contain the word &quot;success&quot;.</p>
<p><strong>Solution</strong>:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("LS0tCi0gbmFtZTogQ3VzdG9tIEZhaWx1cmUgQ29uZGl0aW9ucyBFeGVyY2lzZQogIGhvc3RzOiBsb2NhbGhvc3QKICB0YXNrczoKICAgIC0gbmFtZTogUnVuIGEgY29tbWFuZCBhbmQgY2hlY2sgZm9yICdzdWNjZXNzJwogICAgICBjb21tYW5kOiAvYmluL2VjaG8gImZhaWx1cmUiCiAgICAgIHJlZ2lzdGVyOiByZXN1bHQKICAgICAgZmFpbGVkX3doZW46ICInc3VjY2Vzcycgbm90IGluIHJlc3VsdC5zdGRvdXQi"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>---
- name: Custom Failure Conditions Exercise
  hosts: localhost
  tasks:
    - name: Run a command and check for 'success'
      command: /bin/echo &quot;failure&quot;
      register: result
      failed_when: &quot;'success' not in result.stdout&quot;</pre></div><div class='content'></div><h2><p>Exercise 3: Rescue and Always Blocks</p>
</h2>
<div class='content'><p><strong>Task</strong>: Write a playbook that attempts to run a command that fails, handles the error with a rescue block, and ensures a cleanup task always runs.</p>
<p><strong>Solution</strong>:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("LS0tCi0gbmFtZTogUmVzY3VlIGFuZCBBbHdheXMgQmxvY2tzIEV4ZXJjaXNlCiAgaG9zdHM6IGxvY2FsaG9zdAogIHRhc2tzOgogICAgLSBuYW1lOiBUaGlzIHRhc2sgd2lsbCBmYWlsCiAgICAgIGNvbW1hbmQ6IC9iaW4vZmFsc2UKICAgICAgcmVnaXN0ZXI6IHJlc3VsdAogICAgICBpZ25vcmVfZXJyb3JzOiB5ZXMKCiAgICAtIG5hbWU6IEhhbmRsZSB0aGUgZXJyb3IKICAgICAgZGVidWc6CiAgICAgICAgbXNnOiAiSGFuZGxpbmcgZXJyb3IgaW4gcmVzY3VlIGJsb2NrIgogICAgICB3aGVuOiByZXN1bHQgaXMgZmFpbGVkCgogICAgLSBuYW1lOiBDbGVhbnVwIHRhc2sKICAgICAgZGVidWc6CiAgICAgICAgbXNnOiAiVGhpcyB0YXNrIGFsd2F5cyBydW5zIgogICAgICBhbHdheXM6IHllcw=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>---
- name: Rescue and Always Blocks Exercise
  hosts: localhost
  tasks:
    - name: This task will fail
      command: /bin/false
      register: result
      ignore_errors: yes

    - name: Handle the error
      debug:
        msg: &quot;Handling error in rescue block&quot;
      when: result is failed

    - name: Cleanup task
      debug:
        msg: &quot;This task always runs&quot;
      always: yes</pre></div><div class='content'></div><h1><p>Common Mistakes and Tips</p>
</h1>
<div class='content'><ul>
<li><strong>Ignoring Errors Unintentionally</strong>: Be cautious when using <code>ignore_errors</code>. It can mask underlying issues that need attention.</li>
<li><strong>Overusing Retries</strong>: Avoid excessive retries, as they can lead to longer execution times and may not resolve the underlying issue.</li>
<li><strong>Not Using Rescue and Always Blocks</strong>: These blocks are powerful tools for error handling and cleanup. Use them to ensure your playbooks are robust.</li>
</ul>
</div><h1><p>Conclusion</p>
</h1>
<div class='content'><p>In this section, we covered various error handling techniques in Ansible, including ignoring errors, custom failure conditions, retries, and using rescue and always blocks. By mastering these techniques, you can write more resilient and reliable playbooks. In the next module, we will explore optimizing playbooks to improve performance and efficiency.</p>
</div><div class='row navigation'>
	<div class='col-2'>
					<a href='05-03-ansible-vault' title="Ansible Vault">&#x25C4;Previous</a>
			</div>
	<div class='col-8 text-center'>
			</div>
	<div class='col-2 text-end'>
					<a href='05-05-optimizing-playbooks' title="Optimizing Playbooks">Next &#x25BA;</a>
			</div>
</div>

			</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Advertising</h1>
			<p>This space is reserved for advertising.</p>
			<p>If you want to be a sponsor, contact us to include links in this area: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Thank you for collaborating!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. All rights reserved</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir galetes per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Accept</a>
    <a href="/cookies">More Information</a>
</div>	

	</div>    
</body>
</html>
