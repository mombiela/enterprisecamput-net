<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Testing Ansible Code</title>

    <link rel="alternate" href="https://campusempresa.com/mod/ansible/09-04-testing-ansible-code" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/mod/ansible/09-04-testing-ansible-code" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/mod/ansible/09-04-testing-ansible-code" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="/js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body >
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-12 col-md-8 p-2 p-md-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo-header_enterprise.png"></a>
			</h1>
		</div>
		<div class="col-12 col-md-4 p-2 p-md-0 text-end">
			<h2 id="main_title"><cite>Building today's and tomorrow's society</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-2 p-md-0 m-0 text-end">
													<b id="lit_lang_es" class="px-2">EN</b>
				|
				<a href="https://campusempresa.com/mod/ansible/09-04-testing-ansible-code" class="px-2">ES</a></b>
				|
				<a href="https://campusempresa.cat/mod/ansible/09-04-testing-ansible-code" class="px-2">CA</a>
					</div>
	</div>
</div>

<div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<!-- <a href="/">Home</a>  -->
									<a href="./">Course Content</a>
					<span class="sep">|</span>
								<a href="/all/competencias">Technical Skills</a>
				<a href="/all/conocimientos">Knowledge</a>
				<a href="/all/soft_skills">Social Skills</a>
			</div>
		</div>
	</div>
</div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content">
								<div class='row navigation'>
	<div class='col-1 col-md-2'>
					<a href='09-03-performance-tuning' title="Performance Tuning">
				<span class="d-none d-md-inline">&#x25C4; Previous</span>
				<span class="d-inline d-md-none"><i class="bi bi-caret-left-square-fill"></i></span>
			</a>
			</div>
	<div class='col-10 col-md-8 text-center'>
					<a href="./"><h2 style="text-decoration:underline">Testing Ansible Code</h2></a>
			</div>
	<div class='col-1 col-md-2 text-end'>
					<a href='10-01-custom-modules' title="Custom Modules">
				<span class="d-none d-md-inline">Next &#x25BA;</span>
				<span class="d-inline d-md-none"><i class="bi bi-caret-right-square-fill"></i></span>
			</a>
			</div>
</div>
<div class='content'><p>Testing your Ansible code is crucial to ensure that your automation scripts work as expected and do not introduce errors into your infrastructure. This section will cover various methods and tools for testing Ansible code, including syntax checking, linting, unit testing, and integration testing.</p>
</div><h1><ol>
<li>Syntax Checking</li>
</ol>
</h1>
<div class='content'><p>Before running your playbooks, it's essential to check for syntax errors. Ansible provides a built-in command for this purpose.</p>
</div><h2><p>Syntax Check Command</p>
</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("YW5zaWJsZS1wbGF5Ym9vayAtLXN5bnRheC1jaGVjayB5b3VyX3BsYXlib29rLnltbA=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>ansible-playbook --syntax-check your_playbook.yml</pre></div><div class='content'></div><h2><p>Example</p>
</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("YW5zaWJsZS1wbGF5Ym9vayAtLXN5bnRheC1jaGVjayBzaXRlLnltbA=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>ansible-playbook --syntax-check site.yml</pre></div><div class='content'><p>This command will parse the playbook and report any syntax errors without executing it.</p>
</div><h1><ol start="2">
<li>Linting</li>
</ol>
</h1>
<div class='content'><p>Linting helps to ensure that your Ansible code adheres to best practices and coding standards. <code>ansible-lint</code> is a popular tool for this purpose.</p>
</div><h2><p>Installing <code>ansible-lint</code></p>
</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("cGlwIGluc3RhbGwgYW5zaWJsZS1saW50"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>pip install ansible-lint</pre></div><div class='content'></div><h2><p>Running <code>ansible-lint</code></p>
</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("YW5zaWJsZS1saW50IHlvdXJfcGxheWJvb2sueW1s"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>ansible-lint your_playbook.yml</pre></div><div class='content'></div><h2><p>Example</p>
</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("YW5zaWJsZS1saW50IHNpdGUueW1s"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>ansible-lint site.yml</pre></div><div class='content'><p>This command will analyze your playbook and provide feedback on potential issues and improvements.</p>
</div><h1><ol start="3">
<li>Unit Testing with Molecule</li>
</ol>
</h1>
<div class='content'><p>Molecule is a testing framework designed to aid in the development and testing of Ansible roles. It allows you to test your roles in various environments.</p>
</div><h2><p>Installing Molecule</p>
</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("cGlwIGluc3RhbGwgbW9sZWN1bGVbZG9ja2VyXQ=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>pip install molecule[docker]</pre></div><div class='content'></div><h2><p>Initializing a Molecule Scenario</p>
</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("bW9sZWN1bGUgaW5pdCBzY2VuYXJpbyAtLXNjZW5hcmlvLW5hbWUgZGVmYXVsdCAtciB5b3VyX3JvbGU="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>molecule init scenario --scenario-name default -r your_role</pre></div><div class='content'></div><h2><p>Running Molecule Tests</p>
</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("bW9sZWN1bGUgdGVzdA=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>molecule test</pre></div><div class='content'></div><h2><p>Example</p>
</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("bW9sZWN1bGUgaW5pdCBzY2VuYXJpbyAtLXNjZW5hcmlvLW5hbWUgZGVmYXVsdCAtciBteV9yb2xlCm1vbGVjdWxlIHRlc3Q="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>molecule init scenario --scenario-name default -r my_role
molecule test</pre></div><div class='content'><p>This will create a default testing scenario for your role and run the tests.</p>
</div><h1><ol start="4">
<li>Integration Testing</li>
</ol>
</h1>
<div class='content'><p>Integration testing ensures that your playbooks work correctly in a real environment. You can use tools like Vagrant or Docker to create test environments.</p>
</div><h2><p>Using Vagrant</p>
</h2>
<div class='content'><ol>
<li><strong>Install Vagrant</strong>: Follow the installation instructions from the <a href="https://www.vagrantup.com/">Vagrant website</a>.</li>
<li><strong>Create a Vagrantfile</strong>: Define your test environment.</li>
</ol>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("VmFncmFudC5jb25maWd1cmUoIjIiKSBkbyB8Y29uZmlnfAogIGNvbmZpZy52bS5ib3ggPSAidWJ1bnR1L2Jpb25pYzY0IgogIGNvbmZpZy52bS5wcm92aXNpb24gImFuc2libGUiIGRvIHxhbnNpYmxlfAogICAgYW5zaWJsZS5wbGF5Ym9vayA9ICJzaXRlLnltbCIKICBlbmQKZW5k"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>Vagrant.configure(&quot;2&quot;) do |config|
  config.vm.box = &quot;ubuntu/bionic64&quot;
  config.vm.provision &quot;ansible&quot; do |ansible|
    ansible.playbook = &quot;site.yml&quot;
  end
end</pre></div><div class='content'><ol start="3">
<li><strong>Run Vagrant</strong>:</li>
</ol>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("dmFncmFudCB1cA=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>vagrant up</pre></div><div class='content'></div><h2><p>Using Docker</p>
</h2>
<div class='content'><ol>
<li><strong>Install Docker</strong>: Follow the installation instructions from the <a href="https://www.docker.com/">Docker website</a>.</li>
<li><strong>Create a Dockerfile</strong>: Define your test environment.</li>
</ol>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("RlJPTSB1YnVudHU6MTguMDQKUlVOIGFwdC1nZXQgdXBkYXRlICYmIGFwdC1nZXQgaW5zdGFsbCAteSBhbnNpYmxlCkNPUFkgLiAvYW5zaWJsZQpXT1JLRElSIC9hbnNpYmxlCkNNRCBbImFuc2libGUtcGxheWJvb2siLCAic2l0ZS55bWwiXQ=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>FROM ubuntu:18.04
RUN apt-get update &amp;&amp; apt-get install -y ansible
COPY . /ansible
WORKDIR /ansible
CMD [&quot;ansible-playbook&quot;, &quot;site.yml&quot;]</pre></div><div class='content'><ol start="3">
<li><strong>Build and Run Docker Container</strong>:</li>
</ol>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ZG9ja2VyIGJ1aWxkIC10IGFuc2libGUtdGVzdCAuCmRvY2tlciBydW4gLWl0IGFuc2libGUtdGVzdA=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>docker build -t ansible-test .
docker run -it ansible-test</pre></div><div class='content'></div><h1><ol start="5">
<li>Continuous Integration (CI)</li>
</ol>
</h1>
<div class='content'><p>Integrating Ansible tests into your CI pipeline ensures that your playbooks are tested automatically with every change. Popular CI tools include Jenkins, GitLab CI, and GitHub Actions.</p>
</div><h2><p>Example with GitHub Actions</p>
</h2>
<div class='content'><ol>
<li><strong>Create a <code>.github/workflows/ansible.yml</code> file</strong>:</li>
</ol>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("bmFtZTogQW5zaWJsZSBMaW50IGFuZCBUZXN0CgpvbjogW3B1c2gsIHB1bGxfcmVxdWVzdF0KCmpvYnM6CiAgbGludDoKICAgIHJ1bnMtb246IHVidW50dS1sYXRlc3QKICAgIHN0ZXBzOgogICAgICAtIHVzZXM6IGFjdGlvbnMvY2hlY2tvdXRAdjIKICAgICAgLSBuYW1lOiBTZXQgdXAgUHl0aG9uCiAgICAgICAgdXNlczogYWN0aW9ucy9zZXR1cC1weXRob25AdjIKICAgICAgICB3aXRoOgogICAgICAgICAgcHl0aG9uLXZlcnNpb246ICczLngnCiAgICAgIC0gbmFtZTogSW5zdGFsbCBkZXBlbmRlbmNpZXMKICAgICAgICBydW46IHwKICAgICAgICAgIHB5dGhvbiAtbSBwaXAgaW5zdGFsbCAtLXVwZ3JhZGUgcGlwCiAgICAgICAgICBwaXAgaW5zdGFsbCBhbnNpYmxlIGFuc2libGUtbGludCBtb2xlY3VsZVtkb2NrZXJdCiAgICAgIC0gbmFtZTogTGludCBBbnNpYmxlIHBsYXlib29rCiAgICAgICAgcnVuOiBhbnNpYmxlLWxpbnQgc2l0ZS55bWwKCiAgdGVzdDoKICAgIHJ1bnMtb246IHVidW50dS1sYXRlc3QKICAgIHN0ZXBzOgogICAgICAtIHVzZXM6IGFjdGlvbnMvY2hlY2tvdXRAdjIKICAgICAgLSBuYW1lOiBTZXQgdXAgUHl0aG9uCiAgICAgICAgdXNlczogYWN0aW9ucy9zZXR1cC1weXRob25AdjIKICAgICAgICB3aXRoOgogICAgICAgICAgcHl0aG9uLXZlcnNpb246ICczLngnCiAgICAgIC0gbmFtZTogSW5zdGFsbCBkZXBlbmRlbmNpZXMKICAgICAgICBydW46IHwKICAgICAgICAgIHB5dGhvbiAtbSBwaXAgaW5zdGFsbCAtLXVwZ3JhZGUgcGlwCiAgICAgICAgICBwaXAgaW5zdGFsbCBhbnNpYmxlIG1vbGVjdWxlW2RvY2tlcl0KICAgICAgLSBuYW1lOiBSdW4gTW9sZWN1bGUgdGVzdHMKICAgICAgICBydW46IG1vbGVjdWxlIHRlc3Q="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>name: Ansible Lint and Test

on: [push, pull_request]

jobs:
  lint:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Set up Python
        uses: actions/setup-python@v2
        with:
          python-version: '3.x'
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install ansible ansible-lint molecule[docker]
      - name: Lint Ansible playbook
        run: ansible-lint site.yml

  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Set up Python
        uses: actions/setup-python@v2
        with:
          python-version: '3.x'
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install ansible molecule[docker]
      - name: Run Molecule tests
        run: molecule test</pre></div><div class='content'><p>This workflow will lint and test your Ansible playbooks on every push and pull request.</p>
</div><h1><p>Conclusion</p>
</h1>
<div class='content'><p>Testing your Ansible code is a multi-step process that includes syntax checking, linting, unit testing, and integration testing. By incorporating these practices into your workflow, you can ensure that your automation scripts are reliable and maintainable. Integrating these tests into a CI pipeline further enhances the robustness of your infrastructure automation.</p>
</div><div class='row navigation'>
	<div class='col-1 col-md-2'>
					<a href='09-03-performance-tuning' title="Performance Tuning">
				<span class="d-none d-md-inline">&#x25C4; Previous</span>
				<span class="d-inline d-md-none"><i class="bi bi-caret-left-square-fill"></i></span>
			</a>
			</div>
	<div class='col-10 col-md-8 text-center'>
			</div>
	<div class='col-1 col-md-2 text-end'>
					<a href='10-01-custom-modules' title="Custom Modules">
				<span class="d-none d-md-inline">Next &#x25BA;</span>
				<span class="d-inline d-md-none"><i class="bi bi-caret-right-square-fill"></i></span>
			</a>
			</div>
</div>

			</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Advertising</h1>
			<p>This space is reserved for advertising.</p>
			<p>If you want to be a sponsor, contact us to include links in this area: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Thank you for collaborating!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. All rights reserved</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	We use cookies to improve your user experience and offer content tailored to your interests.
    <a href="#" id="btn_accept_cookies" class="button">Accept</a>
    <a href="/cookies">More Information</a>
</div>	

	</div>    
</body>
</html>
