<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mocking and Stubbing</title>

    <link rel="alternate" href="https://campusempresa.com/mod/groovy/06-02-mocking-stubbing" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/mod/groovy/06-02-mocking-stubbing" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/mod/groovy/06-02-mocking-stubbing" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="/js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body >
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-12 col-md-8 p-2 p-md-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo-header_enterprise.png"></a>
			</h1>
		</div>
		<div class="col-12 col-md-4 p-2 p-md-0 text-end">
			<h2 id="main_title"><cite>Building today's and tomorrow's society</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-2 p-md-0 m-0 text-end">
													<b id="lit_lang_es" class="px-2">EN</b>
				|
				<a href="https://campusempresa.com/mod/groovy/06-02-mocking-stubbing" class="px-2">ES</a></b>
				|
				<a href="https://campusempresa.cat/mod/groovy/06-02-mocking-stubbing" class="px-2">CA</a>
					</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="/objective">The Project</a>
				<a href="/about">About Us</a>
				<a href="/contribute">Contribute</a>
				<a href="/donate">Donations</a>
				<a href="/licence">License</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content">
								<div class='row navigation'>
	<div class='col-2'>
					<a href='06-01-unit-testing' title="Unit Testing with Groovy">&#x25C4;Previous</a>
			</div>
	<div class='col-8 text-center'>
					<a href="./"><h2 style="text-decoration:underline">Mocking and Stubbing</h2></a>
			</div>
	<div class='col-2 text-end'>
					<a href='06-03-debugging' title="Debugging Groovy Code">Next &#x25BA;</a>
			</div>
</div>
<div class='content'><p>In this section, we will explore the concepts of mocking and stubbing in Groovy, which are essential techniques for effective unit testing. Mocking and stubbing allow you to isolate the code under test by replacing dependencies with controlled, predictable substitutes.</p>
</div><h1><p>What are Mocking and Stubbing?</p>
</h1>
<div class='content'></div><h2><p>Mocking</p>
</h2>
<div class='content'><p>Mocking is the process of creating objects that simulate the behavior of real objects. These mock objects are used to test the interactions between the object under test and its dependencies.</p>
</div><h2><p>Stubbing</p>
</h2>
<div class='content'><p>Stubbing is the process of providing predefined responses to method calls made on mock objects. This allows you to control the behavior of dependencies and test how the object under test handles different scenarios.</p>
</div><h1><p>Why Use Mocking and Stubbing?</p>
</h1>
<div class='content'><ul>
<li><strong>Isolation</strong>: Isolate the unit of code under test from its dependencies.</li>
<li><strong>Control</strong>: Control the behavior of dependencies to test different scenarios.</li>
<li><strong>Speed</strong>: Speed up tests by avoiding slow or resource-intensive operations.</li>
<li><strong>Reliability</strong>: Ensure tests are reliable and not dependent on external systems.</li>
</ul>
</div><h1><p>Tools for Mocking and Stubbing in Groovy</p>
</h1>
<div class='content'><p>Groovy provides several libraries for mocking and stubbing, with Spock being one of the most popular testing frameworks that includes built-in support for these techniques.</p>
</div><h2><p>Spock Framework</p>
</h2>
<div class='content'><p>Spock is a testing and specification framework for Java and Groovy applications. It provides powerful mocking and stubbing capabilities.</p>
</div><h1><p>Using Spock for Mocking and Stubbing</p>
</h1>
<div class='content'></div><h2><p>Setting Up Spock</p>
</h2>
<div class='content'><p>To use Spock, you need to add the following dependencies to your <code>build.gradle</code> file:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ZGVwZW5kZW5jaWVzIHsKICAgIHRlc3RJbXBsZW1lbnRhdGlvbiAnb3JnLnNwb2NrZnJhbWV3b3JrOnNwb2NrLWNvcmU6Mi4wLWdyb292eS0zLjAnCiAgICB0ZXN0SW1wbGVtZW50YXRpb24gJ29yZy5jb2RlaGF1cy5ncm9vdnk6Z3Jvb3Z5LWFsbDozLjAuNycKfQ=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>dependencies {
    testImplementation 'org.spockframework:spock-core:2.0-groovy-3.0'
    testImplementation 'org.codehaus.groovy:groovy-all:3.0.7'
}</pre></div><div class='content'></div><h2><p>Basic Example</p>
</h2>
<div class='content'><p>Let's start with a simple example to demonstrate mocking and stubbing using Spock.</p>
<h4>Scenario</h4>
<p>We have a <code>UserService</code> class that depends on a <code>UserRepository</code> to fetch user data. We want to test the <code>getUserById</code> method of <code>UserService</code>.</p>
<h4>Code</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Ly8gVXNlclNlcnZpY2UuZ3Jvb3Z5CmNsYXNzIFVzZXJTZXJ2aWNlIHsKICAgIFVzZXJSZXBvc2l0b3J5IHVzZXJSZXBvc2l0b3J5CgogICAgVXNlciBnZXRVc2VyQnlJZChMb25nIGlkKSB7CiAgICAgICAgcmV0dXJuIHVzZXJSZXBvc2l0b3J5LmZpbmRCeUlkKGlkKQogICAgfQp9CgovLyBVc2VyUmVwb3NpdG9yeS5ncm9vdnkKaW50ZXJmYWNlIFVzZXJSZXBvc2l0b3J5IHsKICAgIFVzZXIgZmluZEJ5SWQoTG9uZyBpZCkKfQoKLy8gVXNlci5ncm9vdnkKY2xhc3MgVXNlciB7CiAgICBMb25nIGlkCiAgICBTdHJpbmcgbmFtZQp9"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>// UserService.groovy
class UserService {
    UserRepository userRepository

    User getUserById(Long id) {
        return userRepository.findById(id)
    }
}

// UserRepository.groovy
interface UserRepository {
    User findById(Long id)
}

// User.groovy
class User {
    Long id
    String name
}</pre></div><div class='content'><h4>Test</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Ly8gVXNlclNlcnZpY2VTcGVjLmdyb292eQppbXBvcnQgc3BvY2subGFuZy5TcGVjaWZpY2F0aW9uCgpjbGFzcyBVc2VyU2VydmljZVNwZWMgZXh0ZW5kcyBTcGVjaWZpY2F0aW9uIHsKCiAgICBkZWYgInRlc3QgZ2V0VXNlckJ5SWQiKCkgewogICAgICAgIGdpdmVuOgogICAgICAgIFVzZXJSZXBvc2l0b3J5IHVzZXJSZXBvc2l0b3J5ID0gTW9jaygpCiAgICAgICAgVXNlclNlcnZpY2UgdXNlclNlcnZpY2UgPSBuZXcgVXNlclNlcnZpY2UodXNlclJlcG9zaXRvcnk6IHVzZXJSZXBvc2l0b3J5KQogICAgICAgIFVzZXIgdXNlciA9IG5ldyBVc2VyKGlkOiAxTCwgbmFtZTogIkpvaG4gRG9lIikKCiAgICAgICAgd2hlbjoKICAgICAgICB1c2VyUmVwb3NpdG9yeS5maW5kQnlJZCgxTCkgPj4gdXNlcgogICAgICAgIFVzZXIgcmVzdWx0ID0gdXNlclNlcnZpY2UuZ2V0VXNlckJ5SWQoMUwpCgogICAgICAgIHRoZW46CiAgICAgICAgcmVzdWx0ID09IHVzZXIKICAgIH0KfQ=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>// UserServiceSpec.groovy
import spock.lang.Specification

class UserServiceSpec extends Specification {

    def &quot;test getUserById&quot;() {
        given:
        UserRepository userRepository = Mock()
        UserService userService = new UserService(userRepository: userRepository)
        User user = new User(id: 1L, name: &quot;John Doe&quot;)

        when:
        userRepository.findById(1L) &gt;&gt; user
        User result = userService.getUserById(1L)

        then:
        result == user
    }
}</pre></div><div class='content'></div><h2><p>Explanation</p>
</h2>
<div class='content'><ul>
<li><strong>Mock Creation</strong>: <code>UserRepository userRepository = Mock()</code> creates a mock object for <code>UserRepository</code>.</li>
<li><strong>Stubbing</strong>: <code>userRepository.findById(1L) &gt;&gt; user</code> stubs the <code>findById</code> method to return the <code>user</code> object when called with <code>1L</code>.</li>
<li><strong>Interaction</strong>: The <code>getUserById</code> method of <code>UserService</code> is called, and the result is verified to be the expected <code>user</code> object.</li>
</ul>
</div><h1><p>Practical Exercises</p>
</h1>
<div class='content'></div><h2><p>Exercise 1: Mocking a Service</p>
</h2>
<div class='content'><h4>Scenario</h4>
<p>You have a <code>PaymentService</code> that depends on a <code>PaymentGateway</code>. Write a test to verify that the <code>processPayment</code> method of <code>PaymentService</code> calls the <code>charge</code> method of <code>PaymentGateway</code>.</p>
<h4>Code</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Ly8gUGF5bWVudFNlcnZpY2UuZ3Jvb3Z5CmNsYXNzIFBheW1lbnRTZXJ2aWNlIHsKICAgIFBheW1lbnRHYXRld2F5IHBheW1lbnRHYXRld2F5CgogICAgYm9vbGVhbiBwcm9jZXNzUGF5bWVudChEb3VibGUgYW1vdW50KSB7CiAgICAgICAgcmV0dXJuIHBheW1lbnRHYXRld2F5LmNoYXJnZShhbW91bnQpCiAgICB9Cn0KCi8vIFBheW1lbnRHYXRld2F5Lmdyb292eQppbnRlcmZhY2UgUGF5bWVudEdhdGV3YXkgewogICAgYm9vbGVhbiBjaGFyZ2UoRG91YmxlIGFtb3VudCkKfQ=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>// PaymentService.groovy
class PaymentService {
    PaymentGateway paymentGateway

    boolean processPayment(Double amount) {
        return paymentGateway.charge(amount)
    }
}

// PaymentGateway.groovy
interface PaymentGateway {
    boolean charge(Double amount)
}</pre></div><div class='content'><h4>Test</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Ly8gUGF5bWVudFNlcnZpY2VTcGVjLmdyb292eQppbXBvcnQgc3BvY2subGFuZy5TcGVjaWZpY2F0aW9uCgpjbGFzcyBQYXltZW50U2VydmljZVNwZWMgZXh0ZW5kcyBTcGVjaWZpY2F0aW9uIHsKCiAgICBkZWYgInRlc3QgcHJvY2Vzc1BheW1lbnQiKCkgewogICAgICAgIGdpdmVuOgogICAgICAgIFBheW1lbnRHYXRld2F5IHBheW1lbnRHYXRld2F5ID0gTW9jaygpCiAgICAgICAgUGF5bWVudFNlcnZpY2UgcGF5bWVudFNlcnZpY2UgPSBuZXcgUGF5bWVudFNlcnZpY2UocGF5bWVudEdhdGV3YXk6IHBheW1lbnRHYXRld2F5KQoKICAgICAgICB3aGVuOgogICAgICAgIHBheW1lbnRTZXJ2aWNlLnByb2Nlc3NQYXltZW50KDEwMC4wKQoKICAgICAgICB0aGVuOgogICAgICAgIDEgKiBwYXltZW50R2F0ZXdheS5jaGFyZ2UoMTAwLjApCiAgICB9Cn0="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>// PaymentServiceSpec.groovy
import spock.lang.Specification

class PaymentServiceSpec extends Specification {

    def &quot;test processPayment&quot;() {
        given:
        PaymentGateway paymentGateway = Mock()
        PaymentService paymentService = new PaymentService(paymentGateway: paymentGateway)

        when:
        paymentService.processPayment(100.0)

        then:
        1 * paymentGateway.charge(100.0)
    }
}</pre></div><div class='content'></div><h2><p>Solution Explanation</p>
</h2>
<div class='content'><ul>
<li><strong>Mock Creation</strong>: <code>PaymentGateway paymentGateway = Mock()</code> creates a mock object for <code>PaymentGateway</code>.</li>
<li><strong>Interaction Verification</strong>: <code>1 * paymentGateway.charge(100.0)</code> verifies that the <code>charge</code> method is called exactly once with <code>100.0</code> as the argument.</li>
</ul>
</div><h2><p>Exercise 2: Stubbing a Repository</p>
</h2>
<div class='content'><h4>Scenario</h4>
<p>You have a <code>ProductService</code> that depends on a <code>ProductRepository</code>. Write a test to verify that the <code>getProductById</code> method of <code>ProductService</code> returns the correct product when the repository is stubbed.</p>
<h4>Code</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Ly8gUHJvZHVjdFNlcnZpY2UuZ3Jvb3Z5CmNsYXNzIFByb2R1Y3RTZXJ2aWNlIHsKICAgIFByb2R1Y3RSZXBvc2l0b3J5IHByb2R1Y3RSZXBvc2l0b3J5CgogICAgUHJvZHVjdCBnZXRQcm9kdWN0QnlJZChMb25nIGlkKSB7CiAgICAgICAgcmV0dXJuIHByb2R1Y3RSZXBvc2l0b3J5LmZpbmRCeUlkKGlkKQogICAgfQp9CgovLyBQcm9kdWN0UmVwb3NpdG9yeS5ncm9vdnkKaW50ZXJmYWNlIFByb2R1Y3RSZXBvc2l0b3J5IHsKICAgIFByb2R1Y3QgZmluZEJ5SWQoTG9uZyBpZCkKfQoKLy8gUHJvZHVjdC5ncm9vdnkKY2xhc3MgUHJvZHVjdCB7CiAgICBMb25nIGlkCiAgICBTdHJpbmcgbmFtZQp9"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>// ProductService.groovy
class ProductService {
    ProductRepository productRepository

    Product getProductById(Long id) {
        return productRepository.findById(id)
    }
}

// ProductRepository.groovy
interface ProductRepository {
    Product findById(Long id)
}

// Product.groovy
class Product {
    Long id
    String name
}</pre></div><div class='content'><h4>Test</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Ly8gUHJvZHVjdFNlcnZpY2VTcGVjLmdyb292eQppbXBvcnQgc3BvY2subGFuZy5TcGVjaWZpY2F0aW9uCgpjbGFzcyBQcm9kdWN0U2VydmljZVNwZWMgZXh0ZW5kcyBTcGVjaWZpY2F0aW9uIHsKCiAgICBkZWYgInRlc3QgZ2V0UHJvZHVjdEJ5SWQiKCkgewogICAgICAgIGdpdmVuOgogICAgICAgIFByb2R1Y3RSZXBvc2l0b3J5IHByb2R1Y3RSZXBvc2l0b3J5ID0gTW9jaygpCiAgICAgICAgUHJvZHVjdFNlcnZpY2UgcHJvZHVjdFNlcnZpY2UgPSBuZXcgUHJvZHVjdFNlcnZpY2UocHJvZHVjdFJlcG9zaXRvcnk6IHByb2R1Y3RSZXBvc2l0b3J5KQogICAgICAgIFByb2R1Y3QgcHJvZHVjdCA9IG5ldyBQcm9kdWN0KGlkOiAxTCwgbmFtZTogIkxhcHRvcCIpCgogICAgICAgIHdoZW46CiAgICAgICAgcHJvZHVjdFJlcG9zaXRvcnkuZmluZEJ5SWQoMUwpID4+IHByb2R1Y3QKICAgICAgICBQcm9kdWN0IHJlc3VsdCA9IHByb2R1Y3RTZXJ2aWNlLmdldFByb2R1Y3RCeUlkKDFMKQoKICAgICAgICB0aGVuOgogICAgICAgIHJlc3VsdCA9PSBwcm9kdWN0CiAgICB9Cn0="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>// ProductServiceSpec.groovy
import spock.lang.Specification

class ProductServiceSpec extends Specification {

    def &quot;test getProductById&quot;() {
        given:
        ProductRepository productRepository = Mock()
        ProductService productService = new ProductService(productRepository: productRepository)
        Product product = new Product(id: 1L, name: &quot;Laptop&quot;)

        when:
        productRepository.findById(1L) &gt;&gt; product
        Product result = productService.getProductById(1L)

        then:
        result == product
    }
}</pre></div><div class='content'></div><h2><p>Solution Explanation</p>
</h2>
<div class='content'><ul>
<li><strong>Mock Creation</strong>: <code>ProductRepository productRepository = Mock()</code> creates a mock object for <code>ProductRepository</code>.</li>
<li><strong>Stubbing</strong>: <code>productRepository.findById(1L) &gt;&gt; product</code> stubs the <code>findById</code> method to return the <code>product</code> object when called with <code>1L</code>.</li>
<li><strong>Interaction</strong>: The <code>getProductById</code> method of <code>ProductService</code> is called, and the result is verified to be the expected <code>product</code> object.</li>
</ul>
</div><h1><p>Common Mistakes and Tips</p>
</h1>
<div class='content'><ul>
<li><strong>Overusing Mocks</strong>: Avoid overusing mocks. Use them only when necessary to isolate the unit under test.</li>
<li><strong>Not Verifying Interactions</strong>: Always verify that the expected interactions with mocks occur.</li>
<li><strong>Complex Stubbing</strong>: Keep stubbing simple. Complex stubbing can make tests hard to understand and maintain.</li>
</ul>
</div><h1><p>Conclusion</p>
</h1>
<div class='content'><p>In this section, we covered the basics of mocking and stubbing in Groovy using the Spock framework. We learned how to create mock objects, stub methods, and verify interactions. These techniques are essential for writing effective unit tests that isolate the code under test from its dependencies. In the next section, we will explore debugging Groovy code to help you identify and fix issues in your applications.</p>
</div><div class='row navigation'>
	<div class='col-2'>
					<a href='06-01-unit-testing' title="Unit Testing with Groovy">&#x25C4;Previous</a>
			</div>
	<div class='col-8 text-center'>
			</div>
	<div class='col-2 text-end'>
					<a href='06-03-debugging' title="Debugging Groovy Code">Next &#x25BA;</a>
			</div>
</div>

			</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Advertising</h1>
			<p>This space is reserved for advertising.</p>
			<p>If you want to be a sponsor, contact us to include links in this area: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Thank you for collaborating!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. All rights reserved</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	We use cookies to improve your user experience and offer content tailored to your interests.
    <a href="#" id="btn_accept_cookies" class="button">Accept</a>
    <a href="/cookies">More Information</a>
</div>	

	</div>    
</body>
</html>
