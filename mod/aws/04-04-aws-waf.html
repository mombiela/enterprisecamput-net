<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AWS WAF</title>

    <link rel="alternate" href="https://campusempresa.com/mod/aws/04-04-aws-waf" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/mod/aws/04-04-aws-waf" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/mod/aws/04-04-aws-waf" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body >
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-8 p-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo-header_enterprise.png"></a>
			</h1>
		</div>
		<div class="col-4 p-0 text-end">
			<h2 id="main_title"><cite>Building today's and tomorrow's society</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-0 m-0 text-end">
													<b id="lit_lang_es" class="px-2">EN</b>
				|
				<a href="https://campusempresa.com/mod/aws/04-04-aws-waf" class="px-2">ES</a></b>
				|
				<a href="https://campusempresa.cat/mod/aws/04-04-aws-waf" class="px-2">CA</a>
					</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="/objective">The Project</a>
				<a href="/about">About Us</a>
				<a href="/contribute">Contribute</a>
				<a href="/donate">Donations</a>
				<a href="/licence">License</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content">
								<div class='row navigation'>
	<div class='col-2'>
					<a href='04-03-aws-shield' title="AWS Shield">&#x25C4;Previous</a>
			</div>
	<div class='col-8 text-center'>
					<a href="./"><h2 style="text-decoration:underline">AWS WAF</h2></a>
			</div>
	<div class='col-2 text-end'>
					<a href='05-01-cloudwatch' title="Amazon CloudWatch">Next &#x25BA;</a>
			</div>
</div>
<div class='content'></div><h1>Introduction to AWS WAF</h1>
<div class='content'><p>AWS WAF (Web Application Firewall) is a security service that helps protect your web applications from common web exploits that could affect application availability, compromise security, or consume excessive resources. AWS WAF gives you control over which traffic to allow or block to your web applications by defining customizable web security rules.</p>
</div><h2>Key Concepts</h2>
<div class='content'><ol>
<li>
<p><strong>Web ACLs (Web Access Control Lists):</strong></p>
<ul>
<li>A Web ACL is a set of rules that define the conditions under which web requests are allowed or blocked.</li>
<li>Each Web ACL can be associated with one or more AWS resources, such as Amazon CloudFront distributions, Application Load Balancers, or API Gateway stages.</li>
</ul>
</li>
<li>
<p><strong>Rules:</strong></p>
<ul>
<li>Rules are the building blocks of a Web ACL. They define the conditions that incoming web requests must meet to be allowed or blocked.</li>
<li>Rules can be based on IP addresses, HTTP headers, HTTP body, URI strings, SQL injection, cross-site scripting (XSS), and more.</li>
</ul>
</li>
<li>
<p><strong>Rule Groups:</strong></p>
<ul>
<li>Rule Groups are collections of rules that you can reuse across multiple Web ACLs.</li>
<li>AWS provides managed rule groups that are maintained and updated by AWS.</li>
</ul>
</li>
<li>
<p><strong>Conditions:</strong></p>
<ul>
<li>Conditions specify the criteria that web requests must meet to trigger a rule. Conditions can include IP match conditions, string match conditions, regex match conditions, and more.</li>
</ul>
</li>
</ol>
</div><h2>Setting Up AWS WAF</h2>
<div class='content'><h4>Step 1: Create a Web ACL</h4>
<ol>
<li>
<p><strong>Navigate to the AWS WAF Console:</strong></p>
<ul>
<li>Open the AWS Management Console and navigate to the AWS WAF service.</li>
</ul>
</li>
<li>
<p><strong>Create a Web ACL:</strong></p>
<ul>
<li>Click on &quot;Create web ACL.&quot;</li>
<li>Provide a name for your Web ACL and select the AWS resource to associate it with (e.g., CloudFront distribution, Application Load Balancer, or API Gateway).</li>
</ul>
</li>
<li>
<p><strong>Add Rules:</strong></p>
<ul>
<li>Add rules to your Web ACL by selecting from predefined rule groups or creating custom rules.</li>
<li>Define the conditions for each rule and specify whether to allow or block requests that match the conditions.</li>
</ul>
</li>
<li>
<p><strong>Review and Create:</strong></p>
<ul>
<li>Review your Web ACL configuration and click &quot;Create.&quot;</li>
</ul>
</li>
</ol>
<h4>Step 2: Associate the Web ACL with AWS Resources</h4>
<ol>
<li>
<p><strong>Select Resources:</strong></p>
<ul>
<li>In the Web ACL configuration, select the AWS resources (e.g., CloudFront distributions, Application Load Balancers) that you want to protect with the Web ACL.</li>
</ul>
</li>
<li>
<p><strong>Apply the Web ACL:</strong></p>
<ul>
<li>Apply the Web ACL to the selected resources.</li>
</ul>
</li>
</ol>
</div><h2>Practical Example</h2>
<div class='content'><p>Let's create a simple Web ACL that blocks requests from a specific IP address.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("aW1wb3J0IGJvdG8zCgojIEluaXRpYWxpemUgYSBzZXNzaW9uIHVzaW5nIEFtYXpvbiBXQUYKY2xpZW50ID0gYm90bzMuY2xpZW50KCd3YWYnKQoKIyBDcmVhdGUgYSBXZWIgQUNMCnJlc3BvbnNlID0gY2xpZW50LmNyZWF0ZV93ZWJfYWNsKAogICAgTmFtZT0nZXhhbXBsZS13ZWItYWNsJywKICAgIE1ldHJpY05hbWU9J2V4YW1wbGVXZWJBQ0wnLAogICAgRGVmYXVsdEFjdGlvbj17J1R5cGUnOiAnQUxMT1cnfSwKICAgIENoYW5nZVRva2VuPSdzdHJpbmcnLCAgIyBPYnRhaW4gdGhpcyBmcm9tIGdldF9jaGFuZ2VfdG9rZW4oKSBBUEkgY2FsbAogICAgVGFncz1bCiAgICAgICAgewogICAgICAgICAgICAnS2V5JzogJ05hbWUnLAogICAgICAgICAgICAnVmFsdWUnOiAnZXhhbXBsZS13ZWItYWNsJwogICAgICAgIH0sCiAgICBdCikKCndlYl9hY2xfaWQgPSByZXNwb25zZVsnV2ViQUNMJ11bJ1dlYkFDTElkJ10KCiMgQ3JlYXRlIGFuIElQIHNldApyZXNwb25zZSA9IGNsaWVudC5jcmVhdGVfaXBfc2V0KAogICAgTmFtZT0nZXhhbXBsZS1pcC1zZXQnLAogICAgQ2hhbmdlVG9rZW49J3N0cmluZycsICAjIE9idGFpbiB0aGlzIGZyb20gZ2V0X2NoYW5nZV90b2tlbigpIEFQSSBjYWxsCiAgICBUYWdzPVsKICAgICAgICB7CiAgICAgICAgICAgICdLZXknOiAnTmFtZScsCiAgICAgICAgICAgICdWYWx1ZSc6ICdleGFtcGxlLWlwLXNldCcKICAgICAgICB9LAogICAgXQopCgppcF9zZXRfaWQgPSByZXNwb25zZVsnSVBTZXQnXVsnSVBTZXRJZCddCgojIFVwZGF0ZSB0aGUgSVAgc2V0IHdpdGggdGhlIElQIGFkZHJlc3MgdG8gYmxvY2sKcmVzcG9uc2UgPSBjbGllbnQudXBkYXRlX2lwX3NldCgKICAgIElQU2V0SWQ9aXBfc2V0X2lkLAogICAgQ2hhbmdlVG9rZW49J3N0cmluZycsICAjIE9idGFpbiB0aGlzIGZyb20gZ2V0X2NoYW5nZV90b2tlbigpIEFQSSBjYWxsCiAgICBVcGRhdGVzPVsKICAgICAgICB7CiAgICAgICAgICAgICdBY3Rpb24nOiAnSU5TRVJUJywKICAgICAgICAgICAgJ0lQU2V0RGVzY3JpcHRvcic6IHsKICAgICAgICAgICAgICAgICdUeXBlJzogJ0lQVjQnLAogICAgICAgICAgICAgICAgJ1ZhbHVlJzogJzE5Mi4wLjIuNDQvMzInCiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgXQopCgojIENyZWF0ZSBhIHJ1bGUgdG8gYmxvY2sgdGhlIElQIGFkZHJlc3MKcmVzcG9uc2UgPSBjbGllbnQuY3JlYXRlX3J1bGUoCiAgICBOYW1lPSdibG9jay1pcC1ydWxlJywKICAgIE1ldHJpY05hbWU9J2Jsb2NrSVBSdWxlJywKICAgIENoYW5nZVRva2VuPSdzdHJpbmcnLCAgIyBPYnRhaW4gdGhpcyBmcm9tIGdldF9jaGFuZ2VfdG9rZW4oKSBBUEkgY2FsbAogICAgVGFncz1bCiAgICAgICAgewogICAgICAgICAgICAnS2V5JzogJ05hbWUnLAogICAgICAgICAgICAnVmFsdWUnOiAnYmxvY2staXAtcnVsZScKICAgICAgICB9LAogICAgXQopCgpydWxlX2lkID0gcmVzcG9uc2VbJ1J1bGUnXVsnUnVsZUlkJ10KCiMgVXBkYXRlIHRoZSBydWxlIHdpdGggdGhlIElQIHNldApyZXNwb25zZSA9IGNsaWVudC51cGRhdGVfcnVsZSgKICAgIFJ1bGVJZD1ydWxlX2lkLAogICAgQ2hhbmdlVG9rZW49J3N0cmluZycsICAjIE9idGFpbiB0aGlzIGZyb20gZ2V0X2NoYW5nZV90b2tlbigpIEFQSSBjYWxsCiAgICBVcGRhdGVzPVsKICAgICAgICB7CiAgICAgICAgICAgICdBY3Rpb24nOiAnSU5TRVJUJywKICAgICAgICAgICAgJ1ByZWRpY2F0ZSc6IHsKICAgICAgICAgICAgICAgICdOZWdhdGVkJzogRmFsc2UsCiAgICAgICAgICAgICAgICAnVHlwZSc6ICdJUE1hdGNoJywKICAgICAgICAgICAgICAgICdEYXRhSWQnOiBpcF9zZXRfaWQKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICBdCikKCiMgQXNzb2NpYXRlIHRoZSBydWxlIHdpdGggdGhlIFdlYiBBQ0wKcmVzcG9uc2UgPSBjbGllbnQudXBkYXRlX3dlYl9hY2woCiAgICBXZWJBQ0xJZD13ZWJfYWNsX2lkLAogICAgQ2hhbmdlVG9rZW49J3N0cmluZycsICAjIE9idGFpbiB0aGlzIGZyb20gZ2V0X2NoYW5nZV90b2tlbigpIEFQSSBjYWxsCiAgICBVcGRhdGVzPVsKICAgICAgICB7CiAgICAgICAgICAgICdBY3Rpb24nOiAnSU5TRVJUJywKICAgICAgICAgICAgJ0FjdGl2YXRlZFJ1bGUnOiB7CiAgICAgICAgICAgICAgICAnUHJpb3JpdHknOiAxLAogICAgICAgICAgICAgICAgJ1J1bGVJZCc6IHJ1bGVfaWQsCiAgICAgICAgICAgICAgICAnQWN0aW9uJzogewogICAgICAgICAgICAgICAgICAgICdUeXBlJzogJ0JMT0NLJwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgIF0KKQ=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>import boto3

# Initialize a session using Amazon WAF
client = boto3.client('waf')

# Create a Web ACL
response = client.create_web_acl(
    Name='example-web-acl',
    MetricName='exampleWebACL',
    DefaultAction={'Type': 'ALLOW'},
    ChangeToken='string',  # Obtain this from get_change_token() API call
    Tags=[
        {
            'Key': 'Name',
            'Value': 'example-web-acl'
        },
    ]
)

web_acl_id = response['WebACL']['WebACLId']

# Create an IP set
response = client.create_ip_set(
    Name='example-ip-set',
    ChangeToken='string',  # Obtain this from get_change_token() API call
    Tags=[
        {
            'Key': 'Name',
            'Value': 'example-ip-set'
        },
    ]
)

ip_set_id = response['IPSet']['IPSetId']

# Update the IP set with the IP address to block
response = client.update_ip_set(
    IPSetId=ip_set_id,
    ChangeToken='string',  # Obtain this from get_change_token() API call
    Updates=[
        {
            'Action': 'INSERT',
            'IPSetDescriptor': {
                'Type': 'IPV4',
                'Value': '192.0.2.44/32'
            }
        },
    ]
)

# Create a rule to block the IP address
response = client.create_rule(
    Name='block-ip-rule',
    MetricName='blockIPRule',
    ChangeToken='string',  # Obtain this from get_change_token() API call
    Tags=[
        {
            'Key': 'Name',
            'Value': 'block-ip-rule'
        },
    ]
)

rule_id = response['Rule']['RuleId']

# Update the rule with the IP set
response = client.update_rule(
    RuleId=rule_id,
    ChangeToken='string',  # Obtain this from get_change_token() API call
    Updates=[
        {
            'Action': 'INSERT',
            'Predicate': {
                'Negated': False,
                'Type': 'IPMatch',
                'DataId': ip_set_id
            }
        },
    ]
)

# Associate the rule with the Web ACL
response = client.update_web_acl(
    WebACLId=web_acl_id,
    ChangeToken='string',  # Obtain this from get_change_token() API call
    Updates=[
        {
            'Action': 'INSERT',
            'ActivatedRule': {
                'Priority': 1,
                'RuleId': rule_id,
                'Action': {
                    'Type': 'BLOCK'
                }
            }
        },
    ]
)</pre></div><div class='content'></div><h2>Practical Exercise</h2>
<div class='content'><p><strong>Exercise: Create a Web ACL to Block SQL Injection Attacks</strong></p>
<ol>
<li>
<p><strong>Create a Web ACL:</strong></p>
<ul>
<li>Name: <code>sql-injection-web-acl</code></li>
<li>Default Action: <code>ALLOW</code></li>
</ul>
</li>
<li>
<p><strong>Create a Rule:</strong></p>
<ul>
<li>Name: <code>block-sql-injection</code></li>
<li>Condition: SQL injection match condition</li>
</ul>
</li>
<li>
<p><strong>Associate the Rule with the Web ACL:</strong></p>
<ul>
<li>Action: <code>BLOCK</code></li>
</ul>
</li>
<li>
<p><strong>Apply the Web ACL to an AWS Resource:</strong></p>
<ul>
<li>Resource: Select an existing CloudFront distribution or Application Load Balancer.</li>
</ul>
</li>
</ol>
<p><strong>Solution:</strong></p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("aW1wb3J0IGJvdG8zCgojIEluaXRpYWxpemUgYSBzZXNzaW9uIHVzaW5nIEFtYXpvbiBXQUYKY2xpZW50ID0gYm90bzMuY2xpZW50KCd3YWYnKQoKIyBDcmVhdGUgYSBXZWIgQUNMCnJlc3BvbnNlID0gY2xpZW50LmNyZWF0ZV93ZWJfYWNsKAogICAgTmFtZT0nc3FsLWluamVjdGlvbi13ZWItYWNsJywKICAgIE1ldHJpY05hbWU9J3NxbEluamVjdGlvbldlYkFDTCcsCiAgICBEZWZhdWx0QWN0aW9uPXsnVHlwZSc6ICdBTExPVyd9LAogICAgQ2hhbmdlVG9rZW49J3N0cmluZycsICAjIE9idGFpbiB0aGlzIGZyb20gZ2V0X2NoYW5nZV90b2tlbigpIEFQSSBjYWxsCiAgICBUYWdzPVsKICAgICAgICB7CiAgICAgICAgICAgICdLZXknOiAnTmFtZScsCiAgICAgICAgICAgICdWYWx1ZSc6ICdzcWwtaW5qZWN0aW9uLXdlYi1hY2wnCiAgICAgICAgfSwKICAgIF0KKQoKd2ViX2FjbF9pZCA9IHJlc3BvbnNlWydXZWJBQ0wnXVsnV2ViQUNMSWQnXQoKIyBDcmVhdGUgYSBTUUwgaW5qZWN0aW9uIG1hdGNoIGNvbmRpdGlvbgpyZXNwb25zZSA9IGNsaWVudC5jcmVhdGVfc3FsX2luamVjdGlvbl9tYXRjaF9zZXQoCiAgICBOYW1lPSdzcWwtaW5qZWN0aW9uLW1hdGNoLXNldCcsCiAgICBDaGFuZ2VUb2tlbj0nc3RyaW5nJywgICMgT2J0YWluIHRoaXMgZnJvbSBnZXRfY2hhbmdlX3Rva2VuKCkgQVBJIGNhbGwKICAgIFRhZ3M9WwogICAgICAgIHsKICAgICAgICAgICAgJ0tleSc6ICdOYW1lJywKICAgICAgICAgICAgJ1ZhbHVlJzogJ3NxbC1pbmplY3Rpb24tbWF0Y2gtc2V0JwogICAgICAgIH0sCiAgICBdCikKCnNxbF9pbmplY3Rpb25fbWF0Y2hfc2V0X2lkID0gcmVzcG9uc2VbJ1NxbEluamVjdGlvbk1hdGNoU2V0J11bJ1NxbEluamVjdGlvbk1hdGNoU2V0SWQnXQoKIyBVcGRhdGUgdGhlIFNRTCBpbmplY3Rpb24gbWF0Y2ggc2V0IHdpdGggYSBjb25kaXRpb24KcmVzcG9uc2UgPSBjbGllbnQudXBkYXRlX3NxbF9pbmplY3Rpb25fbWF0Y2hfc2V0KAogICAgU3FsSW5qZWN0aW9uTWF0Y2hTZXRJZD1zcWxfaW5qZWN0aW9uX21hdGNoX3NldF9pZCwKICAgIENoYW5nZVRva2VuPSdzdHJpbmcnLCAgIyBPYnRhaW4gdGhpcyBmcm9tIGdldF9jaGFuZ2VfdG9rZW4oKSBBUEkgY2FsbAogICAgVXBkYXRlcz1bCiAgICAgICAgewogICAgICAgICAgICAnQWN0aW9uJzogJ0lOU0VSVCcsCiAgICAgICAgICAgICdTcWxJbmplY3Rpb25NYXRjaFR1cGxlJzogewogICAgICAgICAgICAgICAgJ0ZpZWxkVG9NYXRjaCc6IHsKICAgICAgICAgICAgICAgICAgICAnVHlwZSc6ICdRVUVSWV9TVFJJTkcnCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgJ1RleHRUcmFuc2Zvcm1hdGlvbic6ICdVUkxfREVDT0RFJwogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgIF0KKQoKIyBDcmVhdGUgYSBydWxlIHRvIGJsb2NrIFNRTCBpbmplY3Rpb24KcmVzcG9uc2UgPSBjbGllbnQuY3JlYXRlX3J1bGUoCiAgICBOYW1lPSdibG9jay1zcWwtaW5qZWN0aW9uJywKICAgIE1ldHJpY05hbWU9J2Jsb2NrU1FMSW5qZWN0aW9uJywKICAgIENoYW5nZVRva2VuPSdzdHJpbmcnLCAgIyBPYnRhaW4gdGhpcyBmcm9tIGdldF9jaGFuZ2VfdG9rZW4oKSBBUEkgY2FsbAogICAgVGFncz1bCiAgICAgICAgewogICAgICAgICAgICAnS2V5JzogJ05hbWUnLAogICAgICAgICAgICAnVmFsdWUnOiAnYmxvY2stc3FsLWluamVjdGlvbicKICAgICAgICB9LAogICAgXQopCgpydWxlX2lkID0gcmVzcG9uc2VbJ1J1bGUnXVsnUnVsZUlkJ10KCiMgVXBkYXRlIHRoZSBydWxlIHdpdGggdGhlIFNRTCBpbmplY3Rpb24gbWF0Y2ggc2V0CnJlc3BvbnNlID0gY2xpZW50LnVwZGF0ZV9ydWxlKAogICAgUnVsZUlkPXJ1bGVfaWQsCiAgICBDaGFuZ2VUb2tlbj0nc3RyaW5nJywgICMgT2J0YWluIHRoaXMgZnJvbSBnZXRfY2hhbmdlX3Rva2VuKCkgQVBJIGNhbGwKICAgIFVwZGF0ZXM9WwogICAgICAgIHsKICAgICAgICAgICAgJ0FjdGlvbic6ICdJTlNFUlQnLAogICAgICAgICAgICAnUHJlZGljYXRlJzogewogICAgICAgICAgICAgICAgJ05lZ2F0ZWQnOiBGYWxzZSwKICAgICAgICAgICAgICAgICdUeXBlJzogJ1NxbEluamVjdGlvbk1hdGNoJywKICAgICAgICAgICAgICAgICdEYXRhSWQnOiBzcWxfaW5qZWN0aW9uX21hdGNoX3NldF9pZAogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgIF0KKQoKIyBBc3NvY2lhdGUgdGhlIHJ1bGUgd2l0aCB0aGUgV2ViIEFDTApyZXNwb25zZSA9IGNsaWVudC51cGRhdGVfd2ViX2FjbCgKICAgIFdlYkFDTElkPXdlYl9hY2xfaWQsCiAgICBDaGFuZ2VUb2tlbj0nc3RyaW5nJywgICMgT2J0YWluIHRoaXMgZnJvbSBnZXRfY2hhbmdlX3Rva2VuKCkgQVBJIGNhbGwKICAgIFVwZGF0ZXM9WwogICAgICAgIHsKICAgICAgICAgICAgJ0FjdGlvbic6ICdJTlNFUlQnLAogICAgICAgICAgICAnQWN0aXZhdGVkUnVsZSc6IHsKICAgICAgICAgICAgICAgICdQcmlvcml0eSc6IDEsCiAgICAgICAgICAgICAgICAnUnVsZUlkJzogcnVsZV9pZCwKICAgICAgICAgICAgICAgICdBY3Rpb24nOiB7CiAgICAgICAgICAgICAgICAgICAgJ1R5cGUnOiAnQkxPQ0snCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgXQop"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>import boto3

# Initialize a session using Amazon WAF
client = boto3.client('waf')

# Create a Web ACL
response = client.create_web_acl(
    Name='sql-injection-web-acl',
    MetricName='sqlInjectionWebACL',
    DefaultAction={'Type': 'ALLOW'},
    ChangeToken='string',  # Obtain this from get_change_token() API call
    Tags=[
        {
            'Key': 'Name',
            'Value': 'sql-injection-web-acl'
        },
    ]
)

web_acl_id = response['WebACL']['WebACLId']

# Create a SQL injection match condition
response = client.create_sql_injection_match_set(
    Name='sql-injection-match-set',
    ChangeToken='string',  # Obtain this from get_change_token() API call
    Tags=[
        {
            'Key': 'Name',
            'Value': 'sql-injection-match-set'
        },
    ]
)

sql_injection_match_set_id = response['SqlInjectionMatchSet']['SqlInjectionMatchSetId']

# Update the SQL injection match set with a condition
response = client.update_sql_injection_match_set(
    SqlInjectionMatchSetId=sql_injection_match_set_id,
    ChangeToken='string',  # Obtain this from get_change_token() API call
    Updates=[
        {
            'Action': 'INSERT',
            'SqlInjectionMatchTuple': {
                'FieldToMatch': {
                    'Type': 'QUERY_STRING'
                },
                'TextTransformation': 'URL_DECODE'
            }
        },
    ]
)

# Create a rule to block SQL injection
response = client.create_rule(
    Name='block-sql-injection',
    MetricName='blockSQLInjection',
    ChangeToken='string',  # Obtain this from get_change_token() API call
    Tags=[
        {
            'Key': 'Name',
            'Value': 'block-sql-injection'
        },
    ]
)

rule_id = response['Rule']['RuleId']

# Update the rule with the SQL injection match set
response = client.update_rule(
    RuleId=rule_id,
    ChangeToken='string',  # Obtain this from get_change_token() API call
    Updates=[
        {
            'Action': 'INSERT',
            'Predicate': {
                'Negated': False,
                'Type': 'SqlInjectionMatch',
                'DataId': sql_injection_match_set_id
            }
        },
    ]
)

# Associate the rule with the Web ACL
response = client.update_web_acl(
    WebACLId=web_acl_id,
    ChangeToken='string',  # Obtain this from get_change_token() API call
    Updates=[
        {
            'Action': 'INSERT',
            'ActivatedRule': {
                'Priority': 1,
                'RuleId': rule_id,
                'Action': {
                    'Type': 'BLOCK'
                }
            }
        },
    ]
)</pre></div><div class='content'></div><h2>Common Mistakes and Tips</h2>
<div class='content'><ul>
<li><strong>Change Tokens:</strong> Always ensure you have the latest change token before making updates. Use the <code>get_change_token()</code> API call to retrieve it.</li>
<li><strong>Rule Priority:</strong> When adding multiple rules to a Web ACL, ensure that the priority is set correctly to avoid unintended blocking or allowing of requests.</li>
<li><strong>Testing:</strong> Always test your Web ACLs in a staging environment before applying them to production to avoid accidental blocking of legitimate traffic.</li>
</ul>
</div><h1>Conclusion</h1>
<div class='content'><p>In this section, you learned about AWS WAF and how to set up a Web ACL to protect your web applications from common web exploits. You also practiced creating a Web ACL to block SQL injection attacks. Understanding and implementing AWS WAF is crucial for maintaining the security and availability of your web applications. In the next module, we will explore monitoring and management tools in AWS to help you keep track of your resources and their performance.</p>
</div><div class='row navigation'>
	<div class='col-2'>
					<a href='04-03-aws-shield' title="AWS Shield">&#x25C4;Previous</a>
			</div>
	<div class='col-8 text-center'>
			</div>
	<div class='col-2 text-end'>
					<a href='05-01-cloudwatch' title="Amazon CloudWatch">Next &#x25BA;</a>
			</div>
</div>

			</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Advertising</h1>
			<p>This space is reserved for advertising.</p>
			<p>If you want to be a sponsor, contact us to include links in this area: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Thank you for collaborating!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. All rights reserved</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir galetes per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Accept</a>
    <a href="/cookies">More Information</a>
</div>	

	</div>    
</body>
</html>
