<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AWS CloudTrail</title>

    <link rel="alternate" href="https://campusempresa.com/mod/aws/aws-cloudtrail" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/mod/aws/aws-cloudtrail" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/mod/aws/aws-cloudtrail" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body>
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-8 p-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo_header.png" style="visibility:hiddenxx;"></a>
			</h1>
		</div>
		<div class="col-4 p-0 text-end">
			<h2 id="main_title"><cite>Building today's and tomorrow's society</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-0 m-0 text-end">
													<b id="lit_lang_es" class="px-2">EN</b>
				|
				<a href="https://campusempresa.com/mod/aws/aws-cloudtrail" class="px-2">ES</a></b>
				|
				<a href="https://campusempresa.cat/mod/aws/aws-cloudtrail" class="px-2">CA</a>
					</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="/objective">The Project</a>
				<a href="/about">About Us</a>
				<a href="/contribute">Contribute</a>
				<a href="/donate">Donations</a>
				<a href="/licence">License</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content"><div class='row navigation'>
	<div class='col-4'>
					<a href='amazon-cloudwatch'>&#x25C4;Amazon CloudWatch</a>
			</div>
	<div class='col-4 text-center'>
		<a href="./" class="title">AWS CloudTrail</a>
	</div>
	<div class='col-4 text-end'>
					<a href='aws-config'>AWS Config &#x25BA;</a>
			</div>
</div>
<div class='content'></div><h1>Introduction to AWS CloudTrail</h1>
<div class='content'><p>AWS CloudTrail is a service that enables governance, compliance, and operational and risk auditing of your AWS account. With CloudTrail, you can log, continuously monitor, and retain account activity related to actions across your AWS infrastructure.</p>
</div><h1>Key Concepts</h1>
<div class='content'><ul>
<li><strong>Event</strong>: A record of an activity in your AWS account. Events include actions taken in the AWS Management Console, AWS SDKs, command-line tools, and other AWS services.</li>
<li><strong>Trail</strong>: A configuration that enables delivery of events as log files to an Amazon S3 bucket.</li>
<li><strong>Management Events</strong>: Provide information about management operations that are performed on resources in your AWS account.</li>
<li><strong>Data Events</strong>: Provide information about resource operations performed on or within a resource.</li>
<li><strong>Insights Events</strong>: Detect unusual activity in your AWS account.</li>
</ul>
</div><h1>Setting Up AWS CloudTrail</h1>
<h2>Creating a Trail</h2>
<div class='content'><ol>
<li>
<p><strong>Navigate to CloudTrail in the AWS Management Console</strong>:</p>
<ul>
<li>Go to the AWS Management Console.</li>
<li>Search for and select &quot;CloudTrail&quot;.</li>
</ul>
</li>
<li>
<p><strong>Create a Trail</strong>:</p>
<ul>
<li>Click on &quot;Create trail&quot;.</li>
<li>Enter a name for your trail.</li>
<li>Choose whether to apply the trail to all regions.</li>
<li>Specify an S3 bucket to store your log files.</li>
</ul>
</li>
<li>
<p><strong>Configure Trail Settings</strong>:</p>
<ul>
<li>Enable log file validation.</li>
<li>Choose whether to enable CloudWatch Logs.</li>
<li>Specify the log group and IAM role for CloudWatch Logs.</li>
</ul>
</li>
<li>
<p><strong>Review and Create</strong>:</p>
<ul>
<li>Review your settings.</li>
<li>Click &quot;Create trail&quot;.</li>
</ul>
</li>
</ol>
</div><h2>Example: Creating a Trail using AWS CLI</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("YXdzIGNsb3VkdHJhaWwgY3JlYXRlLXRyYWlsIC0tbmFtZSBteS10cmFpbCAtLXMzLWJ1Y2tldC1uYW1lIG15LWJ1Y2tldCAtLWlzLW11bHRpLXJlZ2lvbi10cmFpbA=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>aws cloudtrail create-trail --name my-trail --s3-bucket-name my-bucket --is-multi-region-trail</pre></div><div class='content'></div><h1>Viewing and Analyzing CloudTrail Logs</h1>
<h2>Accessing Logs in S3</h2>
<div class='content'><ul>
<li>Navigate to the S3 bucket specified during trail creation.</li>
<li>Browse the bucket to find the log files organized by year, month, day, and hour.</li>
</ul>
</div><h2>Example: Viewing Logs using AWS CLI</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("YXdzIHMzIGxzIHMzOi8vbXktYnVja2V0L0FXU0xvZ3MvPGFjY291bnQtaWQ+L0Nsb3VkVHJhaWwv"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>aws s3 ls s3://my-bucket/AWSLogs/&lt;account-id&gt;/CloudTrail/</pre></div><div class='content'></div><h2>Analyzing Logs with CloudWatch</h2>
<div class='content'><ul>
<li><strong>Enable CloudWatch Logs Integration</strong>: This can be done during trail creation or by editing an existing trail.</li>
<li><strong>Create Metrics and Alarms</strong>: Use CloudWatch to create metrics and set alarms based on specific events.</li>
</ul>
</div><h2>Example: Creating a Metric Filter</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("YXdzIGxvZ3MgcHV0LW1ldHJpYy1maWx0ZXIgXAogIC0tbG9nLWdyb3VwLW5hbWUgQ2xvdWRUcmFpbC9EZWZhdWx0TG9nR3JvdXAgXAogIC0tZmlsdGVyLW5hbWUgVW5hdXRob3JpemVkQVBJQ2FsbHMgXAogIC0tZmlsdGVyLXBhdHRlcm4gJ3sgKCQuZXJyb3JDb2RlID0gIipVbmF1dGhvcml6ZWRPcGVyYXRpb24iKSB8fCAoJC5lcnJvckNvZGUgPSAiQWNjZXNzRGVuaWVkKiIpIH0nIFwKICAtLW1ldHJpYy10cmFuc2Zvcm1hdGlvbnMgbWV0cmljTmFtZT1VbmF1dGhvcml6ZWRBUElDYWxscyxtZXRyaWNOYW1lc3BhY2U9Q2xvdWRUcmFpbE1ldHJpY3MsbWV0cmljVmFsdWU9MQ=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>aws logs put-metric-filter \
  --log-group-name CloudTrail/DefaultLogGroup \
  --filter-name UnauthorizedAPICalls \
  --filter-pattern '{ ($.errorCode = &quot;*UnauthorizedOperation&quot;) || ($.errorCode = &quot;AccessDenied*&quot;) }' \
  --metric-transformations metricName=UnauthorizedAPICalls,metricNamespace=CloudTrailMetrics,metricValue=1</pre></div><div class='content'></div><h1>Advanced CloudTrail Features</h1>
<h2>CloudTrail Insights</h2>
<div class='content'><ul>
<li><strong>Detect Anomalies</strong>: CloudTrail Insights helps you identify unusual operational activity in your AWS account.</li>
<li><strong>Enable Insights</strong>: This can be done through the CloudTrail console by editing an existing trail and enabling Insights.</li>
</ul>
</div><h2>Example: Enabling Insights using AWS CLI</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("YXdzIGNsb3VkdHJhaWwgdXBkYXRlLXRyYWlsIC0tbmFtZSBteS10cmFpbCAtLWluc2lnaHQtc2VsZWN0b3JzICdbeyJJbnNpZ2h0VHlwZSI6ICJBcGlDYWxsUmF0ZUluc2lnaHQifV0n"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>aws cloudtrail update-trail --name my-trail --insight-selectors '[{&quot;InsightType&quot;: &quot;ApiCallRateInsight&quot;}]'</pre></div><div class='content'></div><h2>Integrating with AWS Lambda</h2>
<div class='content'><ul>
<li><strong>Automate Responses</strong>: Use AWS Lambda to automatically respond to specific CloudTrail events.</li>
<li><strong>Example Use Case</strong>: Trigger a Lambda function to disable a compromised IAM user.</li>
</ul>
</div><h2>Example: Lambda Function Trigger</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ewogICJzb3VyY2UiOiBbImF3cy5jbG91ZHRyYWlsIl0sCiAgImRldGFpbC10eXBlIjogWyJBV1MgQVBJIENhbGwgdmlhIENsb3VkVHJhaWwiXSwKICAiZGV0YWlsIjogewogICAgImV2ZW50TmFtZSI6IFsiQ29uc29sZUxvZ2luIl0sCiAgICAiZXJyb3JDb2RlIjogWyJBY2Nlc3NEZW5pZWQiXQogIH0KfQ=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>{
  &quot;source&quot;: [&quot;aws.cloudtrail&quot;],
  &quot;detail-type&quot;: [&quot;AWS API Call via CloudTrail&quot;],
  &quot;detail&quot;: {
    &quot;eventName&quot;: [&quot;ConsoleLogin&quot;],
    &quot;errorCode&quot;: [&quot;AccessDenied&quot;]
  }
}</pre></div><div class='content'></div><h1>Best Practices</h1>
<div class='content'><ul>
<li><strong>Enable Multi-Region Trails</strong>: Ensure that you capture events from all regions.</li>
<li><strong>Regularly Review Logs</strong>: Periodically review CloudTrail logs to identify any unusual activity.</li>
<li><strong>Integrate with CloudWatch</strong>: Use CloudWatch for real-time monitoring and alerting.</li>
<li><strong>Secure S3 Buckets</strong>: Ensure that the S3 buckets storing your CloudTrail logs are properly secured.</li>
</ul>
</div><h1>Conclusion</h1>
<div class='content'><p>AWS CloudTrail is a powerful tool for monitoring and auditing your AWS account activity. By understanding its key concepts, setting up trails, and leveraging advanced features, you can enhance the security and compliance of your AWS environment. Regularly reviewing logs and integrating with other AWS services like CloudWatch and Lambda can help you maintain a robust and secure infrastructure.</p>
</div><div class='row navigation'>
	<div class='col-4'>
					<a href='amazon-cloudwatch'>&#x25C4;Amazon CloudWatch</a>
			</div>
	<div class='col-4 text-center'>
		<a href="./" class="title">AWS CloudTrail</a>
	</div>
	<div class='col-4 text-end'>
					<a href='aws-config'>AWS Config &#x25BA;</a>
			</div>
</div>
</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Advertising</h1>
			<p>This space is reserved for advertising.</p>
			<p>If you want to be a sponsor, contact us to include links in this area: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Thank you for collaborating!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. All rights reserved</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir galetes per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Accept</a>
    <a href="/cookies">More Information</a>
</div>	

	</div>    
</body>
</html>
