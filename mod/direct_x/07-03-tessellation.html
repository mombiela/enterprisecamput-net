<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tessellation</title>

    <link rel="alternate" href="https://campusempresa.com/mod/direct_x/07-03-tessellation" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/mod/direct_x/07-03-tessellation" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/mod/direct_x/07-03-tessellation" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="/js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body >
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-12 col-md-6 p-2 p-md-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo-header_enterprise.png"></a>
			</h1>
		</div>
		<div class="col-12 col-md-6 p-2 p-md-0 text-end">
				<b id="lit_lang_es" class="px-2">EN</b>
	|
	<a href="https://campusempresa.com/mod/direct_x/07-03-tessellation" class="px-2">ES</a></b>
	|
	<a href="https://campusempresa.cat/mod/direct_x/07-03-tessellation" class="px-2">CA</a>
<br>
			<cite>Building today's and tomorrow's society</cite>
		</div>
	</div>
</div>
<div id="subheader" class="container-xxl">
	<div class="row">
		<div class="col-12 p-2 p-md-0 m-0 text-end">
			<a href="/objective">The Project</a> | 
<a href="/about">About Us</a> | 
<a href="/contribute">Contribute</a> | 
<a href="/donate">Donations</a> | 
<a href="/licence">License</a>
		</div>
	</div>
</div>

<div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				 					<a href="/categ/languages">Programming Languages</a>
				 					<a href="/categ/frameworks">Frameworks and Libraries</a>
				 					<a href="/categ/tech-tools">Technical Tools</a>
				 					<a href="/categ/foundations">Theoretical Foundations</a>
				 					<a href="/categ/soft-skills">Social Skills</a>
							</div>
		</div>
	</div>
</div>
		
<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content">
				<div class='row navigation'>
	<div class='col-1 col-md-2'>
					<a href='07-02-post-processing-effects' title="Post-Processing Effects">
				<span class="d-none d-md-inline">&#x25C4; Previous</span>
				<span class="d-inline d-md-none"><i class="bi bi-caret-left-square-fill"></i></span>
			</a>
			</div>
	<div class='col-10 col-md-8 text-center'>
					<a href="./"><h2 style="text-decoration:underline">Tessellation</h2></a>
			</div>
	<div class='col-1 col-md-2 text-end'>
					<a href='07-04-ray-tracing' title="Ray Tracing">
				<span class="d-none d-md-inline">Next &#x25BA;</span>
				<span class="d-inline d-md-none"><i class="bi bi-caret-right-square-fill"></i></span>
			</a>
			</div>
</div>
<div class='content'><p>Tessellation is an advanced rendering technique in DirectX that allows for the dynamic subdivision of polygons to create more detailed and smoother surfaces. This technique is particularly useful for rendering complex models and terrains with high levels of detail without the need for an excessive number of pre-defined vertices.</p>
</div><h1><p>Key Concepts</p>
</h1>
<div class='content'><ol>
<li>
<p><strong>Tessellation Stages</strong>:</p>
<ul>
<li><strong>Hull Shader (HS)</strong>: Processes control points and generates tessellation factors.</li>
<li><strong>Tessellator</strong>: Subdivides the patches based on the tessellation factors.</li>
<li><strong>Domain Shader (DS)</strong>: Computes the final vertex positions of the subdivided patches.</li>
</ul>
</li>
<li>
<p><strong>Control Points</strong>: Points that define the shape of the patch to be tessellated.</p>
</li>
<li>
<p><strong>Tessellation Factors</strong>: Values that determine how much a patch should be subdivided.</p>
</li>
<li>
<p><strong>Patch Topology</strong>: The shape of the patch, such as triangles, quads, or isolines.</p>
</li>
</ol>
</div><h1><p>Setting Up Tessellation</p>
</h1>
<div class='content'></div><h2><p>Step 1: Define Control Points</p>
</h2>
<div class='content'><p>Control points are the vertices that define the initial shape of the patch. For example, a quad patch would have four control points.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("c3RydWN0IENvbnRyb2xQb2ludAp7CiAgICBYTUZMT0FUMyBQb3NpdGlvbjsKfTs="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>struct ControlPoint
{
    XMFLOAT3 Position;
};</pre></div><div class='content'></div><h2><p>Step 2: Hull Shader</p>
</h2>
<div class='content'><p>The Hull Shader processes the control points and generates tessellation factors. It consists of two main parts: the Hull Shader function and the Hull Shader constant function.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Ly8gSHVsbCBTaGFkZXIgY29uc3RhbnQgZnVuY3Rpb24KSFNfQ09OU1RBTlRfREFUQV9PVVRQVVQgSFNDb25zdGFudEZ1bmN0aW9uKElucHV0UGF0Y2g8Q29udHJvbFBvaW50LCA0PiBpbnB1dFBhdGNoLCB1aW50IHBhdGNoSUQgOiBTVl9QcmltaXRpdmVJRCkKewogICAgSFNfQ09OU1RBTlRfREFUQV9PVVRQVVQgb3V0cHV0OwogICAgb3V0cHV0LkVkZ2VUZXNzRmFjdG9yWzBdID0gNC4wZjsgLy8gVGVzc2VsbGF0aW9uIGZhY3RvciBmb3IgZWRnZSAwCiAgICBvdXRwdXQuRWRnZVRlc3NGYWN0b3JbMV0gPSA0LjBmOyAvLyBUZXNzZWxsYXRpb24gZmFjdG9yIGZvciBlZGdlIDEKICAgIG91dHB1dC5FZGdlVGVzc0ZhY3RvclsyXSA9IDQuMGY7IC8vIFRlc3NlbGxhdGlvbiBmYWN0b3IgZm9yIGVkZ2UgMgogICAgb3V0cHV0LkVkZ2VUZXNzRmFjdG9yWzNdID0gNC4wZjsgLy8gVGVzc2VsbGF0aW9uIGZhY3RvciBmb3IgZWRnZSAzCiAgICBvdXRwdXQuSW5zaWRlVGVzc0ZhY3RvciA9IDQuMGY7ICAvLyBUZXNzZWxsYXRpb24gZmFjdG9yIGZvciB0aGUgaW5zaWRlIG9mIHRoZSBwYXRjaAogICAgcmV0dXJuIG91dHB1dDsKfQoKLy8gSHVsbCBTaGFkZXIgZnVuY3Rpb24KW2RvbWFpbigicXVhZCIpXQpbcGFydGl0aW9uaW5nKCJpbnRlZ2VyIildCltvdXRwdXR0b3BvbG9neSgidHJpYW5nbGVfY3ciKV0KW291dHB1dGNvbnRyb2xwb2ludHMoNCldCltwYXRjaGNvbnN0YW50ZnVuYygiSFNDb25zdGFudEZ1bmN0aW9uIildCkNvbnRyb2xQb2ludCBIU01haW4oSW5wdXRQYXRjaDxDb250cm9sUG9pbnQsIDQ+IGlucHV0UGF0Y2gsIHVpbnQgY29udHJvbFBvaW50SUQgOiBTVl9PdXRwdXRDb250cm9sUG9pbnRJRCkKewogICAgcmV0dXJuIGlucHV0UGF0Y2hbY29udHJvbFBvaW50SURdOwp9"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>// Hull Shader constant function
HS_CONSTANT_DATA_OUTPUT HSConstantFunction(InputPatch&lt;ControlPoint, 4&gt; inputPatch, uint patchID : SV_PrimitiveID)
{
    HS_CONSTANT_DATA_OUTPUT output;
    output.EdgeTessFactor[0] = 4.0f; // Tessellation factor for edge 0
    output.EdgeTessFactor[1] = 4.0f; // Tessellation factor for edge 1
    output.EdgeTessFactor[2] = 4.0f; // Tessellation factor for edge 2
    output.EdgeTessFactor[3] = 4.0f; // Tessellation factor for edge 3
    output.InsideTessFactor = 4.0f;  // Tessellation factor for the inside of the patch
    return output;
}

// Hull Shader function
[domain(&quot;quad&quot;)]
[partitioning(&quot;integer&quot;)]
[outputtopology(&quot;triangle_cw&quot;)]
[outputcontrolpoints(4)]
[patchconstantfunc(&quot;HSConstantFunction&quot;)]
ControlPoint HSMain(InputPatch&lt;ControlPoint, 4&gt; inputPatch, uint controlPointID : SV_OutputControlPointID)
{
    return inputPatch[controlPointID];
}</pre></div><div class='content'></div><h2><p>Step 3: Tessellator</p>
</h2>
<div class='content'><p>The Tessellator is a fixed-function stage that subdivides the patch based on the tessellation factors provided by the Hull Shader.</p>
</div><h2><p>Step 4: Domain Shader</p>
</h2>
<div class='content'><p>The Domain Shader computes the final vertex positions of the subdivided patches.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("W2RvbWFpbigicXVhZCIpXQp2b2lkIERTTWFpbihIU19DT05TVEFOVF9EQVRBX09VVFBVVCBpbnB1dCwgZmxvYXQyIHV2IDogU1ZfRG9tYWluTG9jYXRpb24sIGNvbnN0IE91dHB1dFBhdGNoPENvbnRyb2xQb2ludCwgND4gcGF0Y2gpCnsKICAgIGZsb2F0MyBwMCA9IHBhdGNoWzBdLlBvc2l0aW9uOwogICAgZmxvYXQzIHAxID0gcGF0Y2hbMV0uUG9zaXRpb247CiAgICBmbG9hdDMgcDIgPSBwYXRjaFsyXS5Qb3NpdGlvbjsKICAgIGZsb2F0MyBwMyA9IHBhdGNoWzNdLlBvc2l0aW9uOwoKICAgIGZsb2F0MyBwb3NpdGlvbiA9ICgxLjBmIC0gdXYueCkgKiAoMS4wZiAtIHV2LnkpICogcDAgKwogICAgICAgICAgICAgICAgICAgICAgdXYueCAqICgxLjBmIC0gdXYueSkgKiBwMSArCiAgICAgICAgICAgICAgICAgICAgICAoMS4wZiAtIHV2LngpICogdXYueSAqIHAyICsKICAgICAgICAgICAgICAgICAgICAgIHV2LnggKiB1di55ICogcDM7CgogICAgb3V0cHV0LlBvc2l0aW9uID0gZmxvYXQ0KHBvc2l0aW9uLCAxLjBmKTsKfQ=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>[domain(&quot;quad&quot;)]
void DSMain(HS_CONSTANT_DATA_OUTPUT input, float2 uv : SV_DomainLocation, const OutputPatch&lt;ControlPoint, 4&gt; patch)
{
    float3 p0 = patch[0].Position;
    float3 p1 = patch[1].Position;
    float3 p2 = patch[2].Position;
    float3 p3 = patch[3].Position;

    float3 position = (1.0f - uv.x) * (1.0f - uv.y) * p0 +
                      uv.x * (1.0f - uv.y) * p1 +
                      (1.0f - uv.x) * uv.y * p2 +
                      uv.x * uv.y * p3;

    output.Position = float4(position, 1.0f);
}</pre></div><div class='content'></div><h2><p>Step 5: Rendering Pipeline Integration</p>
</h2>
<div class='content'><p>Integrate the tessellation shaders into the rendering pipeline by setting the appropriate shader stages.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ZGV2aWNlQ29udGV4dC0+SFNTZXRTaGFkZXIoaHVsbFNoYWRlciwgbnVsbHB0ciwgMCk7CmRldmljZUNvbnRleHQtPkRTU2V0U2hhZGVyKGRvbWFpblNoYWRlciwgbnVsbHB0ciwgMCk7CmRldmljZUNvbnRleHQtPkRyYXdJbmRleGVkKGluZGV4Q291bnQsIDAsIDApOw=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>deviceContext-&gt;HSSetShader(hullShader, nullptr, 0);
deviceContext-&gt;DSSetShader(domainShader, nullptr, 0);
deviceContext-&gt;DrawIndexed(indexCount, 0, 0);</pre></div><div class='content'></div><h1><p>Practical Example</p>
</h1>
<div class='content'><p>Let's create a simple example that demonstrates tessellation on a quad patch.</p>
</div><h2><p>Example Code</p>
</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Ly8gRGVmaW5lIGNvbnRyb2wgcG9pbnRzIGZvciBhIHF1YWQKQ29udHJvbFBvaW50IGNvbnRyb2xQb2ludHNbNF0gPSB7CiAgICB7IFhNRkxPQVQzKC0xLjBmLCAtMS4wZiwgMC4wZikgfSwKICAgIHsgWE1GTE9BVDMoMS4wZiwgLTEuMGYsIDAuMGYpIH0sCiAgICB7IFhNRkxPQVQzKC0xLjBmLCAxLjBmLCAwLjBmKSB9LAogICAgeyBYTUZMT0FUMygxLjBmLCAxLjBmLCAwLjBmKSB9Cn07CgovLyBDcmVhdGUgYW5kIHNldCB0aGUgaW5wdXQgbGF5b3V0LCB2ZXJ0ZXggYnVmZmVyLCBhbmQgaW5kZXggYnVmZmVyCi8vIC4uLgoKLy8gU2V0IHRoZSB0ZXNzZWxsYXRpb24gc2hhZGVycwpkZXZpY2VDb250ZXh0LT5IU1NldFNoYWRlcihodWxsU2hhZGVyLCBudWxscHRyLCAwKTsKZGV2aWNlQ29udGV4dC0+RFNTZXRTaGFkZXIoZG9tYWluU2hhZGVyLCBudWxscHRyLCAwKTsKCi8vIERyYXcgdGhlIHRlc3NlbGxhdGVkIHF1YWQKZGV2aWNlQ29udGV4dC0+RHJhd0luZGV4ZWQoaW5kZXhDb3VudCwgMCwgMCk7"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>// Define control points for a quad
ControlPoint controlPoints[4] = {
    { XMFLOAT3(-1.0f, -1.0f, 0.0f) },
    { XMFLOAT3(1.0f, -1.0f, 0.0f) },
    { XMFLOAT3(-1.0f, 1.0f, 0.0f) },
    { XMFLOAT3(1.0f, 1.0f, 0.0f) }
};

// Create and set the input layout, vertex buffer, and index buffer
// ...

// Set the tessellation shaders
deviceContext-&gt;HSSetShader(hullShader, nullptr, 0);
deviceContext-&gt;DSSetShader(domainShader, nullptr, 0);

// Draw the tessellated quad
deviceContext-&gt;DrawIndexed(indexCount, 0, 0);</pre></div><div class='content'></div><h2><p>Exercise</p>
</h2>
<div class='content'><ol>
<li><strong>Modify Tessellation Factors</strong>: Change the tessellation factors in the Hull Shader to see how it affects the level of detail.</li>
<li><strong>Experiment with Patch Topologies</strong>: Try using different patch topologies such as triangles or isolines.</li>
<li><strong>Implement a Displacement Map</strong>: Use a displacement map in the Domain Shader to create more complex surface details.</li>
</ol>
</div><h2><p>Solution</p>
</h2>
<div class='content'><ol>
<li>
<p><strong>Modified Tessellation Factors</strong>:</p>
<pre><code class="language-hlsl">output.EdgeTessFactor[0] = 8.0f; // Increased tessellation factor for edge 0
output.EdgeTessFactor[1] = 8.0f; // Increased tessellation factor for edge 1
output.EdgeTessFactor[2] = 8.0f; // Increased tessellation factor for edge 2
output.EdgeTessFactor[3] = 8.0f; // Increased tessellation factor for edge 3
output.InsideTessFactor = 8.0f;  // Increased tessellation factor for the inside of the patch
</code></pre>
</li>
<li>
<p><strong>Patch Topology Change</strong>:</p>
<pre><code class="language-hlsl">[domain(&quot;tri&quot;)]
[partitioning(&quot;integer&quot;)]
[outputtopology(&quot;triangle_cw&quot;)]
[outputcontrolpoints(3)]
[patchconstantfunc(&quot;HSConstantFunction&quot;)]
ControlPoint HSMain(InputPatch&lt;ControlPoint, 3&gt; inputPatch, uint controlPointID : SV_OutputControlPointID)
{
    return inputPatch[controlPointID];
}
</code></pre>
</li>
<li>
<p><strong>Displacement Map Implementation</strong>:</p>
<pre><code class="language-hlsl">Texture2D displacementMap : register(t0);
SamplerState samplerState : register(s0);

[domain(&quot;quad&quot;)]
void DSMain(HS_CONSTANT_DATA_OUTPUT input, float2 uv : SV_DomainLocation, const OutputPatch&lt;ControlPoint, 4&gt; patch)
{
    float3 p0 = patch[0].Position;
    float3 p1 = patch[1].Position;
    float3 p2 = patch[2].Position;
    float3 p3 = patch[3].Position;

    float3 position = (1.0f - uv.x) * (1.0f - uv.y) * p0 +
                      uv.x * (1.0f - uv.y) * p1 +
                      (1.0f - uv.x) * uv.y * p2 +
                      uv.x * uv.y * p3;

    float displacement = displacementMap.Sample(samplerState, uv).r;
    position += float3(0.0f, 0.0f, displacement);

    output.Position = float4(position, 1.0f);
}
</code></pre>
</li>
</ol>
</div><h1><p>Conclusion</p>
</h1>
<div class='content'><p>Tessellation is a powerful technique in DirectX that allows for the dynamic subdivision of polygons, enabling the creation of highly detailed and smooth surfaces. By understanding and utilizing the Hull Shader, Tessellator, and Domain Shader stages, you can significantly enhance the visual quality of your 3D applications. Experiment with different tessellation factors, patch topologies, and displacement maps to fully leverage the capabilities of tessellation in your projects.</p>
</div><div class='row navigation'>
	<div class='col-1 col-md-2'>
					<a href='07-02-post-processing-effects' title="Post-Processing Effects">
				<span class="d-none d-md-inline">&#x25C4; Previous</span>
				<span class="d-inline d-md-none"><i class="bi bi-caret-left-square-fill"></i></span>
			</a>
			</div>
	<div class='col-10 col-md-8 text-center'>
			</div>
	<div class='col-1 col-md-2 text-end'>
					<a href='07-04-ray-tracing' title="Ray Tracing">
				<span class="d-none d-md-inline">Next &#x25BA;</span>
				<span class="d-inline d-md-none"><i class="bi bi-caret-right-square-fill"></i></span>
			</a>
			</div>
</div>

			</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Advertising</h1>
			<p>This space is reserved for advertising.</p>
			<p>If you want to be a sponsor, contact us to include links in this area: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Thank you for collaborating!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. All rights reserved</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	We use cookies to improve your user experience and offer content tailored to your interests.
    <a href="#" id="btn_accept_cookies" class="button">Accept</a>
    <a href="/cookies">More Information</a>
</div>	

	</div>    
</body>
</html>
