<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="index, follow, noarchive">
    <title>Deferred Shading</title>

    <link rel="alternate" href="https://campusempresa.com/mod/direct_x/07-01-deferred-shading" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/mod/direct_x/07-01-deferred-shading" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/mod/direct_x/07-01-deferred-shading" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css?v=4" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="/js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script>var DEVELOP = window.location.href.indexOf("localhost")!=-1 && true;</script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
	<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-0611338592562725" crossorigin="anonymous"></script>  	
	</head>

<body >
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-12 col-md-6 p-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo-header_enterprise.png"></a>
			</h1>
		</div>
		<div class="col-12 col-md-6 p-0 text-end">
			<p class="mb-0 p-0">	<b id="lit_lang_es" class="px-2">EN</b>
	|
	<a href="https://campusempresa.com/mod/direct_x/07-01-deferred-shading" class="px-2">ES</a></b>
	|
	<a href="https://campusempresa.cat/mod/direct_x/07-01-deferred-shading" class="px-2">CA</a>
</p>
			<p class="mb-4 mt-0 mx-2  d-none d-md-block"><cite>All the knowledge within your reach</cite></p>
		</div>
	</div>
</div>
<div class="subheader container-xxl d-none d-md-block">
	<div class="row">
		<div class="col-12 p-2 p-md-0 m-0 text-end">
			<a href="/objective">The Project</a> | 
<a href="/about">About Us</a> | 
<a href="/contribute">Contribute</a> | 
<a href="/donate">Donations</a> | 
<a href="/licence">License</a>
		</div>
	</div>
</div>
		<div class="top-bar container-fluid p-0">
	<div class="container-xxl p-0">
		<div class="row">
			<div class="col" id="left_menu">
					<a href="/"  class="nav-link px-3">
		<i class="bi bi-house-fill"></i>
		HOME
	</a>

	<a href="./"  class="nav-link px-3">
		<i class="bi bi-journal-bookmark"></i>
		Course Content
	</a>

			</div>
		</div>
	</div>
</div>

<!--  
<div class="top-bar container-fluid">
	<div class="container-xxl">
		<nav class="navbar navbar-expand-md p-0">
			<div class="container-fluid">
				<button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
					<span class="navbar-toggler-icon"></span>
				</button>
				
				<div class="collapse navbar-collapse" id="navbarNav">
					<div class="navbar-nav me-auto">
							<a href="/"  class="nav-link px-3">
		<i class="bi bi-house-fill"></i>
		HOME
	</a>

	<a href="./"  class="nav-link px-3">
		<i class="bi bi-journal-bookmark"></i>
		Course Content
	</a>

					</div>
				</div>			
							</div>
		</nav>
	</div>
</div>
 -->				<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content">
				<div class='row navigation'>
	<div class='col-1 col-md-2'>
					<a href='06-04-multithreading-directx' title="Multithreading in DirectX">
				<span class="d-none d-md-inline">&#x25C4; Previous</span>
				<span class="d-inline d-md-none"><i class="bi bi-caret-left-square-fill"></i></span>
			</a>
			</div>
	<div class='col-10 col-md-8 text-center'>
					<h2 style="text-decoration:underline">Deferred Shading</h2>
			</div>
	<div class='col-1 col-md-2 text-end'>
					<a href='07-02-post-processing-effects' title="Post-Processing Effects">
				<span class="d-none d-md-inline">Next &#x25BA;</span>
				<span class="d-inline d-md-none"><i class="bi bi-caret-right-square-fill"></i></span>
			</a>
			</div>
</div>
<div class='content'><p>Deferred shading is an advanced rendering technique used to manage complex lighting scenarios efficiently. Unlike traditional forward rendering, where lighting calculations are performed for each object in the scene, deferred shading separates the rendering process into multiple stages, allowing for more flexible and efficient lighting computations.</p>
</div><h1>Key Concepts</h1>
<div class='content'><ol>
<li>
<p><strong>G-Buffer (Geometry Buffer):</strong></p>
<ul>
<li>A collection of textures that store various attributes of the scene's geometry, such as positions, normals, colors, and material properties.</li>
<li>These attributes are used later in the lighting pass to compute the final color of each pixel.</li>
</ul>
</li>
<li>
<p><strong>Deferred Shading Pipeline:</strong></p>
<ul>
<li><strong>Geometry Pass:</strong> Render the scene's geometry and store the necessary attributes in the G-Buffer.</li>
<li><strong>Lighting Pass:</strong> Use the data from the G-Buffer to compute lighting for each pixel.</li>
<li><strong>Final Pass:</strong> Combine the results of the lighting pass with other effects (e.g., post-processing) to produce the final image.</li>
</ul>
</li>
<li>
<p><strong>Advantages:</strong></p>
<ul>
<li>Efficient handling of multiple light sources.</li>
<li>Decouples geometry complexity from lighting complexity.</li>
<li>Allows for more complex lighting models and effects.</li>
</ul>
</li>
<li>
<p><strong>Disadvantages:</strong></p>
<ul>
<li>Higher memory usage due to the G-Buffer.</li>
<li>Potential performance issues on lower-end hardware.</li>
<li>Complexity in handling transparent objects.</li>
</ul>
</li>
</ol>
</div><h1>Practical Example</h1>
<div class='content'></div><h2>Step 1: Setting Up the G-Buffer</h2>
<div class='content'><p>First, we need to create the G-Buffer textures to store the necessary attributes.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Ly8gQ3JlYXRlIEctQnVmZmVyIHRleHR1cmVzCklEM0QxMVRleHR1cmUyRCogZ0J1ZmZlclRleHR1cmVzWzNdOwpJRDNEMTFSZW5kZXJUYXJnZXRWaWV3KiBnQnVmZmVyUlRWc1szXTsKSUQzRDExU2hhZGVyUmVzb3VyY2VWaWV3KiBnQnVmZmVyU1JWc1szXTsKCmZvciAoaW50IGkgPSAwOyBpIDwgMzsgKytpKSB7CiAgICBEM0QxMV9URVhUVVJFMkRfREVTQyB0ZXh0dXJlRGVzYyA9IHt9OwogICAgdGV4dHVyZURlc2MuV2lkdGggPSBzY3JlZW5XaWR0aDsKICAgIHRleHR1cmVEZXNjLkhlaWdodCA9IHNjcmVlbkhlaWdodDsKICAgIHRleHR1cmVEZXNjLk1pcExldmVscyA9IDE7CiAgICB0ZXh0dXJlRGVzYy5BcnJheVNpemUgPSAxOwogICAgdGV4dHVyZURlc2MuRm9ybWF0ID0gKGkgPT0gMCkgPyBEWEdJX0ZPUk1BVF9SMzJHMzJCMzJBMzJfRkxPQVQgOiBEWEdJX0ZPUk1BVF9SOEc4QjhBOF9VTk9STTsKICAgIHRleHR1cmVEZXNjLlNhbXBsZURlc2MuQ291bnQgPSAxOwogICAgdGV4dHVyZURlc2MuVXNhZ2UgPSBEM0QxMV9VU0FHRV9ERUZBVUxUOwogICAgdGV4dHVyZURlc2MuQmluZEZsYWdzID0gRDNEMTFfQklORF9SRU5ERVJfVEFSR0VUIHwgRDNEMTFfQklORF9TSEFERVJfUkVTT1VSQ0U7CgogICAgZGV2aWNlLT5DcmVhdGVUZXh0dXJlMkQoJnRleHR1cmVEZXNjLCBudWxscHRyLCAmZ0J1ZmZlclRleHR1cmVzW2ldKTsKICAgIGRldmljZS0+Q3JlYXRlUmVuZGVyVGFyZ2V0VmlldyhnQnVmZmVyVGV4dHVyZXNbaV0sIG51bGxwdHIsICZnQnVmZmVyUlRWc1tpXSk7CiAgICBkZXZpY2UtPkNyZWF0ZVNoYWRlclJlc291cmNlVmlldyhnQnVmZmVyVGV4dHVyZXNbaV0sIG51bGxwdHIsICZnQnVmZmVyU1JWc1tpXSk7Cn0="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>// Create G-Buffer textures
ID3D11Texture2D* gBufferTextures[3];
ID3D11RenderTargetView* gBufferRTVs[3];
ID3D11ShaderResourceView* gBufferSRVs[3];

for (int i = 0; i &lt; 3; ++i) {
    D3D11_TEXTURE2D_DESC textureDesc = {};
    textureDesc.Width = screenWidth;
    textureDesc.Height = screenHeight;
    textureDesc.MipLevels = 1;
    textureDesc.ArraySize = 1;
    textureDesc.Format = (i == 0) ? DXGI_FORMAT_R32G32B32A32_FLOAT : DXGI_FORMAT_R8G8B8A8_UNORM;
    textureDesc.SampleDesc.Count = 1;
    textureDesc.Usage = D3D11_USAGE_DEFAULT;
    textureDesc.BindFlags = D3D11_BIND_RENDER_TARGET | D3D11_BIND_SHADER_RESOURCE;

    device-&gt;CreateTexture2D(&amp;textureDesc, nullptr, &amp;gBufferTextures[i]);
    device-&gt;CreateRenderTargetView(gBufferTextures[i], nullptr, &amp;gBufferRTVs[i]);
    device-&gt;CreateShaderResourceView(gBufferTextures[i], nullptr, &amp;gBufferSRVs[i]);
}</pre></div><div class='content'></div><h2>Step 2: Geometry Pass</h2>
<div class='content'><p>Render the scene's geometry and store the attributes in the G-Buffer.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Ly8gU2V0IEctQnVmZmVyIHJlbmRlciB0YXJnZXRzCmNvbnRleHQtPk9NU2V0UmVuZGVyVGFyZ2V0cygzLCBnQnVmZmVyUlRWcywgZGVwdGhTdGVuY2lsVmlldyk7CgovLyBSZW5kZXIgc2NlbmUgZ2VvbWV0cnkKZm9yIChhdXRvJiBvYmplY3QgOiBzY2VuZU9iamVjdHMpIHsKICAgIG9iamVjdC5SZW5kZXIoY29udGV4dCk7Cn0="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>// Set G-Buffer render targets
context-&gt;OMSetRenderTargets(3, gBufferRTVs, depthStencilView);

// Render scene geometry
for (auto&amp; object : sceneObjects) {
    object.Render(context);
}</pre></div><div class='content'></div><h2>Step 3: Lighting Pass</h2>
<div class='content'><p>Use the data from the G-Buffer to compute lighting for each pixel.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Ly8gU2V0IHRoZSBiYWNrIGJ1ZmZlciBhcyB0aGUgcmVuZGVyIHRhcmdldApjb250ZXh0LT5PTVNldFJlbmRlclRhcmdldHMoMSwgJmJhY2tCdWZmZXJSVFYsIG51bGxwdHIpOwoKLy8gQmluZCBHLUJ1ZmZlciB0ZXh0dXJlcyBhcyBzaGFkZXIgcmVzb3VyY2VzCmNvbnRleHQtPlBTU2V0U2hhZGVyUmVzb3VyY2VzKDAsIDMsIGdCdWZmZXJTUlZzKTsKCi8vIFNldCBsaWdodGluZyBzaGFkZXIKY29udGV4dC0+UFNTZXRTaGFkZXIobGlnaHRpbmdTaGFkZXIsIG51bGxwdHIsIDApOwoKLy8gUmVuZGVyIGEgZnVsbC1zY3JlZW4gcXVhZCB0byBhcHBseSBsaWdodGluZwpSZW5kZXJGdWxsU2NyZWVuUXVhZChjb250ZXh0KTs="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>// Set the back buffer as the render target
context-&gt;OMSetRenderTargets(1, &amp;backBufferRTV, nullptr);

// Bind G-Buffer textures as shader resources
context-&gt;PSSetShaderResources(0, 3, gBufferSRVs);

// Set lighting shader
context-&gt;PSSetShader(lightingShader, nullptr, 0);

// Render a full-screen quad to apply lighting
RenderFullScreenQuad(context);</pre></div><div class='content'></div><h2>Step 4: Final Pass</h2>
<div class='content'><p>Combine the results of the lighting pass with other effects to produce the final image.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Ly8gQXBwbHkgcG9zdC1wcm9jZXNzaW5nIGVmZmVjdHMgYW5kIHByZXNlbnQgdGhlIGZpbmFsIGltYWdlCkFwcGx5UG9zdFByb2Nlc3NpbmcoY29udGV4dCk7CnN3YXBDaGFpbi0+UHJlc2VudCgwLCAwKTs="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>// Apply post-processing effects and present the final image
ApplyPostProcessing(context);
swapChain-&gt;Present(0, 0);</pre></div><div class='content'></div><h1>Practical Exercise</h1>
<div class='content'></div><h2>Exercise: Implement Deferred Shading</h2>
<div class='content'><ol>
<li>
<p><strong>Setup the G-Buffer:</strong></p>
<ul>
<li>Create textures for positions, normals, and albedo (color).</li>
<li>Ensure these textures are bound as render targets during the geometry pass.</li>
</ul>
</li>
<li>
<p><strong>Geometry Pass:</strong></p>
<ul>
<li>Render the scene's geometry and store the necessary attributes in the G-Buffer.</li>
</ul>
</li>
<li>
<p><strong>Lighting Pass:</strong></p>
<ul>
<li>Use the data from the G-Buffer to compute lighting for each pixel.</li>
<li>Implement a simple lighting model (e.g., Phong shading).</li>
</ul>
</li>
<li>
<p><strong>Final Pass:</strong></p>
<ul>
<li>Combine the results of the lighting pass with any post-processing effects.</li>
</ul>
</li>
</ol>
</div><h2>Solution</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Ly8gU29sdXRpb24gY29kZSBwcm92aWRlZCBpbiB0aGUgcHJhY3RpY2FsIGV4YW1wbGUgYWJvdmU="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>// Solution code provided in the practical example above</pre></div><div class='content'></div><h1>Common Mistakes and Tips</h1>
<div class='content'><ul>
<li><strong>Memory Management:</strong> Ensure that the G-Buffer textures are properly managed to avoid memory leaks.</li>
<li><strong>Performance:</strong> Optimize the lighting pass to handle multiple light sources efficiently.</li>
<li><strong>Transparency:</strong> Handle transparent objects separately, as deferred shading does not handle transparency well.</li>
</ul>
</div><h1>Conclusion</h1>
<div class='content'><p>Deferred shading is a powerful technique for managing complex lighting scenarios in real-time rendering. By separating the rendering process into multiple stages, it allows for more flexible and efficient lighting computations. Understanding and implementing deferred shading can significantly enhance the visual quality and performance of your DirectX applications.</p>
</div><div class='row navigation'>
	<div class='col-1 col-md-2'>
					<a href='06-04-multithreading-directx' title="Multithreading in DirectX">
				<span class="d-none d-md-inline">&#x25C4; Previous</span>
				<span class="d-inline d-md-none"><i class="bi bi-caret-left-square-fill"></i></span>
			</a>
			</div>
	<div class='col-10 col-md-8 text-center'>
			</div>
	<div class='col-1 col-md-2 text-end'>
					<a href='07-02-post-processing-effects' title="Post-Processing Effects">
				<span class="d-none d-md-inline">Next &#x25BA;</span>
				<span class="d-inline d-md-none"><i class="bi bi-caret-right-square-fill"></i></span>
			</a>
			</div>
</div>

			</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
				<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-0611338592562725"
	     crossorigin="anonymous"></script>
	<!-- enterprise_campus -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-0611338592562725"
	     data-ad-slot="6914733106"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
	     (adsbygoogle = window.adsbygoogle || []).push({});
	</script>
			
	<div class="container mt-2 d-none d-md-block index">
		<h1>DirectX Programming Course</h1>
<h2>Module 1: Introduction to DirectX</h2>
<ul>
<li><a href="01-01-what-is-directx">What is DirectX?</a></li>
<li><a href="01-02-setting-up-environment">Setting Up the Development Environment</a></li>
<li><a href="01-03-understanding-directx-api">Understanding the DirectX API</a></li>
<li><a href="01-04-creating-first-application">Creating Your First DirectX Application</a></li>
</ul>
<h2>Module 2: Direct3D Basics</h2>
<ul>
<li><a href="02-01-introduction-to-direct3d">Introduction to Direct3D</a></li>
<li><a href="02-02-initializing-direct3d">Initializing Direct3D</a></li>
<li><a href="02-03-rendering-a-triangle">Rendering a Triangle</a></li>
<li><a href="02-04-handling-render-loop">Handling the Render Loop</a></li>
</ul>
<h2>Module 3: Working with Shaders</h2>
<ul>
<li><a href="03-01-introduction-to-shaders">Introduction to Shaders</a></li>
<li><a href="03-02-writing-vertex-shaders">Writing Vertex Shaders</a></li>
<li><a href="03-03-writing-pixel-shaders">Writing Pixel Shaders</a></li>
<li><a href="03-04-compiling-using-shaders">Compiling and Using Shaders</a></li>
</ul>
<h2>Module 4: Advanced Rendering Techniques</h2>
<ul>
<li><a href="04-01-texture-mapping">Texture Mapping</a></li>
<li><a href="04-02-lighting-and-materials">Lighting and Materials</a></li>
<li><a href="04-03-advanced-lighting-techniques">Advanced Lighting Techniques</a></li>
<li><a href="04-04-shadow-mapping">Shadow Mapping</a></li>
</ul>
<h2>Module 5: 3D Models and Animation</h2>
<ul>
<li><a href="05-01-loading-3d-models">Loading 3D Models</a></li>
<li><a href="05-02-animating-3d-models">Animating 3D Models</a></li>
<li><a href="05-03-skeletal-animation">Skeletal Animation</a></li>
<li><a href="05-04-morph-target-animation">Morph Target Animation</a></li>
</ul>
<h2>Module 6: Performance Optimization</h2>
<ul>
<li><a href="06-01-profiling-debugging">Profiling and Debugging</a></li>
<li><a href="06-02-optimizing-rendering-performance">Optimizing Rendering Performance</a></li>
<li><a href="06-03-memory-management">Memory Management</a></li>
<li><a href="06-04-multithreading-directx">Multithreading in DirectX</a></li>
</ul>
<h2>Module 7: Advanced Topics</h2>
<ul>
<li><a href="07-01-deferred-shading">Deferred Shading</a></li>
<li><a href="07-02-post-processing-effects">Post-Processing Effects</a></li>
<li><a href="07-03-tessellation">Tessellation</a></li>
<li><a href="07-04-ray-tracing">Ray Tracing</a></li>
</ul>
<h2>Module 8: DirectX in Practice</h2>
<ul>
<li><a href="08-01-building-game-engine">Building a Game Engine</a></li>
<li><a href="08-02-integrating-physics">Integrating Physics</a></li>
<li><a href="08-03-networking-directx">Networking in DirectX</a></li>
<li><a href="08-04-publishing-application">Publishing Your DirectX Application</a></li>
</ul>

	</div>










		</div>
	</div>
</div>		
<div class="container-xxl d-block d-md-none">
	<div class="row">
		<div class="col-12 p-2 p-md-0 m-0 text-end">
			<a href="/objective">The Project</a> | 
<a href="/about">About Us</a> | 
<a href="/contribute">Contribute</a> | 
<a href="/donate">Donations</a> | 
<a href="/licence">License</a>
		</div>
	</div>
</div>

<div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. All rights reserved</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	We use cookies to improve your user experience and offer content tailored to your interests.
    <a href="#" id="btn_accept_cookies" class="button">Accept</a>
    <a href="/cookies">More Information</a>
</div>	

	</div>    
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
</body>
</html>
