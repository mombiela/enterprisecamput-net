<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Morph Target Animation</title>

    <link rel="alternate" href="https://campusempresa.com/mod/direct_x/05-04-morph-target-animation" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/mod/direct_x/05-04-morph-target-animation" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/mod/direct_x/05-04-morph-target-animation" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="/js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body >
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-12 col-md-6 p-2 p-md-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo-header_enterprise.png"></a>
			</h1>
		</div>
		<div class="col-12 col-md-6 p-2 p-md-0 text-end">
				<b id="lit_lang_es" class="px-2">EN</b>
	|
	<a href="https://campusempresa.com/mod/direct_x/05-04-morph-target-animation" class="px-2">ES</a></b>
	|
	<a href="https://campusempresa.cat/mod/direct_x/05-04-morph-target-animation" class="px-2">CA</a>
<br>
			<cite>Building today's and tomorrow's society</cite>
		</div>
	</div>
</div>
<div id="subheader" class="container-xxl">
	<div class="row">
		<div class="col-12 p-2 p-md-0 m-0 text-end">
			<a href="/objective">The Project</a> | 
<a href="/about">About Us</a> | 
<a href="/contribute">Contribute</a> | 
<a href="/donate">Donations</a> | 
<a href="/licence">License</a>
		</div>
	</div>
</div>

<div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
									<a href="./">Course Content</a>
					<span class="sep">|</span>
								<a href="/all/competencias">Technical Skills</a>
				<a href="/all/conocimientos">Knowledge</a>
				<a href="/all/soft_skills">Social Skills</a>
			</div>
		</div>
	</div>
</div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content">
								<div class='row navigation'>
	<div class='col-1 col-md-2'>
					<a href='05-03-skeletal-animation' title="Skeletal Animation">
				<span class="d-none d-md-inline">&#x25C4; Previous</span>
				<span class="d-inline d-md-none"><i class="bi bi-caret-left-square-fill"></i></span>
			</a>
			</div>
	<div class='col-10 col-md-8 text-center'>
					<a href="./"><h2 style="text-decoration:underline">Morph Target Animation</h2></a>
			</div>
	<div class='col-1 col-md-2 text-end'>
					<a href='06-01-profiling-debugging' title="Profiling and Debugging">
				<span class="d-none d-md-inline">Next &#x25BA;</span>
				<span class="d-inline d-md-none"><i class="bi bi-caret-right-square-fill"></i></span>
			</a>
			</div>
</div>
<div class='content'><p>Morph Target Animation, also known as blend shape animation, is a technique used in 3D computer graphics to animate a mesh by interpolating between different target shapes. This method is particularly useful for facial animations, where subtle deformations are required to convey expressions.</p>
</div><h1><p>Key Concepts</p>
</h1>
<div class='content'><ol>
<li><strong>Morph Targets</strong>: These are the different shapes or states of a mesh that you want to interpolate between. Each morph target represents a specific deformation of the base mesh.</li>
<li><strong>Base Mesh</strong>: The original mesh that will be deformed using the morph targets.</li>
<li><strong>Weights</strong>: Values that determine the influence of each morph target on the final shape of the mesh. These weights are typically between 0 and 1.</li>
</ol>
</div><h1><p>Steps to Implement Morph Target Animation</p>
</h1>
<div class='content'></div><h2><ol>
<li>Preparing the Mesh and Morph Targets</li>
</ol>
</h2>
<div class='content'><p>Before you can animate a mesh using morph targets, you need to have a base mesh and several morph targets. These can be created using 3D modeling software like Blender or Maya.</p>
</div><h2><ol start="2">
<li>Loading the Mesh and Morph Targets</li>
</ol>
</h2>
<div class='content'><p>You need to load the base mesh and its morph targets into your DirectX application. This involves reading the vertex data for each morph target and storing it in a way that allows for efficient interpolation.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Ly8gUHNldWRvLWNvZGUgZm9yIGxvYWRpbmcgYSBtZXNoIGFuZCBpdHMgbW9ycGggdGFyZ2V0cwpNZXNoIGJhc2VNZXNoID0gTG9hZE1lc2goImJhc2VfbWVzaC5vYmoiKTsKc3RkOjp2ZWN0b3I8TWVzaD4gbW9ycGhUYXJnZXRzOwptb3JwaFRhcmdldHMucHVzaF9iYWNrKExvYWRNZXNoKCJtb3JwaF90YXJnZXRfMS5vYmoiKSk7Cm1vcnBoVGFyZ2V0cy5wdXNoX2JhY2soTG9hZE1lc2goIm1vcnBoX3RhcmdldF8yLm9iaiIpKTsKLy8gQWRkIG1vcmUgbW9ycGggdGFyZ2V0cyBhcyBuZWVkZWQ="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>// Pseudo-code for loading a mesh and its morph targets
Mesh baseMesh = LoadMesh(&quot;base_mesh.obj&quot;);
std::vector&lt;Mesh&gt; morphTargets;
morphTargets.push_back(LoadMesh(&quot;morph_target_1.obj&quot;));
morphTargets.push_back(LoadMesh(&quot;morph_target_2.obj&quot;));
// Add more morph targets as needed</pre></div><div class='content'></div><h2><ol start="3">
<li>Setting Up the Shader</li>
</ol>
</h2>
<div class='content'><p>To perform the interpolation between the base mesh and the morph targets, you need to write a vertex shader that takes the base vertex positions and the morph target positions as inputs, along with the corresponding weights.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Ly8gVmVydGV4IFNoYWRlciBmb3IgTW9ycGggVGFyZ2V0IEFuaW1hdGlvbgpjYnVmZmVyIE1vcnBoVGFyZ2V0QnVmZmVyIDogcmVnaXN0ZXIoYjApCnsKICAgIGZsb2F0NHg0IHdvcmxkVmlld1Byb2o7CiAgICBmbG9hdCB3ZWlnaHRzW05VTV9NT1JQSF9UQVJHRVRTXTsKfTsKCnN0cnVjdCBWZXJ0ZXhJbnB1dAp7CiAgICBmbG9hdDMgcG9zaXRpb24gOiBQT1NJVElPTjsKICAgIGZsb2F0MyBub3JtYWwgOiBOT1JNQUw7CiAgICBmbG9hdDMgbW9ycGhQb3NpdGlvbnNbTlVNX01PUlBIX1RBUkdFVFNdIDogTU9SUEhfUE9TSVRJT047Cn07CgpzdHJ1Y3QgVmVydGV4T3V0cHV0CnsKICAgIGZsb2F0NCBwb3NpdGlvbiA6IFNWX1BPU0lUSU9OOwogICAgZmxvYXQzIG5vcm1hbCA6IE5PUk1BTDsKfTsKClZlcnRleE91dHB1dCBtYWluKFZlcnRleElucHV0IGlucHV0KQp7CiAgICBmbG9hdDMgZmluYWxQb3NpdGlvbiA9IGlucHV0LnBvc2l0aW9uOwogICAgZm9yIChpbnQgaSA9IDA7IGkgPCBOVU1fTU9SUEhfVEFSR0VUUzsgKytpKQogICAgewogICAgICAgIGZpbmFsUG9zaXRpb24gKz0gaW5wdXQubW9ycGhQb3NpdGlvbnNbaV0gKiB3ZWlnaHRzW2ldOwogICAgfQoKICAgIFZlcnRleE91dHB1dCBvdXRwdXQ7CiAgICBvdXRwdXQucG9zaXRpb24gPSBtdWwoZmxvYXQ0KGZpbmFsUG9zaXRpb24sIDEuMGYpLCB3b3JsZFZpZXdQcm9qKTsKICAgIG91dHB1dC5ub3JtYWwgPSBpbnB1dC5ub3JtYWw7CiAgICByZXR1cm4gb3V0cHV0Owp9"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>// Vertex Shader for Morph Target Animation
cbuffer MorphTargetBuffer : register(b0)
{
    float4x4 worldViewProj;
    float weights[NUM_MORPH_TARGETS];
};

struct VertexInput
{
    float3 position : POSITION;
    float3 normal : NORMAL;
    float3 morphPositions[NUM_MORPH_TARGETS] : MORPH_POSITION;
};

struct VertexOutput
{
    float4 position : SV_POSITION;
    float3 normal : NORMAL;
};

VertexOutput main(VertexInput input)
{
    float3 finalPosition = input.position;
    for (int i = 0; i &lt; NUM_MORPH_TARGETS; ++i)
    {
        finalPosition += input.morphPositions[i] * weights[i];
    }

    VertexOutput output;
    output.position = mul(float4(finalPosition, 1.0f), worldViewProj);
    output.normal = input.normal;
    return output;
}</pre></div><div class='content'></div><h2><ol start="4">
<li>Updating Weights</li>
</ol>
</h2>
<div class='content'><p>To animate the mesh, you need to update the weights over time. This can be done in your render loop or through an animation system.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Ly8gUHNldWRvLWNvZGUgZm9yIHVwZGF0aW5nIHdlaWdodHMKZmxvYXQgdGltZSA9IEdldFRpbWUoKTsKd2VpZ2h0c1swXSA9IHNpbih0aW1lKTsKd2VpZ2h0c1sxXSA9IGNvcyh0aW1lKTsKLy8gVXBkYXRlIG1vcmUgd2VpZ2h0cyBhcyBuZWVkZWQKCi8vIFVwZGF0ZSB0aGUgY29uc3RhbnQgYnVmZmVyIHdpdGggdGhlIG5ldyB3ZWlnaHRzCmNvbnRleHQtPlVwZGF0ZVN1YnJlc291cmNlKG1vcnBoVGFyZ2V0QnVmZmVyLCAwLCBudWxscHRyLCAmd2VpZ2h0cywgMCwgMCk7"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>// Pseudo-code for updating weights
float time = GetTime();
weights[0] = sin(time);
weights[1] = cos(time);
// Update more weights as needed

// Update the constant buffer with the new weights
context-&gt;UpdateSubresource(morphTargetBuffer, 0, nullptr, &amp;weights, 0, 0);</pre></div><div class='content'></div><h2><ol start="5">
<li>Rendering the Mesh</li>
</ol>
</h2>
<div class='content'><p>Finally, render the mesh using the updated weights and the morph target shader.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Ly8gUHNldWRvLWNvZGUgZm9yIHJlbmRlcmluZyB0aGUgbWVzaApjb250ZXh0LT5WU1NldFNoYWRlcihtb3JwaFRhcmdldFZlcnRleFNoYWRlciwgbnVsbHB0ciwgMCk7CmNvbnRleHQtPlBTU2V0U2hhZGVyKHBpeGVsU2hhZGVyLCBudWxscHRyLCAwKTsKY29udGV4dC0+RHJhd0luZGV4ZWQoaW5kZXhDb3VudCwgMCwgMCk7"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>// Pseudo-code for rendering the mesh
context-&gt;VSSetShader(morphTargetVertexShader, nullptr, 0);
context-&gt;PSSetShader(pixelShader, nullptr, 0);
context-&gt;DrawIndexed(indexCount, 0, 0);</pre></div><div class='content'></div><h1><p>Practical Exercise</p>
</h1>
<div class='content'></div><h2><p>Exercise: Implementing Morph Target Animation</p>
</h2>
<div class='content'><ol>
<li><strong>Objective</strong>: Create a DirectX application that loads a base mesh and two morph targets. Animate the mesh by interpolating between the morph targets using a sine and cosine function for the weights.</li>
<li><strong>Steps</strong>:
<ul>
<li>Load the base mesh and morph targets.</li>
<li>Set up the vertex shader to interpolate between the base mesh and morph targets.</li>
<li>Update the weights over time using sine and cosine functions.</li>
<li>Render the animated mesh.</li>
</ul>
</li>
</ol>
</div><h2><p>Solution</p>
</h2>
<div class='content'></div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Ly8gQ29tcGxldGUgY29kZSBmb3IgaW1wbGVtZW50aW5nIG1vcnBoIHRhcmdldCBhbmltYXRpb24KCi8vIExvYWQgdGhlIGJhc2UgbWVzaCBhbmQgbW9ycGggdGFyZ2V0cwpNZXNoIGJhc2VNZXNoID0gTG9hZE1lc2goImJhc2VfbWVzaC5vYmoiKTsKc3RkOjp2ZWN0b3I8TWVzaD4gbW9ycGhUYXJnZXRzOwptb3JwaFRhcmdldHMucHVzaF9iYWNrKExvYWRNZXNoKCJtb3JwaF90YXJnZXRfMS5vYmoiKSk7Cm1vcnBoVGFyZ2V0cy5wdXNoX2JhY2soTG9hZE1lc2goIm1vcnBoX3RhcmdldF8yLm9iaiIpKTsKCi8vIFNldCB1cCB0aGUgdmVydGV4IHNoYWRlcgpJRDNEMTFWZXJ0ZXhTaGFkZXIqIG1vcnBoVGFyZ2V0VmVydGV4U2hhZGVyID0gQ29tcGlsZVZlcnRleFNoYWRlcigiTW9ycGhUYXJnZXRTaGFkZXIuaGxzbCIpOwpJRDNEMTFQaXhlbFNoYWRlciogcGl4ZWxTaGFkZXIgPSBDb21waWxlUGl4ZWxTaGFkZXIoIlBpeGVsU2hhZGVyLmhsc2wiKTsKCi8vIENyZWF0ZSBhIGNvbnN0YW50IGJ1ZmZlciBmb3IgdGhlIHdlaWdodHMKSUQzRDExQnVmZmVyKiBtb3JwaFRhcmdldEJ1ZmZlcjsKRDNEMTFfQlVGRkVSX0RFU0MgYnVmZmVyRGVzYyA9IHt9OwpidWZmZXJEZXNjLlVzYWdlID0gRDNEMTFfVVNBR0VfREVGQVVMVDsKYnVmZmVyRGVzYy5CeXRlV2lkdGggPSBzaXplb2YoZmxvYXQpICogTlVNX01PUlBIX1RBUkdFVFM7CmJ1ZmZlckRlc2MuQmluZEZsYWdzID0gRDNEMTFfQklORF9DT05TVEFOVF9CVUZGRVI7CmRldmljZS0+Q3JlYXRlQnVmZmVyKCZidWZmZXJEZXNjLCBudWxscHRyLCAmbW9ycGhUYXJnZXRCdWZmZXIpOwoKLy8gTWFpbiByZW5kZXIgbG9vcAp3aGlsZSAodHJ1ZSkKewogICAgZmxvYXQgdGltZSA9IEdldFRpbWUoKTsKICAgIGZsb2F0IHdlaWdodHNbTlVNX01PUlBIX1RBUkdFVFNdID0geyBzaW4odGltZSksIGNvcyh0aW1lKSB9OwoKICAgIC8vIFVwZGF0ZSB0aGUgY29uc3RhbnQgYnVmZmVyIHdpdGggdGhlIG5ldyB3ZWlnaHRzCiAgICBjb250ZXh0LT5VcGRhdGVTdWJyZXNvdXJjZShtb3JwaFRhcmdldEJ1ZmZlciwgMCwgbnVsbHB0ciwgJndlaWdodHMsIDAsIDApOwoKICAgIC8vIFJlbmRlciB0aGUgbWVzaAogICAgY29udGV4dC0+VlNTZXRTaGFkZXIobW9ycGhUYXJnZXRWZXJ0ZXhTaGFkZXIsIG51bGxwdHIsIDApOwogICAgY29udGV4dC0+UFNTZXRTaGFkZXIocGl4ZWxTaGFkZXIsIG51bGxwdHIsIDApOwogICAgY29udGV4dC0+RHJhd0luZGV4ZWQoaW5kZXhDb3VudCwgMCwgMCk7Cn0="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>// Complete code for implementing morph target animation

// Load the base mesh and morph targets
Mesh baseMesh = LoadMesh(&quot;base_mesh.obj&quot;);
std::vector&lt;Mesh&gt; morphTargets;
morphTargets.push_back(LoadMesh(&quot;morph_target_1.obj&quot;));
morphTargets.push_back(LoadMesh(&quot;morph_target_2.obj&quot;));

// Set up the vertex shader
ID3D11VertexShader* morphTargetVertexShader = CompileVertexShader(&quot;MorphTargetShader.hlsl&quot;);
ID3D11PixelShader* pixelShader = CompilePixelShader(&quot;PixelShader.hlsl&quot;);

// Create a constant buffer for the weights
ID3D11Buffer* morphTargetBuffer;
D3D11_BUFFER_DESC bufferDesc = {};
bufferDesc.Usage = D3D11_USAGE_DEFAULT;
bufferDesc.ByteWidth = sizeof(float) * NUM_MORPH_TARGETS;
bufferDesc.BindFlags = D3D11_BIND_CONSTANT_BUFFER;
device-&gt;CreateBuffer(&amp;bufferDesc, nullptr, &amp;morphTargetBuffer);

// Main render loop
while (true)
{
    float time = GetTime();
    float weights[NUM_MORPH_TARGETS] = { sin(time), cos(time) };

    // Update the constant buffer with the new weights
    context-&gt;UpdateSubresource(morphTargetBuffer, 0, nullptr, &amp;weights, 0, 0);

    // Render the mesh
    context-&gt;VSSetShader(morphTargetVertexShader, nullptr, 0);
    context-&gt;PSSetShader(pixelShader, nullptr, 0);
    context-&gt;DrawIndexed(indexCount, 0, 0);
}</pre></div><div class='content'></div><h1><p>Common Mistakes and Tips</p>
</h1>
<div class='content'><ul>
<li><strong>Vertex Count Mismatch</strong>: Ensure that the base mesh and all morph targets have the same number of vertices. A mismatch will result in incorrect deformations.</li>
<li><strong>Weight Normalization</strong>: Weights should typically sum to 1.0 to avoid unexpected scaling of the mesh. Consider normalizing the weights if necessary.</li>
<li><strong>Performance Considerations</strong>: Morph target animation can be computationally expensive. Optimize your shaders and consider using GPU-based techniques for better performance.</li>
</ul>
</div><h1><p>Conclusion</p>
</h1>
<div class='content'><p>Morph Target Animation is a powerful technique for creating detailed and expressive animations in 3D graphics. By understanding the key concepts and following the implementation steps, you can effectively use morph targets to animate meshes in your DirectX applications. This technique is particularly useful for facial animations and other scenarios where subtle deformations are required.</p>
</div><div class='row navigation'>
	<div class='col-1 col-md-2'>
					<a href='05-03-skeletal-animation' title="Skeletal Animation">
				<span class="d-none d-md-inline">&#x25C4; Previous</span>
				<span class="d-inline d-md-none"><i class="bi bi-caret-left-square-fill"></i></span>
			</a>
			</div>
	<div class='col-10 col-md-8 text-center'>
			</div>
	<div class='col-1 col-md-2 text-end'>
					<a href='06-01-profiling-debugging' title="Profiling and Debugging">
				<span class="d-none d-md-inline">Next &#x25BA;</span>
				<span class="d-inline d-md-none"><i class="bi bi-caret-right-square-fill"></i></span>
			</a>
			</div>
</div>

			</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Advertising</h1>
			<p>This space is reserved for advertising.</p>
			<p>If you want to be a sponsor, contact us to include links in this area: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Thank you for collaborating!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. All rights reserved</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	We use cookies to improve your user experience and offer content tailored to your interests.
    <a href="#" id="btn_accept_cookies" class="button">Accept</a>
    <a href="/cookies">More Information</a>
</div>	

	</div>    
</body>
</html>
