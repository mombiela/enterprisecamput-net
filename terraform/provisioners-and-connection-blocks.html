<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Provisioners and Connection Blocks</title>

    <link rel="alternate" href="https://campusempresa.com/terraform/provisioners-and-connection-blocks" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/terraform/provisioners-and-connection-blocks" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/terraform/provisioners-and-connection-blocks" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body>
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-8 p-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo_header.png" style="visibility:hiddenxx;"></a>
			</h1>
		</div>
		<div class="col-4 p-0 text-end">
			<h2 id="main_title"><cite>Building today's and tomorrow's society</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-0 m-0 text-end">
													<b id="lit_lang_es" class="px-2">EN</b>
				|
				<a href="https://campusempresa.com/terraform/provisioners-and-connection-blocks" class="px-2">ES</a></b>
				|
				<a href="https://campusempresa.cat/terraform/provisioners-and-connection-blocks" class="px-2">CA</a>
					</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="/objective">The Project</a>
				<a href="/about">About Us</a>
				<a href="/contribute">Contribute</a>
				<a href="/donate">Donations</a>
				<a href="/licence">License</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content"><div class='row navigation'>
	<div class='col-4'>
					<a href='modules-reusable-configurations'>&#x25C4;Modules: Reusable Configurations</a>
			</div>
	<div class='col-4 text-center'>
		<a href="./" class="title">Provisioners and Connection Blocks</a>
	</div>
	<div class='col-4 text-end'>
					<a href='data-sources'>Data Sources &#x25BA;</a>
			</div>
</div>
<div class='content'><p>Provisioners and connection blocks are essential components in Terraform that allow you to execute scripts or commands on your resources and manage how Terraform connects to them. This topic will cover the basics of provisioners, how to use connection blocks, and advanced usage scenarios.</p>
</div><h1>Provisioners</h1>
<div class='content'><p>Provisioners in Terraform are used to execute scripts or commands on a local or remote machine as part of the resource creation or destruction process. They are useful for bootstrapping, configuration management, and other post-deployment tasks.</p>
</div><h2>Key Concepts</h2>
<div class='content'><ul>
<li>
<p><strong>Types of Provisioners</strong>:</p>
<ul>
<li><strong><code>local-exec</code></strong>: Executes a command on the machine running Terraform.</li>
<li><strong><code>remote-exec</code></strong>: Executes a command on a remote resource.</li>
<li><strong><code>file</code></strong>: Copies files or directories to a remote resource.</li>
</ul>
</li>
<li>
<p><strong>Lifecycle Hooks</strong>:</p>
<ul>
<li><strong><code>creation-time</code></strong>: Executes during resource creation.</li>
<li><strong><code>destroy-time</code></strong>: Executes during resource destruction.</li>
</ul>
</li>
</ul>
</div><h2>Examples</h2>
<div class='content'><h4><code>local-exec</code> Provisioner</h4>
<p>The <code>local-exec</code> provisioner runs a command locally on the machine where Terraform is executed.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("cmVzb3VyY2UgImF3c19pbnN0YW5jZSIgImV4YW1wbGUiIHsKICBhbWkgICAgICAgICAgID0gImFtaS0wYzU1YjE1OWNiZmFmZTFmMCIKICBpbnN0YW5jZV90eXBlID0gInQyLm1pY3JvIgoKICBwcm92aXNpb25lciAibG9jYWwtZXhlYyIgewogICAgY29tbWFuZCA9ICJlY2hvICR7YXdzX2luc3RhbmNlLmV4YW1wbGUucHVibGljX2lwfSA+IGlwX2FkZHJlc3MudHh0IgogIH0KfQ=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>resource &quot;aws_instance&quot; &quot;example&quot; {
  ami           = &quot;ami-0c55b159cbfafe1f0&quot;
  instance_type = &quot;t2.micro&quot;

  provisioner &quot;local-exec&quot; {
    command = &quot;echo ${aws_instance.example.public_ip} &gt; ip_address.txt&quot;
  }
}</pre></div><div class='content'><p>In this example, after the AWS instance is created, the public IP address of the instance is written to a file named <code>ip_address.txt</code> on the local machine.</p>
<h4><code>remote-exec</code> Provisioner</h4>
<p>The <code>remote-exec</code> provisioner runs commands on the remote resource.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("cmVzb3VyY2UgImF3c19pbnN0YW5jZSIgImV4YW1wbGUiIHsKICBhbWkgICAgICAgICAgID0gImFtaS0wYzU1YjE1OWNiZmFmZTFmMCIKICBpbnN0YW5jZV90eXBlID0gInQyLm1pY3JvIgoKICBjb25uZWN0aW9uIHsKICAgIHR5cGUgICAgID0gInNzaCIKICAgIHVzZXIgICAgID0gInVidW50dSIKICAgIHByaXZhdGVfa2V5ID0gZmlsZSgifi8uc3NoL2lkX3JzYSIpCiAgICBob3N0ICAgICA9IHNlbGYucHVibGljX2lwCiAgfQoKICBwcm92aXNpb25lciAicmVtb3RlLWV4ZWMiIHsKICAgIGlubGluZSA9IFsKICAgICAgInN1ZG8gYXB0LWdldCB1cGRhdGUiLAogICAgICAic3VkbyBhcHQtZ2V0IGluc3RhbGwgLXkgbmdpbngiCiAgICBdCiAgfQp9"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>resource &quot;aws_instance&quot; &quot;example&quot; {
  ami           = &quot;ami-0c55b159cbfafe1f0&quot;
  instance_type = &quot;t2.micro&quot;

  connection {
    type     = &quot;ssh&quot;
    user     = &quot;ubuntu&quot;
    private_key = file(&quot;~/.ssh/id_rsa&quot;)
    host     = self.public_ip
  }

  provisioner &quot;remote-exec&quot; {
    inline = [
      &quot;sudo apt-get update&quot;,
      &quot;sudo apt-get install -y nginx&quot;
    ]
  }
}</pre></div><div class='content'><p>In this example, after the AWS instance is created, the <code>remote-exec</code> provisioner connects to the instance via SSH and installs Nginx.</p>
</div><h1>Connection Blocks</h1>
<div class='content'><p>Connection blocks define how Terraform connects to the remote resource. They are used in conjunction with provisioners to specify connection details such as the type of connection, user credentials, and host information.</p>
</div><h2>Key Concepts</h2>
<div class='content'><ul>
<li>
<p><strong>Connection Types</strong>:</p>
<ul>
<li><strong><code>ssh</code></strong>: Connects via SSH.</li>
<li><strong><code>winrm</code></strong>: Connects via Windows Remote Management.</li>
</ul>
</li>
<li>
<p><strong>Connection Attributes</strong>:</p>
<ul>
<li><strong><code>type</code></strong>: The type of connection (e.g., <code>ssh</code> or <code>winrm</code>).</li>
<li><strong><code>user</code></strong>: The username for the connection.</li>
<li><strong><code>password</code></strong>: The password for the connection (if applicable).</li>
<li><strong><code>private_key</code></strong>: The private key for SSH connections.</li>
<li><strong><code>host</code></strong>: The hostname or IP address of the remote resource.</li>
</ul>
</li>
</ul>
</div><h2>Example</h2>
<div class='content'><h4>SSH Connection Block</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("cmVzb3VyY2UgImF3c19pbnN0YW5jZSIgImV4YW1wbGUiIHsKICBhbWkgICAgICAgICAgID0gImFtaS0wYzU1YjE1OWNiZmFmZTFmMCIKICBpbnN0YW5jZV90eXBlID0gInQyLm1pY3JvIgoKICBjb25uZWN0aW9uIHsKICAgIHR5cGUgICAgID0gInNzaCIKICAgIHVzZXIgICAgID0gInVidW50dSIKICAgIHByaXZhdGVfa2V5ID0gZmlsZSgifi8uc3NoL2lkX3JzYSIpCiAgICBob3N0ICAgICA9IHNlbGYucHVibGljX2lwCiAgfQoKICBwcm92aXNpb25lciAicmVtb3RlLWV4ZWMiIHsKICAgIGlubGluZSA9IFsKICAgICAgInN1ZG8gYXB0LWdldCB1cGRhdGUiLAogICAgICAic3VkbyBhcHQtZ2V0IGluc3RhbGwgLXkgbmdpbngiCiAgICBdCiAgfQp9"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>resource &quot;aws_instance&quot; &quot;example&quot; {
  ami           = &quot;ami-0c55b159cbfafe1f0&quot;
  instance_type = &quot;t2.micro&quot;

  connection {
    type     = &quot;ssh&quot;
    user     = &quot;ubuntu&quot;
    private_key = file(&quot;~/.ssh/id_rsa&quot;)
    host     = self.public_ip
  }

  provisioner &quot;remote-exec&quot; {
    inline = [
      &quot;sudo apt-get update&quot;,
      &quot;sudo apt-get install -y nginx&quot;
    ]
  }
}</pre></div><div class='content'><p>In this example, the connection block specifies that Terraform should connect to the AWS instance using SSH with the provided user and private key.</p>
</div><h1>Advanced Usage</h1>
<div class='content'></div><h2>Multiple Provisioners</h2>
<div class='content'><p>You can use multiple provisioners within a single resource to perform a series of tasks.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("cmVzb3VyY2UgImF3c19pbnN0YW5jZSIgImV4YW1wbGUiIHsKICBhbWkgICAgICAgICAgID0gImFtaS0wYzU1YjE1OWNiZmFmZTFmMCIKICBpbnN0YW5jZV90eXBlID0gInQyLm1pY3JvIgoKICBjb25uZWN0aW9uIHsKICAgIHR5cGUgICAgID0gInNzaCIKICAgIHVzZXIgICAgID0gInVidW50dSIKICAgIHByaXZhdGVfa2V5ID0gZmlsZSgifi8uc3NoL2lkX3JzYSIpCiAgICBob3N0ICAgICA9IHNlbGYucHVibGljX2lwCiAgfQoKICBwcm92aXNpb25lciAicmVtb3RlLWV4ZWMiIHsKICAgIGlubGluZSA9IFsKICAgICAgInN1ZG8gYXB0LWdldCB1cGRhdGUiLAogICAgICAic3VkbyBhcHQtZ2V0IGluc3RhbGwgLXkgbmdpbngiCiAgICBdCiAgfQoKICBwcm92aXNpb25lciAiZmlsZSIgewogICAgc291cmNlICAgICAgPSAiaW5kZXguaHRtbCIKICAgIGRlc3RpbmF0aW9uID0gIi92YXIvd3d3L2h0bWwvaW5kZXguaHRtbCIKICB9Cn0="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>resource &quot;aws_instance&quot; &quot;example&quot; {
  ami           = &quot;ami-0c55b159cbfafe1f0&quot;
  instance_type = &quot;t2.micro&quot;

  connection {
    type     = &quot;ssh&quot;
    user     = &quot;ubuntu&quot;
    private_key = file(&quot;~/.ssh/id_rsa&quot;)
    host     = self.public_ip
  }

  provisioner &quot;remote-exec&quot; {
    inline = [
      &quot;sudo apt-get update&quot;,
      &quot;sudo apt-get install -y nginx&quot;
    ]
  }

  provisioner &quot;file&quot; {
    source      = &quot;index.html&quot;
    destination = &quot;/var/www/html/index.html&quot;
  }
}</pre></div><div class='content'><p>In this example, the first provisioner installs Nginx, and the second provisioner copies an <code>index.html</code> file to the web server's root directory.</p>
</div><h2>Error Handling</h2>
<div class='content'><p>You can control the behavior of provisioners in case of errors using the <code>on_failure</code> attribute.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("cmVzb3VyY2UgImF3c19pbnN0YW5jZSIgImV4YW1wbGUiIHsKICBhbWkgICAgICAgICAgID0gImFtaS0wYzU1YjE1OWNiZmFmZTFmMCIKICBpbnN0YW5jZV90eXBlID0gInQyLm1pY3JvIgoKICBjb25uZWN0aW9uIHsKICAgIHR5cGUgICAgID0gInNzaCIKICAgIHVzZXIgICAgID0gInVidW50dSIKICAgIHByaXZhdGVfa2V5ID0gZmlsZSgifi8uc3NoL2lkX3JzYSIpCiAgICBob3N0ICAgICA9IHNlbGYucHVibGljX2lwCiAgfQoKICBwcm92aXNpb25lciAicmVtb3RlLWV4ZWMiIHsKICAgIGlubGluZSA9IFsKICAgICAgInN1ZG8gYXB0LWdldCB1cGRhdGUiLAogICAgICAic3VkbyBhcHQtZ2V0IGluc3RhbGwgLXkgbmdpbngiCiAgICBdCiAgICBvbl9mYWlsdXJlID0gImNvbnRpbnVlIgogIH0KfQ=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>resource &quot;aws_instance&quot; &quot;example&quot; {
  ami           = &quot;ami-0c55b159cbfafe1f0&quot;
  instance_type = &quot;t2.micro&quot;

  connection {
    type     = &quot;ssh&quot;
    user     = &quot;ubuntu&quot;
    private_key = file(&quot;~/.ssh/id_rsa&quot;)
    host     = self.public_ip
  }

  provisioner &quot;remote-exec&quot; {
    inline = [
      &quot;sudo apt-get update&quot;,
      &quot;sudo apt-get install -y nginx&quot;
    ]
    on_failure = &quot;continue&quot;
  }
}</pre></div><div class='content'><p>In this example, if the <code>remote-exec</code> provisioner fails, Terraform will continue with the next steps instead of stopping.</p>
</div><h1>Summary</h1>
<div class='content'><p>Provisioners and connection blocks are powerful tools in Terraform that allow you to execute scripts and commands on your resources, both locally and remotely. By understanding how to use these components effectively, you can automate complex deployment and configuration tasks, ensuring that your infrastructure is set up exactly as needed. Remember to handle errors gracefully and use multiple provisioners when necessary to perform a series of tasks.</p>
</div><div class='row navigation'>
	<div class='col-4'>
					<a href='modules-reusable-configurations'>&#x25C4;Modules: Reusable Configurations</a>
			</div>
	<div class='col-4 text-center'>
		<a href="./" class="title">Provisioners and Connection Blocks</a>
	</div>
	<div class='col-4 text-end'>
					<a href='data-sources'>Data Sources &#x25BA;</a>
			</div>
</div>
</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Advertising</h1>
			<p>This space is reserved for advertising.</p>
			<p>If you want to be a sponsor, contact us to include links in this area: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Thank you for collaborating!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. All rights reserved</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir galetes per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Entès!</a>
    <a href="/cookies">Més informació</a>
</div>	

	</div>    
</body>
</html>
