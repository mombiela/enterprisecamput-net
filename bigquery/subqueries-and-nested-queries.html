<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Subqueries and Nested Queries in BigQuery</title>

    <link rel="alternate" href="https://campusempresa.com/bigquery/subqueries-and-nested-queries" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/bigquery/subqueries-and-nested-queries" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/bigquery/subqueries-and-nested-queries" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body>
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-8 p-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo_header.png" style="visibility:hiddenxx;"></a>
			</h1>
		</div>
		<div class="col-4 p-0 text-end">
			<h2 id="main_title"><cite>Building today's and tomorrow's society</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-0 m-0 text-end">
													<b id="lit_lang_es" class="px-2">EN</b>
				|
				<a href="https://campusempresa.com/bigquery/subqueries-and-nested-queries" class="px-2">ES</a></b>
				|
				<a href="https://campusempresa.cat/bigquery/subqueries-and-nested-queries" class="px-2">CA</a>
					</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="/objective">The Project</a>
				<a href="/about">About Us</a>
				<a href="/contribute">Contribute</a>
				<a href="/donate">Donations</a>
				<a href="/licence">License</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content"><div class='row navigation'>
	<div class='col-4'>
					<a href='joins-and-unions'>&#x25C4;Joins and Unions</a>
			</div>
	<div class='col-4 text-center'>
		<a href="./" class="title">Subqueries and Nested Queries in BigQuery</a>
	</div>
	<div class='col-4 text-end'>
					<a href='common-table-expressions'>Common Table Expressions (CTEs) &#x25BA;</a>
			</div>
</div>
<div class='content'></div><h1>Introduction</h1>
<div class='content'><p>Subqueries and nested queries are powerful tools in SQL that allow you to perform complex data retrieval operations. In BigQuery, these concepts are essential for writing efficient and readable queries. This section will guide you from the basics to advanced usage of subqueries and nested queries in BigQuery.</p>
</div><h1>What are Subqueries?</h1>
<div class='content'><p>A subquery is a query nested inside another query. It can be used in various parts of a SQL statement, such as the SELECT, FROM, WHERE, and HAVING clauses.</p>
</div><h2>Key Concepts</h2>
<div class='content'><ul>
<li><strong>Inner Query</strong>: The query inside the main query.</li>
<li><strong>Outer Query</strong>: The main query that contains the subquery.</li>
<li><strong>Correlated Subquery</strong>: A subquery that references columns from the outer query.</li>
</ul>
</div><h2>Basic Example</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("U0VMRUNUIG5hbWUKRlJPTSBgYmlncXVlcnktcHVibGljLWRhdGEudXNhX25hbWVzLnVzYV8xOTEwXzIwMTNgCldIRVJFIHN0YXRlID0gJ1RYJwpBTkQgeWVhciA9IChTRUxFQ1QgTUFYKHllYXIpIEZST00gYGJpZ3F1ZXJ5LXB1YmxpYy1kYXRhLnVzYV9uYW1lcy51c2FfMTkxMF8yMDEzYCBXSEVSRSBzdGF0ZSA9ICdUWCcpOw=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>SELECT name
FROM `bigquery-public-data.usa_names.usa_1910_2013`
WHERE state = 'TX'
AND year = (SELECT MAX(year) FROM `bigquery-public-data.usa_names.usa_1910_2013` WHERE state = 'TX');</pre></div><div class='content'><ul>
<li><strong>Explanation</strong>: This query retrieves the names from the Texas state for the most recent year available in the dataset.</li>
</ul>
</div><h1>Types of Subqueries</h1>
<h2>Scalar Subqueries</h2>
<div class='content'><p>A scalar subquery returns a single value. It can be used in places where a single value is expected.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("U0VMRUNUIG5hbWUsIHllYXIKRlJPTSBgYmlncXVlcnktcHVibGljLWRhdGEudXNhX25hbWVzLnVzYV8xOTEwXzIwMTNgCldIRVJFIHllYXIgPSAoU0VMRUNUIE1BWCh5ZWFyKSBGUk9NIGBiaWdxdWVyeS1wdWJsaWMtZGF0YS51c2FfbmFtZXMudXNhXzE5MTBfMjAxM2ApOw=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>SELECT name, year
FROM `bigquery-public-data.usa_names.usa_1910_2013`
WHERE year = (SELECT MAX(year) FROM `bigquery-public-data.usa_names.usa_1910_2013`);</pre></div><div class='content'><ul>
<li><strong>Explanation</strong>: This query retrieves names and years where the year is the maximum year in the dataset.</li>
</ul>
</div><h2>Correlated Subqueries</h2>
<div class='content'><p>A correlated subquery references columns from the outer query. It is evaluated once for each row processed by the outer query.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("U0VMRUNUIG5hbWUsIHllYXIsIHN0YXRlCkZST00gYGJpZ3F1ZXJ5LXB1YmxpYy1kYXRhLnVzYV9uYW1lcy51c2FfMTkxMF8yMDEzYCBBUyBvdXRlcgpXSEVSRSB5ZWFyID0gKFNFTEVDVCBNQVgoeWVhcikgRlJPTSBgYmlncXVlcnktcHVibGljLWRhdGEudXNhX25hbWVzLnVzYV8xOTEwXzIwMTNgIEFTIGlubmVyIFdIRVJFIGlubmVyLnN0YXRlID0gb3V0ZXIuc3RhdGUpOw=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>SELECT name, year, state
FROM `bigquery-public-data.usa_names.usa_1910_2013` AS outer
WHERE year = (SELECT MAX(year) FROM `bigquery-public-data.usa_names.usa_1910_2013` AS inner WHERE inner.state = outer.state);</pre></div><div class='content'><ul>
<li><strong>Explanation</strong>: This query retrieves names, years, and states where the year is the maximum year for each state.</li>
</ul>
</div><h1>Nested Queries</h1>
<div class='content'><p>Nested queries are subqueries that are used within another query. They can be used to break down complex queries into simpler parts.</p>
</div><h2>Using Nested Queries in the FROM Clause</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("U0VMRUNUIHN0YXRlLCBBVkcoeWVhcikgQVMgYXZnX3llYXIKRlJPTSAoCiAgU0VMRUNUIHN0YXRlLCB5ZWFyCiAgRlJPTSBgYmlncXVlcnktcHVibGljLWRhdGEudXNhX25hbWVzLnVzYV8xOTEwXzIwMTNgCiAgV0hFUkUgbmFtZSA9ICdKb2huJwopCkdST1VQIEJZIHN0YXRlOw=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>SELECT state, AVG(year) AS avg_year
FROM (
  SELECT state, year
  FROM `bigquery-public-data.usa_names.usa_1910_2013`
  WHERE name = 'John'
)
GROUP BY state;</pre></div><div class='content'><ul>
<li><strong>Explanation</strong>: This query first selects the state and year for the name 'John' and then calculates the average year for each state.</li>
</ul>
</div><h2>Using Nested Queries in the SELECT Clause</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("U0VMRUNUIG5hbWUsCiAgKFNFTEVDVCBNQVgoeWVhcikgRlJPTSBgYmlncXVlcnktcHVibGljLWRhdGEudXNhX25hbWVzLnVzYV8xOTEwXzIwMTNgIFdIRVJFIHN0YXRlID0gJ1RYJykgQVMgbWF4X3llYXIKRlJPTSBgYmlncXVlcnktcHVibGljLWRhdGEudXNhX25hbWVzLnVzYV8xOTEwXzIwMTNgCldIRVJFIHN0YXRlID0gJ1RYJzs="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>SELECT name,
  (SELECT MAX(year) FROM `bigquery-public-data.usa_names.usa_1910_2013` WHERE state = 'TX') AS max_year
FROM `bigquery-public-data.usa_names.usa_1910_2013`
WHERE state = 'TX';</pre></div><div class='content'><ul>
<li><strong>Explanation</strong>: This query selects names and the maximum year for the state of Texas.</li>
</ul>
</div><h1>Advanced Usage</h1>
<h2>Combining Multiple Subqueries</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("U0VMRUNUIG5hbWUsIHllYXIsIHN0YXRlCkZST00gYGJpZ3F1ZXJ5LXB1YmxpYy1kYXRhLnVzYV9uYW1lcy51c2FfMTkxMF8yMDEzYApXSEVSRSB5ZWFyID0gKFNFTEVDVCBNQVgoeWVhcikgRlJPTSBgYmlncXVlcnktcHVibGljLWRhdGEudXNhX25hbWVzLnVzYV8xOTEwXzIwMTNgKQpBTkQgc3RhdGUgSU4gKFNFTEVDVCBESVNUSU5DVCBzdGF0ZSBGUk9NIGBiaWdxdWVyeS1wdWJsaWMtZGF0YS51c2FfbmFtZXMudXNhXzE5MTBfMjAxM2AgV0hFUkUgbmFtZSA9ICdKb2huJyk7"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>SELECT name, year, state
FROM `bigquery-public-data.usa_names.usa_1910_2013`
WHERE year = (SELECT MAX(year) FROM `bigquery-public-data.usa_names.usa_1910_2013`)
AND state IN (SELECT DISTINCT state FROM `bigquery-public-data.usa_names.usa_1910_2013` WHERE name = 'John');</pre></div><div class='content'><ul>
<li><strong>Explanation</strong>: This query retrieves names, years, and states where the year is the maximum year and the state is one where the name 'John' appears.</li>
</ul>
</div><h2>Performance Considerations</h2>
<div class='content'><ul>
<li><strong>Indexes</strong>: Ensure that the columns used in subqueries are indexed for better performance.</li>
<li><strong>Query Optimization</strong>: Use EXPLAIN to understand the query execution plan and optimize accordingly.</li>
<li><strong>Avoiding Correlated Subqueries</strong>: Where possible, avoid correlated subqueries as they can be less efficient.</li>
</ul>
</div><h1>Conclusion</h1>
<div class='content'><p>Subqueries and nested queries are essential for writing complex and efficient SQL queries in BigQuery. Understanding how to use them effectively can greatly enhance your data retrieval capabilities. Practice writing different types of subqueries and nested queries to become proficient in their usage.</p>
</div><div class='row navigation'>
	<div class='col-4'>
					<a href='joins-and-unions'>&#x25C4;Joins and Unions</a>
			</div>
	<div class='col-4 text-center'>
		<a href="./" class="title">Subqueries and Nested Queries in BigQuery</a>
	</div>
	<div class='col-4 text-end'>
					<a href='common-table-expressions'>Common Table Expressions (CTEs) &#x25BA;</a>
			</div>
</div>
</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Advertising</h1>
			<p>This space is reserved for advertising.</p>
			<p>If you want to be a sponsor, contact us to include links in this area: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Thank you for collaborating!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. All rights reserved</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir galetes per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Entès!</a>
    <a href="/cookies">Més informació</a>
</div>	

	</div>    
</body>
</html>
