<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ray Tracing with DirectX</title>

    <link rel="alternate" href="https://campusempresa.com/direct_x/ray-tracing-with-directx" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/direct_x/ray-tracing-with-directx" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/direct_x/ray-tracing-with-directx" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body>
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-8 p-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo_header.png" style="visibility:hiddenxx;"></a>
			</h1>
		</div>
		<div class="col-4 p-0 text-end">
			<h2 id="main_title"><cite>Building today's and tomorrow's society</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-0 m-0 text-end">
													<b id="lit_lang_es" class="px-2">EN</b>
				|
				<a href="https://campusempresa.com/direct_x/ray-tracing-with-directx" class="px-2">ES</a></b>
				|
				<a href="https://campusempresa.cat/direct_x/ray-tracing-with-directx" class="px-2">CA</a>
					</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="/objective">The Project</a>
				<a href="/about">About Us</a>
				<a href="/contribute">Contribute</a>
				<a href="/donate">Donations</a>
				<a href="/licence">License</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content"><div class='row navigation'>
	<div class='col-4'>
					<a href='directx-12-features'>&#x25C4;DirectX 12 Features</a>
			</div>
	<div class='col-4 text-center'>
		<a href="./" class="title">Ray Tracing with DirectX</a>
	</div>
	<div class='col-4 text-end'>
					<a href='virtual-reality-and-directx'>Virtual Reality and DirectX &#x25BA;</a>
			</div>
</div>
<div class='content'></div><h1>Introduction to Ray Tracing</h1>
<div class='content'><p>Ray tracing is a rendering technique that simulates the way light interacts with objects to produce realistic images. Unlike traditional rasterization, which processes each triangle individually, ray tracing traces the path of light rays as they travel through the scene.</p>
</div><h2>Key Concepts</h2>
<div class='content'><ul>
<li><strong>Rays</strong>: Lines that represent the path of light.</li>
<li><strong>Intersection</strong>: The point where a ray hits an object.</li>
<li><strong>Shading</strong>: Calculating the color at the intersection point.</li>
<li><strong>Reflection and Refraction</strong>: Rays bouncing off surfaces or passing through transparent materials.</li>
<li><strong>Acceleration Structures</strong>: Data structures that optimize ray-object intersection tests.</li>
</ul>
</div><h1>Setting Up DirectX for Ray Tracing</h1>
<div class='content'><p>Before diving into ray tracing, ensure you have a basic DirectX setup. This includes initializing Direct3D, creating a device, and setting up a swap chain.</p>
</div><h2>Basic DirectX Initialization</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Ly8gSW5pdGlhbGl6ZSBEaXJlY3QzRApEM0QxMkNyZWF0ZURldmljZSguLi4pOwpEM0QxMl9DT01NQU5EX1FVRVVFX0RFU0MgcXVldWVEZXNjID0ge307CklEM0QxMkNvbW1hbmRRdWV1ZSogY29tbWFuZFF1ZXVlOwpkZXZpY2UtPkNyZWF0ZUNvbW1hbmRRdWV1ZSgmcXVldWVEZXNjLCBJSURfUFBWX0FSR1MoJmNvbW1hbmRRdWV1ZSkpOwoKLy8gQ3JlYXRlIFN3YXAgQ2hhaW4KRFhHSV9TV0FQX0NIQUlOX0RFU0Mgc3dhcENoYWluRGVzYyA9IHt9OwpJRFhHSVN3YXBDaGFpbiogc3dhcENoYWluOwpmYWN0b3J5LT5DcmVhdGVTd2FwQ2hhaW4oY29tbWFuZFF1ZXVlLCAmc3dhcENoYWluRGVzYywgJnN3YXBDaGFpbik7"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>// Initialize Direct3D
D3D12CreateDevice(...);
D3D12_COMMAND_QUEUE_DESC queueDesc = {};
ID3D12CommandQueue* commandQueue;
device-&gt;CreateCommandQueue(&amp;queueDesc, IID_PPV_ARGS(&amp;commandQueue));

// Create Swap Chain
DXGI_SWAP_CHAIN_DESC swapChainDesc = {};
IDXGISwapChain* swapChain;
factory-&gt;CreateSwapChain(commandQueue, &amp;swapChainDesc, &amp;swapChain);</pre></div><div class='content'></div><h1>Implementing Ray Tracing in DirectX</h1>
<h2>Setting Up Ray Tracing Pipeline</h2>
<div class='content'><p>DirectX 12 introduces the DXR (DirectX Raytracing) API, which extends DirectX 12 to support ray tracing. The ray tracing pipeline consists of several key components:</p>
<ul>
<li><strong>Ray Generation Shader</strong>: Initiates rays.</li>
<li><strong>Intersection Shader</strong>: Determines if and where a ray intersects an object.</li>
<li><strong>Any-Hit Shader</strong>: Executes when a ray intersects any geometry.</li>
<li><strong>Closest-Hit Shader</strong>: Executes for the closest intersection.</li>
<li><strong>Miss Shader</strong>: Executes when a ray misses all geometry.</li>
</ul>
</div><h2>Creating the Ray Tracing Pipeline State Object (RTPSO)</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Ly8gRGVmaW5lIHRoZSByYXkgdHJhY2luZyBwaXBlbGluZSBzdGF0ZSBvYmplY3QgKFJUUFNPKQpEM0QxMl9TVEFURV9PQkpFQ1RfREVTQyByYXl0cmFjaW5nUGlwZWxpbmUgPSB7fTsKcmF5dHJhY2luZ1BpcGVsaW5lLlR5cGUgPSBEM0QxMl9TVEFURV9PQkpFQ1RfVFlQRV9SQVlUUkFDSU5HX1BJUEVMSU5FOwoKLy8gQWRkIHN1Ym9iamVjdHM6IHNoYWRlcnMsIHJvb3Qgc2lnbmF0dXJlcywgZXRjLgpEM0QxMl9FWFBPUlRfREVTQyBleHBvcnREZXNjID0ge307CmV4cG9ydERlc2MuTmFtZSA9IEwiUmF5R2VuU2hhZGVyIjsKZXhwb3J0RGVzYy5FeHBvcnRUb1JlbmFtZSA9IEwiUmF5R2VuU2hhZGVyIjsKcmF5dHJhY2luZ1BpcGVsaW5lLnBTdWJvYmplY3RzID0gJmV4cG9ydERlc2M7CnJheXRyYWNpbmdQaXBlbGluZS5OdW1TdWJvYmplY3RzID0gMTsKCi8vIENyZWF0ZSB0aGUgUlRQU08KSUQzRDEyU3RhdGVPYmplY3QqIHBTdGF0ZU9iamVjdDsKZGV2aWNlLT5DcmVhdGVTdGF0ZU9iamVjdCgmcmF5dHJhY2luZ1BpcGVsaW5lLCBJSURfUFBWX0FSR1MoJnBTdGF0ZU9iamVjdCkpOw=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>// Define the ray tracing pipeline state object (RTPSO)
D3D12_STATE_OBJECT_DESC raytracingPipeline = {};
raytracingPipeline.Type = D3D12_STATE_OBJECT_TYPE_RAYTRACING_PIPELINE;

// Add subobjects: shaders, root signatures, etc.
D3D12_EXPORT_DESC exportDesc = {};
exportDesc.Name = L&quot;RayGenShader&quot;;
exportDesc.ExportToRename = L&quot;RayGenShader&quot;;
raytracingPipeline.pSubobjects = &amp;exportDesc;
raytracingPipeline.NumSubobjects = 1;

// Create the RTPSO
ID3D12StateObject* pStateObject;
device-&gt;CreateStateObject(&amp;raytracingPipeline, IID_PPV_ARGS(&amp;pStateObject));</pre></div><div class='content'></div><h2>Building Acceleration Structures</h2>
<div class='content'><p>Acceleration structures are essential for efficient ray tracing. They are divided into two types: bottom-level acceleration structures (BLAS) for individual objects and top-level acceleration structures (TLAS) for the scene.</p>
<h4>Creating a Bottom-Level Acceleration Structure (BLAS)</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Ly8gRGVmaW5lIGdlb21ldHJ5IGZvciBCTEFTCkQzRDEyX1JBWVRSQUNJTkdfR0VPTUVUUllfREVTQyBnZW9tZXRyeURlc2MgPSB7fTsKZ2VvbWV0cnlEZXNjLlR5cGUgPSBEM0QxMl9SQVlUUkFDSU5HX0dFT01FVFJZX1RZUEVfVFJJQU5HTEVTOwpnZW9tZXRyeURlc2MuVHJpYW5nbGVzLlZlcnRleEJ1ZmZlci5TdGFydEFkZHJlc3MgPSB2ZXJ0ZXhCdWZmZXItPkdldEdQVVZpcnR1YWxBZGRyZXNzKCk7Cmdlb21ldHJ5RGVzYy5UcmlhbmdsZXMuVmVydGV4Q291bnQgPSB2ZXJ0ZXhDb3VudDsKCi8vIEJ1aWxkIEJMQVMKRDNEMTJfQlVJTERfUkFZVFJBQ0lOR19BQ0NFTEVSQVRJT05fU1RSVUNUVVJFX0RFU0MgYmxhc0Rlc2MgPSB7fTsKYmxhc0Rlc2MuSW5wdXRzLlR5cGUgPSBEM0QxMl9SQVlUUkFDSU5HX0FDQ0VMRVJBVElPTl9TVFJVQ1RVUkVfVFlQRV9CT1RUT01fTEVWRUw7CmJsYXNEZXNjLklucHV0cy5EZXNjc0xheW91dCA9IEQzRDEyX0VMRU1FTlRTX0xBWU9VVF9BUlJBWTsKYmxhc0Rlc2MuSW5wdXRzLnBHZW9tZXRyeURlc2NzID0gJmdlb21ldHJ5RGVzYzsKYmxhc0Rlc2MuSW5wdXRzLk51bURlc2NzID0gMTsKY29tbWFuZExpc3QtPkJ1aWxkUmF5dHJhY2luZ0FjY2VsZXJhdGlvblN0cnVjdHVyZSgmYmxhc0Rlc2MsIDAsIG51bGxwdHIpOw=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>// Define geometry for BLAS
D3D12_RAYTRACING_GEOMETRY_DESC geometryDesc = {};
geometryDesc.Type = D3D12_RAYTRACING_GEOMETRY_TYPE_TRIANGLES;
geometryDesc.Triangles.VertexBuffer.StartAddress = vertexBuffer-&gt;GetGPUVirtualAddress();
geometryDesc.Triangles.VertexCount = vertexCount;

// Build BLAS
D3D12_BUILD_RAYTRACING_ACCELERATION_STRUCTURE_DESC blasDesc = {};
blasDesc.Inputs.Type = D3D12_RAYTRACING_ACCELERATION_STRUCTURE_TYPE_BOTTOM_LEVEL;
blasDesc.Inputs.DescsLayout = D3D12_ELEMENTS_LAYOUT_ARRAY;
blasDesc.Inputs.pGeometryDescs = &amp;geometryDesc;
blasDesc.Inputs.NumDescs = 1;
commandList-&gt;BuildRaytracingAccelerationStructure(&amp;blasDesc, 0, nullptr);</pre></div><div class='content'><h4>Creating a Top-Level Acceleration Structure (TLAS)</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Ly8gRGVmaW5lIGluc3RhbmNlIGZvciBUTEFTCkQzRDEyX1JBWVRSQUNJTkdfSU5TVEFOQ0VfREVTQyBpbnN0YW5jZURlc2MgPSB7fTsKaW5zdGFuY2VEZXNjLlRyYW5zZm9ybSA9IC4uLjsgLy8gU2V0IHRoZSB0cmFuc2Zvcm1hdGlvbiBtYXRyaXgKaW5zdGFuY2VEZXNjLkluc3RhbmNlSUQgPSAwOwppbnN0YW5jZURlc2MuSW5zdGFuY2VNYXNrID0gMHhGRjsKaW5zdGFuY2VEZXNjLkFjY2VsZXJhdGlvblN0cnVjdHVyZSA9IGJsYXMtPkdldEdQVVZpcnR1YWxBZGRyZXNzKCk7CgovLyBCdWlsZCBUTEFTCkQzRDEyX0JVSUxEX1JBWVRSQUNJTkdfQUNDRUxFUkFUSU9OX1NUUlVDVFVSRV9ERVNDIHRsYXNEZXNjID0ge307CnRsYXNEZXNjLklucHV0cy5UeXBlID0gRDNEMTJfUkFZVFJBQ0lOR19BQ0NFTEVSQVRJT05fU1RSVUNUVVJFX1RZUEVfVE9QX0xFVkVMOwp0bGFzRGVzYy5JbnB1dHMuRGVzY3NMYXlvdXQgPSBEM0QxMl9FTEVNRU5UU19MQVlPVVRfQVJSQVk7CnRsYXNEZXNjLklucHV0cy5JbnN0YW5jZURlc2NzID0gaW5zdGFuY2VCdWZmZXItPkdldEdQVVZpcnR1YWxBZGRyZXNzKCk7CnRsYXNEZXNjLklucHV0cy5OdW1EZXNjcyA9IDE7CmNvbW1hbmRMaXN0LT5CdWlsZFJheXRyYWNpbmdBY2NlbGVyYXRpb25TdHJ1Y3R1cmUoJnRsYXNEZXNjLCAwLCBudWxscHRyKTs="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>// Define instance for TLAS
D3D12_RAYTRACING_INSTANCE_DESC instanceDesc = {};
instanceDesc.Transform = ...; // Set the transformation matrix
instanceDesc.InstanceID = 0;
instanceDesc.InstanceMask = 0xFF;
instanceDesc.AccelerationStructure = blas-&gt;GetGPUVirtualAddress();

// Build TLAS
D3D12_BUILD_RAYTRACING_ACCELERATION_STRUCTURE_DESC tlasDesc = {};
tlasDesc.Inputs.Type = D3D12_RAYTRACING_ACCELERATION_STRUCTURE_TYPE_TOP_LEVEL;
tlasDesc.Inputs.DescsLayout = D3D12_ELEMENTS_LAYOUT_ARRAY;
tlasDesc.Inputs.InstanceDescs = instanceBuffer-&gt;GetGPUVirtualAddress();
tlasDesc.Inputs.NumDescs = 1;
commandList-&gt;BuildRaytracingAccelerationStructure(&amp;tlasDesc, 0, nullptr);</pre></div><div class='content'></div><h1>Shaders for Ray Tracing</h1>
<div class='content'><p>Shaders are crucial in ray tracing for generating rays, handling intersections, and shading.</p>
</div><h2>Ray Generation Shader</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Ly8gUmF5IEdlbmVyYXRpb24gU2hhZGVyCltzaGFkZXIoInJheWdlbmVyYXRpb24iKV0Kdm9pZCBSYXlHZW5TaGFkZXIoKQp7CiAgICAvLyBHZW5lcmF0ZSBwcmltYXJ5IHJheXMKICAgIFJheURlc2MgcmF5OwogICAgcmF5Lk9yaWdpbiA9IGNhbWVyYVBvc2l0aW9uOwogICAgcmF5LkRpcmVjdGlvbiA9IGNhbGN1bGF0ZVJheURpcmVjdGlvbigpOwogICAgVHJhY2VSYXkodGxhcywgUkFZX0ZMQUdfTk9ORSwgMHhGRiwgMCwgMSwgMCwgcmF5LCBwYXlsb2FkKTsKfQ=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>// Ray Generation Shader
[shader(&quot;raygeneration&quot;)]
void RayGenShader()
{
    // Generate primary rays
    RayDesc ray;
    ray.Origin = cameraPosition;
    ray.Direction = calculateRayDirection();
    TraceRay(tlas, RAY_FLAG_NONE, 0xFF, 0, 1, 0, ray, payload);
}</pre></div><div class='content'></div><h2>Closest-Hit Shader</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Ly8gQ2xvc2VzdC1IaXQgU2hhZGVyCltzaGFkZXIoImNsb3Nlc3RoaXQiKV0Kdm9pZCBDbG9zZXN0SGl0U2hhZGVyKGlub3V0IFJheVBheWxvYWQgcGF5bG9hZCwgaW4gSW50ZXJzZWN0aW9uQXR0cmlidXRlcyBhdHRyaWIpCnsKICAgIC8vIENhbGN1bGF0ZSBzaGFkaW5nIGF0IHRoZSBpbnRlcnNlY3Rpb24gcG9pbnQKICAgIGZsb2F0MyBoaXRQb2ludCA9IHJheS5PcmlnaW4gKyByYXkuRGlyZWN0aW9uICogYXR0cmliLkhpdFQ7CiAgICBwYXlsb2FkLkNvbG9yID0gY2FsY3VsYXRlU2hhZGluZyhoaXRQb2ludCwgYXR0cmliLk5vcm1hbCk7Cn0="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>// Closest-Hit Shader
[shader(&quot;closesthit&quot;)]
void ClosestHitShader(inout RayPayload payload, in IntersectionAttributes attrib)
{
    // Calculate shading at the intersection point
    float3 hitPoint = ray.Origin + ray.Direction * attrib.HitT;
    payload.Color = calculateShading(hitPoint, attrib.Normal);
}</pre></div><div class='content'></div><h2>Miss Shader</h2>
<div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Ly8gTWlzcyBTaGFkZXIKW3NoYWRlcigibWlzcyIpXQp2b2lkIE1pc3NTaGFkZXIoaW5vdXQgUmF5UGF5bG9hZCBwYXlsb2FkKQp7CiAgICAvLyBTZXQgYmFja2dyb3VuZCBjb2xvcgogICAgcGF5bG9hZC5Db2xvciA9IGZsb2F0MygwLjAsIDAuMCwgMC4wKTsKfQ=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>// Miss Shader
[shader(&quot;miss&quot;)]
void MissShader(inout RayPayload payload)
{
    // Set background color
    payload.Color = float3(0.0, 0.0, 0.0);
}</pre></div><div class='content'></div><h1>Conclusion</h1>
<div class='content'><p>Ray tracing with DirectX involves setting up a specialized pipeline, creating acceleration structures, and writing shaders to handle ray generation, intersections, and shading. While it requires a more complex setup compared to traditional rasterization, the results can produce highly realistic images by accurately simulating light behavior.</p>
<p>By understanding and implementing these concepts, you can leverage the power of DirectX to create stunning visuals in your applications.</p>
</div><div class='row navigation'>
	<div class='col-4'>
					<a href='directx-12-features'>&#x25C4;DirectX 12 Features</a>
			</div>
	<div class='col-4 text-center'>
		<a href="./" class="title">Ray Tracing with DirectX</a>
	</div>
	<div class='col-4 text-end'>
					<a href='virtual-reality-and-directx'>Virtual Reality and DirectX &#x25BA;</a>
			</div>
</div>
</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Advertising</h1>
			<p>This space is reserved for advertising.</p>
			<p>If you want to be a sponsor, contact us to include links in this area: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Thank you for collaborating!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. All rights reserved</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir galetes per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Accept</a>
    <a href="/cookies">More Information</a>
</div>	

	</div>    
</body>
</html>
