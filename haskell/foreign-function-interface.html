<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Foreign Function Interface (FFI) in Haskell</title>

    <link rel="alternate" href="https://campusempresa.com/haskell/foreign-function-interface" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/haskell/foreign-function-interface" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/haskell/foreign-function-interface" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body>
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-8 p-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo_header.png" style="visibility:hiddenxx;"></a>
			</h1>
		</div>
		<div class="col-4 p-0 text-end">
			<h2 id="main_title"><cite>Building today's and tomorrow's society</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-0 m-0 text-end">
													<b id="lit_lang_es" class="px-2">EN</b>
				|
				<a href="https://campusempresa.com/haskell/foreign-function-interface" class="px-2">ES</a></b>
				|
				<a href="https://campusempresa.cat/haskell/foreign-function-interface" class="px-2">CA</a>
					</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="/objective">The Project</a>
				<a href="/about">About Us</a>
				<a href="/contribute">Contribute</a>
				<a href="/donate">Donations</a>
				<a href="/licence">License</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content"><div class='row navigation'>
	<div class='col-4'>
					<a href='concurrency-parallelism'>&#x25C4;Concurrency and Parallelism</a>
			</div>
	<div class='col-4 text-center'>
		<a href="./" class="title">Foreign Function Interface (FFI) in Haskell</a>
	</div>
	<div class='col-4 text-end'>
					<a href='template-haskell'>Template Haskell &#x25BA;</a>
			</div>
</div>
<div class='content'></div><h1>Introduction to FFI</h1>
<div class='content'><p>Foreign Function Interface (FFI) allows Haskell programs to call functions written in other programming languages, such as C. This is particularly useful for leveraging existing libraries, optimizing performance-critical sections, or interfacing with system-level APIs.</p>
</div><h2>Key Concepts</h2>
<div class='content'><ul>
<li><strong>Foreign Imports</strong>: Declaring external functions in Haskell.</li>
<li><strong>Foreign Exports</strong>: Making Haskell functions available to other languages.</li>
<li><strong>Marshalling</strong>: Converting data between Haskell and the foreign language.</li>
</ul>
</div><h1>Foreign Imports</h1>
<div class='content'></div><h2>Declaring External Functions</h2>
<div class='content'><p>To call a function written in C from Haskell, you need to declare it using the <code>foreign import</code> keyword.</p>
<h4>Example: Importing a C Function</h4>
<p>Suppose you have a C function <code>int add(int a, int b)</code>:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Ly8gYWRkLmMKI2luY2x1ZGUgPHN0ZGlvLmg+CgppbnQgYWRkKGludCBhLCBpbnQgYikgewogICAgcmV0dXJuIGEgKyBiOwp9"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>// add.c
#include &lt;stdio.h&gt;

int add(int a, int b) {
    return a + b;
}</pre></div><div class='content'><p>You can import this function into Haskell as follows:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("LS0gQWRkLmhzCnstIyBMQU5HVUFHRSBGb3JlaWduRnVuY3Rpb25JbnRlcmZhY2UgIy19Cgptb2R1bGUgQWRkIHdoZXJlCgpmb3JlaWduIGltcG9ydCBjY2FsbCAiYWRkIiBjX2FkZCA6OiBJbnQgLT4gSW50IC0+IEludAoKbWFpbiA6OiBJTyAoKQptYWluID0gZG8KICAgIGxldCByZXN1bHQgPSBjX2FkZCA1IDMKICAgIHB1dFN0ckxuICQgIlRoZSByZXN1bHQgaXM6ICIgKysgc2hvdyhyZXN1bHQp"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>-- Add.hs
{-# LANGUAGE ForeignFunctionInterface #-}

module Add where

foreign import ccall &quot;add&quot; c_add :: Int -&gt; Int -&gt; Int

main :: IO ()
main = do
    let result = c_add 5 3
    putStrLn $ &quot;The result is: &quot; ++ show(result)</pre></div><div class='content'></div><h2>Explanation</h2>
<div class='content'><ul>
<li><code>foreign import ccall &quot;add&quot;</code>: Indicates that we are importing a C function named <code>add</code>.</li>
<li><code>c_add :: Int -&gt; Int -&gt; Int</code>: Specifies the Haskell type signature for the imported function.</li>
</ul>
</div><h1>Foreign Exports</h1>
<div class='content'></div><h2>Making Haskell Functions Available to C</h2>
<div class='content'><p>You can also make Haskell functions callable from C using the <code>foreign export</code> keyword.</p>
<h4>Example: Exporting a Haskell Function</h4>
<p>Suppose you have a Haskell function <code>multiply</code>:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("LS0gTXVsdGlwbHkuaHMKey0jIExBTkdVQUdFIEZvcmVpZ25GdW5jdGlvbkludGVyZmFjZSAjLX0KCm1vZHVsZSBNdWx0aXBseSB3aGVyZQoKZm9yZWlnbiBleHBvcnQgY2NhbGwgbXVsdGlwbHkgOjogSW50IC0+IEludCAtPiBJbnQKCm11bHRpcGx5IDo6IEludCAtPiBJbnQgLT4gSW50Cm11bHRpcGx5IGEgYiA9IGEgKiBi"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>-- Multiply.hs
{-# LANGUAGE ForeignFunctionInterface #-}

module Multiply where

foreign export ccall multiply :: Int -&gt; Int -&gt; Int

multiply :: Int -&gt; Int -&gt; Int
multiply a b = a * b</pre></div><div class='content'></div><h2>Explanation</h2>
<div class='content'><ul>
<li><code>foreign export ccall multiply</code>: Indicates that we are exporting the Haskell function <code>multiply</code> to be callable from C.</li>
<li><code>multiply :: Int -&gt; Int -&gt; Int</code>: Specifies the Haskell function to be exported.</li>
</ul>
</div><h1>Marshalling Data</h1>
<div class='content'></div><h2>Converting Data Types</h2>
<div class='content'><p>When interfacing with foreign functions, you often need to convert data between Haskell and the foreign language. This process is known as marshalling.</p>
<h4>Example: Marshalling Strings</h4>
<p>Consider a C function that takes a string:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("Ly8gZ3JlZXQuYwojaW5jbHVkZSA8c3RkaW8uaD4KCnZvaWQgZ3JlZXQoY29uc3QgY2hhciogbmFtZSkgewogICAgcHJpbnRmKCJIZWxsbywgJXMhXG4iLCBuYW1lKTsKfQ=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>// greet.c
#include &lt;stdio.h&gt;

void greet(const char* name) {
    printf(&quot;Hello, %s!\n&quot;, name);
}</pre></div><div class='content'><p>You can call this function from Haskell by marshalling a Haskell <code>String</code> to a C string (<code>CString</code>):</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("LS0gR3JlZXQuaHMKey0jIExBTkdVQUdFIEZvcmVpZ25GdW5jdGlvbkludGVyZmFjZSAjLX0KCm1vZHVsZSBHcmVldCB3aGVyZQoKaW1wb3J0IEZvcmVpZ24uQy5TdHJpbmcgKENTdHJpbmcsIHdpdGhDU3RyaW5nKQoKZm9yZWlnbiBpbXBvcnQgY2NhbGwgImdyZWV0IiBjX2dyZWV0IDo6IENTdHJpbmcgLT4gSU8gKCkKCmdyZWV0IDo6IFN0cmluZyAtPiBJTyAoKQpncmVldCBuYW1lID0gd2l0aENTdHJpbmcgbmFtZSBjX2dyZWV0CgptYWluIDo6IElPICgpCm1haW4gPSBncmVldCAiSGFza2VsbCI="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>-- Greet.hs
{-# LANGUAGE ForeignFunctionInterface #-}

module Greet where

import Foreign.C.String (CString, withCString)

foreign import ccall &quot;greet&quot; c_greet :: CString -&gt; IO ()

greet :: String -&gt; IO ()
greet name = withCString name c_greet

main :: IO ()
main = greet &quot;Haskell&quot;</pre></div><div class='content'></div><h2>Explanation</h2>
<div class='content'><ul>
<li><code>import Foreign.C.String (CString, withCString)</code>: Imports necessary functions for string marshalling.</li>
<li><code>withCString name c_greet</code>: Converts the Haskell <code>String</code> to a <code>CString</code> and calls the C function.</li>
</ul>
</div><h1>Conclusion</h1>
<div class='content'><p>The Foreign Function Interface (FFI) in Haskell is a powerful feature that allows you to call functions written in other languages and make Haskell functions available to those languages. By understanding how to declare foreign imports and exports, and how to marshal data between Haskell and the foreign language, you can extend the capabilities of your Haskell programs and integrate them with a wide range of external libraries and systems.</p>
</div><div class='row navigation'>
	<div class='col-4'>
					<a href='concurrency-parallelism'>&#x25C4;Concurrency and Parallelism</a>
			</div>
	<div class='col-4 text-center'>
		<a href="./" class="title">Foreign Function Interface (FFI) in Haskell</a>
	</div>
	<div class='col-4 text-end'>
					<a href='template-haskell'>Template Haskell &#x25BA;</a>
			</div>
</div>
</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Advertising</h1>
			<p>This space is reserved for advertising.</p>
			<p>If you want to be a sponsor, contact us to include links in this area: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Thank you for collaborating!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. All rights reserved</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir galetes per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Accept</a>
    <a href="/cookies">More Information</a>
</div>	

	</div>    
</body>
</html>
