<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aggregation Pipeline</title>

    <link rel="alternate" href="https://campusempresa.com/mongodb/aggregation-pipeline" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/mongodb/aggregation-pipeline" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/mongodb/aggregation-pipeline" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body>
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-8 p-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo_header.png" style="visibility:hiddenxx;"></a>
			</h1>
		</div>
		<div class="col-4 p-0 text-end">
			<h2 id="main_title"><cite>Building today's and tomorrow's society</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-0 m-0 text-end">
													<b id="lit_lang_es" class="px-2">EN</b>
				|
				<a href="https://campusempresa.com/mongodb/aggregation-pipeline" class="px-2">ES</a></b>
				|
				<a href="https://campusempresa.cat/mongodb/aggregation-pipeline" class="px-2">CA</a>
					</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="/objective">The Project</a>
				<a href="/about">About Us</a>
				<a href="/contribute">Contribute</a>
				<a href="/donate">Donations</a>
				<a href="/licence">License</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content"><div class='row navigation'>
	<div class='col-4'>
					<a href='introduction-to-aggregation'>&#x25C4;Introduction to Aggregation</a>
			</div>
	<div class='col-4 text-center'>
		<a href="./" class="title">Aggregation Pipeline</a>
	</div>
	<div class='col-4 text-end'>
					<a href='common-aggregation-stages'>Common Aggregation Stages &#x25BA;</a>
			</div>
</div>
<div class='content'></div><h1>Introduction to Aggregation Pipeline</h1>
<div class='content'><p>The Aggregation Pipeline is a powerful framework in MongoDB for data aggregation, allowing you to process data records and return computed results. It is similar to the concept of data processing pipelines in Unix-like systems, where data is passed through a series of stages, each performing a specific operation.</p>
</div><h2>Key Concepts</h2>
<div class='content'><ul>
<li><strong>Stages</strong>: Each stage in the pipeline performs an operation on the input documents and passes the result to the next stage.</li>
<li><strong>Operators</strong>: Operators define the operations to be performed on the data within each stage.</li>
<li><strong>Pipeline</strong>: A sequence of stages through which the data flows.</li>
</ul>
</div><h1>Basic Stages in Aggregation Pipeline</h1>
<h2>$match</h2>
<div class='content'><p>Filters the documents to pass only those that match the specified condition(s) to the next stage.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ZGIub3JkZXJzLmFnZ3JlZ2F0ZShbCiAgeyAkbWF0Y2g6IHsgc3RhdHVzOiAiQSIgfSB9Cl0p"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>db.orders.aggregate([
  { $match: { status: &quot;A&quot; } }
])</pre></div><div class='content'><p><em>Example</em>: This stage filters documents where the <code>status</code> field is &quot;A&quot;.</p>
</div><h2>$group</h2>
<div class='content'><p>Groups input documents by a specified identifier expression and applies the accumulator expressions to each group.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ZGIub3JkZXJzLmFnZ3JlZ2F0ZShbCiAgeyAkZ3JvdXA6IHsgX2lkOiAiJGN1c3RfaWQiLCB0b3RhbDogeyAkc3VtOiAiJGFtb3VudCIgfSB9IH0KXSk="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>db.orders.aggregate([
  { $group: { _id: &quot;$cust_id&quot;, total: { $sum: &quot;$amount&quot; } } }
])</pre></div><div class='content'><p><em>Example</em>: This stage groups documents by <code>cust_id</code> and calculates the total amount for each customer.</p>
</div><h2>$project</h2>
<div class='content'><p>Reshapes each document in the stream, such as by adding new fields or removing existing fields.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ZGIub3JkZXJzLmFnZ3JlZ2F0ZShbCiAgeyAkcHJvamVjdDogeyBpdGVtOiAxLCB0b3RhbDogeyAkbXVsdGlwbHk6IFsiJHByaWNlIiwgIiRxdWFudGl0eSJdIH0gfSB9Cl0p"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>db.orders.aggregate([
  { $project: { item: 1, total: { $multiply: [&quot;$price&quot;, &quot;$quantity&quot;] } } }
])</pre></div><div class='content'><p><em>Example</em>: This stage projects the <code>item</code> field and calculates a new <code>total</code> field by multiplying <code>price</code> and <code>quantity</code>.</p>
</div><h2>$sort</h2>
<div class='content'><p>Sorts all input documents and returns them to the pipeline in sorted order.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ZGIub3JkZXJzLmFnZ3JlZ2F0ZShbCiAgeyAkc29ydDogeyB0b3RhbDogLTEgfSB9Cl0p"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>db.orders.aggregate([
  { $sort: { total: -1 } }
])</pre></div><div class='content'><p><em>Example</em>: This stage sorts the documents by the <code>total</code> field in descending order.</p>
</div><h2>$limit</h2>
<div class='content'><p>Limits the number of documents passed to the next stage.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ZGIub3JkZXJzLmFnZ3JlZ2F0ZShbCiAgeyAkbGltaXQ6IDUgfQpdKQ=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>db.orders.aggregate([
  { $limit: 5 }
])</pre></div><div class='content'><p><em>Example</em>: This stage limits the output to the first 5 documents.</p>
</div><h2>$skip</h2>
<div class='content'><p>Skips the first N documents and passes the remaining documents to the next stage.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ZGIub3JkZXJzLmFnZ3JlZ2F0ZShbCiAgeyAkc2tpcDogMTAgfQpdKQ=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>db.orders.aggregate([
  { $skip: 10 }
])</pre></div><div class='content'><p><em>Example</em>: This stage skips the first 10 documents.</p>
</div><h1>Advanced Stages and Operators</h1>
<h2>$unwind</h2>
<div class='content'><p>Deconstructs an array field from the input documents to output a document for each element.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ZGIub3JkZXJzLmFnZ3JlZ2F0ZShbCiAgeyAkdW53aW5kOiAiJGl0ZW1zIiB9Cl0p"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>db.orders.aggregate([
  { $unwind: &quot;$items&quot; }
])</pre></div><div class='content'><p><em>Example</em>: This stage deconstructs the <code>items</code> array field, outputting a document for each item.</p>
</div><h2>$lookup</h2>
<div class='content'><p>Performs a left outer join to another collection in the same database to filter in documents from the &quot;joined&quot; collection for processing.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ZGIub3JkZXJzLmFnZ3JlZ2F0ZShbCiAgewogICAgJGxvb2t1cDogewogICAgICBmcm9tOiAiY3VzdG9tZXJzIiwKICAgICAgbG9jYWxGaWVsZDogImN1c3RfaWQiLAogICAgICBmb3JlaWduRmllbGQ6ICJjdXN0X2lkIiwKICAgICAgYXM6ICJjdXN0b21lcl9pbmZvIgogICAgfQogIH0KXSk="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>db.orders.aggregate([
  {
    $lookup: {
      from: &quot;customers&quot;,
      localField: &quot;cust_id&quot;,
      foreignField: &quot;cust_id&quot;,
      as: &quot;customer_info&quot;
    }
  }
])</pre></div><div class='content'><p><em>Example</em>: This stage joins the <code>orders</code> collection with the <code>customers</code> collection based on the <code>cust_id</code> field.</p>
</div><h2>$facet</h2>
<div class='content'><p>Processes multiple aggregation pipelines within a single stage on the same set of input documents.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ZGIub3JkZXJzLmFnZ3JlZ2F0ZShbCiAgewogICAgJGZhY2V0OiB7CiAgICAgICJjYXRlZ29yaXplZEJ5UHJpY2UiOiBbCiAgICAgICAgeyAkbWF0Y2g6IHsgcHJpY2U6IHsgJGV4aXN0czogMSB9IH0gfSwKICAgICAgICB7ICRidWNrZXQ6IHsgZ3JvdXBCeTogIiRwcmljZSIsIGJvdW5kYXJpZXM6IFswLCA1MCwgMTAwLCAyMDBdLCBkZWZhdWx0OiAiT3RoZXIiIH0gfQogICAgICBdLAogICAgICAiY2F0ZWdvcml6ZWRCeVF1YW50aXR5IjogWwogICAgICAgIHsgJG1hdGNoOiB7IHF1YW50aXR5OiB7ICRleGlzdHM6IDEgfSB9IH0sCiAgICAgICAgeyAkYnVja2V0OiB7IGdyb3VwQnk6ICIkcXVhbnRpdHkiLCBib3VuZGFyaWVzOiBbMCwgMjAsIDUwLCAxMDBdLCBkZWZhdWx0OiAiT3RoZXIiIH0gfQogICAgICBdCiAgICB9CiAgfQpdKQ=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>db.orders.aggregate([
  {
    $facet: {
      &quot;categorizedByPrice&quot;: [
        { $match: { price: { $exists: 1 } } },
        { $bucket: { groupBy: &quot;$price&quot;, boundaries: [0, 50, 100, 200], default: &quot;Other&quot; } }
      ],
      &quot;categorizedByQuantity&quot;: [
        { $match: { quantity: { $exists: 1 } } },
        { $bucket: { groupBy: &quot;$quantity&quot;, boundaries: [0, 20, 50, 100], default: &quot;Other&quot; } }
      ]
    }
  }
])</pre></div><div class='content'><p><em>Example</em>: This stage categorizes documents by price and quantity using two separate pipelines.</p>
</div><h1>Practical Examples</h1>
<h2>Example 1: Sales Report</h2>
<div class='content'><p>Generate a sales report showing the total sales amount for each product category.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ZGIuc2FsZXMuYWdncmVnYXRlKFsKICB7ICRtYXRjaDogeyBkYXRlOiB7ICRndGU6IElTT0RhdGUoIjIwMjMtMDEtMDEiKSwgJGx0OiBJU09EYXRlKCIyMDI0LTAxLTAxIikgfSB9IH0sCiAgeyAkZ3JvdXA6IHsgX2lkOiAiJGNhdGVnb3J5IiwgdG90YWxTYWxlczogeyAkc3VtOiAiJGFtb3VudCIgfSB9IH0sCiAgeyAkc29ydDogeyB0b3RhbFNhbGVzOiAtMSB9IH0KXSk="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>db.sales.aggregate([
  { $match: { date: { $gte: ISODate(&quot;2023-01-01&quot;), $lt: ISODate(&quot;2024-01-01&quot;) } } },
  { $group: { _id: &quot;$category&quot;, totalSales: { $sum: &quot;$amount&quot; } } },
  { $sort: { totalSales: -1 } }
])</pre></div><div class='content'><p><em>Explanation</em>: This pipeline filters sales within the year 2023, groups them by category, calculates the total sales amount for each category, and sorts the results in descending order.</p>
</div><h2>Example 2: Customer Purchase Frequency</h2>
<div class='content'><p>Find the number of purchases made by each customer.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("ZGIub3JkZXJzLmFnZ3JlZ2F0ZShbCiAgeyAkZ3JvdXA6IHsgX2lkOiAiJGN1c3RfaWQiLCBwdXJjaGFzZUNvdW50OiB7ICRzdW06IDEgfSB9IH0sCiAgeyAkc29ydDogeyBwdXJjaGFzZUNvdW50OiAtMSB9IH0KXSk="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>db.orders.aggregate([
  { $group: { _id: &quot;$cust_id&quot;, purchaseCount: { $sum: 1 } } },
  { $sort: { purchaseCount: -1 } }
])</pre></div><div class='content'><p><em>Explanation</em>: This pipeline groups orders by customer ID, counts the number of purchases for each customer, and sorts the results in descending order.</p>
</div><h1>Conclusion</h1>
<div class='content'><p>The Aggregation Pipeline in MongoDB is a versatile and powerful tool for data processing and analysis. By chaining multiple stages together, you can perform complex data transformations and computations efficiently. Understanding the basic and advanced stages, along with practical examples, will help you leverage the full potential of MongoDB's aggregation framework in your applications.</p>
</div><div class='row navigation'>
	<div class='col-4'>
					<a href='introduction-to-aggregation'>&#x25C4;Introduction to Aggregation</a>
			</div>
	<div class='col-4 text-center'>
		<a href="./" class="title">Aggregation Pipeline</a>
	</div>
	<div class='col-4 text-end'>
					<a href='common-aggregation-stages'>Common Aggregation Stages &#x25BA;</a>
			</div>
</div>
</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Advertising</h1>
			<p>This space is reserved for advertising.</p>
			<p>If you want to be a sponsor, contact us to include links in this area: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Thank you for collaborating!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. All rights reserved</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir galetes per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Entès!</a>
    <a href="/cookies">Més informació</a>
</div>	

	</div>    
</body>
</html>
