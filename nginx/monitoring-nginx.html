<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monitoring NGINX</title>

    <link rel="alternate" href="https://campusempresa.com/nginx/monitoring-nginx" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/nginx/monitoring-nginx" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/nginx/monitoring-nginx" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body>
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-8 p-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo_header.png" style="visibility:hiddenxx;"></a>
			</h1>
		</div>
		<div class="col-4 p-0 text-end">
			<h2 id="main_title"><cite>Building today's and tomorrow's society</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-0 m-0 text-end">
													<b id="lit_lang_es" class="px-2">EN</b>
				|
				<a href="https://campusempresa.com/nginx/monitoring-nginx" class="px-2">ES</a></b>
				|
				<a href="https://campusempresa.cat/nginx/monitoring-nginx" class="px-2">CA</a>
					</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="/objective">The Project</a>
				<a href="/about">About Us</a>
				<a href="/contribute">Contribute</a>
				<a href="/donate">Donations</a>
				<a href="/licence">License</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content"><div class='row navigation'>
	<div class='col-4'>
					<a href='custom-error-pages'>&#x25C4;Custom Error Pages</a>
			</div>
	<div class='col-4 text-center'>
		<a href="./" class="title">Monitoring NGINX</a>
	</div>
	<div class='col-4 text-end'>
					<a href='logging-and-log-management'>Logging and Log Management &#x25BA;</a>
			</div>
</div>
<div class='content'><p>Monitoring NGINX is crucial for ensuring the performance, reliability, and security of your web server. This section will guide you through various methods and tools for monitoring NGINX, from basic log analysis to advanced monitoring solutions.</p>
</div><h1>Key Concepts of Monitoring NGINX</h1>
<div class='content'><ul>
<li><strong>Access Logs</strong>: Track requests made to your server.</li>
<li><strong>Error Logs</strong>: Record any issues or errors encountered by NGINX.</li>
<li><strong>Status Module</strong>: Provides real-time metrics about NGINX performance.</li>
<li><strong>Third-Party Monitoring Tools</strong>: Tools like Prometheus, Grafana, and Datadog for advanced monitoring.</li>
</ul>
</div><h1>Access Logs</h1>
<div class='content'><p>Access logs record all requests processed by NGINX. These logs are invaluable for understanding traffic patterns, identifying potential issues, and auditing purposes.</p>
</div><h2>Configuring Access Logs</h2>
<div class='content'><p>By default, NGINX logs all requests to the access log. You can configure the format and location of these logs in the NGINX configuration file.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("aHR0cCB7CiAgICBsb2dfZm9ybWF0IG1haW4gJyRyZW1vdGVfYWRkciAtICRyZW1vdGVfdXNlciBbJHRpbWVfbG9jYWxdICIkcmVxdWVzdCIgJwogICAgICAgICAgICAgICAgICAgICAgJyRzdGF0dXMgJGJvZHlfYnl0ZXNfc2VudCAiJGh0dHBfcmVmZXJlciIgJwogICAgICAgICAgICAgICAgICAgICAgJyIkaHR0cF91c2VyX2FnZW50IiAiJGh0dHBfeF9mb3J3YXJkZWRfZm9yIic7CgogICAgYWNjZXNzX2xvZyAvdmFyL2xvZy9uZ2lueC9hY2Nlc3MubG9nIG1haW47Cn0="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>http {
    log_format main '$remote_addr - $remote_user [$time_local] &quot;$request&quot; '
                      '$status $body_bytes_sent &quot;$http_referer&quot; '
                      '&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;';

    access_log /var/log/nginx/access.log main;
}</pre></div><div class='content'><ul>
<li><strong>log_format</strong>: Defines the format of the log entries.</li>
<li><strong>access_log</strong>: Specifies the file where logs will be stored and the format to use.</li>
</ul>
</div><h2>Analyzing Access Logs</h2>
<div class='content'><p>You can use tools like <code>awk</code>, <code>grep</code>, or specialized log analysis tools like GoAccess to analyze access logs.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("IyBFeGFtcGxlOiBDb3VudCB0aGUgbnVtYmVyIG9mIHJlcXVlc3RzIHBlciBJUAphd2sgJ3twcmludCAkMX0nIC92YXIvbG9nL25naW54L2FjY2Vzcy5sb2cgfCBzb3J0IHwgdW5pcSAtYyB8IHNvcnQgLW5y"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'># Example: Count the number of requests per IP
awk '{print $1}' /var/log/nginx/access.log | sort | uniq -c | sort -nr</pre></div><div class='content'></div><h1>Error Logs</h1>
<div class='content'><p>Error logs capture any issues or errors that occur while NGINX processes requests. This includes configuration errors, runtime errors, and more.</p>
</div><h2>Configuring Error Logs</h2>
<div class='content'><p>Error logs can be configured to capture different levels of detail.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("aHR0cCB7CiAgICBlcnJvcl9sb2cgL3Zhci9sb2cvbmdpbngvZXJyb3IubG9nIHdhcm47Cn0="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>http {
    error_log /var/log/nginx/error.log warn;
}</pre></div><div class='content'><ul>
<li><strong>error_log</strong>: Specifies the file where error logs will be stored and the level of detail (e.g., <code>debug</code>, <code>info</code>, <code>notice</code>, <code>warn</code>, <code>error</code>, <code>crit</code>, <code>alert</code>, <code>emerg</code>).</li>
</ul>
</div><h2>Analyzing Error Logs</h2>
<div class='content'><p>Error logs can be analyzed using tools like <code>grep</code> to filter specific types of errors.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("IyBFeGFtcGxlOiBGaW5kIGFsbCAiNDA0IE5vdCBGb3VuZCIgZXJyb3JzCmdyZXAgIjQwNCIgL3Zhci9sb2cvbmdpbngvZXJyb3IubG9n"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'># Example: Find all &quot;404 Not Found&quot; errors
grep &quot;404&quot; /var/log/nginx/error.log</pre></div><div class='content'></div><h1>NGINX Status Module</h1>
<div class='content'><p>The NGINX status module provides real-time metrics about the server's performance, including active connections, requests per second, and more.</p>
</div><h2>Enabling the Status Module</h2>
<div class='content'><p>To enable the status module, you need to configure a location block in your NGINX configuration.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("aHR0cCB7CiAgICBzZXJ2ZXIgewogICAgICAgIGxvY2F0aW9uIC9uZ2lueF9zdGF0dXMgewogICAgICAgICAgICBzdHViX3N0YXR1czsKICAgICAgICAgICAgYWxsb3cgMTI3LjAuMC4xOyAjIE9ubHkgYWxsb3cgbG9jYWwgYWNjZXNzCiAgICAgICAgICAgIGRlbnkgYWxsOyAjIERlbnkgYWxsIG90aGVyIGFjY2VzcwogICAgICAgIH0KICAgIH0KfQ=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>http {
    server {
        location /nginx_status {
            stub_status;
            allow 127.0.0.1; # Only allow local access
            deny all; # Deny all other access
        }
    }
}</pre></div><div class='content'></div><h2>Accessing the Status Page</h2>
<div class='content'><p>Once configured, you can access the status page by navigating to <code>http://your_server_ip/nginx_status</code>.</p>
</div><h2>Metrics Provided</h2>
<div class='content'><ul>
<li><strong>Active connections</strong>: The current number of active client connections.</li>
<li><strong>Accepted connections</strong>: The total number of accepted client connections.</li>
<li><strong>Handled connections</strong>: The total number of handled connections.</li>
<li><strong>Requests</strong>: The total number of client requests.</li>
</ul>
</div><h1>Third-Party Monitoring Tools</h1>
<div class='content'><p>For more advanced monitoring, you can integrate NGINX with third-party tools like Prometheus, Grafana, and Datadog.</p>
</div><h2>Prometheus and Grafana</h2>
<div class='content'><p>Prometheus is an open-source monitoring system that collects metrics, and Grafana is a visualization tool that can display these metrics.</p>
<h4>Setting Up Prometheus with NGINX</h4>
<ol>
<li>
<p><strong>Install the NGINX Prometheus Exporter</strong>:</p>
<pre><code class="language-bash">docker run -d -p 9113:9113 nginx/nginx-prometheus-exporter:latest -nginx.scrape-uri http://localhost:8080/nginx_status
</code></pre>
</li>
<li>
<p><strong>Configure Prometheus</strong>:</p>
<pre><code class="language-yaml">scrape_configs:
  - job_name: 'nginx'
    static_configs:
      - targets: ['localhost:9113']
</code></pre>
</li>
<li>
<p><strong>Visualize with Grafana</strong>:</p>
<ul>
<li>Add Prometheus as a data source in Grafana.</li>
<li>Import NGINX dashboards from Grafana's dashboard repository.</li>
</ul>
</li>
</ol>
</div><h2>Datadog</h2>
<div class='content'><p>Datadog is a monitoring and analytics platform that provides comprehensive monitoring for NGINX.</p>
<h4>Setting Up Datadog with NGINX</h4>
<ol>
<li>
<p><strong>Install the Datadog Agent</strong>:</p>
<pre><code class="language-bash">DD_API_KEY=your_api_key bash -c &quot;$(curl -L https://s3.amazonaws.com/dd-agent/scripts/install_script.sh)&quot;
</code></pre>
</li>
<li>
<p><strong>Enable the NGINX Integration</strong>:</p>
<pre><code class="language-yaml"># /etc/datadog-agent/conf.d/nginx.d/conf.yaml
init_config:

instances:
  - nginx_status_url: http://localhost/nginx_status
</code></pre>
</li>
<li>
<p><strong>View Metrics in Datadog</strong>:</p>
<ul>
<li>Navigate to the Datadog dashboard to view NGINX metrics.</li>
</ul>
</li>
</ol>
</div><h1>Conclusion</h1>
<div class='content'><p>Monitoring NGINX is essential for maintaining the health and performance of your web server. By leveraging access logs, error logs, the NGINX status module, and third-party monitoring tools, you can gain valuable insights into your server's operation and quickly identify and resolve issues. Whether you are a beginner or an advanced user, these tools and techniques will help you ensure that your NGINX server runs smoothly and efficiently.</p>
</div><div class='row navigation'>
	<div class='col-4'>
					<a href='custom-error-pages'>&#x25C4;Custom Error Pages</a>
			</div>
	<div class='col-4 text-center'>
		<a href="./" class="title">Monitoring NGINX</a>
	</div>
	<div class='col-4 text-end'>
					<a href='logging-and-log-management'>Logging and Log Management &#x25BA;</a>
			</div>
</div>
</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Advertising</h1>
			<p>This space is reserved for advertising.</p>
			<p>If you want to be a sponsor, contact us to include links in this area: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Thank you for collaborating!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. All rights reserved</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir galetes per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Accept</a>
    <a href="/cookies">More Information</a>
</div>	

	</div>    
</body>
</html>
