<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Optimizing Ansible Performance</title>

    <link rel="alternate" href="https://campusempresa.com/ansible/optimizing-ansible-performance" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/ansible/optimizing-ansible-performance" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/ansible/optimizing-ansible-performance" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body>
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-8 p-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo_header.png" style="visibility:hiddenxx;"></a>
			</h1>
		</div>
		<div class="col-4 p-0 text-end">
			<h2 id="main_title"><cite>Building today's and tomorrow's society</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-0 m-0 text-end">
													<b id="lit_lang_es" class="px-2">EN</b>
				|
				<a href="https://campusempresa.com/ansible/optimizing-ansible-performance" class="px-2">ES</a></b>
				|
				<a href="https://campusempresa.cat/ansible/optimizing-ansible-performance" class="px-2">CA</a>
					</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="/objective">The Project</a>
				<a href="/about">About Us</a>
				<a href="/contribute">Contribute</a>
				<a href="/donate">Donations</a>
				<a href="/licence">License</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content"><div class='row navigation'>
	<div class='col-4'>
					<a href='error-handling-and-debugging'>&#x25C4;Error Handling and Debugging</a>
			</div>
	<div class='col-4 text-center'>
		<a href="./" class="title">Optimizing Ansible Performance</a>
	</div>
	<div class='col-4 text-end'>
					<a href='managing-linux-servers'>Managing Linux Servers &#x25BA;</a>
			</div>
</div>
<div class='content'><p>Optimizing Ansible performance is crucial for ensuring efficient and fast automation processes. This topic will cover various techniques and best practices to enhance the performance of your Ansible playbooks and roles.</p>
</div><h1>Key Concepts</h1>
<div class='content'><ul>
<li><strong>Parallelism and Forks</strong>: Running tasks in parallel to speed up execution.</li>
<li><strong>Fact Caching</strong>: Storing gathered facts to avoid repeated collection.</li>
<li><strong>Efficient Playbook Design</strong>: Structuring playbooks to minimize unnecessary tasks.</li>
<li><strong>Task Delegation</strong>: Offloading tasks to other hosts to distribute the load.</li>
<li><strong>Using Ansible Modules Efficiently</strong>: Choosing the right modules for the job.</li>
<li><strong>Reducing SSH Overhead</strong>: Optimizing SSH connections for better performance.</li>
<li><strong>Avoiding Unnecessary Handlers</strong>: Minimizing the use of handlers to reduce overhead.</li>
<li><strong>Profiling and Benchmarking</strong>: Measuring performance to identify bottlenecks.</li>
</ul>
</div><h1>Parallelism and Forks</h1>
<div class='content'><p>Ansible can run multiple tasks in parallel by adjusting the number of forks. The default number of forks is 5, but this can be increased to improve performance.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("IyBhbnNpYmxlLmNmZwpbZGVmYXVsdHNdCmZvcmtzID0gMTA="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'># ansible.cfg
[defaults]
forks = 10</pre></div><div class='content'><ul>
<li>Increasing the number of forks can significantly speed up playbook execution, especially in large environments.</li>
<li>Be cautious with very high values as they can overwhelm the control machine or network.</li>
</ul>
</div><h1>Fact Caching</h1>
<div class='content'><p>Fact caching allows Ansible to store facts gathered from hosts, reducing the need to collect them repeatedly.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("IyBhbnNpYmxlLmNmZwpbZGVmYXVsdHNdCmdhdGhlcmluZyA9IHNtYXJ0CmZhY3RfY2FjaGluZyA9IGpzb25maWxlCmZhY3RfY2FjaGluZ19jb25uZWN0aW9uID0gL3BhdGgvdG8vZmFjdF9jYWNoZQpmYWN0X2NhY2hpbmdfdGltZW91dCA9IDg2NDAwICAjIENhY2hlIGZhY3RzIGZvciAyNCBob3Vycw=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'># ansible.cfg
[defaults]
gathering = smart
fact_caching = jsonfile
fact_caching_connection = /path/to/fact_cache
fact_caching_timeout = 86400  # Cache facts for 24 hours</pre></div><div class='content'><ul>
<li>Fact caching can drastically reduce the time spent on gathering facts, especially in large environments.</li>
<li>Choose a suitable caching backend (e.g., JSON file, Redis, etc.) based on your needs.</li>
</ul>
</div><h1>Efficient Playbook Design</h1>
<div class='content'><p>Designing efficient playbooks involves minimizing unnecessary tasks and optimizing task execution.</p>
<ul>
<li><strong>Use <code>when</code> statements</strong> to conditionally execute tasks only when necessary.</li>
<li><strong>Combine tasks</strong> where possible to reduce the number of SSH connections.</li>
<li><strong>Avoid using <code>command</code> or <code>shell</code> modules</strong> when a dedicated module exists.</li>
</ul>
<p>Example of combining tasks:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("LSBuYW1lOiBJbnN0YWxsIGFuZCBzdGFydCBBcGFjaGUKICBob3N0czogd2Vic2VydmVycwogIHRhc2tzOgogICAgLSBuYW1lOiBJbnN0YWxsIEFwYWNoZQogICAgICBhcHQ6CiAgICAgICAgbmFtZTogYXBhY2hlMgogICAgICAgIHN0YXRlOiBwcmVzZW50CiAgICAtIG5hbWU6IFN0YXJ0IEFwYWNoZQogICAgICBzZXJ2aWNlOgogICAgICAgIG5hbWU6IGFwYWNoZTIKICAgICAgICBzdGF0ZTogc3RhcnRlZA=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>- name: Install and start Apache
  hosts: webservers
  tasks:
    - name: Install Apache
      apt:
        name: apache2
        state: present
    - name: Start Apache
      service:
        name: apache2
        state: started</pre></div><div class='content'></div><h1>Task Delegation</h1>
<div class='content'><p>Delegating tasks to other hosts can help distribute the load and improve performance.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("LSBuYW1lOiBEZWxlZ2F0ZSB0YXNrIHRvIGFub3RoZXIgaG9zdAogIGhvc3RzOiB3ZWJzZXJ2ZXJzCiAgdGFza3M6CiAgICAtIG5hbWU6IFJ1biB0YXNrIG9uIGEgZGlmZmVyZW50IGhvc3QKICAgICAgY29tbWFuZDogL3Vzci9iaW4vc29tZV9jb21tYW5kCiAgICAgIGRlbGVnYXRlX3RvOiBvdGhlcl9ob3N0"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>- name: Delegate task to another host
  hosts: webservers
  tasks:
    - name: Run task on a different host
      command: /usr/bin/some_command
      delegate_to: other_host</pre></div><div class='content'><ul>
<li>Task delegation is useful for tasks that can be offloaded to other hosts, such as database updates or file transfers.</li>
</ul>
</div><h1>Using Ansible Modules Efficiently</h1>
<div class='content'><p>Choosing the right modules for your tasks can improve performance.</p>
<ul>
<li>Prefer using built-in modules over <code>command</code> or <code>shell</code> modules.</li>
<li>Use modules that support batch operations to reduce the number of tasks.</li>
</ul>
<p>Example of using a batch operation:</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("LSBuYW1lOiBDcmVhdGUgbXVsdGlwbGUgdXNlcnMKICBob3N0czogYWxsCiAgdGFza3M6CiAgICAtIG5hbWU6IEFkZCB1c2VycwogICAgICB1c2VyOgogICAgICAgIG5hbWU6ICJ7eyBpdGVtLm5hbWUgfX0iCiAgICAgICAgc3RhdGU6IHByZXNlbnQKICAgICAgd2l0aF9pdGVtczoKICAgICAgICAtIHsgbmFtZTogJ3VzZXIxJyB9CiAgICAgICAgLSB7IG5hbWU6ICd1c2VyMicgfQ=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>- name: Create multiple users
  hosts: all
  tasks:
    - name: Add users
      user:
        name: &quot;{{ item.name }}&quot;
        state: present
      with_items:
        - { name: 'user1' }
        - { name: 'user2' }</pre></div><div class='content'></div><h1>Reducing SSH Overhead</h1>
<div class='content'><p>Optimizing SSH connections can reduce overhead and improve performance.</p>
<ul>
<li>Use persistent SSH connections with <code>ControlPersist</code>.</li>
</ul>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("IyBhbnNpYmxlLmNmZwpbc3NoX2Nvbm5lY3Rpb25dCnNzaF9hcmdzID0gLW8gQ29udHJvbE1hc3Rlcj1hdXRvIC1vIENvbnRyb2xQZXJzaXN0PTYwcw=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'># ansible.cfg
[ssh_connection]
ssh_args = -o ControlMaster=auto -o ControlPersist=60s</pre></div><div class='content'><ul>
<li>Adjust SSH connection settings to reduce latency.</li>
</ul>
</div><h1>Avoiding Unnecessary Handlers</h1>
<div class='content'><p>Handlers can introduce overhead if used excessively. Minimize their use by combining tasks or using conditional handlers.</p>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("LSBuYW1lOiBSZXN0YXJ0IEFwYWNoZSBvbmx5IGlmIGNvbmZpZ3VyYXRpb24gY2hhbmdlcwogIGhvc3RzOiB3ZWJzZXJ2ZXJzCiAgdGFza3M6CiAgICAtIG5hbWU6IFVwZGF0ZSBBcGFjaGUgY29uZmlndXJhdGlvbgogICAgICB0ZW1wbGF0ZToKICAgICAgICBzcmM6IGFwYWNoZS5jb25mLmoyCiAgICAgICAgZGVzdDogL2V0Yy9hcGFjaGUyL2FwYWNoZTIuY29uZgogICAgICBub3RpZnk6IFJlc3RhcnQgQXBhY2hlCgogIGhhbmRsZXJzOgogICAgLSBuYW1lOiBSZXN0YXJ0IEFwYWNoZQogICAgICBzZXJ2aWNlOgogICAgICAgIG5hbWU6IGFwYWNoZTIKICAgICAgICBzdGF0ZTogcmVzdGFydGVk"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>- name: Restart Apache only if configuration changes
  hosts: webservers
  tasks:
    - name: Update Apache configuration
      template:
        src: apache.conf.j2
        dest: /etc/apache2/apache2.conf
      notify: Restart Apache

  handlers:
    - name: Restart Apache
      service:
        name: apache2
        state: restarted</pre></div><div class='content'></div><h1>Profiling and Benchmarking</h1>
<div class='content'><p>Profiling and benchmarking help identify performance bottlenecks.</p>
<ul>
<li>Use the <code>ansible-playbook</code> command with the <code>--profile</code> option to gather performance data.</li>
<li>Analyze the output to identify slow tasks and optimize them.</li>
</ul>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("YW5zaWJsZS1wbGF5Ym9vayBwbGF5Ym9vay55bWwgLS1wcm9maWxl"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>ansible-playbook playbook.yml --profile</pre></div><div class='content'></div><h1>Conclusion</h1>
<div class='content'><p>Optimizing Ansible performance involves a combination of techniques and best practices. By adjusting parallelism, using fact caching, designing efficient playbooks, delegating tasks, choosing the right modules, reducing SSH overhead, minimizing handlers, and profiling playbooks, you can significantly improve the performance of your Ansible automation. Implement these strategies to ensure your Ansible playbooks run efficiently and effectively.</p>
</div><div class='row navigation'>
	<div class='col-4'>
					<a href='error-handling-and-debugging'>&#x25C4;Error Handling and Debugging</a>
			</div>
	<div class='col-4 text-center'>
		<a href="./" class="title">Optimizing Ansible Performance</a>
	</div>
	<div class='col-4 text-end'>
					<a href='managing-linux-servers'>Managing Linux Servers &#x25BA;</a>
			</div>
</div>
</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Advertising</h1>
			<p>This space is reserved for advertising.</p>
			<p>If you want to be a sponsor, contact us to include links in this area: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Thank you for collaborating!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. All rights reserved</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir galetes per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Accept</a>
    <a href="/cookies">More Information</a>
</div>	

	</div>    
</body>
</html>
