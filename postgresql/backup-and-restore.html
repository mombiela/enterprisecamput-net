<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Backup and Restore</title>

    <link rel="alternate" href="https://campusempresa.com/postgresql/backup-and-restore" hreflang="es" />
	<link rel="alternate" href="https://campusempresa.cat/postgresql/backup-and-restore" hreflang="ca" />
	<link rel="alternate" href="https://enterprisecampus.net/postgresql/backup-and-restore" hreflang="en" />
    
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
	<link href="/css/site.css" rel="stylesheet">
	
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  	<script type="text/javascript" src="js/math_init.js"></script>
  	<script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js"></script>
  	<script type="text/javascript" src="/js/cookie.js"></script>
  	<script type="text/javascript" src="/js/main.js"></script>
</head>

<body>
    <div id="content">
		<div id="header" class="container-xxl">
	<div class="row">
		<div class="col-8 p-0">
			<h1 class="m-0 p-0">
				<a href="/"><img src="/img/logo_header.png" style="visibility:hiddenxx;"></a>
			</h1>
		</div>
		<div class="col-4 p-0 text-end">
			<h2 id="main_title"><cite>Building today's and tomorrow's society</cite></h2>
			<h3 id="main_subtitle"></h3>
		</div>
	</div>
</div>
<div class="container-xxl" style="margin-top: -1em;">
	<div class="row">
		<div class="col-12 p-0 m-0 text-end">
													<b id="lit_lang_es" class="px-2">EN</b>
				|
				<a href="https://campusempresa.com/postgresql/backup-and-restore" class="px-2">ES</a></b>
				|
				<a href="https://campusempresa.cat/postgresql/backup-and-restore" class="px-2">CA</a>
					</div>
	</div>
</div>
   <div class="top-bar container-fluid">
	<div class="container-xxl">
		<div class="row">
			<div class="col" id="left_menu">
				<a href="/objective">The Project</a>
				<a href="/about">About Us</a>
				<a href="/contribute">Contribute</a>
				<a href="/donate">Donations</a>
				<a href="/licence">License</a>
			</div>
		</div>
	</div>
   </div>

<div class="container-xxl" id="main_content">
	<div class="row">
		<div class="col-12 col-lg-8">
			<div id="nav1" class="navigation"></div>
			<div id="inner_content"><div class='row navigation'>
	<div class='col-4'>
					<a href='securing-connections'>&#x25C4;Securing Connections</a>
			</div>
	<div class='col-4 text-center'>
		<a href="./" class="title">Backup and Restore</a>
	</div>
	<div class='col-4 text-end'>
					<a href='data-encryption'>Data Encryption &#x25BA;</a>
			</div>
</div>
<div class='content'></div><h1>Introduction</h1>
<div class='content'><p>Backup and restore are critical operations for database management. They ensure data safety, integrity, and availability in case of hardware failures, software issues, or human errors. This section will cover the basics of creating backups and restoring data in PostgreSQL, progressing from beginner to advanced techniques.</p>
</div><h1>Why Backup and Restore are Important</h1>
<div class='content'><ul>
<li><strong>Data Protection</strong>: Safeguards against data loss.</li>
<li><strong>Disaster Recovery</strong>: Enables recovery from catastrophic failures.</li>
<li><strong>Data Integrity</strong>: Ensures data consistency and accuracy.</li>
<li><strong>Compliance</strong>: Meets regulatory requirements for data retention and recovery.</li>
</ul>
</div><h1>Types of Backups</h1>
<div class='content'><ol>
<li><strong>Logical Backups</strong>:
<ul>
<li>Uses SQL commands to dump database contents.</li>
<li>Suitable for smaller databases and easier to manage.</li>
</ul>
</li>
<li><strong>Physical Backups</strong>:
<ul>
<li>Copies the actual database files.</li>
<li>Suitable for larger databases and faster to restore.</li>
</ul>
</li>
</ol>
</div><h1>Logical Backups with `pg_dump`</h1>
<h2>Basic Usage</h2>
<div class='content'><p><code>pg_dump</code> is a utility for backing up a PostgreSQL database into a script or archive file.</p>
<h4>Example: Backing Up a Database</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("cGdfZHVtcCAtVSB1c2VybmFtZSAtVyAtRiBjIC1iIC12IC1mIG15ZGIuYmFja3VwIG15ZGI="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>pg_dump -U username -W -F c -b -v -f mydb.backup mydb</pre></div><div class='content'><ul>
<li><code>-U username</code>: Specifies the database user.</li>
<li><code>-W</code>: Prompts for the password.</li>
<li><code>-F c</code>: Specifies the format (custom).</li>
<li><code>-b</code>: Includes large objects.</li>
<li><code>-v</code>: Verbose mode.</li>
<li><code>-f mydb.backup</code>: Output file.</li>
<li><code>mydb</code>: Name of the database.</li>
</ul>
</div><h2>Restoring a Logical Backup</h2>
<div class='content'><p><code>pg_restore</code> is used to restore a PostgreSQL database from an archive created by <code>pg_dump</code>.</p>
<h4>Example: Restoring a Database</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("cGdfcmVzdG9yZSAtVSB1c2VybmFtZSAtVyAtZCBteWRiIC12IG15ZGIuYmFja3Vw"))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>pg_restore -U username -W -d mydb -v mydb.backup</pre></div><div class='content'><ul>
<li><code>-U username</code>: Specifies the database user.</li>
<li><code>-W</code>: Prompts for the password.</li>
<li><code>-d mydb</code>: Target database.</li>
<li><code>-v</code>: Verbose mode.</li>
<li><code>mydb.backup</code>: Backup file.</li>
</ul>
</div><h1>Physical Backups with `pg_basebackup`</h1>
<h2>Basic Usage</h2>
<div class='content'><p><code>pg_basebackup</code> is a utility for taking base backups of a running PostgreSQL database cluster.</p>
<h4>Example: Taking a Physical Backup</h4>
</div><div style='position:relative'><a class='copy_button' href='#' onclick='navigator.clipboard.writeText(decodeURIComponent(escape(atob("cGdfYmFzZWJhY2t1cCAtVSB1c2VybmFtZSAtVyAtRCAvcGF0aC90by9iYWNrdXAgLUZwIC1YcyAtUA=="))));alert("Copied!");return false;'><i class='bi bi-copy'></i></a><pre class='code'>pg_basebackup -U username -W -D /path/to/backup -Fp -Xs -P</pre></div><div class='content'><ul>
<li><code>-U username</code>: Specifies the database user.</li>
<li><code>-W</code>: Prompts for the password.</li>
<li><code>-D /path/to/backup</code>: Destination directory.</li>
<li><code>-Fp</code>: Plain format.</li>
<li><code>-Xs</code>: Includes WAL files.</li>
<li><code>-P</code>: Shows progress.</li>
</ul>
</div><h2>Restoring a Physical Backup</h2>
<div class='content'><p>To restore a physical backup, you need to stop the PostgreSQL server, replace the data directory with the backup, and start the server again.</p>
<h4>Example: Restoring a Physical Backup</h4>
<ol>
<li><strong>Stop the PostgreSQL server</strong>:
<pre><code class="language-sh">pg_ctl stop -D /path/to/data
</code></pre>
</li>
<li><strong>Replace the data directory</strong>:
<pre><code class="language-sh">rm -rf /path/to/data/*
cp -r /path/to/backup/* /path/to/data/
</code></pre>
</li>
<li><strong>Start the PostgreSQL server</strong>:
<pre><code class="language-sh">pg_ctl start -D /path/to/data
</code></pre>
</li>
</ol>
</div><h1>Advanced Backup and Restore Techniques</h1>
<h2>Point-in-Time Recovery (PITR)</h2>
<div class='content'><p>PITR allows you to restore the database to a specific point in time.</p>
<h4>Steps for PITR</h4>
<ol>
<li><strong>Take a base backup</strong>:
<pre><code class="language-sh">pg_basebackup -U username -W -D /path/to/backup -Fp -Xs -P
</code></pre>
</li>
<li><strong>Enable WAL archiving</strong> in <code>postgresql.conf</code>:
<pre><code class="language-conf">archive_mode = on
archive_command = 'cp %p /path/to/archive/%f'
</code></pre>
</li>
<li><strong>Restore the base backup</strong>:
<pre><code class="language-sh">rm -rf /path/to/data/*
cp -r /path/to/backup/* /path/to/data/
</code></pre>
</li>
<li><strong>Restore WAL files</strong>:
<pre><code class="language-sh">cp /path/to/archive/* /path/to/data/pg_wal/
</code></pre>
</li>
<li><strong>Create a <code>recovery.conf</code> file</strong> in the data directory:
<pre><code class="language-conf">restore_command = 'cp /path/to/archive/%f %p'
recovery_target_time = 'YYYY-MM-DD HH:MM:SS'
</code></pre>
</li>
<li><strong>Start the PostgreSQL server</strong>:
<pre><code class="language-sh">pg_ctl start -D /path/to/data
</code></pre>
</li>
</ol>
</div><h1>Summary</h1>
<div class='content'><ul>
<li><strong>Logical Backups</strong>: Use <code>pg_dump</code> and <code>pg_restore</code> for smaller databases.</li>
<li><strong>Physical Backups</strong>: Use <code>pg_basebackup</code> for larger databases.</li>
<li><strong>Advanced Techniques</strong>: Implement PITR for precise recovery needs.</li>
</ul>
<p>By mastering these backup and restore techniques, you can ensure the safety and integrity of your PostgreSQL databases, making you well-prepared to handle any data-related emergencies.</p>
</div><div class='row navigation'>
	<div class='col-4'>
					<a href='securing-connections'>&#x25C4;Securing Connections</a>
			</div>
	<div class='col-4 text-center'>
		<a href="./" class="title">Backup and Restore</a>
	</div>
	<div class='col-4 text-end'>
					<a href='data-encryption'>Data Encryption &#x25BA;</a>
			</div>
</div>
</div>
		</div>
		<div class="col-12 col-lg-4 publi" id="div_publi">
			<h1>Advertising</h1>
			<p>This space is reserved for advertising.</p>
			<p>If you want to be a sponsor, contact us to include links in this area: <a href='mailto:admin@campusempresa.cat'>admin@campusempresa.cat</a></p>
			<p>Thank you for collaborating!</p>
		</div>
	</div>
</div>

   <div class="container-xxl my-3">
	<div class="row">
		<div class="col">
			<footer>&copy; Copyright 2024. All rights reserved</footer>
		</div>
	</div>
</div>	

<div id="cookies_adv" style="display:none;">
	Fem servir galetes per millorar la teva experiència d'ús i oferir continguts adaptats als teus interessos
    <a href="#" id="btn_accept_cookies" class="button">Accept</a>
    <a href="/cookies">More Information</a>
</div>	

	</div>    
</body>
</html>
